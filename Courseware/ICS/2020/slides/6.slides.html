<!DOCTYPE html><html class="h-100">


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com/"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // â€¢ auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // â€¢ rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="../../../static/reveal/reveal.css">
<link rel="stylesheet" href="../../../static/reveal/theme/simple.css" id="theme">

<style>
.reveal .slide-number {
  font-size: 26px;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, .3);
}

.reveal .full-screen {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.reveal .slides {
  border: 1.5px #ddd solid;
  border-radius: 7px;
  text-align: left;
  font-weight: 300;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4 {
  font-family: 'Lato', 'SimHei', 'STXihei', 'Droid Sans';
  font-weight: 400;
}

.reveal p, .reveal li, .reveal center {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Droid Sans';
}

.reveal li + li {
  margin-top: 10px;
}

.reveal ul {
  display: block;
  margin-right: 15px;
}

.reveal p, .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
  padding:  0 25px 0 25px;
}

.reveal table {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Sans Serif';
  margin-top: 15px;
  margin-bottom: 15px;
}

.reveal th {
  background-color: #eee;
}

.reveal tr:nth-child(even) {
  background-color: #efffff;
}

.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  text-align: left;
  margin: 0 0 20px 0;
 color: #222; 
  font-weight: 400;
  line-height: 1.2;
  letter-spacing: normal;
}



.reveal h1 {
  margin: 0 10 0 10;
  font-size: 60px;
}
.reveal .middle h1 {
  text-align: center;
}

.reveal h2 {
  font-size: 48px;
  border-bottom: 2px solid rgb(106, 0, 95);
  padding-bottom: 5px;
}
.reveal h3 { font-size: 1.15em; }
.reveal h4 { font-size: 1.05em; }

.reveal .center {
  text-align: center;
}

.reveal .middle {
  height: 728px;
  display: flex;
  align-items: center;
  width: 100%;
}

.reveal pre {
  font-size: 28px;
 
  background-color: #eee;

  border-radius: 3mm;
  padding: 10px 10px 10px 10px;
}

.reveal pre code {
  max-height: none;
}

.reveal code {
  font-family: 'Inconsolata', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif', Monospace;
}

.reveal .middle blockquote {
  text-align: center;
  color: rgb(106, 0, 95);
  background: none;
  box-shadow: none;
}

.reveal .middle blockquote a {
  color: inherit;
}

.reveal blockquote p, .reveal blockquote li {
  font-family: 'Lato', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif';
}

section .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.reveal .author-block {
  margin: 75px 0 35px 0;
}
.reveal .author-affiliation img {
  margin: 15px 0 0 0;
}
.reveal .author-block p, .reveal .author-affiliation p  {
  font-family: 'Kaiti', 'STKaiti', 'Serif', 'Times', 'Times New Roman';
  margin-block-start: 0em;
  margin-block-end: 0em;
}
.reveal .author-affiliation {
  display: inline-block;
  font-size: 90%;
}
.reveal hr {
  border: 10px solid rgba(0, 0, 0, 0);
}
.reveal li {
  margin-top: 10px;
}
</style>

  <title>æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div class="reveal">
<div class="slides">
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º</h1>
<p class=" font-serif my-1"><include src="Slides_Author/index.html"><div><div class="py-16">
<p class=" font-serif my-1"><a href="http://ics.nju.edu.cn/~jyy" class=" text-amber-900">è’‹ç‚å²©</a></p>
</div>
<div class="row">
<div class="author-affiliation">
    <a href="http://www.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">ã€€ã€€å—äº¬å¤§å­¦ã€€ã€€</p>
    <img class="inline-img h-24" src="../../../static/img/nju-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
   <a href="http://cs.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</p>
    <img class="inline-img h-24" src="../../../static/img/njucs-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
    <a href="https://cs.nju.edu.cn/ics/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</p>
    <img class="inline-img h-24" src="../../../static/img/ics-logo.png" style="display: inline-block;"></a>
  </div>
</div></div></include></p></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æé†’</h2>
<p class=" font-serif my-1">è¯·å¤§å®¶åŠæ—¶å…³æ³¨è¯¾ç¨‹ç½‘ç«™å‘å¸ƒçš„ä½œä¸š</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">HW2/Lab2 å·²å‘å¸ƒ</p>
<p class=" font-serif my-1">PA2.2 å·²ä¸´è¿‘æˆªæ­¢</p>
</blockquote>
<hr>
<p class=" font-serif my-1">ä»¥å„ä½çš„å¹³å‡æ°´å‡†æ¥çœ‹ï¼Œå®Œæˆ PA çš„æ—¶é—´æ˜¯é•¿äºé¢„ä¼°æ—¶é—´çš„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¦‚æœè¿˜æ²¡æœ‰å¼€å§‹â€¦â€¦</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æœ¬è®²æ¦‚è¿°</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">æˆ‘ä»¬å·²ç»çŸ¥é“æ•°æ®æ˜¯å¦‚ä½•åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºçš„ã€‚ä½†ä¸ºä»€ä¹ˆè¦è¿™æ ·è¡¨ç¤ºï¼Ÿè¿™æ ·çš„è¡¨ç¤ºæœ‰ä»€ä¹ˆå¥½å¤„å’Œç”¨æ³•ï¼Ÿ</p>
</blockquote>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä½è¿ç®—ä¸å•æŒ‡ä»¤å¤šæ•°æ®</li>
<li class=" ml-8">æ•´æ•°æº¢å‡ºä¸ Undefined Behavior</li>
<li class=" ml-8">IEEE754 æµ®ç‚¹æ•°</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">ä½è¿ç®—ä¸å•æŒ‡ä»¤å¤šæ•°æ®</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">ä¸ºä»€ä¹ˆä¼šæœ‰ä½è¿ç®—ï¼Ÿ</h2>
<p class=" font-serif my-1">é€»è¾‘é—¨å’Œå¯¼çº¿æ˜¯æ„æˆè®¡ç®—æœº (ç»„åˆé€»è¾‘ç”µè·¯) çš„åŸºæœ¬å•å…ƒ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä½è¿ç®—æ˜¯ç”¨ç”µè·¯æœ€å®¹æ˜“å®ç°çš„è¿ç®—<ul class=" list-disc font-serif">
<li class=" ml-8"><code>&</code> (ä¸), <code>|</code> (æˆ–), <code>~</code> (é)</li>
<li class=" ml-8"><code>^</code> (å¼‚æˆ–)</li>
<li class=" ml-8"><code><<</code> (å·¦ç§»ä½), <code>>></code> (å³ç§»ä½)</li>
<li class=" ml-8">ä¾‹å­ï¼šä¸€ä»£ä¼ å¥‡å¤„ç†å™¨ 8-bit <a href="https://www.masswerk.at/6502/6502_instruction_set.html" class=" text-amber-900">MOS 6502</a><ul class=" list-disc font-serif">
<li class=" ml-8">3510 æ™¶ä½“ç®¡ï¼›56 æ¡æŒ‡ä»¤ï¼Œç®—æ•°æŒ‡ä»¤ä»…æœ‰åŠ å‡æ³•å’Œä½è¿ç®—</li>
</ul>
</li>
</ul>
</li>
<li class=" ml-8">æ•°å­¦ä¸Šè‡ªç„¶çš„æ•´æ•°éœ€è¦å®ç°æˆå›ºå®šé•¿åº¦çš„ 01 å­—ç¬¦ä¸²</li>
</ul></div>
        
      
         <div class="fragment"> 
        <div><hr>
<p class=" font-serif my-1">ä¹ é¢˜ï¼šç”¨ä¸Šè¿°ä½è¿ç®—å’Œå¸¸æ•°å®ç° 4 ä½æ•´æ•°çš„åŠ æ³•è¿ç®—/Lab1</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åŠ æ³•æ¯”ä¸Šè¿°è¿ç®—åœ¨ç”µè·¯ä¸Šå®ç° fundamentally æ›´å›°éš¾ (ä¸ºä»€ä¹ˆï¼Ÿ)<ul class=" list-disc font-serif">
<li class=" ml-8">â€œCircuit Complexityâ€</li>
</ul>
</li>
</ul></div>
         </div> 
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-string" class=" text-xl mt-2 pb-2 font-sans">æ•´æ•°ï¼šå›ºå®šé•¿åº¦çš„ Bit String</h2>
<p class=" font-serif my-1"><code>142857 -> 0000 0000 0000 0010 0010 1110 0000 1001</code></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å‡è®¾ 32-bit æ•´æ•°ï¼›çº¦å®š MSB åœ¨å·¦ï¼ŒLSB åœ¨å³</li>
</ul>
<hr>
<p class=" font-serif my-1">çƒ­èº«é—®é¢˜ï¼šå­—ç¬¦ä¸²æ“ä½œ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åˆ†åˆ«å–å‡º 4 ä¸ªå­—èŠ‚</li>
<li class=" ml-8">äº¤æ¢é«˜/ä½ 16 ä½</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å•æŒ‡ä»¤å¤šæ•°æ®</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><code>&</code>, <code>|</code>, <code>~</code>, ... å¯¹äºæ•´æ•°é‡Œçš„æ¯ä¸€ä¸ª bit æ¥è¯´æ˜¯<red>ç‹¬ç«‹</red> (å¹¶è¡Œ) çš„</p>
</blockquote>
<p class=" font-serif my-1">å¦‚æœæˆ‘ä»¬æ“ä½œçš„å¯¹è±¡åˆšå¥½æ¯ä¸€ä¸ª bit æ˜¯ç‹¬ç«‹çš„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æˆ‘ä»¬åœ¨ä¸€æ¡æŒ‡ä»¤é‡Œå°±å®ç°äº†å¤šä¸ªæ“ä½œ</li>
<li class=" ml-8">SIMD (Single Instruction, Multiple Data)</li>
</ul>
<hr>
<p class=" font-serif my-1">ä¾‹å­ï¼šBit Set</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">32-bit æ•´æ•° $x \to S \subseteq \{0,1,2,\ldots,31\}$</li>
<li class=" ml-8">ä½è¿ç®—æ˜¯å¯¹æ‰€æœ‰ bit <red>åŒæ—¶</red>å®Œæˆçš„<ul class=" list-disc font-serif">
<li class=" ml-8">C++ ä¸­æœ‰ <code>bitset</code>ï¼Œæ€§èƒ½éå¸¸å¯è§‚</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-set" class=" text-xl mt-2 pb-2 font-sans">Bit Set: åŸºæœ¬æ“ä½œ</h2>
<p class=" font-serif my-1">æµ‹è¯• $x\in S$</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>(S >> x) & 1</code></li>
</ul>
<p class=" font-serif my-1">æ±‚ $S' = S\cup{x}$</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>S | (1 << x)</code></li>
</ul>
<p class=" font-serif my-1">æ›´å¤šä¹ é¢˜</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ±‚ $|S|$</li>
<li class=" ml-8">æ±‚ $S_1 \cup S_2$, $S_1 \cap S_2$</li>
<li class=" ml-8">æ±‚ $S_1 \setminus S_2$</li>
<li class=" ml-8">éå† $S$ ä¸­çš„æ‰€æœ‰å…ƒç´  (foreach)</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-set-s" class=" text-xl mt-2 pb-2 font-sans">Bit Set: æ±‚ $|S|$</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">bitset_size</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o"><</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bitset_contains</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">bitset_size1</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// SIMD</span>
<span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x55555555</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">S</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x55555555</span><span class="p">);</span>
<span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x33333333</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">S</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x33333333</span><span class="p">);</span>
<span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x0F0F0F0F</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">S</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x0F0F0F0F</span><span class="p">);</span>
<span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x00FF00FF</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">S</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x00FF00FF</span><span class="p">);</span>
<span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x0000FFFF</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">S</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="mh">0x0000FFFF</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-set-snevarnothing" class=" text-xl mt-2 pb-2 font-sans">Bit Set: è¿”å› $S\ne\varnothing$ ä¸­çš„æŸä¸ªå…ƒç´ </h2>
<p class=" font-serif my-1">æœ‰äºŒè¿›åˆ¶æ•°<code>x = 0b+++++100</code>ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°æœ€åé‚£ä¸ª<code>100</code></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æƒ³æ³•ï¼šä½¿ç”¨åŸºæœ¬æ“ä½œæ„é€ ä¸€äº›ç»“æœï¼Œèƒ½æŠŠ<code>+++++</code>çš„éƒ¨åˆ†ç»™æŠµæ¶ˆæ‰</li>
</ul>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x</code></td>
<td><code>0b+++++100</code></td>
</tr>
<tr>
<td><code>x-1</code></td>
<td><code>0b+++++011</code></td>
</tr>
<tr>
<td><code>~x</code></td>
<td><code>0b-----011</code></td>
</tr>
<tr>
<td><code>~x+1</code></td>
<td><code>0b-----100</code></td>
</tr>
</tbody>
</table></div>
        
      
         <div class="fragment"> 
        <div><p class=" font-serif my-1">ä¸€äº›æœ‰è¶£çš„å¼å­ï¼š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>x & (x-1)</code> â†’ <code>0b+++++000</code>ï¼›<code>x ^ (x-1)</code> â†’ <code>0b00000111</code></li>
<li class=" ml-8"><code>x & (~x+1)</code> â†’ <code>0b00000100</code> (lowbitï¸)<ul class=" list-disc font-serif">
<li class=" ml-8"><code>x & -x</code>, <code>(~x & (x-1)) + 1</code> éƒ½å¯ä»¥å®ç° lowbit</li>
<li class=" ml-8">åªéå†å­˜åœ¨çš„å…ƒç´ å¯ä»¥åŠ é€Ÿæ±‚ $|S|$</li>
</ul>
</li>
</ul></div>
         </div> 
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-set-lfloor-log_2x-rfloor" class=" text-xl mt-2 pb-2 font-sans">Bit Set: æ±‚ $\lfloor \log_2(x) \rfloor$</h2>
<p class=" font-serif my-1">ç­‰åŒäº $31 - \mathrm{clz}(x)$</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">clz</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o"><=</span><span class="w"> </span><span class="mh">0x0000ffff</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o"><<=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o"><=</span><span class="w"> </span><span class="mh">0x00ffffff</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w">  </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o"><<=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o"><=</span><span class="w"> </span><span class="mh">0x0fffffff</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w">  </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o"><<=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o"><=</span><span class="w"> </span><span class="mh">0x3fffffff</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o"><<=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o"><=</span><span class="w"> </span><span class="mh">0x7fffffff</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr>
<p class=" font-serif my-1">(å¥‡æ€ªçš„ä»£ç ) å‡è®¾ $x$ æ˜¯ <code>lowbit</code> å¾—åˆ°çš„ç»“æœï¼Ÿ</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="cp">#define LOG2(x) \</span>
<span class="cp">  ("-01J2GK-3@HNL;-=47A-IFO?M:<6-E>95D8CB"[(x) % 37] - '0')</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="bit-set-lfloor-log_2x-rfloor-contd" class=" text-xl mt-2 pb-2 font-sans">Bit Set: æ±‚ $\lfloor \log_2(x) \rfloor$ (cont'd)</h2>
<p class=" font-serif my-1">ç”¨ä¸€ç‚¹ç‚¹å…ƒç¼–ç¨‹ (meta-programming)ï¼›è¯•ä¸€è¯• <a href="../../../pages/ICS/2020/demos/log2.c" class=" text-amber-900">log2.c</a></p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">n</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'0'</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">10000</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">({</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">})</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">{</span> <span class="n">j</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="n">j</span> <span class="p">}</span>
    <span class="k">break</span>

<span class="n">magic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
  <span class="p">[</span> <span class="n">M</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="p">]</span>
  <span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'"'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'#define LOG2(x) ("</span><span class="si">{</span><span class="n">magic</span><span class="si">}</span><span class="s1">"[(x) % </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">] - </span><span class="se">\'</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="se">\'</span><span class="s1">)'</span><span class="p">)</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">ä¸€æœ¬æœ‰è¶£çš„å‚è€ƒä¹¦</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">Henry S. Warren, Jr. <em>Hacker's Delight</em> (2ed), Addison-Wesley, 2012.</p>
</blockquote>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/ICS/2020/slides/img/hackers-delight.jpg" width="200px"></p>
<p class=" font-serif my-1">è®©ä½ ç†è§£å†™å‡ºæ›´å¿«çš„ä»£ç å¹¶ä¸æ˜¯ â€œççŒœâ€</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸»è¦å†…å®¹æ˜¯å„ç§æ•°å­¦ (å¸¦æ¥çš„ä»£ç ä¼˜åŒ–)</li>
<li class=" ml-8">å®˜æ–¹ç½‘ç«™ï¼š<a href="http://hackersdelight.org/" class=" text-amber-900">hackersdelight.org</a></li>
<li class=" ml-8">è§è¯†ä¸€ä¸‹çœŸæ­£çš„ â€œå¥‡æŠ€æ·«å·§â€</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="undefined-behavior" class=" text-2xl mt-2 font-sans">æ•´æ•°æº¢å‡ºä¸ Undefined Behavior</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="undefined-behavior-ub" class=" text-xl mt-2 pb-2 font-sans">Undefined Behavior (UB)</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><em>Undefined behavior</em> (UB) is the result of executing computer code whose behavior is not prescribed by the language specification to which the code adheres, for the current state of the program. This happens when the translator of the source code makes certain assumptions, but these assumptions are not satisfied during execution. -- Wikipedia</p>
</blockquote>
<p class=" font-serif my-1">C å¯¹ UB çš„è¡Œä¸ºæ˜¯ä¸åšä»»ä½•çº¦æŸçš„ï¼ŒæŠŠ<font color="red">ç”µè„‘ç‚¸äº†</font>éƒ½è¡Œ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¸¸è§çš„ UBï¼šéæ³•å†…å­˜è®¿é—® (ç©ºæŒ‡é’ˆè§£å¼•ç”¨ã€æ•°ç»„è¶Šç•Œã€å†™åªè¯»å†…å­˜ç­‰)ã€è¢«é›¶é™¤ã€æœ‰ç¬¦å·æ•´æ•°æº¢å‡ºã€å‡½æ•°æ²¡æœ‰è¿”å›å€¼â€¦â€¦<ul class=" list-disc font-serif">
<li class=" ml-8">é€šå¸¸çš„åæœæ¯”è¾ƒè½»å¾®ï¼Œæ¯”å¦‚ wrong answer, crash</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="cc-ub" class=" text-xl mt-2 pb-2 font-sans">ä¸ºä»€ä¹ˆ C/C++ ä¼šæœ‰ UBï¼Ÿ</h2>
<p class=" font-serif my-1">ä¸ºäº†å°½å¯èƒ½é«˜æ•ˆ (zero-overhead)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸åˆæ³•çš„äº‹æƒ…çš„åæœåªå¥½ undefined äº†</li>
<li class=" ml-8">Java, js, python, ... é€‰æ‹©æ‰€æœ‰æ“ä½œéƒ½è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥</li>
</ul>
<hr>
<p class=" font-serif my-1">ä¸ºäº†å…¼å®¹å¤šç§ç¡¬ä»¶ä½“ç³»ç»“æ„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æœ‰äº›ç¡¬ä»¶ <code>/0</code> ä¼šäº§ç”Ÿå¤„ç†å™¨å¼‚å¸¸</li>
<li class=" ml-8">æœ‰äº›ç¡¬ä»¶å•¥ä¹Ÿä¸å‘ç”Ÿ</li>
<li class=" ml-8">åªå¥½ undefined äº†</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="undefined-behavior" class=" text-xl mt-2 pb-2 font-sans">Undefined Behavior: ä¸€ä¸ªå†å²æ€§çš„åŒ…è¢±</h2>
<p class=" font-serif my-1">åŸ‹ä¸‹äº†ç¾éš¾çš„ç§å­</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">CVE: <em>Common Vulnerabilities and Exposures</em>ï¼Œå…¬å¼€å‘å¸ƒè½¯ä»¶ä¸­çš„æ¼æ´<ul class=" list-disc font-serif">
<li class=" ml-8">buffer/integer overflow å¸¸å¹´å æ® CVE çš„ä¸€å¸­ä¹‹åœ°</li>
<li class=" ml-8">é«˜å±æ¼æ´è®©æ²¡æœ‰ä¿®è¡¥çš„æœºå™¨ç«‹é©¬å®•ğŸ”/å˜æˆè‚‰ğŸ”</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">ä¾‹å­ï¼š<a href="https://nvd.nist.gov/vuln/detail/CVE-2018-7445" class=" text-amber-900">CVE-2018-7445</a> (RouterOS), ä»…ä»…æ˜¯å¿˜è®°æ£€æŸ¥ç¼“å†²åŒºå¤§å°â€¦â€¦</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="o"><</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="undefined-behavior" class=" text-xl mt-2 pb-2 font-sans">Undefined Behavior: è­¦æƒ•æ•´æ•°æº¢å‡º</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">è¡¨è¾¾å¼</th>
<th style="text-align: center;">å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>UINT_MAX+1</code></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><code>INT_MAX+1; LONG_MAX+1</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
<tr>
<td style="text-align: center;"><code>char c = CHAR_MAX; c++;</code></td>
<td style="text-align: center;"><font color="blue">varies</font> (???)</td>
</tr>
<tr>
<td style="text-align: center;"><code>1 << -1</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
<tr>
<td style="text-align: center;"><code>1 << 0</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><code>1 << 31</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
<tr>
<td style="text-align: center;"><code>1 << 32</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
<tr>
<td style="text-align: center;"><code>1 / 0</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
<tr>
<td style="text-align: center;"><code>INT_MAX % -1</code></td>
<td style="text-align: center;"><font color="red">undefined</font></td>
</tr>
</tbody>
</table>
<ul class=" list-disc font-serif">
<li class=" ml-8">W. Dietz, et al. Understanding integer overflow in C/C++. In <em>Proceedings of ICSE</em>, 2012.</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•´æ•°æº¢å‡ºå’Œç¼–è¯‘ä¼˜åŒ–</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o"><<</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">æ ¹æ®æ‰‹å†Œï¼Œè¿™æ˜¯ä¸ª UBï¼Œäºæ˜¯ clang è¿™æ ·å¤„ç½®â€¦â€¦</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>0000000000000000 <f>:
   0:   c3      retq
</code></pre></div>

<hr>
<p class=" font-serif my-1">ç¼–è¯‘å™¨æŠŠè¿™ä¸ªè®¡ç®—ç›´æ¥åˆ é™¤äº†</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">W. Xi, et al. Towards optimization-safe systems: Analyzing the impact of undefined behavior. In <em>Proceedings of SOSP</em>, 2013.</p>
</blockquote></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="ieee-754" class=" text-2xl mt-2 font-sans">æµ®ç‚¹æ•°ï¼šIEEE 754</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å®æ•°çš„è®¡ç®—æœºè¡¨ç¤º</h2>
<p class=" font-serif my-1">å®æ•°éå¸¸éå¸¸å¤š ($\aleph_0 < \mathfrak c$)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åªèƒ½ç”¨ 32/64-bit 01 ä¸²æ¥è¡¨ç¤º<red>ä¸€å°éƒ¨åˆ†</red>å®æ•°<ul class=" list-disc font-serif">
<li class=" ml-8">ç¡®å®šä¸€ç§æ˜ å°„æ–¹æ³•ï¼ŒæŠŠä¸€ä¸ª 01 ä¸²æ˜ å°„åˆ°ä¸€ä¸ªå®æ•°<ul class=" list-disc font-serif">
<li class=" ml-8">è¿ç®—èµ·æ¥ä¸å¤ªéº»çƒ¦</li>
<li class=" ml-8">è®¡ç®—è¯¯å·®ä¸å¤ªå¯æ€•</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">äºæ˜¯æœ‰äº† IEEE754 (1bit S, 23/52bits Fraction, 8/11bits Exponent)</p>
<p class=" font-serif my-1">$$x = (-1)^S \times (1.F) \times 2^{E - B}$$</p>
<p class=" font-serif my-1"><img alt="" class="center" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/IEEE_754_Single_Floating_Point_Format.svg/1200px-IEEE_754_Single_Floating_Point_Format.svg.png"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ieee754" class=" text-xl mt-2 pb-2 font-sans">IEEE754: ä½ å¯èƒ½ä¸çŸ¥é“çš„äº‹å®</h2>
<p class=" font-serif my-1">ä¸€ä¸ªæœ‰å…³æµ®ç‚¹æ•°å¤§å°/å¯†åº¦çš„å®éªŒ (<a href="../../../pages/ICS/2020/demos/float.c" class=" text-amber-900">float.c</a>)</p></div>
        
      
         <div class="fragment"> 
        <div><hr>
<p class=" font-serif my-1">è¶Šå¤§çš„æ•°å­—ï¼Œè·ç¦»ä¸‹ä¸€ä¸ªå®æ•°çš„è·ç¦»å°±è¶Šå¤§</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¯èƒ½ä¼šå¸¦æ¥ç›¸å½“çš„ç»å¯¹è¯¯å·®</li>
<li class=" ml-8">å› æ­¤å¾ˆå¤šæ•°å­¦åº“éƒ½ä¼šé¢‘ç¹åšå½’ä¸€åŒ–</li>
</ul>
<hr>
<p class=" font-serif my-1">ä¾‹å­ï¼šè®¡ç®— $1 + \frac{1}{2} + \frac{1}{3} + \ldots + \frac{1}{n}$</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="cp">#define SUM(T, st, ed, d) ({ \</span>
<span class="cp">  T s = 0; \</span>
<span class="cp">  for (int i = st; i != ed + d; i += d) \</span>
<span class="cp">    s += (T)1 / i; \</span>
<span class="cp">  s; \</span>
<span class="cp">})</span>
</code></pre></div>

<ul class=" list-disc font-serif">
<li class=" ml-8">æµ®ç‚¹æ•°ï¼š$ (a + b) + c \ne a + (b + c)$</li>
</ul></div>
         </div> 
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ieee754-contd" class=" text-xl mt-2 pb-2 font-sans">IEEE754: ä½ å¯èƒ½ä¸çŸ¥é“çš„äº‹å® (cont'd)</h2>
<p class=" font-serif my-1">æ¯”è¾ƒ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>a == b</code> éœ€è¦è°¨æ…åˆ¤æ–­ (è¦å‡è®¾è‡ªå¸¦ $\varepsilon$)</li>
</ul>
<hr>
<p class=" font-serif my-1">éè§„æ ¼åŒ–æ•° (Exponent == 0)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">$x = (-1)^S \times (0.F) \times 2^{-126}$</li>
</ul>
<hr>
<p class=" font-serif my-1">é›¶</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>+0.0</code>, <code>-0.0</code> çš„ $S$ bit æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½† <code>+0.0 == -0.0</code></li>
</ul>
<hr>
<p class=" font-serif my-1">Inf/NaN (Not a Number)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">Inf: æµ®ç‚¹æ•°æº¢å‡ºå¾ˆå¸¸è§ï¼Œä¸åº”è¯¥ä½œä¸º undefined behavior</li>
<li class=" ml-8">NaN (<code>0.0/0.0</code>): èƒ½å¤Ÿæ»¡è¶³ <code>x != x</code> è¡¨è¾¾å¼çš„å€¼</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ieee754" class=" text-xl mt-2 pb-2 font-sans">IEEE754ï¼šå¼‚å¸¸å¤æ‚</h2>
<p class=" font-serif my-1">é™¤äº† $x = (-1)^S \times (1.F) \times 2^{E - B}$ï¼Œè¿˜è¦è€ƒè™‘</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">éè§„æ ¼åŒ–æ•°, +0.0/-0.0, Inf, NaN<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸€åº¦å¼•èµ·äº†ç¡¬ä»¶å‚å•†çš„ä¼—æ€’ (ç¢°åˆ°éè§„æ ¼æ•°å¹²è„†è½¯ä»¶æ¨¡æ‹Ÿå§)</li>
<li class=" ml-8">å¾ˆå¤šâ€œå¯¹æµ®ç‚¹æ•°ç²¾åº¦è¦æ±‚ä¸é«˜â€ç¡¬ä»¶å‚å•†é€‰æ‹©ä¸å…¼å®¹ IEEE 754 (æ¯”å¦‚å„ç§ GPU åˆ¶é€ å•†)</li>
<li class=" ml-8">Nvidia ä» Fermi æ‰å¼€å§‹å®Œæ•´æ”¯æŒ IEEE754 (2010)</li>
</ul>
</li>
</ul>
<hr>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><a href="https://people.eecs.berkeley.edu/~wkahan/ieee754status/754story.html" class=" text-amber-900">An interview with the old man of floating-point</a>. Reminiscences elicited from <a href="http://http.cs.berkeley.edu/~wkahan/" class=" text-amber-900">William Kahan </a>by <a href="http://www.dr-chuck.com/" class=" text-amber-900">Charles Severance</a>.</p>
</blockquote></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="frac-b-sqrtb2-4ac2a" class=" text-xl mt-2 pb-2 font-sans">ä¾‹å­ï¼šè®¡ç®— $\frac{-b - \sqrt{b^2-4ac}}{2a}$</h2>
<p class=" font-serif my-1">å¦‚æœè€ƒè™‘æ¯”è¾ƒæç«¯çš„æ•°å€¼æ¡ä»¶ï¼Ÿ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ¶ˆå»è¯¯å·®: $-b$ v.s. $ \sqrt{b^2-4ac} $ (catastrophic cancellation)<ul class=" list-disc font-serif">
<li class=" ml-8">è¿˜è®°å¾— <code>x + 1.0 == x</code> çš„ä¾‹å­å—</li>
</ul>
</li>
<li class=" ml-8">æº¢å‡º: $b^2$</li>
</ul>
<hr>
<p class=" font-serif my-1">ä¸€ä¸ªæ›´å¥½çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹æ±‚æ ¹å…¬å¼</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">$\frac{(-b)^2 - (\sqrt{b^2-4ac})^2}{ (-b) + \sqrt{b^2-4ac}} /2a = \frac{4ac}{(-b)+\sqrt{b^2-4ac}}/2a $ ($b < 0$)</li>
<li class=" ml-8">$(-b-\sqrt{b^2-4ac}) \cdot \frac{1}{2a}$ ($0\le b\le 10^{127}$)</li>
<li class=" ml-8">$-\frac{b}{a}+\frac{c}{b}$ ($b > 10^{127}$)<ul class=" list-disc font-serif">
<li class=" ml-8">P. Panchekha, et al. Automatically improving accuracy for floating point expressions. In <em>Proc. of PLDI</em>, 2015.</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å‡­ä»€ä¹ˆï¼Ÿ</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">It looked pretty complicated. On the other hand, we had a rationale for everything. -- <a href="http://http.cs.berkeley.edu/~wkahan/" class=" text-amber-900">William Kahan</a>, 1989 ACM Turing Award Winner for his <em>fundamental contributions to numerical analysis</em>.</p>
</blockquote>
<p class=" font-serif my-1"></p><center>æµ®ç‚¹æ•°å¯ä»¥ç›´æ¥å½“æˆæ•´æ•°æ¯”è¾ƒå¤§å°</center>
<p class=" font-serif my-1"></p><center><code>+0.0/-0.0</code> å’Œ Inf ä¿è¯ $(1/x)/x$ ä¸ä¼šå‘ç”Ÿ sign shift</center>
<p class=" font-serif my-1"></p><center>â€¦â€¦</center>
<p class=" font-serif my-1">IEEE754 å¤©æ‰çš„è®¾è®¡ä¿è¯äº†æ•°å€¼è®¡ç®—çš„ç¨³å®š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¦‚æœæƒ³äº†è§£ IEEE754ï¼Œè¯·é˜…è¯» D. Goldberg. <a href="https://dl.acm.org/citation.cfm?id=103163" class=" text-amber-900">What every computer scientist should know about floating-point arithmetic</a>. <em>ACM Computing Surveys</em>, 23(1), 1991.</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ•°æ®çš„æœºå™¨çº§è¡¨ç¤ºï¼šç»¼åˆæ¡ˆä¾‹</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="1sqrtx" class=" text-xl mt-2 pb-2 font-sans">æ¡ˆä¾‹ï¼šè®¡ç®— $1/\sqrt{x}$</h2>
<p class=" font-serif my-1">åº”ç”¨ï¼šSurface Norm</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¹³é¢çš„æ³•å‘é‡<ul class=" list-disc font-serif">
<li class=" ml-8">ç”¨äºè®¡ç®—å…‰ç…§/åå°„</li>
<li class=" ml-8"><del>ç¬¬ä¸€æ¬¡æ„Ÿè§‰æ•°å­¦æ´¾ä¸Šäº†ç”¨åœº</del></li>
</ul>
</li>
<li class=" ml-8">è®¡ç®—æ–¹æ³•<ul class=" list-disc font-serif">
<li class=" ml-8">å¹‚çº§æ•°å±•å¼€</li>
<li class=" ml-8">äºŒåˆ†æ³•</li>
<li class=" ml-8">ç‰›é¡¿æ³•â€¦â€¦</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">å¦‚ä½•ä¸å€ŸåŠ©ç¡¬ä»¶æŒ‡ä»¤ï¼Œå¿«é€Ÿ (è¿‘ä¼¼) è®¡ç®— $f(x)$ï¼Ÿ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">äººçœ¼å¯¹åƒç´ çº§çš„è¯¯å·®å¹¶ä¸æ•æ„Ÿï¼Œå› æ­¤ç®—é”™ä¸€ç‚¹ä¹Ÿæ²¡äº‹</li>
<li class=" ml-8">å¿« 1.5 å€: $ 640 \times 480 \to 800 \times 600 $ (è¿™ä¸ªæ¨å¯¼ä¸ä¸¥æ ¼)</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="o1" class=" text-xl mt-2 pb-2 font-sans">ç¥å¥‡çš„ $O(1)$ ä»£ç </h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">float</span><span class="w"> </span><span class="nf">Q_rsqrt</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">conv</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5F</span><span class="p">;</span>
<span class="w">  </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number</span><span class="p">;</span>
<span class="w">  </span><span class="n">conv</span><span class="p">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x5f3759df</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conv</span><span class="p">.</span><span class="n">i</span><span class="w"> </span><span class="o">>></span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// ???</span>
<span class="w">  </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mf">1.5F</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">conv</span><span class="p">.</span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr>
<p class=" font-serif my-1">çœ‹çœ‹åˆ«äººçš„æ¯•ä¸šè®¾è®¡</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">Matthew Robertson. <a href="http://localhost:5001/static/wiki/ics/rsqrt.pdf" class=" text-amber-900">A Brief History of InvSqrt</a>, <em>Bachelor Thesis, The University of New Brunswick</em>, 2012.</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="atimes-b-bmod-m" class=" text-xl mt-2 pb-2 font-sans">æ¡ˆä¾‹ï¼šè®¡ç®— $(a\times b) \bmod m$</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int64_t</span><span class="w"> </span><span class="nf">multimod_fast</span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o"><</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr>
<p class=" font-serif my-1">ä»¤ $a \times b = p \cdot m + q$</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>a * b</code> â†’ $(p \cdot m + q) \bmod 2^{64}$</li>
<li class=" ml-8"><code>x</code> â†’ $(\lfloor \frac{p\cdot m+q}{m} \rfloor \cdot m) \bmod 2^{64}$<ul class=" list-disc font-serif">
<li class=" ml-8">å¦‚æœæµ®ç‚¹æ•°çš„ç²¾åº¦æ˜¯æ— é™çš„ï¼Œ$x = (p\cdot m) \bmod 2^{64}$</li>
<li class=" ml-8">åŒä½™å°±å¾—åˆ°äº† $q$</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ€»ç»“</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º</h2>
<p class=" font-serif my-1"><em>Everything</em> is a bit-string!</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä½†å´èƒ½ç©å‡ºå¾ˆå¤šèŠ±æ ·æ¥<ul class=" list-disc font-serif">
<li class=" ml-8">bit-set/SIMD</li>
<li class=" ml-8">æµ®ç‚¹æ•°çš„è¡¨ç¤º</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">PA: ç¦æ­¢å†™å‡ºä¸å¯ç»´æŠ¤çš„ä»£ç </p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¦‚æœä½ æƒ³ç©å‡ºèŠ±ï¼Œè¯·åšåˆé€‚çš„å°è£…å’Œå……åˆ†çš„æµ‹è¯•</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="end" class=" text-2xl mt-2 font-sans">End.</h1></div></div></div>
        
      
      </section>
    
    </section>
  
</div>
</div>

<script src="../../../static/reveal/reveal.js"></script>
<script>
  Reveal.initialize({
    
    width: 1024, height: 768,
    
    slideNumber: 'c/t',
    controlsTutorial: false,
    progress: false,
    hash: true,
    center: false,
    autoAnimateUnmatched: true,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.3,
    transitionSpeed: 'fast'
  });
</script>


</body>


</html>