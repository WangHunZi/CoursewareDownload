<!DOCTYPE html><html class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // &#8226; auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // &#8226; rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<style>
.article {
  -webkit-hyphens: auto;
}
form {
  margin-block-end: 0;
}
img {
  display: inline-block;
}
code { font-size: 85%; }
pre {
  font-size: 95%;
  line-height: 120%;
}
blockquote {
  font-size: 95%;
}
p {
  font-size: 105%;
  text-indent: 2em;
}
li {
  font-size: 105%;
}
blockquote p {
  text-indent: 0em;
}
.float-right {
  padding-left: 10px;
}
.float-left {
  padding-right: 10px;
}
a {
  color: rgb(29 78 216);
}
strong {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.box        {
  border-radius: 2px; padding: 1px 4px 2px 4px;
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
  font-size: 95%;
}
.box-blue,  .badge-primary  { background-color: rgba(66, 139, 202, 0.5); color: #1d4ed8; }
.box-green, .badge-success  { background-color: rgba(92, 184, 92, 0.5);  color: #15803d; }
.box-red,   .badge-danger   { background-color: rgba(217, 83, 79, 0.5);  color: #b91c1c; }
.box-yellow,.badge-warning  { background-color: rgba(240, 173, 78, 0.5); color: #a16207; }
.box-gray   { background-color: #a0a0a0; }

.badge {
  padding: 1 4 1 4;
  display: inline-block;
  border-radius: 0.25rem;
  border: 1px solid;
}
.message p {
  text-indent: 0em;
  margin-top: 1px;
}
.message h1, h2, h3, h4, h5 {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.message h2 {
  font-size: 120%;
  margin-top: 5px;
  margin-bottom: 2px;
}
.message li {
  list-style: disc;
  margin-left: 2em;
}
li > p {
  text-indent: 0em;
}
block-quote h4 {
  float: left;
  display: inline-block;
}
.center {
  display: block;
  margin: auto;
}
hr {
  margin-top: 20px;
  padding-bottom: 20px;
}

.fa-gradient {
	background: -webkit-gradient(linear, left top, left bottom, from(rgb(99, 27, 103)), to(#333));
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
}

</style>


  <title>Lab4: &#32531;&#23384;&#27169;&#25311;&#22120;</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div>

<div class="px-2 py-1 w-full fixed z-50 bg-gradient-to-r from-black via-purple-700 via-purple-500 shadow-lg" style="-webkit-backdrop-filter: saturate(150%) blur(4px); backdrop-filter: saturate(150%) blur(4px)">
  <form>
    <a href="../../../index.html"><span class="text-lg px-2 text-white">Yanyan's Wiki</span></a>
    <a href="../../../OS/2023/index.html"><span class="text-sm px-2 text-white">&#25805;&#20316;&#31995;&#32479; (2023)</span></a>
    <input maxlength="9" id="token-input" class="float-right appearance-none border border-transparent px-2 py-1 w-20 bg-white text-gray-700 placeholder-gray-400 shadow-md rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent font-mono" type="text" placeholder="TOKEN" oninput="login();">
  </form>
</div>

<div class="article container mx-auto md:px-8 lg:px-8 xl:px-8 2xl:px-8 shadow-lg border pb-8 pt-10 max-w-screen-md text-justify divide-y-2 divide-white">
  <div><h1 id="lab4" class=" text-2xl mt-2 font-sans">Lab4: &#32531;&#23384;&#27169;&#25311;&#22120;</h1>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_1" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">&#23567;&#23454;&#39564;&#35828;&#26126;</h4>
<p class=" font-serif my-1">&#23567;&#23454;&#39564; (Labs) &#26159; ICS &#36825;&#38376;&#35838;&#31243;&#37324;&#30340;&#19968;&#20123;&#32508;&#21512;&#32534;&#31243;&#39064;&#65292;&#26088;&#22312;&#32467;&#21512;&#35838;&#22530;&#30693;&#35782;&#35299;&#20915;&#19968;&#20123;&#23454;&#38469;&#20013;&#30340;&#38382;&#39064;&#12290;&#22240;&#20026;&#38382;&#39064;&#26469;&#33258;&#23454;&#38469;&#65292;&#25152;&#20197;&#26377;&#26102;&#20505;&#26410;&#24517;&#33021;&#31435;&#21363;&#22312;&#35838;&#26412;&#19978;&#25214;&#21040;&#30456;&#20851;&#30693;&#35782;&#30340;&#31572;&#26696;&#65292;&#32780;&#26159;&#38656;&#35201; &#8220;&#27963;&#23398;&#27963;&#29992;&#8221;&#12290;&#22240;&#27492;&#65292;&#22823;&#23478;&#38656;&#35201;&#21033;&#29992;&#20114;&#32852;&#32593;&#19978;&#30340;&#30693;&#35782;&#35299;&#20915;&#36825;&#20123;&#38382;&#39064;&#65292;&#20294;<strong>&#19981;&#35201;</strong>&#35797;&#22270;&#30452;&#25509;&#25628;&#32034;&#36825;&#20123;&#38382;&#39064;&#30340;&#31572;&#26696;&#65292;&#21363;&#20415;&#26377;&#20063;&#19981;&#35201;&#28857;&#36827;&#21435; (&#20063;&#35831;&#33258;&#35273;&#19981;&#35201;&#20844;&#24320;&#21457;&#24067;&#31572;&#26696;)&#12290;</p>
<p class=" font-serif my-1">Soft deadline: 2020 &#24180; 1 &#26376; 14 &#26085; 23:59:59&#12290;&#26412;&#23454;&#39564;&#23433;&#25490;&#22312;&#26399;&#26411;&#32771;&#35797;&#21069;&#25130;&#27490;&#65292;&#22240;&#20026;<strong>&#26412;&#23454;&#39564;&#20869;&#23481;&#23545;&#26399;&#26411;&#32771;&#35797;&#24110;&#21161;&#24456;&#22823;</strong>&#65306;&#24448;&#24180;&#27599;&#24180;&#37117;&#20250;&#26377;&#19968;&#36947;&#20851;&#20110; cache &#32454;&#33410;&#30340;&#39064;&#30446;&#65292;&#29616;&#22330;&#26597;&#20070;&#26159;&#26469;&#19981;&#21450;&#30340;&#12290;</p>
</blockquote>
<h2 id="1" class=" text-xl mt-2 pb-2 font-sans">1. &#32972;&#26223;</h2>
<p class=" font-serif my-1">(&#36825;&#20010;&#23454;&#39564;&#26159; yzh &#20174;&#26087;&#29256;PA&#37324;&#25688;&#20986;&#26469;&#30340;&#65292;&#25152;&#20197;&#20320;&#20204;&#21453;&#27491;&#26159;&#36867;&#19981;&#20102;&#30340;&#12290;)</p>
<p class=" font-serif my-1">&#24590;&#26679;&#20248;&#21270;&#31995;&#32479;&#35774;&#35745;&#21644;&#23454;&#29616;&#35753;&#31995;&#32479;/&#31243;&#24207;&#36816;&#34892;&#24471;&#26356;&#24555;&#12289;&#24590;&#26679;&#26597;&#25214;&#31243;&#24207;&#20013;&#30340; bug &#31561;&#26159;&#35745;&#31639;&#26426;&#31995;&#32479;&#21644;&#36719;&#20214;&#20013;&#30340;&#26680;&#24515;&#30740;&#31350;&#38382;&#39064;&#65292;&#32780;&#22312;&#31243;&#24207;&#36816;&#34892;&#26102;&#35760;&#24405;&#26085;&#24535;&#20379;&#20043;&#21518;&#20998;&#26512;&#26159;&#20854;&#20013;&#24456;&#37325;&#35201;&#30340;&#19968;&#31181;&#25216;&#26415;&#25163;&#27573;&#65292;&#36825;&#37324;&#26377;&#20004;&#20010;&#38382;&#39064;&#65306;</p>
<ol class=" list-decimal font-serif">
<li class=" ml-8">&#24590;&#26679;&#22312;&#31243;&#24207;&#36816;&#34892;&#26102;&#36827;&#34892;&#35760;&#24405;&#65311;&#38500;&#20102;&#25163;&#24037;&#22312;&#31243;&#24207;&#20013;&#28155;&#21152; printf &#20043;&#22806;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;<strong>&#33258;&#21160;</strong>&#30340;&#24037;&#20855;&#65292;&#20363;&#22914;&#31243;&#24207;&#25554;&#35013;&#24037;&#20855;&#12289;profiler &#31561;&#65292;&#37117;&#33021;&#36755;&#20986;&#26576;&#31181;&#24418;&#24335;&#30340;&#31243;&#24207;&#36816;&#34892;&#26085;&#24535;&#12290;&#20363;&#22914;&#65292;function call trace &#26159;&#20989;&#25968;&#35843;&#29992;&#30340;&#24207;&#21015;&#65307;memory trace &#26159;&#20869;&#23384;&#35775;&#38382;&#30340;&#24207;&#21015; (&#36825;&#20010;&#23454;&#39564;&#20013;&#29992;&#21040;)&#12290;</li>
<li class=" ml-8">&#22312;&#26377;&#20102;&#31243;&#24207;&#25191;&#34892;&#30340; trace &#20043;&#21518;&#65292;&#24590;&#26679;&#29992;&#35760;&#24405;&#30340;&#19968;&#27425;&#31243;&#24207;&#25191;&#34892;&#26469;&#25351;&#23548;&#31995;&#32479;&#30340;&#20248;&#21270;&#25110;&#26159;&#23547;&#25214;&#31995;&#32479;&#20013;&#28508;&#22312;&#30340;bug&#12290;</li>
</ol>
<p class=" font-serif my-1">&#21160;&#24577;&#20998;&#26512;&#26159;&#35745;&#31639;&#26426;&#31995;&#32479;/&#36719;&#20214;&#24037;&#31243;&#39046;&#22495;&#38750;&#24120; active &#30340;&#30740;&#31350; topic&#65306;&#24590;&#20040;&#21448;&#24555;&#21448;&#22909;&#22320;&#24471;&#21040;&#25105;&#20204;&#24819;&#35201;&#30340;&#26085;&#24535;&#65311;&#24590;&#26679;&#20174;&#26085;&#24535;&#20013;&#20998;&#26512;&#20986;&#23545;&#25105;&#20204;&#26377;&#29992;&#30340;&#20449;&#24687;&#65292;&#20363;&#22914;&#24615;&#33021;&#29942;&#39048;&#12289;&#36719;&#20214; bug&#65311;</p>
<h2 id="2" class=" text-xl mt-2 pb-2 font-sans">2. &#23454;&#39564;&#35201;&#27714;</h2>
<h3 id="21" class=" text-lg mt-2 pb-2 font-sans">2.1 &#23454;&#39564;&#20869;&#23481;</h3>
<p class=" font-serif my-1">&#36825;&#20010;&#32534;&#31243;&#23454;&#39564;&#38656;&#35201;&#27169;&#25311;&#23454;&#29616;&#19968;&#20010;&#31616;&#21333;&#30340; cache&#65292;&#24182;&#23581;&#35797;&#23454;&#29616;&#21508;&#31181;&#26367;&#25442;&#31639;&#27861;&#26469;&#20248;&#21270;&#31243;&#24207;&#30340;&#24615;&#33021;&#12290;&#25152;&#35859;&#27169;&#25311;&#65292;&#21363;&#25105;&#20204;&#24050;&#26377;&#25152;&#26377;&#20869;&#23384;&#35775;&#38382;&#30340;&#24207;&#21015;&#65292;&#20320;&#38656;&#35201; &#8220;&#27169;&#25311;&#8221; &#20986; cache &#30340;&#34892;&#20026;&#65292;&#20174;&#32780;&#35780;&#20272;&#19981;&#21516;&#37197;&#32622;&#30340; cache &#23545;&#31243;&#24207;&#36816;&#34892;&#30340;&#24433;&#21709;&#12290;</p>
<p class=" font-serif my-1">&#20320;&#38656;&#35201;&#22312; <code>cache.c</code> &#20013;&#23454;&#29616;&#22914;&#19979;&#20989;&#25968;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="c1">// &#20174; cache &#20013;&#35835;&#20986; addr &#22320;&#22336;&#22788;&#30340; 4 &#23383;&#33410;&#25968;&#25454;</span>
<span class="c1">// &#33509;&#32570;&#22833;&#65292;&#38656;&#35201;&#20808;&#20174;&#20869;&#23384;&#20013;&#35835;&#20837;&#25968;&#25454;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="nf">cache_read</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>

<span class="c1">// &#24448; cache &#20013; addr &#22320;&#22336;&#25152;&#23646;&#30340;&#22359;&#20889;&#20837;&#25968;&#25454; data&#65292;&#20889;&#25513;&#30721;&#20026; wmask</span>
<span class="c1">// &#20363;&#22914;&#24403; wmask &#20026; 0xff &#26102;&#65292;&#21482;&#20889;&#20837;&#20302;8&#27604;&#29305;</span>
<span class="c1">// &#33509;&#32570;&#22833;&#65292;&#38656;&#35201;&#20174;&#20808;&#20869;&#23384;&#20013;&#35835;&#20837;&#25968;&#25454;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">cache_write</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">wmask</span><span class="p">);</span>

<span class="c1">// &#21021;&#22987;&#21270;&#19968;&#20010;&#25968;&#25454;&#22823;&#23567;&#20026; 2^total_size_width B&#65292;&#20851;&#32852;&#24230;&#20026; 2^associativity_width &#30340; cache</span>
<span class="c1">// &#20363;&#22914; init_cache(14, 2) &#23558;&#21021;&#22987;&#21270;&#19968;&#20010; 16KB&#65292;4 &#36335;&#32452;&#30456;&#32852;&#30340;cache</span>
<span class="c1">// &#23558;&#25152;&#26377; valid bit &#32622;&#20026;&#26080;&#25928;&#21363;&#21487;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">init_cache</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">total_size_width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">associativity_width</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#21478;&#22806; cache &#30340;&#19968;&#20123;&#29305;&#24615;&#22914;&#19979;:</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#22359;&#22823;&#23567;&#20026; 64B (&#35265; <code>common.h</code> &#20013; <code>BLOCK_SIZE</code> &#30340;&#23450;&#20041;)</li>
<li class=" ml-8">&#26367;&#25442;&#31639;&#27861;&#37319;&#29992;&#38543;&#26426;&#26041;&#24335;</li>
<li class=" ml-8">&#20889;&#22238;&#65292;&#20889;&#20998;&#37197;</li>
</ul>
<p class=" font-serif my-1"><code>mem.c</code> &#20013;&#25552;&#20379;&#20102;&#22914;&#19979;&#20004;&#20010;&#20989;&#25968;&#65292;cache &#32570;&#22833;/&#20889;&#22238;&#30340;&#26102;&#20505;&#38656;&#35201;&#29992;&#21040;&#23427;&#20204;:</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="c1">// &#20174;&#22359;&#21495;&#20026;`block_num`&#30340;&#20869;&#23384;&#22320;&#22336;&#20013;&#35835;&#20986;&#19968;&#25972;&#20010;cache&#22359;&#22823;&#23567;&#30340;&#20869;&#23481;&#21040;`buf`&#20013;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mem_read</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="w"> </span><span class="n">block_num</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="c1">// &#24448;&#22359;&#21495;&#20026;`block_num`&#30340;&#20869;&#23384;&#22320;&#22336;&#20013;&#20889;&#20837;&#19968;&#25972;&#20010;cache&#22359;&#22823;&#23567;&#30340;&#20869;&#23481;`buf`</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mem_write</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="w"> </span><span class="n">block_num</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#25105;&#20204;&#24050;&#32463;&#25552;&#20379;&#20102;&#19968;&#20221;&#26694;&#26550;&#20195;&#30721;&#65292;&#24037;&#20855;&#30340;&#21629;&#20196;&#34892;&#26684;&#24335;&#20026;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="p">.</span><span class="o">/</span><span class="n">cachesim</span><span class="o">-</span><span class="mi">64</span><span class="w"> </span><span class="o">[</span><span class="n">-r seed</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">trace</span><span class="o">]</span>
</code></pre></div>

<p class=" font-serif my-1">&#20854;&#20013; <code>seed</code> &#26159;&#38543;&#26426;&#31181;&#23376;&#65292;&#21487;&#20197;&#29992;&#20110;&#30830;&#23450;&#24615;&#22238;&#25918;&#24110;&#21161;&#35843;&#35797;&#65292;&#32570;&#30465;&#26102;&#20250;&#29992;&#31995;&#32479;&#26102;&#38388;&#20316;&#20026;&#31181;&#23376;&#65307;<code>trace</code> &#26159; <code>bz2</code> &#21387;&#32553;&#26684;&#24335;&#30340;&#35775;&#23384;&#24207;&#21015;&#65292;&#32570;&#30465;&#26102;&#20250;&#20135;&#29983;&#38543;&#26426;&#35775;&#23384;&#24207;&#21015;&#26469;&#27979;&#35797;&#12290;</p>
<h3 id="22-online-judge-cache" class=" text-lg mt-2 pb-2 font-sans">2.2 (&#36873;&#20570;&#65292;Online Judge &#19981;&#35780;&#27979;) &#29702;&#35299; cache &#30340;&#22797;&#26434;&#24615;&#23545;&#39057;&#29575;&#30340;&#24433;&#21709;</h3>
<p class=" font-serif my-1">&#25105;&#20204;&#25552;&#20379;&#20102;&#19968;&#20010;&#30495;&#23454;&#30340; workload &#20379;&#22823;&#23478;&#29702;&#35299;&#19981;&#21516; cache &#35774;&#35745;&#23545;&#24615;&#33021;&#20135;&#29983;&#30340;&#28508;&#22312;&#24433;&#21709;&#65306;<a href="https://box.nju.edu.cn/f/3f8856e5769e4f3fa15b/?dl=1" class=" text-amber-900">microbench-test.log.bz2</a>&#12290;</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_2" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">&#19981;&#35201;&#35299;&#21387;&#32553;</h4>
<p class=" font-serif my-1">&#24050;&#26377;&#30340;&#20195;&#30721;&#21487;&#20197;<strong>&#36890;&#36807;&#35843;&#29992;&#22806;&#37096;&#21629;&#20196; (bzcat)</strong> &#30452;&#25509;&#35835;&#21462;&#21387;&#32553;&#30340;&#26085;&#24535;&#25991;&#20214;&#12290;&#22312;&#19968;&#20010;&#31243;&#24207;&#37324;&#35843;&#29992;&#21478;&#19968;&#20010;&#31243;&#24207;&#20284;&#20046;&#36824;&#26159;&#22836;&#19968;&#27425;&#65292;&#22823;&#23478;&#21487;&#20197;&#20180;&#32454;&#38405;&#35835;&#20195;&#30721;&#65292;&#20854;&#20013;&#20351;&#29992;&#20102; popen &#20989;&#25968; (RTFM)&#12290;</p>
</blockquote>
<p class=" font-serif my-1">&#22312;&#23436;&#25104;&#23454;&#29616;&#20043;&#21518;&#65292;&#20320;&#23601;&#21487;&#20197;&#35266;&#23519; cache &#30340;&#21508;&#31867;&#24615;&#33021;&#25351;&#26631;&#65306;&#32531;&#23384;&#30340;&#32570;&#22833;&#29575;&#31561;&#12290;&#22312;&#23454;&#38469;&#30340;&#30828;&#20214;&#23454;&#29616;&#20013;&#65292;&#26356;&#22797;&#26434;&#30340;&#32531;&#23384;&#24847;&#21619;&#30528;&#26356;&#39640;&#30340;&#21629;&#20013;&#29575;&#65292;&#20294;&#20063;&#24847;&#21619;&#30528;&#26356;&#20302;&#30340;&#35775;&#38382;&#36895;&#24230;&#12290;&#34429;&#28982;&#27969;&#27700;&#32447;&#25216;&#26415;&#33021;&#38477;&#20302;&#32531;&#23384;&#23545;&#22788;&#29702;&#22120;&#39057;&#29575;&#30340;&#24433;&#21709;&#65292;&#22797;&#26434;&#30340;&#32531;&#23384;&#38477;&#20302;&#20102;&#32570;&#22833;&#30340;&#27425;&#25968; (&#25552;&#21319;&#20102;&#24615;&#33021;) &#30340;&#21478;&#19968;&#26041;&#38754;&#20063;&#38477;&#20302;&#20102;&#22788;&#29702;&#22120;&#30340; IPC (&#38477;&#20302;&#20102;&#24615;&#33021;)&#12290;&#35745;&#31639;&#26426;&#31995;&#32479;&#20013;&#24635;&#26159;&#26377;&#36825;&#26679;&#30340; trade-offs&#65292;&#20351;&#35774;&#35745;&#39640;&#25928;&#30340;&#31995;&#32479;&#25104;&#20026;&#19968;&#20010;&#24456;&#22823;&#30340;&#25361;&#25112;&#12290;</p>
<p class=" font-serif my-1">&#20026;&#20102;&#35780;&#20272;&#19968;&#20010;&#32473;&#23450; cache &#30340;&#24615;&#33021;&#65292;&#20320;&#21487;&#20197;&#23545;&#20197;&#19979;&#20960;&#26041;&#38754;&#36827;&#34892;&#24314;&#27169;&#65306;</p>
<ol class=" list-decimal font-serif">
<li class=" ml-8">cache &#30340;&#22797;&#26434;&#24615;&#65292;&#20855;&#20307;&#24230;&#37327;&#20026;&#35775;&#38382; cache &#25152;&#38656;&#30340;&#26102;&#38388; (ns)&#12290;&#36825;&#20250;&#38477;&#20302;&#22788;&#29702;&#22120;&#30340;&#39057;&#29575;&#12290;</li>
<li class=" ml-8">cache miss &#26102;&#30340;&#20195;&#20215;&#65292;&#26681;&#25454;&#20869;&#23384;&#35775;&#38382;&#30340;&#26102;&#38388;&#24314;&#27169;&#12290;</li>
</ol>
<p class=" font-serif my-1">&#23581;&#35797;&#20462;&#25913; cache &#30340;&#21508;&#31181;&#21442;&#25968; (&#20363;&#22914;&#25226; cache &#24635;&#22823;&#23567;&#25913;&#25104; 256B &#31561;)&#65292;&#24182;&#20026;&#27599;&#19968;&#20010;&#27169;&#22411;&#20272;&#35745;&#23427;&#30340;&#35775;&#38382;&#26102;&#38388;&#65292;&#28982;&#21518;&#26681;&#25454;&#20320;&#24314;&#31435;&#30340;&#27169;&#22411;&#35745;&#31639;&#32473;&#23450; workload &#30340; &#8220;&#36816;&#34892;&#26102;&#38388;&#8221;&#12290;&#26681;&#25454;&#20320;&#23545;&#35745;&#31639;&#26426;&#31995;&#32479;&#30340;&#29702;&#35299;&#65292;&#20320;&#21487;&#33021;&#21487;&#20197;&#32473;&#20986;&#20363;&#22914; microbench-test &#31561; workload &#19979;&#20320;&#35748;&#20026;&#26368;&#20339;&#30340; cache &#35774;&#35745;&#12290;</p>
<p class=" font-serif my-1">&#20363;&#22914;&#65292;&#20320;&#21487;&#20197;&#24314;&#31435;&#24102;&#21442;&#25968;&#30340;&#27169;&#22411;&#65292;&#20363;&#22914;&#20551;&#35774; associativity &#20026; $k$&#65292;&#21017;&#35775;&#38382;&#26102;&#38388;&#20026; $ak^2 + b$&#12290;&#36825;&#26679;&#20320;&#21487;&#20197;&#32771;&#23519; $a$, $b$ &#23545; cache &#24615;&#33021;&#30340;&#24433;&#21709;&#12290;</p>
<p class=" font-serif my-1">&#26085;&#24535;&#20998;&#26512;&#24037;&#20855;&#30340;&#22909;&#22788;&#22312;&#36825;&#37324;&#20307;&#29616;&#24471;&#28107;&#28435;&#23613;&#33268;&#65292;&#20320;&#21487;&#20197;&#36731;&#32780;&#26131;&#20030;&#22320;&#20462;&#25913;&#19968;&#20010; cache &#30340; &#8220;&#26500;&#36896;&#8221;&#65292;&#39532;&#19978;&#37325;&#26032;&#24320;&#22987;&#32479;&#35745;&#26032;&#30340;&#25968;&#25454;&#65292;&#32780;&#19981;&#38656;&#35201;&#20570;&#19968;&#20010;&#30495;&#27491;&#30340; cache &#25165;&#24320;&#22987;&#27979;&#35797;&#12290;&#33258;&#20174; cache &#30340;&#27010;&#24565;&#34987;&#25552;&#20986;&#26469;&#65292;&#26080;&#25968;&#30340;&#30740;&#31350;&#32773;&#25552;&#20986;&#20102;&#20116;&#33457;&#20843;&#38376;&#30340; cache&#12290;&#23398;&#26415;&#30028;&#20013;&#30740;&#31350; cache &#30340;&#35770;&#25991;&#26356;&#26159;&#25968;&#19981;&#32988;&#25968;&#65292;&#20294;&#34987;&#24037;&#19994;&#30028;&#37319;&#32435;&#30340; cache &#30740;&#31350;&#21364;&#23525;&#23525;&#26080;&#20960;&#65292;&#31350;&#20854;&#21407;&#22240;&#21482;&#26377;&#19968;&#20010;&#8212;&#8212;&#32440;&#19978;&#35848;&#20853;&#65292;&#26080;&#27861;&#29992;&#30828;&#20214;&#39640;&#25928;&#22320;&#23454;&#29616;&#12290;&#23454;&#38469;&#31995;&#32479;&#20013;&#30340; cache &#21644;&#22810;&#22788;&#29702;&#22120;&#20869;&#23384;&#19968;&#33268;&#24615;&#12289;MMU &#31561;&#37117;&#26159;&#32039;&#23494;&#32806;&#21512;&#30340;&#65292;&#22240;&#27492; cache &#30340;&#23454;&#29616;&#21487;&#33021;&#27604;&#22823;&#23478;&#24819;&#35937;&#24471;&#35201;&#22256;&#38590;&#12290;</p>
<h3 id="23" class=" text-lg mt-2 pb-2 font-sans">2.3 &#20195;&#30721;&#33719;&#21462;&#19982;&#25552;&#20132;</h3>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="academic-integrity" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">Academic Integrity</h4>
<p class=" font-serif my-1">&#20174;&#32593;&#19978;&#25110;&#21035;&#20154;&#37027;&#37324;&#22797;&#21046;&#20960;&#34892;&#20195;&#30721;&#38750;&#24120;&#31616;&#21333;&#8212;&#8212;&#20294;&#20320;&#22914;&#26524;&#36981;&#23432; academic integrity&#65292;&#33258;&#24049;&#23581;&#35797;&#23436;&#25104;&#65292;&#23601;&#20250;&#36935;&#21040;&#24040;&#22823;&#30340;&#22256;&#38590; (&#23588;&#20854;&#22914;&#26524;&#20320;&#27809;&#26377;&#35797;&#30528;&#29992;&#27491;&#30830;&#30340;&#24037;&#20855;&#12289;&#27491;&#30830;&#30340;&#26041;&#27861;&#35786;&#26029;&#38382;&#39064;)&#12290;&#36825;&#26159;&#25105;&#20204;&#32473;&#20320;&#24517;&#35201;&#30340;<strong>&#35757;&#32451;</strong>&#12290;</p>
<p class=" font-serif my-1">&#35831;&#20351;&#29992;&#25105;&#20204;&#30340; <code>Makefile</code> &#32534;&#35793; (&#22312;&#23454;&#39564;&#30446;&#24405;&#20013;&#25191;&#34892; <code>make</code>)&#65292;&#30830;&#20445; Git &#35760;&#24405;&#23436;&#25972;&#12290;</p>
</blockquote>
<p class=" font-serif my-1">&#22312;&#20043;&#21069;&#23454;&#39564;&#30340; ics-workbench &#20013;&#65292;&#22312;&#32456;&#31471;&#25191;&#34892;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>git pull origin lab4
</code></pre></div>

<p class=" font-serif my-1">&#21487;&#20197;&#33719;&#24471;&#23454;&#39564;&#30340;&#26694;&#26550;&#20195;&#30721;&#12290;&#25552;&#20132;&#26041;&#27861;&#21516;&#20043;&#21069;&#30340; Lab: &#22312;&#23454;&#39564;&#30340;&#24037;&#20316;&#30446;&#24405;&#20013;&#25191;&#34892; <code>make submit</code>&#12290;&#38656;&#35201;&#35774;&#32622; <code>STUID</code> (&#23398;&#21495;) &#21644; <code>STUNAME</code> (&#20013;&#25991;&#22995;&#21517;) &#29615;&#22659;&#21464;&#37327;&#12290;</p>
<p class=" font-serif my-1"><oj-status course="ICS2020" module="Lab4"><div class="divide-y divide-dashed">
    <div class="flex font-semibold">
      ICS2020-Lab4 &#25552;&#20132;&#32467;&#26524;
    </div>
    
  </div>
</oj-status></p>
<h3 id="24" class=" text-lg mt-2 pb-2 font-sans">2.4 &#35780;&#20998;&#19982;&#27491;&#30830;&#24615;&#26631;&#20934;</h3>
<p class=" font-serif my-1">&#25105;&#20204;&#20250;&#29992;&#19981;&#21516;&#30340;&#35774;&#23450;&#27979;&#35797;&#20320;&#30340; <code>cache.c</code> &#30340;&#27491;&#30830;&#24615;&#12290;&#21482;&#26377;&#19968;&#20010; Easy Test Case&#12290;</p>
<h2 id="3" class=" text-xl mt-2 pb-2 font-sans">3. &#23454;&#39564;&#25351;&#21335;</h2>
<h3 id="31-cache" class=" text-lg mt-2 pb-2 font-sans">3.1 Cache &#30340;&#25925;&#20107;</h3>
<p class=" font-serif my-1">&#38543;&#30528;&#38598;&#25104;&#30005;&#36335;&#25216;&#26415;&#30340;&#21457;&#23637;&#65292;CPU &#36234;&#26469;&#36234;&#24555;&#65307;&#21478;&#19968;&#26041;&#38754;&#65292;DRAM &#30340;&#36895;&#24230;&#21364;&#21463;&#38480;&#20110;&#23427;&#26412;&#36523;&#30340;<a href="http://computer.howstuffworks.com/ram.htm" class=" text-amber-900">&#24037;&#20316;&#21407;&#29702;</a>&#12290;&#25105;&#20204;&#20808;&#31616;&#35201;&#35299;&#37322;&#19968;&#19979;&#36825;&#20004;&#32773;&#30340;&#24046;&#21035;&#12290;DRAM &#30340;&#23384;&#20648;&#31354;&#38388;&#21487;&#20197;&#30475;&#25104;&#33509;&#24178;&#20010;&#20108;&#32500;&#30697;&#38453; (&#33509;&#24178;&#20010; bank)&#65292;&#30697;&#38453;&#20013;&#30340;&#27599;&#20010;&#20803;&#32032;&#21253;&#21547;&#19968;&#20010;&#26230;&#20307;&#31649;&#21644;&#19968;&#20010;&#30005;&#23481;&#65292;&#26230;&#20307;&#31649;&#20805;&#24403;&#24320;&#20851;&#30340;&#20316;&#29992;&#65292;&#21151;&#33021;&#19978;&#30456;&#24403;&#20110;&#35835;&#20889;&#20351;&#33021;&#65307;&#30005;&#23481;&#29992;&#26469;&#23384;&#20648;&#19968;&#20010; bit&#65292;&#24403;&#30005;&#23481;&#30340;&#30005;&#37327;&#22823;&#20110; 50%&#65292;&#23601;&#35748;&#20026;&#26159; <code>1</code>&#65292;&#21542;&#21017;&#23601;&#35748;&#20026;&#26159; <code>0</code>&#12290;&#20294;&#26159;&#30005;&#23481;&#26159;&#20250;&#28431;&#30005;&#30340;&#65292;&#22914;&#26524;&#19981;&#36827;&#34892;&#20219;&#20309;&#25805;&#20316;&#30340;&#35805;&#65292;&#30005;&#23481;&#20013;&#30340;&#30005;&#37327;&#23601;&#20250;&#19981;&#26029;&#19979;&#38477;&#65292;<code>1</code> &#26368;&#32456;&#20250;&#21464;&#25104; <code>0</code>&#65292;&#23384;&#20648;&#25968;&#25454;&#23601;&#20002;&#22833;&#20102;&#12290;</p>
<p class=" font-serif my-1">&#20026;&#20102;&#36991;&#20813;&#36825;&#31181;&#24773;&#20917;&#65292;DRAM &#24517;&#39035;&#23450;&#26102;&#21047;&#26032;&#65292;&#35835;&#20986;&#23384;&#20648;&#21333;&#20803;&#30340;&#27599;&#19968;&#20010; bit&#65292;&#22914;&#26524;&#34920;&#31034; <code>1</code>&#65292;&#23601;&#24448;&#37324;&#38754;&#20805;&#30005;&#12290;DRAM &#27599;&#27425;&#35835;&#25805;&#20316;&#37117;&#20250;&#35835;&#20986;&#20108;&#32500;&#30697;&#38453;&#20013;&#30340;&#19968;&#34892;&#65292;&#30001;&#20110;&#30005;&#23481;&#20250;&#28431;&#30005;&#30340;&#29305;&#24615;&#65292;&#22312;&#23558;&#19968;&#34892;&#25968;&#25454;&#35835;&#20986;&#20043;&#21069;&#65292;&#36824;&#35201;&#23545;&#36825;&#19968;&#34892;&#30340;&#30005;&#23481;&#36827;&#34892;&#39044;&#20805;&#30005;&#65292;&#38450;&#27490;&#22312;&#35835;&#20986;&#30340;&#36807;&#31243;&#20013;&#26377;&#30340;&#30005;&#23481;&#30005;&#37327;&#19979;&#38477;&#21040; 50% &#20197;&#19979;&#32780;&#34987;&#35823;&#35748;&#20026;&#26159; <code>0</code>&#12290;</p>
<p class=" font-serif my-1">&#32780; CPU &#30340;&#23492;&#23384;&#22120;&#37319;&#29992;&#30340;&#26159; SRAM&#65292;&#26159;&#36890;&#36807;&#19968;&#20010;&#35302;&#21457;&#22120;&#26469;&#23384;&#20648;&#19968;&#20010; bit&#65292;&#20855;&#20307;&#26469;&#35828;&#23601;&#26159; 4-6 &#20010;&#26230;&#20307;&#31649;&#65292;&#21482;&#35201;&#19981;&#26029;&#30005;&#65292;SRAM &#20013;&#30340;&#25968;&#25454;&#23601;&#19981;&#20250;&#20002;&#22833;&#65292;&#19981;&#38656;&#35201;&#23450;&#26102;&#21047;&#26032;&#65292;&#20063;&#19981;&#38656;&#35201;&#39044;&#20805;&#30005;&#65292;&#35835;&#20889;&#36895;&#24230;&#38543;&#30528;&#20027;&#39057;&#30340;&#25552;&#21319;&#32780;&#25552;&#21319;&#12290;</p>
<p class=" font-serif my-1">&#30001;&#20110; RISC &#26550;&#26500;&#30340;&#25351;&#20196;&#23569;&#65292;&#26684;&#24335;&#35268;&#25972;&#65292;&#30828;&#20214;&#30340;&#36923;&#36753;&#19981;&#31639;&#29305;&#21035;&#22797;&#26434;&#65292;CPU &#20570;&#20986;&#26469;&#20043;&#21518;&#65292;&#33455;&#29255;&#19978;&#36824;&#22810;&#20986;&#20102;&#24456;&#22810;&#38754;&#31215;&#12290;&#20026;&#20102;&#25226;&#36825;&#20123;&#38754;&#31215;&#21033;&#29992;&#36215;&#26469;&#65292;&#26550;&#26500;&#24072;&#20204;&#25552;&#20986;&#20102; cache &#30340;&#27010;&#24565;&#65292;&#25226;&#21097;&#19979;&#30340;&#38754;&#31215;&#29992;&#20110; SRAM&#65292;&#21516;&#26102;&#20063;&#20026;&#20102;&#24357;&#34917; CPU &#21644; Memory &#20043;&#21069;&#24615;&#33021;&#30340;&#40511;&#27807;&#12290;CISC &#30340;&#36816;&#27668;&#23601;&#27809;&#37027;&#20040;&#22909;&#20102;&#65292;&#25351;&#20196;&#22810;&#65292;&#26684;&#24335;&#19981;&#35268;&#25972;&#65292;&#30828;&#20214;&#36923;&#36753;&#21313;&#20998;&#22797;&#26434;&#65292;&#22312;&#33455;&#29255;&#19978;&#19968;&#26102;&#38388;&#33150;&#19981;&#20986;&#22320;&#26041;&#26469;&#25918; cache&#65292;&#25152;&#20197;&#20320;&#22312; i386 &#25163;&#20876;&#19978;&#25214;&#19981;&#21040;&#21644; cache &#30456;&#20851;&#30340;&#20869;&#23481;&#12290;&#24403; CISC &#26550;&#26500;&#24072;&#20204;&#24847;&#35782;&#21040;&#22797;&#26434;&#30340;&#30005;&#36335;&#36923;&#36753;&#24050;&#32463;&#25104;&#20026;&#20102;&#25552;&#39640;&#24615;&#33021;&#30340;&#29942;&#39048;&#26102;&#65292;&#20182;&#20204;&#25165;&#21521; RISC &#21462;&#32463;&#65292;&#25226;&#25351;&#20196;&#20998;&#35299;&#25104;&#24494;&#25351;&#20196;&#26469;&#25191;&#34892;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>                              R[EAX] &lt;- M[var]
addl $1, var        =&gt;        R[EAX] &lt;- R[EAX] + 1
                              M[var] &lt;- R[EAX]
</code></pre></div>

<p class=" font-serif my-1">&#36825;&#26679;&#23601;&#20943;&#23569;&#20102;&#30828;&#20214;&#30340;&#36923;&#36753;&#65292;&#35753;&#24494;&#25351;&#20196;&#30340;&#25191;&#34892;&#27969;&#27700;&#21270;&#30340;&#21516;&#26102;&#65292;&#20063;&#21487;&#20197;&#33150;&#20986;&#38754;&#31215;&#26469;&#20570; cache &#20102;&#65292;&#19981;&#36807;&#36825;&#20123;&#37117;&#26159;&#21518;&#35805;&#20102;&#12290;</p>
<h3 id="32-cache" class=" text-lg mt-2 pb-2 font-sans">3.2 Cache &#30340;&#24605;&#24819;&#21644;&#35774;&#35745;</h3>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="fast-and-slow-paths" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">Fast and Slow Paths</h4>
<p class=" font-serif my-1">&#35745;&#31639;&#26426;&#31995;&#32479;&#20013;&#26377;&#19968;&#20010;&#24456;&#24120;&#35265;&#30340;&#35299;&#20915;&#38382;&#39064;&#30340;&#24605;&#36335;&#65292;&#23601;&#26159;&#25226;&#38382;&#39064;&#20998;&#31867;&#65306;&#23545;&#20110;&#19968;&#20010;&#38382;&#39064;&#65292;&#25105;&#20204;&#23384;&#22312;&#19968;&#20010;&#19981;&#23436;&#32654;&#20294;&#31616;&#21333;&#12289;&#39640;&#25928;&#30340;&#35299;&#20915;&#26041;&#26696; (&#20363;&#22914; 99.9% &#25104;&#21151;&#29575;)&#65292;&#32780;&#19968;&#20010;&#23436;&#32654;&#30340;&#35299;&#20915;&#26041;&#26696;&#20195;&#20215;&#24456;&#22823;&#26102;&#65292;&#25105;&#20204;&#19981;&#22952;&#20808;&#35797;&#30528;&#29992;&#31616;&#21333;&#20998;&#26041;&#27861;&#20570;&#20570;&#30475; (fast path)&#65292;&#22914;&#26524;&#19981;&#25104;&#21151;&#20877;&#35843;&#29992;&#23436;&#32654;&#30340;&#26041;&#26696;&#12290;&#20154;&#31867;&#21516;&#26679;&#20063;&#26377;&#36825;&#26679;&#30340;&#31995;&#32479;&#65292;&#22823;&#23478;&#19981;&#22952;&#35835;&#19968;&#35835;&#19968;&#26412;&#26377;&#36259;&#30340;&#35838;&#22806;&#20070; &#8220;Thinking: Fast and Slow&#8221;&#12290;</p>
</blockquote>
<p class=" font-serif my-1">Cache &#24037;&#20316;&#26041;&#24335;&#23454;&#38469;&#19978;&#26159;&#23616;&#37096;&#24615;&#21407;&#29702;&#30340;&#24212;&#29992;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#22914;&#26524;&#31243;&#24207;&#35775;&#38382;&#20102;&#19968;&#20010;&#20869;&#23384;&#21306;&#38388;&#65292;&#37027;&#20040;&#36825;&#20010;&#20869;&#23384;&#21306;&#38388;&#24456;&#26377;&#21487;&#33021;&#22312;&#19981;&#20037;&#30340;&#23558;&#26469;&#20250;&#34987;&#20877;&#27425;&#35775;&#38382;&#65292;&#36825;&#23601;&#26159;&#26102;&#38388;&#23616;&#37096;&#24615;&#12290;
  &#20363;&#22914;&#24490;&#29615;&#25191;&#34892;&#19968;&#23567;&#27573;&#20195;&#30721;&#65292;&#25110;&#32773;&#26159;&#23545;&#19968;&#20010;&#21464;&#37327;&#36827;&#34892;&#35835;&#20889; (<code>addl $1, var</code> &#38656;&#35201;&#23558; <code>var</code> &#21464;&#37327;&#20174;&#20869;&#23384;&#20013;&#35835;&#20986;&#65292;&#21152; 1 &#20043;&#21518;&#20877;&#20889;&#22238;&#20869;&#23384;)&#12290;</li>
<li class=" ml-8">&#22914;&#26524;&#31243;&#24207;&#35775;&#38382;&#20102;&#19968;&#20010;&#20869;&#23384;&#21306;&#38388;&#65292;&#37027;&#20040;&#36825;&#20010;&#20869;&#23384;&#21306;&#38388;&#30340;&#30456;&#37051;&#21306;&#38388;&#24456;&#26377;&#21487;&#33021;&#22312;&#19981;&#20037;&#30340;&#23558;&#26469;&#20250;&#34987;&#35775;&#38382;&#65292;&#36825;&#23601;&#26159;&#31354;&#38388;&#23616;&#37096;&#24615;&#12290;&#20363;&#22914;&#39034;&#24207;&#25191;&#34892;&#20195;&#30721;&#65292;&#25110;&#32773;&#26159;&#25195;&#25551;&#25968;&#32452;&#20803;&#32032;&#12290;</li>
</ul>
<p class=" font-serif my-1">&#30456;&#24212;&#30340;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#20026;&#20102;&#21033;&#29992;&#26102;&#38388;&#23616;&#37096;&#24615;&#65292;cache &#23558;&#26242;&#26102;&#23384;&#25918;&#20174;&#20869;&#23384;&#35835;&#20986;&#30340;&#25968;&#25454;&#65292;&#24403; CPU &#25171;&#31639;&#20877;&#27425;&#35775;&#38382;&#36825;&#20123;&#25968;&#25454;&#30340;&#26102;&#20505;&#65292;&#23427;&#19981;&#38656;&#35201;&#21435;&#35775;&#38382;&#20869;&#23384;&#65292;&#32780;&#26159;&#30452;&#25509;&#22312; cache &#20013;&#35835;&#20986;&#21363;&#21487;&#12290;&#23601;&#36825;&#26679;&#25226;&#25968;&#25454;&#19968;&#25918;&#65292;&#37027;&#20123;&#23567;&#24490;&#29615;&#30340;&#25191;&#34892;&#36895;&#24230;&#39532;&#19978;&#25552;&#39640;&#20102;&#25968;&#21313;&#20493;&#12290;</li>
<li class=" ml-8">&#20026;&#20102;&#21033;&#29992;&#31354;&#38388;&#23616;&#37096;&#24615;&#65292;cache &#20174;&#20869;&#23384;&#20013;&#35835;&#25968;&#25454;&#30340;&#26102;&#20505;&#65292;&#24182;&#19981;&#26159; CPU &#35201;&#22810;&#23569;&#35835;&#22810;&#23569;&#65292;&#32780;&#26159;&#19968;&#27425;&#22810;&#35835;&#28857;&#12290;Cache &#21521;&#20869;&#23384;&#36827;&#34892;&#35835;&#20889;&#30340;&#22522;&#26412;&#21333;&#20301;&#26159; cache block (&#22359;)&#12290;&#29616;&#20195;&#30340; cache &#35774;&#35745;&#36824;&#20250;&#22312;&#31354;&#38386;&#30340;&#26102;&#20505;&#36827;&#34892;&#39044;&#21462; (prefetch)&#65292;&#24403; CPU &#19968;&#30452;&#22312;&#35745;&#31639;&#30340;&#26102;&#20505;&#65292;cache &#20250;&#36225;&#36825;&#27573;&#26102;&#38388;&#21521;&#20869;&#23384;&#25343;&#28857;&#25968;&#25454;&#65292;&#23558;&#26469; CPU &#27491;&#22909;&#38656;&#35201;&#30340;&#35805;&#23601;&#19981;&#29992;&#20877;&#33457;&#26102;&#38388;&#25343;&#20102;&#12290;</li>
</ul>
<p class=" font-serif my-1">&#36825;&#21548;&#36215;&#26469;&#24456;&#19981;&#38169;&#65292;&#26377;&#20102; cache&#65292;&#21482;&#35201; CPU &#35775;&#38382; cache &#30340;&#26102;&#20505;&#21629;&#20013;&#65292;&#23601;&#19981;&#38656;&#35201;&#25226;&#22823;&#37327;&#26102;&#38388;&#33457;&#36153;&#22312;&#35775;&#23384;&#19978;&#38754;&#20102;&#12290;&#19981;&#36807;&#20026;&#20102;&#20445;&#35777; cache &#30340;&#21629;&#20013;&#29575;&#65292;cache &#26412;&#36523;&#20063;&#38656;&#35201;&#22788;&#29702;&#24456;&#22810;&#38382;&#39064;&#65292;&#20363;&#22914;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#19968;&#20010;&#20869;&#23384;&#21306;&#22495;&#21487;&#20197;&#34987;&#26144;&#23556;&#21040;&#22810;&#23569;&#20010; cache block&#65311;&#23569;&#20102;&#23481;&#26131;&#20914;&#31361;&#65292;&#22810;&#20102;&#30005;&#36335;&#36923;&#36753;&#21644;&#21151;&#32791;&#37117;&#20250;&#19978;&#21319;&#12290;&#23545;&#36825;&#20010;&#38382;&#39064;&#30340;&#22238;&#31572;&#21010;&#20998;&#20102;&#19981;&#21516;&#30340; cache &#32452;&#32455;&#26041;&#24335;&#65292;&#21253;&#25324; direct-mapped (&#30452;&#25509;&#26144;&#23556;), set associative (&#32452;&#30456;&#32852;) &#21644; fully associative (&#20840;&#30456;&#32852;)&#12290;</li>
<li class=" ml-8">&#20914;&#31361;&#30340;&#26102;&#20505;&#65292;&#38656;&#35201;&#26367;&#25442;&#21738;&#19968;&#20010; cache block&#65311;&#36825;&#20010;&#38382;&#39064;&#30340;&#22238;&#31572;&#28041;&#21450;&#21040;&#26367;&#25442;&#31639;&#27861;&#65292;&#26368;&#29702;&#24819;&#30340;&#24773;&#20917;&#26159;&#26367;&#25442;&#37027;&#20010;&#24456;&#38271;&#26102;&#38388;&#37117;&#27809;&#35775;&#38382;&#36807;&#30340; cache block&#65292;&#36825;&#23601;&#26159; LRU &#31639;&#27861;&#12290;&#20294;&#36825;&#23545;&#30828;&#20214;&#23454;&#29616;&#26469;&#35828;&#22826;&#22797;&#26434;&#20102;&#65292;&#23545;&#20110; 8-way set associative &#26469;&#35828;&#65292;&#27599;&#19968;&#20010; set &#20013;&#30340; 8 &#20010; cache block &#37117;&#26377; $8! = 40320$ &#31181;&#21487;&#33021;&#30340;&#35775;&#38382;&#24773;&#20917;&#65292;&#32534;&#30721;&#33267;&#23569;&#38656;&#35201; 16 &#20010; bit&#65292;&#35793;&#30721;&#21017;&#38656;&#35201;&#26356;&#22823;&#30340;&#20195;&#20215;&#65292;&#30005;&#36335;&#36923;&#36753;&#21644;&#26102;&#24310;&#37117;&#20250;&#19978;&#21319;&#12290;&#22240;&#27492;&#23454;&#38469;&#19978;&#20250;&#37319;&#29992;&#20266; LRU &#31639;&#27861;&#65292;&#36817;&#20284;&#35760;&#24405; cache block &#30340;&#35775;&#38382;&#24773;&#20917;&#65292;&#20174;&#32780;&#38477;&#20302;&#30828;&#20214;&#22797;&#26434;&#24230;&#12290;&#20063;&#26377;&#30740;&#31350;&#34920;&#26126;&#65292;&#38543;&#26426;&#26367;&#25442;&#30340;&#25928;&#26524;&#20063;&#19981;&#20250;&#24456;&#24046;&#12290;</li>
<li class=" ml-8">&#20889; cache &#30340;&#26102;&#20505;&#35201;&#19981;&#35201;&#27599;&#27425;&#37117;&#20889;&#22238;&#21040;&#20869;&#23384;?&#36825;&#20010;&#38382;&#39064;&#28041;&#21450;&#21040;&#20889;&#31574;&#30053;&#65292;write through (&#20889;&#36890;) &#31574;&#30053;&#35201;&#27714;&#27599;&#27425; cache &#30340;&#20889;&#25805;&#20316;&#37117;&#21516;&#26102;&#26356;&#26032;&#20869;&#23384;&#65292;cache &#20013;&#30340;&#25968;&#25454;&#21644;&#20869;&#23384;&#20013;&#30340;&#25968;&#25454;&#24635;&#26159;&#19968;&#33268;&#30340;&#65307;write back (&#20889;&#22238;) &#31574;&#30053;&#21017;&#31561;&#21040; cache block &#34987;&#26367;&#25442;&#25165;&#26356;&#26032;&#20869;&#23384;&#65292;&#23601;&#33410;&#30465;&#20102;&#24456;&#22810;&#20869;&#23384;&#20889;&#25805;&#20316;&#65292;&#20294;&#25968;&#25454;&#19968;&#33268;&#24615;&#24471;&#19981;&#21040;&#20445;&#35777;&#65292;&#26368;&#26032;&#30340;&#25968;&#25454;&#26377;&#21487;&#33021;&#22312; cache &#20013;&#12290;&#25968;&#25454;&#19968;&#33268;&#24615;&#22312;&#22810;&#26680;&#26550;&#26500;&#20013;&#26159;&#21313;&#20998;&#37325;&#35201;&#30340;&#65292;&#22914;&#26524;&#19968;&#20010;&#26680;&#36890;&#36807;&#35775;&#38382;&#20869;&#23384;&#25343;&#21040;&#20102;&#19968;&#20010;&#36807;&#26102;&#30340;&#25968;&#25454;&#65292;&#29992;&#23427;&#26469;&#36827;&#34892;&#36816;&#31639;&#24471;&#21040;&#30340;&#32467;&#26524;&#23601;&#26159;&#38169;&#35823;&#30340;&#12290;</li>
<li class=" ml-8">&#20889;&#32570;&#22833;&#30340;&#26102;&#20505;&#35201;&#19981;&#35201;&#22312; cache &#20013;&#20998;&#37197;&#19968;&#20010; cache block&#65311;&#20998;&#37197;&#23601;&#26356;&#23481;&#26131;&#24341;&#36215;&#20914;&#31361;&#65292;&#19981;&#20998;&#37197;&#23601;&#27809;&#26377;&#29992;&#21040;&#26102;&#38388;&#23616;&#37096;&#24615;&#12290;</li>
</ul>
<p class=" font-serif my-1">&#36825;&#20123;&#38382;&#39064;&#24182;&#27809;&#26377;&#23436;&#32654;&#30340;&#22238;&#31572;&#65292;&#20219;&#20309;&#19968;&#20010;&#36873;&#25321;&#37117;&#26159; trade-off&#65292;&#24819;&#33719;&#24471;&#22909;&#22788;&#21183;&#24517;&#35201;&#20184;&#20986;&#30456;&#24212;&#30340;&#20195;&#20215;&#65292;&#35745;&#31639;&#26426;&#23601;&#26159;&#36825;&#26679;&#19968;&#20010;&#20844;&#24179;&#30340;&#19990;&#30028;&#12290;</p>
<p class=" font-serif my-1">&#21478;&#19968;&#20010;&#20540;&#24471;&#32771;&#34385;&#30340;&#38382;&#39064;&#26159;&#22914;&#20309;&#38477;&#20302; cache &#32570;&#22833;&#30340;&#20195;&#20215;&#12290;&#19968;&#31181;&#26041;&#27861;&#26159;&#37319;&#29992;&#22810;&#32423;&#30340; cache &#32467;&#26500;&#65292;&#24403; L1 cache &#21457;&#29983;&#32570;&#22833;&#26102;&#65292;&#23601;&#21435; L2 cache &#20013;&#26597;&#25214;&#65292;&#21482;&#26377;&#24403; L2 cache &#20063;&#21457;&#29983;&#32570;&#22833;&#26102;&#65292;&#25165;&#21435;&#35775;&#38382;&#20869;&#23384;&#12290;L2 cache &#36890;&#24120;&#27604; L1 cache &#35201;&#22823;&#65292;&#25152;&#20197;&#26597;&#25214;&#25152;&#33457;&#26102;&#38388;&#35201;&#22810;&#19968;&#20123;&#65292;&#20294;&#24590;&#20040;&#35828;&#20063;&#27604;&#35775;&#38382;&#20869;&#23384;&#35201;&#24555;&#12290;&#36824;&#26377;&#19968;&#31181;&#26041;&#27861;&#26159;&#37319;&#29992; victim cache&#65292;&#34987;&#26367;&#25442;&#30340; cache block &#20808;&#20020;&#26102;&#23384;&#25918;&#22312; victim cache &#20013;&#65292;&#31561;&#21040;&#35201;&#35775;&#38382;&#37027;&#20010;&#19981;&#24184;&#34987;&#26367;&#25442;&#30340; cache block &#30340;&#26102;&#20505;&#65292;&#21487;&#20197;&#20174; victim cache &#20013;&#25214;&#22238;&#26469;&#12290;&#23454;&#39564;&#25968;&#25454;&#34920;&#26126;&#65292;&#20165;&#20165;&#26159;&#19968;&#20010;&#22823;&#23567;&#21482;&#26377; 4 &#39033;&#30340; victim cache&#65292;&#23545;&#20110; direct-mapped &#32452;&#32455;&#26041;&#24335;&#30340; cache &#26377;&#21313;&#20998;&#26126;&#26174;&#30340;&#24615;&#33021;&#25552;&#21319;&#65292;&#26377;&#26102;&#20505;&#21487;&#20197;&#33410;&#30465;&#39640;&#36798; 90% &#30340;&#35775;&#23384;&#12290;</p>
<p class=" font-serif my-1">&#19978;&#38754;&#21465;&#36848;&#30340;&#21482;&#26159; CPU cache&#65292;&#20107;&#23454;&#19978;&#35745;&#31639;&#26426;&#19990;&#30028;&#21040;&#22788;&#34164;&#21547;&#30528; cache &#30340;&#24605;&#24819;&#12290;&#22312;&#20320;&#38405;&#35835;&#26412;&#39029;&#38754;&#30340;&#26102;&#20505;&#65292;&#26412;&#39029;&#38754;&#30340;&#20869;&#23481;&#24050;&#32463;&#34987;&#23384;&#25918;&#21040;&#32593;&#39029;&#32531;&#23384;&#20013;&#20102;&#65307;&#20351;&#29992; <code>printf</code> &#24182;&#27809;&#26377;&#21450;&#26102;&#36755;&#20986;&#65292;&#26159;&#22240;&#20026;&#27599;&#27425;&#21482;&#36755;&#20986;&#19968;&#20010;&#23383;&#31526;&#38656;&#35201;&#33457;&#24456;&#22823;&#30340;&#20195;&#20215;&#65292;&#22240;&#27492;&#31243;&#24207;&#20250;&#23558;&#20869;&#23481;&#20808;&#25918;&#22312;&#36755;&#20986;&#32531;&#23384;&#21306;&#65292;&#31561;&#21040;&#32531;&#20914;&#21306;&#28385;&#20102;&#20877;&#36755;&#20986;&#65292;&#36825;&#20854;&#23454;&#26377;&#28857; write back &#30340;&#24433;&#23376; (&#23454;&#38469;&#24773;&#20917;&#35201;&#31245;&#24494;&#22797;&#26434;&#19968;&#20123;&#65292;&#25105;&#20204;&#20250;&#22312;&#12298;&#25805;&#20316;&#31995;&#32479;&#12299;&#35838;&#19978;&#22238;&#21040;&#36825;&#20010;&#35805;&#39064;)&#12290;&#20687;&#20869;&#23384;&#12289;&#30913;&#30424;&#36825;&#20123;&#30456;&#23545;&#20110; CPU &#26469;&#35828;&#30340; &#8220;&#20302;&#36895;&#8221; &#30828;&#20214;&#65292;&#37117;&#26377;&#30456;&#24212;&#30340;&#30828;&#20214; cache &#26469;&#25552;&#39640;&#24615;&#33021;&#12290;</p>
<p class=" font-serif my-1">&#20877;&#27604;&#22914;&#65292;&#29616;&#20195;&#30340; DRAM &#19968;&#33324;&#37117;&#21253;&#21547;&#20197;&#19979;&#20004;&#31181;&#21151;&#33021;&#65306;</p>
<ol class=" list-decimal font-serif">
<li class=" ml-8">&#27599;&#20010; bank &#20013;&#37117;&#26377;&#19968;&#20010;&#34892;&#32531;&#23384;&#65292;&#35835;&#20986;&#19968;&#34892;&#30340;&#26102;&#20505;&#20250;&#25226;&#25968;&#25454;&#25918;&#21040;&#34892;&#32531;&#23384;&#20013;&#65292;&#22914;&#26524;&#25509;&#19979;&#26469;&#30340;&#35775;&#23384;&#25805;&#20316;&#30340;&#30446;&#30340;&#25968;&#25454;&#27491;&#22909;&#22312;&#34892;&#32531;&#23384;&#20013;&#65292;&#23601;&#30452;&#25509;&#23545;&#34892;&#32531;&#23384;&#36827;&#34892;&#25805;&#20316;&#65292;&#32780;&#19981;&#38656;&#35201;&#20877;&#36827;&#34892;&#39044;&#20805;&#30005;&#12290;</li>
<li class=" ml-8">&#37319;&#29992; burst (&#31361;&#21457;&#35835;&#20889;) &#25216;&#26415;&#65292;&#27599;&#27425;&#35835;&#20889; DRAM &#30340;&#26102;&#20505;&#19981;&#20165;&#35835;&#20889;&#30446;&#30340;&#23384;&#20648;&#21333;&#20803;&#65292;&#25226;&#20854;&#30456;&#37051;&#30340;&#23384;&#20648;&#21333;&#20803;&#20063;&#19968;&#21516;&#36827;&#34892;&#35835;&#20889;&#65292;&#36825;&#26679;&#23545;&#20110;&#19968;&#20123;&#29289;&#29702;&#23384;&#20648;&#36830;&#32493;&#30340;&#25805;&#20316; (&#20363;&#22914;&#25968;&#32452;)&#65292;&#19968;&#27425; DRAM &#25805;&#20316;&#23601;&#21487;&#20197;&#35835;&#20889;&#22810;&#20010;&#23384;&#20648;&#21333;&#20803;&#20102;&#12290;</li>
</ol>
<p class=" font-serif my-1">&#26126;&#30333; cache &#23384;&#22312;&#30340;&#20215;&#20540;&#20043;&#21518;&#65292;&#20320;&#23601;&#19981;&#38590;&#29702;&#35299;&#36825;&#20123;&#25216;&#26415;&#30340;&#24847;&#20041;&#20102;&#12290;&#21487;&#24796;&#30340;&#26159;&#65292;DRAM &#20173;&#26087;&#25670;&#33073;&#19981;&#20102;&#23450;&#26102;&#21047;&#26032;&#30340;&#21629;&#36816;&#12290;</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_3" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">&#24605;&#32771;&#39064;: &#25968;&#25454;&#23545;&#40784;&#21644;&#23384;&#20648;&#23618;&#27425;&#32467;&#26500;</h4>
<p class=" font-serif my-1">&#24819;&#19968;&#24819;&#65292;&#20026;&#20160;&#20040;&#32534;&#35793;&#22120;&#20026;&#21464;&#37327;&#20998;&#37197;&#23384;&#20648;&#31354;&#38388;&#30340;&#26102;&#20505;&#19968;&#33324;&#37117;&#20250;&#23545;&#40784;?&#35775;&#38382;&#19968;&#20010;&#27809;&#26377;&#23545;&#40784;&#30340;&#23384;&#20648;&#31354;&#38388;&#20250;&#32463;&#21382;&#24590;&#20040;&#26679;&#30340;&#36807;&#31243;&#65311;</p>
<p class=" font-serif my-1">&#20851;&#20110; cache &#20855;&#20307;&#22914;&#20309;&#24037;&#20316;&#65292;&#35838;&#19978;&#37117;&#24050;&#32463;&#35814;&#32454;&#35762;&#36807;&#65292;&#36825;&#37324;&#23601;&#19981;&#21478;&#22806;&#21465;&#36848;&#20102;&#12290;&#20540;&#24471;&#19968;&#25552;&#30340;&#26159;&#32500;&#22522;&#30334;&#31185;&#20013;&#30340; <a href="http://en.wikipedia.org/wiki/CPU_cache" class=" text-amber-900">CPU cache</a> &#39029;&#38754;&#65292;&#37324;&#38754;&#38500;&#20102;&#35838;&#22530;&#19978;&#35762;&#36807;&#30340;&#30693;&#35782;&#65292;&#36824;&#26377;&#35832;&#22810;&#24310;&#20280;&#65292;&#20540;&#24471;&#20180;&#32454;&#29730;&#30952;&#12290;</p>
</blockquote>
<h3 id="32-cache_1" class=" text-lg mt-2 pb-2 font-sans">3.2 &#27979;&#35797;&#20320;&#30340; Cache &#23454;&#29616;</h3>
<p class=" font-serif my-1">&#26694;&#26550;&#20195;&#30721;&#25552;&#20379;&#20102;&#19968;&#22871; CPU &#25509;&#21475; <code>cpu_read()</code> &#21644; <code>cpu_write()</code>&#65292;&#23427;&#20204;&#20250;&#35843;&#29992;&#20320;&#23454;&#29616;&#30340; <code>cache_read()</code> &#21644; <code>cache_write()</code>&#12290;&#21516;&#26102;&#26694;&#26550;&#20195;&#30721;&#25552;&#20379;&#20102;&#19968;&#22871; uncache &#30340;&#25509;&#21475; <code>cpu_uncache_read()</code> &#21644; <code>cpu_uncache_write()</code>&#65292;&#29992;&#20110;&#30452;&#25509;&#35775;&#38382;&#21478;&#19968;&#20010;&#29420;&#31435;&#30340;&#20869;&#23384; &#36825;&#26679;&#26159;&#20026;&#20102;&#23545;&#20320;&#30340;&#23454;&#29616;&#36827;&#34892;&#23545;&#27604;&#27979;&#35797;&#65292;&#27979;&#35797;&#30340;&#20027;&#35201;&#24605;&#24819;&#26159; cache &#26159;&#23545; CPU <strong>&#36879;&#26126;</strong>&#30340;&#65306;&#20174; CPU &#31471;&#26469;&#30475;&#65292;&#26377;&#26080; cache &#24182;&#19981;&#24433;&#21709;&#35835;&#25968;&#25454;&#30340;&#32467;&#26524;&#12290;&#22240;&#27492;&#65292;&#26694;&#26550;&#20195;&#30721;&#20250;&#38543;&#26426;&#29983;&#25104;&#19968;&#20123;&#35775;&#23384;&#35831;&#27714;&#65292;&#21516;&#26102;&#36755;&#20837;&#21040;&#20004;&#22871;CPU&#25509;&#21475;&#20013;&#65292;&#24182;&#23545;&#27604;&#35835;&#25509;&#21475;&#30340;&#32467;&#26524;&#12290;&#33509;&#22312;&#26576;&#19968;&#26102;&#21051;&#21457;&#29616;&#35835;&#32467;&#26524;&#19981;&#19968;&#33268;&#65292;&#23601;&#20250;&#35302;&#21457; &#8220;assertion failed&#8221;&#12290;</p>
<p class=" font-serif my-1">&#21478;&#22806;&#20026;&#20102;&#26041;&#20415;&#35843;&#35797;&#65292;&#25105;&#20204;&#20801;&#35768;&#23558;&#38543;&#26426;&#31181;&#23376;&#20316;&#20026;&#21442;&#25968;&#26469;&#36816;&#34892; cache &#31243;&#24207;&#65292;&#22914;&#26524;&#20351;&#29992;&#30456;&#21516;&#30340;&#31181;&#23376;&#22810;&#27425;&#36816;&#34892;&#65292;&#23601;&#20250;&#20135;&#29983;&#19968;&#26679;&#30340;&#38543;&#26426;&#25968;&#24207;&#21015;&#12290;</p></div>
</div>

<div class="container text-xs py-3">
  <span class="text-muted">
    <center><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="../../../static/img/cc-4.0.png"></a>
    &#160;&#160;&#160;<a style="color:inherit" href="https://beian.miit.gov.cn/">&#33487; ICP &#22791; 2020049101 &#21495;</a>
    </center>
  </span>
</div>

</div>

<script src="../../../static/js/jquery.min.js"></script>

<script>
function get_token() {
  var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
  if (match) return match[2];
  else return "";
}
var token = get_token();
var hint = "token", box = $("#token-input");

if (token == "") { }
else { box.val(token); }

function login() {
  var token = box.val()
  if (!token) {
    document.cookie = ''
  } else {
    document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;'
  }
}
</script>


</body>

</html>