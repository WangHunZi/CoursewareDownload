<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Yanyan&#x27;s Wiki</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"/><meta name="next-head-count" content="5"/><link rel="preload" href="../_next/static/css/e993edd6a18ef4f0.css" as="style"/><link rel="stylesheet" href="../_next/static/css/e993edd6a18ef4f0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../_next/static/chunks/webpack-f73d82589f972e7d.js" defer=""></script><script src="../_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="../_next/static/chunks/main-3929bf55b0f13a18.js" defer=""></script><script src="../_next/static/chunks/pages/_app-00b06920b385caf1.js" defer=""></script><script src="../_next/static/chunks/pages/[[...index]]-877ec949b69be209.js" defer=""></script><script src="../_next/static/a2FwJzUPGFGc0QcwaUr13/_buildManifest.js" defer=""></script><script src="../_next/static/a2FwJzUPGFGc0QcwaUr13/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-slate-300/10"><div class="sticky top-0 z-40 w-full backdrop-blur flex-none border-b border-slate-900/10 bg-white/75 supports-backdrop-blur:bg-white/60"><div class="max-w-8xl mx-auto"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="relative flex items-center"><a href="../index.html">Yanyan&#x27;s wiki</a><form class="text-xs text-slate-500"> for <input type="text" name="token" class="font-mono text-xs w-16" maxLength="8"/></form><div class="relative hidden lg:flex items-center ml-4 pl-4 border-l"><nav class="text-sm leading-6 font-semibold text-slate-700 dark:text-slate-200"><ul class="flex space-x-8"><li><a class="hover:text-sky-500 dark:hover:text-sky-400" href="2025/index.html">操作系统 (2025 春)</a></li></ul></nav></div></div></div></div></div><div class="container mx-auto max-w-5xl flex flex-col min-h-screen px-4"><div class="wiki bg-neutral-200/10"><h1>SSH 聊天室实现原理</h1>
<p>SSH 聊天室受到 <a href="http://sshtron.zachlatta.com/">sshtron</a> (贪吃蛇) 的启发。OpenSSH Server 允许我们指定 “ForceCommand”，即该用户强制只能执行此命令。</p>
<pre><code class="hljs language-text">Match user chat
  PermitEmptyPasswords yes
  ForceCommand /home/chat/startup
</code></pre>
<p>连接时需要 <code>-t</code> 的原因是，在 <code>ssh</code> 带参数时默认不会分配终端。startup 启动一个普通的 curses 程序，使用 <a href="https://docs.python.org/3/howto/curses.html">Python curses 标准库</a> 实现；大部分代码都由 GPT-4 生成。</p>
<blockquote>
<p>Prompt: Give me a python code using curses, there is a input box in the bottom, while a file&#x27;s content is constantly updated on the top panel in a separate thread. (Directly give the code without any explanation or tutorial setups.)</p>
</blockquote>
<p>GPT-4-turbo 生成的代码 (同样，你可以预期 Github Copilot X 能够在多大程度上辅助程序员完成工作)，经过修缮就可以使用了：</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> curses
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_file_content</span>(<span class="hljs-params">window, path</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> file:
            lines = file.readlines()
        
        window.clear()
        <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines):
            window.addstr(i, <span class="hljs-number">0</span>, line)
        window.refresh()
        time.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># Update every second</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">input_box</span>(<span class="hljs-params">stdscr</span>):
    curses.echo()
    
    <span class="hljs-comment"># Setup the window for file content</span>
    file_content_height = curses.LINES - <span class="hljs-number">3</span>
    file_content_window = curses.newwin(file_content_height, curses.COLS, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    file_content_window.scrollok(<span class="hljs-literal">True</span>)
    
    <span class="hljs-comment"># Setup the window for input box</span>
    input_box_window = curses.newwin(<span class="hljs-number">3</span>, curses.COLS, curses.LINES - <span class="hljs-number">3</span>, <span class="hljs-number">0</span>)
    input_box_window.box()
    input_box_window.addstr(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;Input: &quot;</span>)
    input_box_window.refresh()
    
    <span class="hljs-comment"># Start thread for updating file content</span>
    file_path = <span class="hljs-string">&#x27;your_file_path_here.txt&#x27;</span>  <span class="hljs-comment"># Change this to your file path</span>
    threading.Thread(target=update_file_content, args=(file_content_window, file_path), daemon=<span class="hljs-literal">True</span>).start()
    
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># Get input from the user</span>
        input_str = input_box_window.getstr(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">20</span>)
        
        <span class="hljs-comment"># Process the input (Here, just print it to the console)</span>
        <span class="hljs-built_in">print</span>(input_str.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))

        <span class="hljs-comment"># Clear the input box after getting input</span>
        input_box_window.clear()
        input_box_window.box()
        input_box_window.addstr(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;Input: &quot;</span>)
        input_box_window.refresh()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    curses.wrapper(input_box)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    main()
</code></pre></div></div><div class="bg-neutral-100 text-center text-neutral-600 dark:bg-neutral-600 dark:text-neutral-200 lg:text-left"><div class="bg-neutral-200 p-6 text-center dark:bg-neutral-700"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons License: BY-NC 4.0</a><br/><a href="https://beian.miit.gov.cn/">苏 ICP 备 2020049101 号</a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    a: \"a\",\n    pre: \"pre\",\n    code: \"code\",\n    blockquote: \"blockquote\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"SSH 聊天室实现原理\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"SSH 聊天室受到 \", _jsx(_components.a, {\n        href: \"http://sshtron.zachlatta.com/\",\n        children: \"sshtron\"\n      }), \" (贪吃蛇) 的启发。OpenSSH Server 允许我们指定 “ForceCommand”，即该用户强制只能执行此命令。\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-text\",\n        children: \"Match user chat\\n  PermitEmptyPasswords yes\\n  ForceCommand /home/chat/startup\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"连接时需要 \", _jsx(_components.code, {\n        children: \"-t\"\n      }), \" 的原因是，在 \", _jsx(_components.code, {\n        children: \"ssh\"\n      }), \" 带参数时默认不会分配终端。startup 启动一个普通的 curses 程序，使用 \", _jsx(_components.a, {\n        href: \"https://docs.python.org/3/howto/curses.html\",\n        children: \"Python curses 标准库\"\n      }), \" 实现；大部分代码都由 GPT-4 生成。\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"Prompt: Give me a python code using curses, there is a input box in the bottom, while a file's content is constantly updated on the top panel in a separate thread. (Directly give the code without any explanation or tutorial setups.)\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"GPT-4-turbo 生成的代码 (同样，你可以预期 Github Copilot X 能够在多大程度上辅助程序员完成工作)，经过修缮就可以使用了：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-python\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" curses\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" threading\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" time\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"update_file_content\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"window, path\"\n        }), \"):\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"True\"\n        }), \":\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"with\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"open\"\n        }), \"(path, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'r'\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"as\"\n        }), \" file:\\n            lines = file.readlines()\\n        \\n        window.clear()\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" i, line \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"enumerate\"\n        }), \"(lines):\\n            window.addstr(i, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", line)\\n        window.refresh()\\n        time.sleep(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \")  \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Update every second\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"input_box\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"stdscr\"\n        }), \"):\\n    curses.echo()\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Setup the window for file content\"\n        }), \"\\n    file_content_height = curses.LINES - \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \"\\n    file_content_window = curses.newwin(file_content_height, curses.COLS, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n    file_content_window.scrollok(\", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"True\"\n        }), \")\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Setup the window for input box\"\n        }), \"\\n    input_box_window = curses.newwin(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \", curses.COLS, curses.LINES - \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n    input_box_window.box()\\n    input_box_window.addstr(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Input: \\\"\"\n        }), \")\\n    input_box_window.refresh()\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Start thread for updating file content\"\n        }), \"\\n    file_path = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'your_file_path_here.txt'\"\n        }), \"  \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Change this to your file path\"\n        }), \"\\n    threading.Thread(target=update_file_content, args=(file_content_window, file_path), daemon=\", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"True\"\n        }), \").start()\\n    \\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"True\"\n        }), \":\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Get input from the user\"\n        }), \"\\n        input_str = input_box_window.getstr(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"8\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"20\"\n        }), \")\\n        \\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Process the input (Here, just print it to the console)\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(input_str.decode(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'utf-8'\"\n        }), \"))\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Clear the input box after getting input\"\n        }), \"\\n        input_box_window.clear()\\n        input_box_window.box()\\n        input_box_window.addstr(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Input: \\\"\"\n        }), \")\\n        input_box_window.refresh()\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), \"():\\n    curses.wrapper(input_box)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" __name__ == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"__main__\\\"\"\n        }), \":\\n    main()\\n\"]\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"frontmatter":{}},"__N_SSG":true},"page":"/[[...index]]","query":{"index":["OS","Chatroom.md"]},"buildId":"a2FwJzUPGFGc0QcwaUr13","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>