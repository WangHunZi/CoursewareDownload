<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Yanyan&#x27;s Wiki</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"/><meta name="next-head-count" content="5"/><link rel="preload" href="../../_next/static/css/e993edd6a18ef4f0.css" as="style"/><link rel="stylesheet" href="../../_next/static/css/e993edd6a18ef4f0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../../_next/static/chunks/webpack-f73d82589f972e7d.js" defer=""></script><script src="../../_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="../../_next/static/chunks/main-3929bf55b0f13a18.js" defer=""></script><script src="../../_next/static/chunks/pages/_app-00b06920b385caf1.js" defer=""></script><script src="../../_next/static/chunks/pages/[[...index]]-877ec949b69be209.js" defer=""></script><script src="../../_next/static/a2FwJzUPGFGc0QcwaUr13/_buildManifest.js" defer=""></script><script src="../../_next/static/a2FwJzUPGFGc0QcwaUr13/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-slate-300/10"><div class="sticky top-0 z-40 w-full backdrop-blur flex-none border-b border-slate-900/10 bg-white/75 supports-backdrop-blur:bg-white/60"><div class="max-w-8xl mx-auto"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="relative flex items-center"><a href="../../index.html">Yanyan&#x27;s wiki</a><form class="text-xs text-slate-500"> for <input type="text" name="token" class="font-mono text-xs w-16" maxLength="8"/></form><div class="relative hidden lg:flex items-center ml-4 pl-4 border-l"><nav class="text-sm leading-6 font-semibold text-slate-700 dark:text-slate-200"><ul class="flex space-x-8"><li><a class="hover:text-sky-500 dark:hover:text-sky-400" href="../2025/index.html">操作系统 (2025 春)</a></li></ul></nav></div></div></div></div></div><div class="container mx-auto max-w-5xl flex flex-col min-h-screen px-4"><div class="wiki bg-neutral-200/10"><h1>2. 应用视角的操作系统</h1>
<p><strong>背景回顾</strong>：操作系统是连接软件和硬件的桥梁。因此想要理解操作系统，我们首先需要对操作系统的服务对象 (应用程序) 有更精确和深刻的理解。</p>
<p><strong>本讲内容</strong>：程序的状态机模型；回答以下问题：</p>
<ul>
<li>什么是程序？</li>
<li>如何在操作系统上构造最小/一般、甚至是图形界面应用程序？</li>
<li>编译器的工作原理是什么？</li>
</ul>
<h2>2.1 操作系统上的最小应用程序</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/2.1.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<p>我们在编程时，总是想象程序 “独占整个计算机，逐条指令执行”，大部分时候都不用 “考虑” 操作系统的存在。当系统调用发生时，程序执行被完全暂停，但操作系统依然在工作——就像麻醉后醒来，周围的环境发生了变化，但我们完全没有感到时间的流逝。</p>
<h2>2.2 操作系统上的应用程序</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/2.2.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<p>如果你感到 strace 的结果不那么友善，用适当的工具处理它就非常重要了。课堂上我们展示了用命令行工具进行处理的 “传统方法”：</p>
<pre><code class="hljs language-text">$ strace ls |&amp; grep -e read -e write
</code></pre>
<p>对新手来说，感到困惑是非常正常的——但我们总是可以把不熟悉的东西用熟悉的东西类比 (正是 AI 擅长的)。今天你只要学会提问，就几乎总是能得到满意的答案。</p>
<h2>2.3 C 语言与汇编</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/2.3.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<h2>2.4 编译器与编译优化 🌶️</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/2.4.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<h2>Take-away Messages</h2>
<p>Everything (高级语言代码、机器代码) 都是状态机；而编译器实现了两种状态机之间的翻译。无论何种状态机，在没有操作系统时，它们只能做纯粹的计算，甚至都不能把结果传递到程序之外——而程序与操作系统沟通的唯一桥梁是系统调用 (例如 x86-64 的 syscall 指令)。如此重要的桥梁，操作系统中自然也有工具：strace 可以查看程序运行过程中的系统调用序列。</p>
<h3>课后习题/编程作业</h3>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">📚</span><span class="font-serif text-lg border-b border-slate-600"><b>阅读材料</b></span><div class="font-serif pt-2"><p>本次课没有书本阅读材料；但你可以花一些时间了解一下相关的源码项目：</p><ul>
<li>浏览 <a href="https://www.gnu.org/software/coreutils/">GNU Coreutils</a> 和 <a href="https://www.gnu.org/software/binutils/">GNU Binutils</a> 的网站，建立 “手边有哪些可用的命令行工具” 的一些印象。</li>
<li>浏览 <a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/">gdb</a> 文档的目录，找到你感兴趣的章节了解，例如——“Reverse Execution”、“TUI: GDB Text User Interface”……</li>
<li>对于你有兴趣的命令行工具，可以参考 <a href="https://www.busybox.net">busybox</a> 和 <a href="https://landley.net/toybox/about.html">toybox</a> 项目中与之对应的简化实现。Toybox 现在已经成为了 Android 自带的命令行工具集。</li>
</ul></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">🖥️</span><span class="font-serif text-lg border-b border-slate-600"><b>编程</b></span><div class="font-serif pt-2"><p>在你的 Linux 中运行课堂上的代码示例，包括：</p><ul>
<li>编译链接最小二进制文件，并使用 strace 查看执行的系统调用序列。</li>
<li>尝试将非递归汉诺塔扩展到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span></span></span></span> 两个函数互相调用的情况。</li>
<li>使用 strace 查看更多程序的系统调用序列，并在好奇心的驱使下了解一部分系统调用的作用。</li>
</ul><p><strong>在之后的课程中，我们默认你会运行和理解课堂上的代码示例。</strong></p></div></div></div></div></div><div class="bg-neutral-100 text-center text-neutral-600 dark:bg-neutral-600 dark:text-neutral-200 lg:text-left"><div class="bg-neutral-200 p-6 text-center dark:bg-neutral-700"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons License: BY-NC 4.0</a><br/><a href="https://beian.miit.gov.cn/">苏 ICP 备 2020049101 号</a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    strong: \"strong\",\n    ul: \"ul\",\n    li: \"li\",\n    h2: \"h2\",\n    pre: \"pre\",\n    code: \"code\",\n    h3: \"h3\",\n    a: \"a\",\n    span: \"span\",\n    math: \"math\",\n    semantics: \"semantics\",\n    mrow: \"mrow\",\n    mi: \"mi\",\n    annotation: \"annotation\"\n  }, _provideComponents(), props.components), {Slideshow, Demo, Box} = _components;\n  if (!Box) _missingMdxReference(\"Box\", true);\n  if (!Demo) _missingMdxReference(\"Demo\", true);\n  if (!Slideshow) _missingMdxReference(\"Slideshow\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"2. 应用视角的操作系统\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"背景回顾\"\n      }), \"：操作系统是连接软件和硬件的桥梁。因此想要理解操作系统，我们首先需要对操作系统的服务对象 (应用程序) 有更精确和深刻的理解。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"本讲内容\"\n      }), \"：程序的状态机模型；回答以下问题：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"什么是程序？\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"如何在操作系统上构造最小/一般、甚至是图形界面应用程序？\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"编译器的工作原理是什么？\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2.1 操作系统上的最小应用程序\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/2.1.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/minimal\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"我们在编程时，总是想象程序 “独占整个计算机，逐条指令执行”，大部分时候都不用 “考虑” 操作系统的存在。当系统调用发生时，程序执行被完全暂停，但操作系统依然在工作——就像麻醉后醒来，周围的环境发生了变化，但我们完全没有感到时间的流逝。\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2.2 操作系统上的应用程序\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/2.2.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/tar\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/strace\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"如果你感到 strace 的结果不那么友善，用适当的工具处理它就非常重要了。课堂上我们展示了用命令行工具进行处理的 “传统方法”：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-text\",\n        children: \"$ strace ls |\u0026 grep -e read -e write\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"对新手来说，感到困惑是非常正常的——但我们总是可以把不熟悉的东西用熟悉的东西类比 (正是 AI 擅长的)。今天你只要学会提问，就几乎总是能得到满意的答案。\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2.3 C 语言与汇编\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/2.3.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/hanoi\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2.4 编译器与编译优化 🌶️\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/2.4.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/compiler-opt\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Take-away Messages\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Everything (高级语言代码、机器代码) 都是状态机；而编译器实现了两种状态机之间的翻译。无论何种状态机，在没有操作系统时，它们只能做纯粹的计算，甚至都不能把结果传递到程序之外——而程序与操作系统沟通的唯一桥梁是系统调用 (例如 x86-64 的 syscall 指令)。如此重要的桥梁，操作系统中自然也有工具：strace 可以查看程序运行过程中的系统调用序列。\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"课后习题/编程作业\"\n    }), \"\\n\", _jsxs(Box, {\n      logo: \"📚\",\n      title: \"阅读材料\",\n      children: [_jsx(_components.p, {\n        children: \"本次课没有书本阅读材料；但你可以花一些时间了解一下相关的源码项目：\"\n      }), _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"浏览 \", _jsx(_components.a, {\n            href: \"https://www.gnu.org/software/coreutils/\",\n            children: \"GNU Coreutils\"\n          }), \" 和 \", _jsx(_components.a, {\n            href: \"https://www.gnu.org/software/binutils/\",\n            children: \"GNU Binutils\"\n          }), \" 的网站，建立 “手边有哪些可用的命令行工具” 的一些印象。\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"浏览 \", _jsx(_components.a, {\n            href: \"https://sourceware.org/gdb/current/onlinedocs/gdb.html/\",\n            children: \"gdb\"\n          }), \" 文档的目录，找到你感兴趣的章节了解，例如——“Reverse Execution”、“TUI: GDB Text User Interface”……\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"对于你有兴趣的命令行工具，可以参考 \", _jsx(_components.a, {\n            href: \"https://www.busybox.net\",\n            children: \"busybox\"\n          }), \" 和 \", _jsx(_components.a, {\n            href: \"https://landley.net/toybox/about.html\",\n            children: \"toybox\"\n          }), \" 项目中与之对应的简化实现。Toybox 现在已经成为了 Android 自带的命令行工具集。\"]\n        }), \"\\n\"]\n      })]\n    }), \"\\n\", _jsxs(Box, {\n      logo: \"🖥️\",\n      title: \"编程\",\n      children: [_jsx(_components.p, {\n        children: \"在你的 Linux 中运行课堂上的代码示例，包括：\"\n      }), _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"编译链接最小二进制文件，并使用 strace 查看执行的系统调用序列。\"\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"尝试将非递归汉诺塔扩展到 \", _jsxs(_components.span, {\n            className: \"katex\",\n            children: [_jsx(_components.span, {\n              className: \"katex-mathml\",\n              children: _jsx(_components.math, {\n                xmlns: \"http://www.w3.org/1998/Math/MathML\",\n                children: _jsxs(_components.semantics, {\n                  children: [_jsx(_components.mrow, {\n                    children: _jsx(_components.mi, {\n                      children: \"f\"\n                    })\n                  }), _jsx(_components.annotation, {\n                    encoding: \"application/x-tex\",\n                    children: \"f\"\n                  })]\n                })\n              })\n            }), _jsx(_components.span, {\n              className: \"katex-html\",\n              \"aria-hidden\": \"true\",\n              children: _jsxs(_components.span, {\n                className: \"base\",\n                children: [_jsx(_components.span, {\n                  className: \"strut\",\n                  style: {\n                    height: \"0.8889em\",\n                    verticalAlign: \"-0.1944em\"\n                  }\n                }), _jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.10764em\"\n                  },\n                  children: \"f\"\n                })]\n              })\n            })]\n          }), \" 和 \", _jsxs(_components.span, {\n            className: \"katex\",\n            children: [_jsx(_components.span, {\n              className: \"katex-mathml\",\n              children: _jsx(_components.math, {\n                xmlns: \"http://www.w3.org/1998/Math/MathML\",\n                children: _jsxs(_components.semantics, {\n                  children: [_jsx(_components.mrow, {\n                    children: _jsx(_components.mi, {\n                      children: \"g\"\n                    })\n                  }), _jsx(_components.annotation, {\n                    encoding: \"application/x-tex\",\n                    children: \"g\"\n                  })]\n                })\n              })\n            }), _jsx(_components.span, {\n              className: \"katex-html\",\n              \"aria-hidden\": \"true\",\n              children: _jsxs(_components.span, {\n                className: \"base\",\n                children: [_jsx(_components.span, {\n                  className: \"strut\",\n                  style: {\n                    height: \"0.625em\",\n                    verticalAlign: \"-0.1944em\"\n                  }\n                }), _jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.03588em\"\n                  },\n                  children: \"g\"\n                })]\n              })\n            })]\n          }), \" 两个函数互相调用的情况。\"]\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"使用 strace 查看更多程序的系统调用序列，并在好奇心的驱使下了解一部分系统调用的作用。\"\n        }), \"\\n\"]\n      }), _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"在之后的课程中，我们默认你会运行和理解课堂上的代码示例。\"\n        })\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"frontmatter":{}},"__N_SSG":true},"page":"/[[...index]]","query":{"index":["OS","2024","lect2.md"]},"buildId":"a2FwJzUPGFGc0QcwaUr13","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>