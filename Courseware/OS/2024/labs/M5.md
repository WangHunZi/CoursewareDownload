<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>M5: ç³»ç»Ÿè°ƒç”¨ Profiler (sperf)</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"/><meta name="next-head-count" content="5"/><link rel="preload" href="../../../_next/static/css/e993edd6a18ef4f0.css" as="style"/><link rel="stylesheet" href="../../../_next/static/css/e993edd6a18ef4f0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../../../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../../../_next/static/chunks/webpack-f73d82589f972e7d.js" defer=""></script><script src="../../../_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="../../../_next/static/chunks/main-3929bf55b0f13a18.js" defer=""></script><script src="../../../_next/static/chunks/pages/_app-00b06920b385caf1.js" defer=""></script><script src="../../../_next/static/chunks/pages/[[...index]]-877ec949b69be209.js" defer=""></script><script src="../../../_next/static/a2FwJzUPGFGc0QcwaUr13/_buildManifest.js" defer=""></script><script src="../../../_next/static/a2FwJzUPGFGc0QcwaUr13/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-slate-300/10"><div class="sticky top-0 z-40 w-full backdrop-blur flex-none border-b border-slate-900/10 bg-white/75 supports-backdrop-blur:bg-white/60"><div class="max-w-8xl mx-auto"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="relative flex items-center"><a href="../../../index.html">Yanyan&#x27;s wiki</a><form class="text-xs text-slate-500">Â forÂ <input type="text" name="token" class="font-mono text-xs w-16" maxLength="8"/></form><div class="relative hidden lg:flex items-center ml-4 pl-4 border-l"><nav class="text-sm leading-6 font-semibold text-slate-700 dark:text-slate-200"><ul class="flex space-x-8"><li><a class="hover:text-sky-500 dark:hover:text-sky-400" href="../../2025/index.html">æ“ä½œç³»ç»Ÿ (2025 æ˜¥)</a></li></ul></nav></div></div></div></div></div><div class="container mx-auto max-w-5xl flex flex-col min-h-screen px-4"><div class="wiki bg-neutral-200/10"><h1>M5: ç³»ç»Ÿè°ƒç”¨ Profiler (sperf)</h1>
<div class="box yellow-box"><div><span class="float-left text-4xl mr-3 mt-2">â°</span><span class="font-serif text-lg border-b border-slate-600"><b>Soft Deadline: 2024 å¹´ 5 æœˆ 26 æ—¥ 23:59:59</b></span><div class="font-serif pt-2"><p><strong><red>ä½ éœ€è¦é¦–å…ˆé˜…è¯»<a href="Labs.md">å®éªŒé¡»çŸ¥</a>ï¼Œå…¶ä¸­åŒ…å«äº†ä»£ç è·å–æ–¹æ³•ã€æäº¤æ–¹æ³•ã€å¦‚ä½•æŸ¥çœ‹æäº¤ç»“æœç­‰</red></strong>ã€‚åœ¨å‘½ä»¤è¡Œä¸­ <code>git pull origin M5</code> ä¸‹è½½æ¡†æ¶ä»£ç ã€‚</p></div></div></div>
<div class="box slate-box"><div><span class="float-left text-4xl mr-3 mt-2">âš–ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>M5 - sperf</b></span><div class="font-serif pt-2"><p>è¯·è¾“å…¥ Token ç™»å½•ã€‚</p></div></div></div>
<h2>1. èƒŒæ™¯</h2>
<p>â€œEverything is a state machine.â€ èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£æ â€œçŠ¶æ€æœºæ‰§è¡Œâ€ çš„å·¥å…·ï¼Œè‡ªç„¶å¯¹è°ƒè¯•ã€æ€§èƒ½è¯Šæ–­ç­‰ä»»åŠ¡æ˜¯è‡³å…³é‡è¦çš„ã€‚æˆ‘ä»¬åœ¨è¯¾å ‚ä¸Šå±•ç¤ºè¿‡å„ç±»å„ç±»åˆ†æçŠ¶æ€æœºæ‰§è¡Œè½¨è¿¹çš„å·¥å…·ï¼ŒåŒ…æ‹¬ gdb (step/stepi)ã€strace ç­‰ã€‚ä¸ºäº†åŠ æ·±å¤§å®¶å¯¹è¿™äº›å·¥å…·çš„è®¤è¯†ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¾å ‚ä¸Šå­¦è¿‡çš„è¿›ç¨‹ç®¡ç† APIï¼Œå»å¯åŠ¨ä¸€ä¸ªè¿™æ ·çš„å·¥å…·ï¼Œå¹¶è·å¾—å®ƒä»¬çš„è¾“å‡ºã€‚è¿™ä¸ªå®éªŒä¹Ÿæ›¿ä»£äº†é€šå¸¸ã€Šæ“ä½œç³»ç»Ÿã€‹è¯¾ç¨‹ä¸­å¸¸è§çš„ç®¡é“ (shell) ä½œä¸šã€‚</p>
<h2>2. å®éªŒæè¿°</h2>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">ğŸ—’ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>å®éªŒè¦æ±‚ï¼šå®ç°ç³»ç»Ÿè°ƒç”¨ Profiler</b></span><div class="font-serif pt-2"><p>å®ç°ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒèƒ½å¯åŠ¨å¦ä¸€ä¸ªç¨‹åºï¼Œå¹¶ç»Ÿè®¡è¯¥ç¨‹åºä¸­å„ä¸ªç³»ç»Ÿè°ƒç”¨çš„å ç”¨æ—¶é—´ã€‚å¯¹äºè¾ƒçŸ­æ—¶é—´è¿è¡Œçš„ç¨‹åºï¼Œä½ å¯ä»¥ä¸€æ¬¡æ€§æ‰“å°å‡ºè€—æ—¶æœ€å¤šçš„å‡ ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºè€—æ—¶è¾ƒé•¿çš„ç¨‹åºï¼Œä½ éœ€è¦ä¿è¯æ¯ç§’å¤§çº¦<strong>æ‰“å° 10 æ¬¡</strong> (ä¸è¦è¿‡å¤š) ç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ä¿¡æ¯ã€‚</p></div></div></div>
<h3>2.1 æ€»è§ˆ</h3>
<center>sperf <u>COMMAND</u> [<u>ARG</u>]... </center>
<h3>2.2 æè¿°</h3>
<p>å®ƒä¼šè¿è¡Œ COMMAND å‘½ä»¤ (å¦‚æœ COMMAND æ˜¯ä»¥ <code>/</code> å¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œåˆ™ç›´æ¥æ‰§è¡Œï¼›å¦åˆ™åœ¨ <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­æœç´¢åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶)ï¼Œå¹¶ä¸º COMMAND ä¼ å…¥ ARG å‚æ•° (åˆ—è¡¨)ï¼Œç„¶åç»Ÿè®¡å‘½ä»¤æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨æ‰€å çš„æ—¶é—´ã€‚ä¾‹å¦‚æ‰§è¡Œ <code>sperf find /</code> ä¼šåœ¨ç³»ç»Ÿä¸­æ‰§è¡Œ <code>find /</code>ï¼Œå¹¶ä¸”åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå‡ºè€—æ—¶æœ€å¤šçš„è‹¥å¹²ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ã€‚</p>
<p>sperf å‡è®¾ <code>COMMAND</code> æ˜¯å•è¿›ç¨‹ã€å•çº¿ç¨‹çš„ï¼Œæ— éœ€å¤„ç†å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„æƒ…å†µã€‚</p>
<div class="box red-box"><div><span class="float-left text-4xl mr-3 mt-2">âš ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>åªèƒ½ä½¿ç”¨ execve</b></span><div class="font-serif pt-2"><p>ä¸ºäº†å¼ºè¿«å¤§å®¶ç†è§£ execve ç³»ç»Ÿè°ƒç”¨ï¼Œsperf å®ç°æ—¶ï¼Œ<strong>åªèƒ½ä½¿ç”¨ execve ç³»ç»Ÿè°ƒç”¨</strong>ï¼›ä½¿ç”¨ glibc å¯¹ execve çš„åŒ…è£… (execl, execlp, execle, execv, execvp, execvpe) å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œexec ç³»åˆ—å‡½æ•°ï¼Œä¾‹å¦‚ä»¥ p (path) ç»“å°¾çš„å‡½æ•°ä¼šä» PATH ç¯å¢ƒå˜é‡ä¸­æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></div></div></div>
<h3>2.3 è§£é‡Š</h3>
<p>ä½ å¯ä»¥ä»¥ä»»ä½•æ–¹å¼è¾“å‡ºç³»ç»Ÿè°ƒç”¨èŠ±è´¹çš„æ—¶é—´ï¼Œä¾‹å¦‚ä½ å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´æŠŠè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼š</p>
<pre><code>$ ./sperf-64 tree /
Time: 0.1s
lstat (50%)
getdents (20%)
...
====================
Time: 0.2s
lstat (50%)
getdents (20%)
...
</code></pre>
<p>åœ¨æˆ‘ä»¬çš„å‚è€ƒå®ç°ä¸­ï¼Œé€šè¿‡åœ¨å­—ç¬¦ç»ˆç«¯é‡Œç»˜åˆ¶ç³»ç»Ÿè°ƒç”¨å›¾çš„æ–¹å¼å±•ç¤ºç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ (ç³»ç»Ÿè°ƒç”¨æ‰€èŠ±æ—¶é—´ä¸æ‰€å é¢ç§¯æˆæ­£æ¯”)ã€‚ä½ å®Œå…¨å¯ä»¥æŠŠä½ çš„ sperf çš„è¾“å‡ºç®¡é“ç»™å¦ä¸€ä¸ª â€œå¯è§†åŒ–â€ å·¥å…·æ¥ç”Ÿæˆå®ƒâ€”â€”è¿™ä¸æœ¬æ¬¡å®éªŒæ— å…³ã€‚</p>
<p><img src="../../img/sperf-demo.gif" alt=""/></p>
<p>ä½†æ— è®ºå¦‚ä½•ï¼Œä¸€ä¸ªå¯è§†åŒ–çš„å·¥å…·éƒ½å¯ä»¥å¸®æˆ‘ä»¬æä¾›å…³äºç³»ç»Ÿå’Œç¨‹åºè¿è¡Œçš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å¯¹äº memory intensive çš„çº¯è®¡ç®—å‹ç¨‹åºï¼Œbrk å’Œ munmap èŠ±å»äº†æœ€å¤šçš„æ—¶é—´ï¼›</li>
<li>å¯¹äºæ–‡ä»¶ç³»ç»Ÿéå†ï¼Œæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®è®¿é—® lstat å’Œ getdents èŠ±å»äº†æœ€å¤šçš„æ—¶é—´ã€‚</li>
</ul>
<h2>3. æ­£ç¡®æ€§æ ‡å‡†</h2>
<p>sperf å¯¹ profiling ç»“æœçš„è¾“å‡ºæ ¼å¼æ²¡æœ‰ç‰¹åˆ«è¦æ±‚ï¼Œå¹¶å‡è®¾è¢« trace çš„ç¨‹åºæ˜¯å•è¿›ç¨‹ç¨‹åº (Online Judge æµ‹è¯•ç”¨ä¾‹ä¼šä¿è¯è¿™ä¸€ç‚¹)ã€‚å¦‚æœè¿›ç¨‹æ²¡æœ‰å‘ç”Ÿç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–ç³»ç»Ÿè°ƒç”¨è€—æ—¶å¾ˆé•¿æ²¡æœ‰ç»“æŸ (ä¾‹å¦‚ç­‰å¾…è¾“å…¥çš„ <code>read</code> æˆ–å¤§é‡æ•°æ®çš„å†™å…¥)ï¼Œä½ ç›¸åº”çš„ä¿¡æ¯ä¹Ÿå¯ä»¥ä¸å¿…æ›´æ–° (å³é‡åˆ°å¾ˆé•¿çš„ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä½ ä¸éœ€è¦ç«‹å³å°†è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ç»Ÿè®¡è¿›æ¥ï¼Œå¯ä»¥ç­‰å®ƒæ‰§è¡Œç»“æŸåå†ç»Ÿè®¡)ã€‚</p>
<p>ä¸ºäº† Online Judge åˆ¤å®šæ–¹ä¾¿ï¼Œæˆ‘ä»¬è¦æ±‚ä½ çš„ç¨‹åºæ»¡è¶³ä»¥ä¸‹è¾“å‡ºæ ¼å¼ï¼š</p>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">ğŸ—’ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>å®éªŒè¦æ±‚ï¼šå®ç°ç³»ç»Ÿè°ƒç”¨ Profiler</b></span><div class="font-serif pt-2"><p>æ¯æ¬¡è¾“å‡ºè€—æ—¶ top 5 çš„ç³»ç»Ÿè°ƒç”¨ã€æ¯ä¸ªç³»ç»Ÿè°ƒç”¨è‡³å¤šè¾“å‡ºä¸€æ¬¡ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨çš„å°å†™åå­— (strace è¾“å‡ºçš„åå­—)å’Œç³»ç»Ÿè°ƒç”¨è€—æ—¶æ¯”ä¾‹æŒ‰ç…§ â€œ<code>(XX%)</code>â€ã€‚ä½¿ç”¨</p><pre><code class="hljs language-c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s (%d%%)\n&quot;</span>, syscall_name, ratio);
</code></pre><p>è¾“å‡ºå³å¯ã€‚åœ¨æ¯æ¬¡ç»Ÿè®¡ä¿¡æ¯è¾“å‡ºå®Œæ¯•åï¼Œæ‰“å° 80 ä¸ª <code>\0</code> (æ³¨æ„ä¸æ˜¯ <code>&#x27;0&#x27;</code>ï¼Œæ˜¯æ•°å€¼ä¸º 0 çš„å­—ç¬¦ï¼Œå®ƒä»¬ä¸ä¼šåœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤º)ã€‚æˆ‘ä»¬å°†ä»¥è¿™ 80 ä¸ª <code>\0</code> ä½œä¸ºåˆ’åˆ†ã€‚</p></div></div></div>
<p>è¾“å‡ºè¿‡äºé¢‘ç¹ä¼šè‡´ Output Limit Exceededã€‚ä¿è¯åœ¨è¢«è¿½è¸ªè¿›ç¨‹ä¸æ–­æŒç»­æœ‰ç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼Œæ¯ç§’æ‰“å°å¤§çº¦ 10 æ¬¡å³å¯ã€‚æ­¤å¤–ï¼Œå¦‚æœè¿›ç¨‹é€€å‡ºï¼Œä½ çš„ sperf ä¹Ÿåº”è¯¥ç›¸åº”é€€å‡ºã€‚è¿™ä¸ªè¡Œä¸ºç±»ä¼¼äº strace å’Œ perfã€‚</p>
<div class="box red-box"><div><span class="float-left text-4xl mr-3 mt-2">âš ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>åŠæ—¶æ¸…ç©º stdout çš„ç¼“å†²åŒº</b></span><div class="font-serif pt-2"><p>ä¸åŒäºä½ çš„æœ¬åœ°æµ‹è¯• (stdout ä¸ºç»ˆç«¯)ï¼ŒOnline Judge åœ¨è¯„æµ‹æ—¶ä¼šæŠŠ stdout é‡å®šå‘åˆ°æ–‡ä»¶ (æˆ–ç®¡é“)ï¼Œå› è€Œ libc ä¼šè¿›å…¥
fully buffered mode (å°±åƒæˆ‘ä»¬è¯¾å ‚ä¸Šè®² fork åœ¨ <code>./a.out</code> å’Œ <code>./a.out | wc -l</code> çœ‹åˆ°ä¸åŒè¡Œæ•°çš„ä¾‹å­é‚£æ ·)ã€‚å› æ­¤è¯·ç¡®ä¿ä½ åœ¨æ¯ä¸€è½®è¾“å‡ºåä½¿ç”¨ fflushâ€”â€”å¦åˆ™ timeout è¢«å¼ºè¡Œç»ˆæ­¢æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½çœ‹ä¸åˆ°ä½ çš„è¾“å‡ºã€‚</p></div></div></div>
<h2>4. å®éªŒæŒ‡å—</h2>
<h3>4.1 Trace å·¥å…·</h3>
<p>æ“ä½œç³»ç»Ÿé‡Œæä¾›äº†è¶³å¤Ÿçš„å·¥å…·æ»¡è¶³ä½  â€œæ£€æŸ¥çŠ¶æ€æœºæ‰§è¡Œâ€ çš„éœ€æ±‚â€”â€”é‚£å°±æ˜¯è¿½è¸ªå·¥å…· traceã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ strace å¯ä»¥è¿½è¸ªç¨‹åºæ‰§è¡Œæ—¶çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">â˜•ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>å®ç° strace</b></span><div class="font-serif pt-2"><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ Linux ä¸Šå®ç° straceï¼Œæœ‰å“ªäº›å¯èƒ½çš„é€”å¾„ï¼ŸAI ç»™äº†æˆ‘ä»¬ä¸€äº›æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ ptrace ç³»ç»Ÿè°ƒç”¨ã€Linux Auditã€eBPFã€SystemTap å’Œ LTTngã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ã€æŒæ¡ç¨‹åº¦æ¥é€‰æ‹©æ€§åœ°äº†è§£è¿™äº›æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¯¹è¯¾ç¨‹å†…å®¹æ„Ÿåˆ°åƒåŠ›ï¼Œä¸å¦¨ä¼˜å…ˆå®Œæˆå®éªŒï¼›ä½†å¦‚æœä½ å¯¹ç¼–ç¨‹å·²ç»æœ‰å¾ˆä¸é”™çš„è‡ªä¿¡ï¼Œå°±å¯ä»¥è¯•ä¸€è¯•å…¶ä»–çš„æœºåˆ¶ã€‚</p></div></div></div>
<p>Trace å·¥å…·æ˜¯ç³»ç»Ÿç¼–ç¨‹æ—¶éå¸¸å¸¸ç”¨çš„é—®é¢˜è¯Šæ–­å·¥å…·ã€‚æ ¹æ®è°ƒè¯•ç†è®ºï¼Œtrace åœ¨ä¸€å®šç¨‹åº¦ä¸Šååº”äº†ç¨‹åºæ‰§è¡Œçš„æµç¨‹ï¼Œå› æ­¤å¯ä»¥å¸®åŠ©ä½ ç¼©å° bug æ‰€åœ¨çš„èŒƒå›´ (å›é¡¾è°ƒè¯•çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘ç”Ÿ error çš„ç¨‹åºçŠ¶æ€)ï¼›æ­¤å¤–ï¼Œtrace ä¸­é¢å¤–çš„ä¿¡æ¯è¿˜èƒ½å¸®åŠ©è¯Šæ–­æ€§èƒ½ç­‰é—®é¢˜ (ä¾‹å¦‚ä½ çš„ç¨‹åºæ˜¯å¦åœ¨æŸä¸ªç³»ç»Ÿè°ƒç”¨ä¸ŠèŠ±å»äº†å¤§é‡çš„æ—¶é—´)ã€‚é™¤äº†æˆ‘ä»¬ç†ŸçŸ¥çš„ strace, ltraceï¼Œå…¶å® trace å¹¿æ³›åœ°å­˜åœ¨äºè®¡ç®—æœºç³»ç»Ÿçš„å„ä¸ªå±‚é¢ä¸Šï¼š</p>
<ul>
<li>æ“ä½œç³»ç»Ÿå†…æ ¸ (ä¾‹å¦‚ Linux) æä¾›äº†å¤šç§ trace æœºåˆ¶ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒ <a href="https://www.kernel.org/doc/html/latest/trace/ftrace.html">ftrace</a>ï¼›</li>
<li>æµè§ˆå™¨çš„å¼€å‘è€…æ¨¡å¼ (F12 æ§åˆ¶å°ï¼Œæƒ³å¿…å¤§å®¶å·²ç»ç”¨å®ƒæŸ¥çœ‹è¿‡è¯¾ç¨‹ç½‘ç«™çš„ slides æ˜¯å¦‚ä½•å®ç°çš„äº†) ä¸­ï¼Œèƒ½å¤Ÿ trace ç½‘ç»œç­‰è¯·æ±‚â€”â€”åˆ«å°çœ‹å®ƒï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ traceï¼è€Œä¸”å®ƒå¯¹è°ƒè¯•ç½‘ç«™çš„åŠŸèƒ½æ€§é—®é¢˜å’Œæ€§èƒ½é—®é¢˜éƒ½æ˜¯è‡³å…³é‡è¦çš„ï¼›</li>
<li>é€šè¿‡ Java Virtual Machine Tool Interface (JVMTI) åœ¨ Java è™šæ‹Ÿæœºä¸­åˆ›å»º agentï¼Œæ”¶é›†ç¨‹åºæ‰§è¡Œçš„ä¿¡æ¯ã€‚</li>
</ul>
<p>åœ¨ trace çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å®ç°ç¨‹åºçš„<strong>æ€§èƒ½è¯Šæ–­</strong>å·¥å…· (è™½ç„¶ strace çš„è®¾è®¡æ„å›¾æœ¬èº«å¹¶ä¸ä¸»è¦æ˜¯ä¸ºäº†è¯Šæ–­æ€§èƒ½é—®é¢˜)ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æ‰¾åˆ°ç¨‹åºè¿è¡Œæ—¶è€—æ—¶æœ€å¤šçš„é‚£äº›ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œæ‰¾åˆ°ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆã€‚<a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiler</a> èƒ½å¤Ÿæä¾›ç³»ç»Ÿæ€§èƒ½åˆ†æçš„æŠ¥å‘Šâ€”â€”è€Œä¸”è¿™ä»¶äº‹ä¸€ç‚¹ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªè¦åˆ†æ trace çš„è¾“å‡ºå°±å¯ä»¥äº†ã€‚ä½¿ç”¨é€‚å½“çš„å·¥å…·ï¼Œç”šè‡³å¯ä»¥æ ¹æ® trace çš„ç»“æœè¾“å‡ºä¸€ä¸ªå¯äº¤äº’çš„ <a href="http://www.brendangregg.com/flamegraphs.html">Flame Graph</a>:</p>
<iframe class="w-full" height="480" src="../../img/flame-graph.svg"></iframe>
<h3>4.2 è·å¾—ç³»ç»Ÿè°ƒç”¨åºåˆ—</h3>
<p>æˆ‘ä»¬çŸ¥é“ (å¹¶ä¸”æ¯å¹´è€ƒè¯•éƒ½ä¼šè€ƒ)ï¼Œstrace å¯ä»¥è·å¾—è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨çš„åºåˆ—ï¼š</p>
<pre><code class="hljs language-text">$ strace ls
execve(&quot;/bin/ls&quot;, [&quot;ls&quot;], 0x7ffd3a99eb80 /* 23 vars */)  = 0
brk(NULL)                                                = 0x55c642aa9000
access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)                       = -1 ENOENT
access(&quot;/etc/ld.so.preload&quot;, R_OK)                       = -1 ENOENT
openat(AT_FDCWD, &quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=93852, ...})     = 0
...
</code></pre>
<p>è€Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ä¸ª â€œçŠ¶æ€æœºçŠ¶æ€â€ ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„<strong>å”¯ä¸€</strong>æ–¹å¼ (è¿™ä¸ªè¯´æ³•å¹¶ä¸ä¸¥æ ¼ï¼›è¿˜å¯ä»¥é€šè¿‡å…±äº«å†…å­˜å®ç°ä¸æ“ä½œç³»ç»Ÿå†…æ ¸çš„é€šä¿¡)ã€‚strace ä» execve â€œé‡ç½®çŠ¶æ€æœºâ€ çš„ç³»ç»Ÿè°ƒç”¨å¼€å§‹ï¼Œåˆ—å‡ºè¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„ä¸€åˆ‡äº¤äº’ã€‚æ‰€ä»¥ä»æœ¬è´¨ä¸Šè®²ï¼Œæˆ‘ä»¬åªéœ€è¦<strong>è§£æ strace çš„è¾“å‡º</strong>å°±èƒ½å®Œæˆè¿™ä¸ªå®éªŒã€‚</p>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">â˜•ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>é˜…è¯»ç³»ç»Ÿè°ƒç”¨åºåˆ—</b></span><div class="font-serif pt-2"><p>è¿™ä¸ªå®éªŒçš„ä¸€ä¸ªæœ‰æ„çš„ â€œè®¾è®¡â€ æ˜¯å¼ºè¿«å¤§å®¶é˜…è¯» strace è¾“å‡ºçš„ç³»ç»Ÿè°ƒç”¨åºåˆ—ï¼Œè¿›è€Œè§£æå®ƒä»¬ã€‚è¿™æ ·ï¼Œå¤§å®¶å°±ä¼šè¢«è¿«å»çœ‹ä¸€çœ‹çœŸå®è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹æ˜¯æ€æ ·è°ƒç”¨æ“ä½œç³»ç»Ÿ API çš„ã€‚å¦‚æœä½ å¯¹ä»»ä½•ç³»ç»Ÿè°ƒç”¨æ„Ÿåˆ°å›°æƒ‘ï¼Œä½ éƒ½å¯ä»¥ç›´æ¥è¯¢é—® AIã€‚</p></div></div></div>
<p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¸ä»…å¸Œæœ›å¾—åˆ°ç³»ç»Ÿè°ƒç”¨çš„åºåˆ—ï¼Œè¿˜éœ€è¦æœ‰ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæ—¶é—´æ‰èƒ½å®Œæˆè¿™ä¸ªå®éªŒã€‚strace çš„è¾“å‡ºä¸­å¹¶æ²¡æœ‰ï¼Œå—¯ï¼Œé‚£ä½ åº”è¯¥æƒ³åˆ°è®¡ç®—æœºç³»ç»Ÿä¸­çš„ â€œå…¬ç†â€ï¼š</p>
<div class="box purple-box"><div><span class="float-left text-4xl mr-3 mt-2">ğŸ’¡</span><span class="font-serif text-lg border-b border-slate-600"><b>è®¡ç®—æœºç³»ç»Ÿå…¬ç†</b></span><div class="font-serif pt-2"><div class="py-1">å¦‚æœä½ æœ‰ä¸€ä¸ªåˆç†çš„éœ€æ±‚ï¼Œå°±ä¸€å®šæœ‰å·¥å…·å¯ä»¥æ»¡è¶³ä½ ã€‚</div><ol class="quiz-card p-0 ml-8 my-1"></ol></div></div></div>
<p>æ‰€ä»¥ä½ ä¼šçŒœæµ‹ strace ä¹Ÿæä¾›äº†è¿™ä¸ªåŠŸèƒ½ã€‚ä½ å¯ä»¥æœç´¢ç½‘ç»œã€é˜…è¯»æ‰‹å†Œï¼Œæˆ–è€…ç›´æ¥é—®ä¸€é—® AI â€œå¦‚ä½•è·å¾—ä¸€ä¸ªè¿›ç¨‹æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ï¼Ÿâ€ã€‚äººå·¥æ™ºèƒ½ç»™ä½ çš„å›ç­”ä¼šæœ‰æƒŠå–œ (ä¾‹å¦‚ï¼Œå®ƒä¼šç»™å‡º Windows å’Œ macOS åº”è¯¥æ€ä¹ˆè·å¾—ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´)ã€‚åœ¨å»ºç«‹äº†  strace çš„åŸºæœ¬æ¦‚å¿µåï¼Œæˆ‘ä»¬ä¾ç„¶æ¨èå¤§å®¶éå†å¼åœ°é˜…è¯» strace çš„æ‰‹å†Œï¼Œè·å¾—å¯¹è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ›´å…¨é¢çš„ç†è§£ã€‚</p>
<h3>4.3 å®ç° sperf</h3>
<p>æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åŸºäº strace è®¾è®¡ä¸€ä¸ªå®Œæˆå®éªŒçš„è·¯çº¿å›¾äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠé‡è¦çš„æ­¥éª¤ä¸ºå¤§å®¶åˆ†è§£å¥½ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>fork</code> åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼›</li>
<li>å­è¿›ç¨‹ä½¿ç”¨ execve è°ƒç”¨ <code>strace COMMAND ARG...</code>ï¼Œå¯åŠ¨ä¸€ä»½ straceï¼›æ³¨æ„åœ¨ execve æˆåŠŸè¿”å›ä»¥åï¼Œå­è¿›ç¨‹å·²ç»ä¸å†å—æ§åˆ¶äº†ï¼Œstrace ä¼šä¸æ–­è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„ traceï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚ç¨‹åºä¸ç»“æŸ strace ä¹Ÿä¸ä¼šç»“æŸï¼›</li>
<li>çˆ¶è¿›ç¨‹æƒ³åŠæ³•ä¸æ–­è¯»å– strace çš„è¾“å‡ºï¼Œç›´åˆ° strace ç¨‹åºç»“æŸï¼Œè¯»å–åˆ°è¾“å‡ºåï¼Œå¦‚æœè·ç¦»ä¸Šæ¬¡è¾“å‡ºå·²ç»è¶…è¿‡ 100msï¼Œå°±æŠŠç»Ÿè®¡ä¿¡æ¯æ‰“å°åˆ°å±å¹•ä¸Šã€‚</li>
</ol>
<p>ä½ é‡åˆ°çš„ç¬¬ä¸€ä¸ªå®é™…é—®é¢˜å°±æ˜¯ä½¿ç”¨ execve ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[])</span>;
</code></pre>
<p>é¦–å…ˆï¼Œfilename æ˜¯ç›¸å¯¹äºè¿›ç¨‹çš„å½“å‰ç›®å½• (current working directory) è€Œè¨€çš„ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å› æ­¤ï¼Œè™½ç„¶ä½ åœ¨ç»ˆç«¯é‡Œ <code>yes</code> æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœä½ </p>
<pre><code class="hljs language-c">execve(<span class="hljs-string">&quot;yes&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
perror(<span class="hljs-string">&quot;exec&quot;</span>);
</code></pre>
<p>ç«‹å³å°±ä¼šå¾—åˆ° â€œexec: No such file or directoryâ€ï¼Œé™¤éä½ ä½¿ç”¨ <code>/usr/bin/yes</code>ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ execvpe è§£å†³ï¼Œä¸è¿‡æˆ‘ä»¬çš„å®éªŒæ˜¯ç¦ç”¨çš„ï¼Œæ‰€ä»¥ä½ å¾—è‡ªå·±æƒ³åŠæ³•ã€‚</p>
<p>æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦ä¼ å…¥æ­£ç¡®çš„ <code>argv</code> å’Œ <code>envp</code>ã€‚å¦‚æœä½ åªæ˜¯è°ƒç”¨ yesï¼Œç»™ <code>envp</code> ä¼ å…¥ <code>NULL</code> ä¸ç®—æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†å¾ˆå¤šç¨‹åºçš„è¿è¡Œéƒ½æ˜¯ä¾èµ–äºæ­£ç¡®çš„ç¯å¢ƒå˜é‡çš„â€”â€”ä¸€ä¸ªä¾‹å­å°±æ˜¯ straceã€‚å¦‚æœåœ¨ execve strace çš„æ—¶å€™æ²¡æœ‰ä¼ å…¥æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒä¹Ÿæ²¡æ³•æ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-text">$ PATH=&quot;&quot; /usr/bin/strace ls
/usr/bin/strace: Can&#x27;t stat &#x27;ls&#x27;: No such file or directory
</code></pre>
<p>ç”¨ä»¥ä¸‹ä»£ç  (ä¸å‡ºæ„å¤–) åº”è¯¥èƒ½æ­£ç¡®æ‰§è¡Œ straceï¼š</p>
<pre><code class="hljs language-c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> {
    <span class="hljs-type">char</span> *exec_argv[] = { <span class="hljs-string">&quot;strace&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-literal">NULL</span>, };
    <span class="hljs-type">char</span> *exec_envp[] = { <span class="hljs-string">&quot;PATH=/bin&quot;</span>, <span class="hljs-literal">NULL</span>, };
    execve(<span class="hljs-string">&quot;strace&quot;</span>,          exec_argv, exec_envp);
    execve(<span class="hljs-string">&quot;/bin/strace&quot;</span>,     exec_argv, exec_envp);
    execve(<span class="hljs-string">&quot;/usr/bin/strace&quot;</span>, exec_argv, exec_envp);
    perror(argv[<span class="hljs-number">0</span>]);
    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
}
</code></pre>
<p>å®ƒ â€œæ‰‹å·¥â€ æ¨¡æ‹Ÿäº† PATH ç¯å¢ƒå˜é‡çš„è§£æâ€”â€”è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ä¸€ç³»åˆ—çš„ exec å‡½æ•°ï¼šexecl, execlp, execle, execv, execvp, execvpeã€‚</p>
<p>åœ¨è¯¾å ‚ä¸Š (å’Œ xv6 shell) ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† pipe ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ›å»ºåŒ¿åç®¡é“ï¼Œå¹¶ä¸”åœ¨ gdb ä¸­è°ƒè¯•äº† Shell æ˜¯å¦‚ä½•å®ç°é‡å®šå‘çš„ã€‚æˆ‘ä»¬æ‘˜æŠ„ xv6 shell ç®¡é“å‘½ä»¤çš„å®ç°ï¼š</p>
<pre><code class="hljs language-c"><span class="hljs-keyword">case</span> PIPE:
    pcmd = (<span class="hljs-keyword">struct</span> pipecmd *)cmd;
    assert(syscall(SYS_pipe, p) &gt;= <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (syscall(SYS_fork) == <span class="hljs-number">0</span>) {
        syscall(SYS_close, <span class="hljs-number">1</span>);
        syscall(SYS_dup, p[<span class="hljs-number">1</span>]);
        syscall(SYS_close, p[<span class="hljs-number">0</span>]);
        syscall(SYS_close, p[<span class="hljs-number">1</span>]);
        runcmd(pcmd-&gt;left);
    }
    <span class="hljs-keyword">if</span> (syscall(SYS_fork) == <span class="hljs-number">0</span>) {
        syscall(SYS_close, <span class="hljs-number">0</span>);
        syscall(SYS_dup, p[<span class="hljs-number">0</span>]);
        syscall(SYS_close, p[<span class="hljs-number">0</span>]);
        syscall(SYS_close, p[<span class="hljs-number">1</span>]);
        runcmd(pcmd-&gt;right);
    }
    syscall(SYS_close, p[<span class="hljs-number">0</span>]);
    syscall(SYS_close, p[<span class="hljs-number">1</span>]);
    syscall(SYS_wait4, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    syscall(SYS_wait4, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
</code></pre>
<div class="box red-box"><div><span class="float-left text-4xl mr-3 mt-2">âš ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>è¯·å¤§å®¶ä¸è¦å¤åˆ¶ç²˜è´´ä¸Šé¢çš„ä»£ç </b></span><div class="font-serif pt-2"><p>ä¸Šé¢çš„ä»£ç ç»™å¤§å®¶ä¸€ä¸ª â€œè¦åšä»€ä¹ˆâ€ çš„æç¤ºï¼›è€Œå¦‚æœä½ è‡ªå·±äº²æ‰‹ä»é›¶ç¼–å†™ï¼Œä½ å°±ä¼šè¢«è¿«ç”»å‡ºçŠ¶æ€æœºï¼Œæ¨¡æ‹Ÿå¤šä¸ªè¿›ç¨‹ä¹‹é—´äº¤äº’çš„çŠ¶æ€â€”â€”è¿™æ˜¯å¯¹å¤§å®¶ç†è§£å¤šè¿›ç¨‹ã€ç®¡é“éå¸¸å¿…è¦çš„ã€‚</p></div></div></div>
<p>strace çš„è¾“å‡ºå¾ˆåƒæ˜¯ä¸€è¡Œ C å‡½æ•°è°ƒç”¨ã€‚å¦‚æœä½¿ç”¨äº†æ­£ç¡®çš„å‚æ•°è°ƒç”¨ straceï¼Œæˆ‘ä»¬çš„é—®é¢˜å°±å˜æˆäº†ä»ä¸€è¡Œå­—ç¬¦ä¸²é‡Œæå–ç‰¹å®šä½ç½®çš„æ•°å­—å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ â€œ<code>&lt;0.000011&gt;</code>â€ã€‚</p>
<pre><code class="hljs language-text">mmap2(0xb76d1000, 10780, PROT_READ|PROT_WRITE, ...) = 0xb76d1000 &lt;0.000011&gt;
</code></pre>
<p>è§£ææœ‰å¾ˆå¤šç§åŠæ³•ï¼Œæœ€æ–¹ä¾¿çš„å½“ç„¶æ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼å•¦ï¼æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¯•è¯• <code>regex.h</code>ã€‚</p>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">â˜•ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>å†™å‡ºæ­£ç¡®çš„ sperf</b></span><div class="font-serif pt-2"><p>å¦‚æœä½ æƒ³å¾—å¤šä¸€äº›ï¼Œå¯èƒ½ä¼šå‘ç°ä¸€äº›é¢å¤–çš„éº»çƒ¦ã€‚ä¾‹å¦‚ï¼Œstrace é»˜è®¤ä¼šæŠŠ trace è¾“å‡ºåˆ° stderrï¼Œè¿™ä¸ªè¡Œä¸ºæ²¡å•¥é—®é¢˜ã€‚ä½†å¦‚æœ strace è¿½è¸ªçš„ç¨‹åºä¹Ÿè¾“å‡ºåˆ° stderrï¼Œä¸å°± â€œç ´åâ€ äº† strace çš„è¾“å‡ºäº†å—ã€‚è€Œä¸”ï¼Œå³ä¾¿è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ (æ¯”å¦‚æŠŠç¨‹åºçš„ stderr é‡å®šå‘åˆ° <code>/dev/null</code> ä¸¢å¼ƒ)ï¼Œç¨‹åºè¾“å‡ºçš„å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½å¯¹ parsing å¸¦æ¥ä¸å¥½çš„å½±å“ï¼š</p><pre><code class="hljs language-text">$ strace -T echo -n &#x27;&quot;, 1) = 100 &lt;99999.9&gt;&#x27; &gt; /dev/null
ioctl(1, TCGETS, 0x7fff80723570)        = -1 ENOTTY &lt;0.000100&gt;
write(1, &quot;\&quot;, 1) = 100 &lt;99999.9&gt;&quot;, 21)  = 21 &lt;0.000149&gt;
close(1)                                = 0 &lt;0.000126&gt;
</code></pre><p>æ˜¯çš„ï¼Œä¸€ä¸ªç³»ç»Ÿå·¥å…·éœ€è¦åœ¨<strong>ä»»ä½•æ—¶å€™</strong>éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚ä¸Šé¢çš„ä¾‹å­æœ‰ç‚¹ â€œæ•…æ„è€èµ–â€ï¼Œä½†å¦‚æœä½ åªè¯•å›¾åŒ¹é… <code>&lt;&gt;</code> ä¸­çš„æ•°å­—ï¼Œå°±çš„ç¡®ä¼šåœ¨ä¸€äº›åœºæ™¯ä¸‹äº§ç”Ÿé”™è¯¯ã€‚è™½ç„¶æˆ‘ä»¬å¹¶ä¸ä¼šæƒ³å°½ä¸€åˆ‡åŠæ³•æ„é€ æç«¯çš„æµ‹è¯•ç”¨ä¾‹æ¥å¯¹ä»˜å¤§å®¶ï¼Œä½†å¤§å®¶ä¸å¦¨å¯ä»¥æ·±å…¥æ€è€ƒä¸€ä¸‹ â€œæ€ä¹ˆæŠŠç¨‹åºå†™å¯¹â€ è¿™ä¸ªé—®é¢˜ã€‚</p></div></div></div></div></div><div class="bg-neutral-100 text-center text-neutral-600 dark:bg-neutral-600 dark:text-neutral-200 lg:text-left"><div class="bg-neutral-200 p-6 text-center dark:bg-neutral-700"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons License: BY-NC 4.0</a><br/><a href="https://beian.miit.gov.cn/">è‹ ICP å¤‡ 2020049101 å·</a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    strong: \"strong\",\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    h3: \"h3\",\n    pre: \"pre\",\n    img: \"img\",\n    ul: \"ul\",\n    li: \"li\",\n    span: \"span\",\n    ol: \"ol\"\n  }, _provideComponents(), props.components), {Box, Submission, Quiz} = _components;\n  if (!Box) _missingMdxReference(\"Box\", true);\n  if (!Quiz) _missingMdxReference(\"Quiz\", true);\n  if (!Submission) _missingMdxReference(\"Submission\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"M5: ç³»ç»Ÿè°ƒç”¨ Profiler (sperf)\"\n    }), \"\\n\", _jsx(Box, {\n      logo: \"â°\",\n      title: \"Soft Deadline: 2024 å¹´ 5 æœˆ 26 æ—¥ 23:59:59\",\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: _jsxs(\"red\", {\n            children: [\"ä½ éœ€è¦é¦–å…ˆé˜…è¯»\", _jsx(_components.a, {\n              href: \"Labs.md\",\n              children: \"å®éªŒé¡»çŸ¥\"\n            }), \"ï¼Œå…¶ä¸­åŒ…å«äº†ä»£ç è·å–æ–¹æ³•ã€æäº¤æ–¹æ³•ã€å¦‚ä½•æŸ¥çœ‹æäº¤ç»“æœç­‰\"]\n          })\n        }), \"ã€‚åœ¨å‘½ä»¤è¡Œä¸­ \", _jsx(_components.code, {\n          children: \"git pull origin M5\"\n        }), \" ä¸‹è½½æ¡†æ¶ä»£ç ã€‚\"]\n      })\n    }), \"\\n\", _jsx(Submission, {\n      course: \"OS2024\",\n      module: \"M5\",\n      desc: \"M5 - sperf\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"1. èƒŒæ™¯\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"â€œEverything is a state machine.â€ èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£æ â€œçŠ¶æ€æœºæ‰§è¡Œâ€ çš„å·¥å…·ï¼Œè‡ªç„¶å¯¹è°ƒè¯•ã€æ€§èƒ½è¯Šæ–­ç­‰ä»»åŠ¡æ˜¯è‡³å…³é‡è¦çš„ã€‚æˆ‘ä»¬åœ¨è¯¾å ‚ä¸Šå±•ç¤ºè¿‡å„ç±»å„ç±»åˆ†æçŠ¶æ€æœºæ‰§è¡Œè½¨è¿¹çš„å·¥å…·ï¼ŒåŒ…æ‹¬ gdb (step/stepi)ã€strace ç­‰ã€‚ä¸ºäº†åŠ æ·±å¤§å®¶å¯¹è¿™äº›å·¥å…·çš„è®¤è¯†ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¾å ‚ä¸Šå­¦è¿‡çš„è¿›ç¨‹ç®¡ç† APIï¼Œå»å¯åŠ¨ä¸€ä¸ªè¿™æ ·çš„å·¥å…·ï¼Œå¹¶è·å¾—å®ƒä»¬çš„è¾“å‡ºã€‚è¿™ä¸ªå®éªŒä¹Ÿæ›¿ä»£äº†é€šå¸¸ã€Šæ“ä½œç³»ç»Ÿã€‹è¯¾ç¨‹ä¸­å¸¸è§çš„ç®¡é“ (shell) ä½œä¸šã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2. å®éªŒæè¿°\"\n    }), \"\\n\", _jsx(Box, {\n      logo: \"ğŸ—’ï¸\",\n      title: \"å®éªŒè¦æ±‚ï¼šå®ç°ç³»ç»Ÿè°ƒç”¨ Profiler\",\n      children: _jsxs(_components.p, {\n        children: [\"å®ç°ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒèƒ½å¯åŠ¨å¦ä¸€ä¸ªç¨‹åºï¼Œå¹¶ç»Ÿè®¡è¯¥ç¨‹åºä¸­å„ä¸ªç³»ç»Ÿè°ƒç”¨çš„å ç”¨æ—¶é—´ã€‚å¯¹äºè¾ƒçŸ­æ—¶é—´è¿è¡Œçš„ç¨‹åºï¼Œä½ å¯ä»¥ä¸€æ¬¡æ€§æ‰“å°å‡ºè€—æ—¶æœ€å¤šçš„å‡ ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºè€—æ—¶è¾ƒé•¿çš„ç¨‹åºï¼Œä½ éœ€è¦ä¿è¯æ¯ç§’å¤§çº¦\", _jsx(_components.strong, {\n          children: \"æ‰“å° 10 æ¬¡\"\n        }), \" (ä¸è¦è¿‡å¤š) ç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ä¿¡æ¯ã€‚\"]\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"2.1 æ€»è§ˆ\"\n    }), \"\\n\", _jsxs(\"center\", {\n      children: [\"sperf \", _jsx(\"u\", {\n        children: \"COMMAND\"\n      }), \" [\", _jsx(\"u\", {\n        children: \"ARG\"\n      }), \"]... \"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"2.2 æè¿°\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å®ƒä¼šè¿è¡Œ COMMAND å‘½ä»¤ (å¦‚æœ COMMAND æ˜¯ä»¥ \", _jsx(_components.code, {\n        children: \"/\"\n      }), \" å¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œåˆ™ç›´æ¥æ‰§è¡Œï¼›å¦åˆ™åœ¨ \", _jsx(_components.code, {\n        children: \"PATH\"\n      }), \" ç¯å¢ƒå˜é‡ä¸­æœç´¢åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶)ï¼Œå¹¶ä¸º COMMAND ä¼ å…¥ ARG å‚æ•° (åˆ—è¡¨)ï¼Œç„¶åç»Ÿè®¡å‘½ä»¤æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨æ‰€å çš„æ—¶é—´ã€‚ä¾‹å¦‚æ‰§è¡Œ \", _jsx(_components.code, {\n        children: \"sperf find /\"\n      }), \" ä¼šåœ¨ç³»ç»Ÿä¸­æ‰§è¡Œ \", _jsx(_components.code, {\n        children: \"find /\"\n      }), \"ï¼Œå¹¶ä¸”åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå‡ºè€—æ—¶æœ€å¤šçš„è‹¥å¹²ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"sperf å‡è®¾ \", _jsx(_components.code, {\n        children: \"COMMAND\"\n      }), \" æ˜¯å•è¿›ç¨‹ã€å•çº¿ç¨‹çš„ï¼Œæ— éœ€å¤„ç†å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„æƒ…å†µã€‚\"]\n    }), \"\\n\", _jsx(Box, {\n      logo: \"âš ï¸\",\n      title: \"åªèƒ½ä½¿ç”¨ execve\",\n      children: _jsxs(_components.p, {\n        children: [\"ä¸ºäº†å¼ºè¿«å¤§å®¶ç†è§£ execve ç³»ç»Ÿè°ƒç”¨ï¼Œsperf å®ç°æ—¶ï¼Œ\", _jsx(_components.strong, {\n          children: \"åªèƒ½ä½¿ç”¨ execve ç³»ç»Ÿè°ƒç”¨\"\n        }), \"ï¼›ä½¿ç”¨ glibc å¯¹ execve çš„åŒ…è£… (execl, execlp, execle, execv, execvp, execvpe) å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œexec ç³»åˆ—å‡½æ•°ï¼Œä¾‹å¦‚ä»¥ p (path) ç»“å°¾çš„å‡½æ•°ä¼šä» PATH ç¯å¢ƒå˜é‡ä¸­æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚\"]\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"2.3 è§£é‡Š\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä½ å¯ä»¥ä»¥ä»»ä½•æ–¹å¼è¾“å‡ºç³»ç»Ÿè°ƒç”¨èŠ±è´¹çš„æ—¶é—´ï¼Œä¾‹å¦‚ä½ å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´æŠŠè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼š\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        children: \"$ ./sperf-64 tree /\\nTime: 0.1s\\nlstat (50%)\\ngetdents (20%)\\n...\\n====================\\nTime: 0.2s\\nlstat (50%)\\ngetdents (20%)\\n...\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨æˆ‘ä»¬çš„å‚è€ƒå®ç°ä¸­ï¼Œé€šè¿‡åœ¨å­—ç¬¦ç»ˆç«¯é‡Œç»˜åˆ¶ç³»ç»Ÿè°ƒç”¨å›¾çš„æ–¹å¼å±•ç¤ºç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ (ç³»ç»Ÿè°ƒç”¨æ‰€èŠ±æ—¶é—´ä¸æ‰€å é¢ç§¯æˆæ­£æ¯”)ã€‚ä½ å®Œå…¨å¯ä»¥æŠŠä½ çš„ sperf çš„è¾“å‡ºç®¡é“ç»™å¦ä¸€ä¸ª â€œå¯è§†åŒ–â€ å·¥å…·æ¥ç”Ÿæˆå®ƒâ€”â€”è¿™ä¸æœ¬æ¬¡å®éªŒæ— å…³ã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"../../img/sperf-demo.gif\",\n        alt: \"\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä½†æ— è®ºå¦‚ä½•ï¼Œä¸€ä¸ªå¯è§†åŒ–çš„å·¥å…·éƒ½å¯ä»¥å¸®æˆ‘ä»¬æä¾›å…³äºç³»ç»Ÿå’Œç¨‹åºè¿è¡Œçš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"å¯¹äº memory intensive çš„çº¯è®¡ç®—å‹ç¨‹åºï¼Œbrk å’Œ munmap èŠ±å»äº†æœ€å¤šçš„æ—¶é—´ï¼›\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å¯¹äºæ–‡ä»¶ç³»ç»Ÿéå†ï¼Œæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®è®¿é—® lstat å’Œ getdents èŠ±å»äº†æœ€å¤šçš„æ—¶é—´ã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"3. æ­£ç¡®æ€§æ ‡å‡†\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"sperf å¯¹ profiling ç»“æœçš„è¾“å‡ºæ ¼å¼æ²¡æœ‰ç‰¹åˆ«è¦æ±‚ï¼Œå¹¶å‡è®¾è¢« trace çš„ç¨‹åºæ˜¯å•è¿›ç¨‹ç¨‹åº (Online Judge æµ‹è¯•ç”¨ä¾‹ä¼šä¿è¯è¿™ä¸€ç‚¹)ã€‚å¦‚æœè¿›ç¨‹æ²¡æœ‰å‘ç”Ÿç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–ç³»ç»Ÿè°ƒç”¨è€—æ—¶å¾ˆé•¿æ²¡æœ‰ç»“æŸ (ä¾‹å¦‚ç­‰å¾…è¾“å…¥çš„ \", _jsx(_components.code, {\n        children: \"read\"\n      }), \" æˆ–å¤§é‡æ•°æ®çš„å†™å…¥)ï¼Œä½ ç›¸åº”çš„ä¿¡æ¯ä¹Ÿå¯ä»¥ä¸å¿…æ›´æ–° (å³é‡åˆ°å¾ˆé•¿çš„ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä½ ä¸éœ€è¦ç«‹å³å°†è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ç»Ÿè®¡è¿›æ¥ï¼Œå¯ä»¥ç­‰å®ƒæ‰§è¡Œç»“æŸåå†ç»Ÿè®¡)ã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä¸ºäº† Online Judge åˆ¤å®šæ–¹ä¾¿ï¼Œæˆ‘ä»¬è¦æ±‚ä½ çš„ç¨‹åºæ»¡è¶³ä»¥ä¸‹è¾“å‡ºæ ¼å¼ï¼š\"\n    }), \"\\n\", _jsxs(Box, {\n      logo: \"ğŸ—’ï¸\",\n      title: \"å®éªŒè¦æ±‚ï¼šå®ç°ç³»ç»Ÿè°ƒç”¨ Profiler\",\n      children: [_jsxs(_components.p, {\n        children: [\"æ¯æ¬¡è¾“å‡ºè€—æ—¶ top 5 çš„ç³»ç»Ÿè°ƒç”¨ã€æ¯ä¸ªç³»ç»Ÿè°ƒç”¨è‡³å¤šè¾“å‡ºä¸€æ¬¡ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨çš„å°å†™åå­— (strace è¾“å‡ºçš„åå­—)å’Œç³»ç»Ÿè°ƒç”¨è€—æ—¶æ¯”ä¾‹æŒ‰ç…§ â€œ\", _jsx(_components.code, {\n          children: \"(XX%)\"\n        }), \"â€ã€‚ä½¿ç”¨\"]\n      }), _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-c\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"printf\"\n          }), \"(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"%s (%d%%)\\\\n\\\"\"\n          }), \", syscall_name, ratio);\\n\"]\n        })\n      }), _jsxs(_components.p, {\n        children: [\"è¾“å‡ºå³å¯ã€‚åœ¨æ¯æ¬¡ç»Ÿè®¡ä¿¡æ¯è¾“å‡ºå®Œæ¯•åï¼Œæ‰“å° 80 ä¸ª \", _jsx(_components.code, {\n          children: \"\\\\0\"\n        }), \" (æ³¨æ„ä¸æ˜¯ \", _jsx(_components.code, {\n          children: \"'0'\"\n        }), \"ï¼Œæ˜¯æ•°å€¼ä¸º 0 çš„å­—ç¬¦ï¼Œå®ƒä»¬ä¸ä¼šåœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤º)ã€‚æˆ‘ä»¬å°†ä»¥è¿™ 80 ä¸ª \", _jsx(_components.code, {\n          children: \"\\\\0\"\n        }), \" ä½œä¸ºåˆ’åˆ†ã€‚\"]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è¾“å‡ºè¿‡äºé¢‘ç¹ä¼šè‡´ Output Limit Exceededã€‚ä¿è¯åœ¨è¢«è¿½è¸ªè¿›ç¨‹ä¸æ–­æŒç»­æœ‰ç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼Œæ¯ç§’æ‰“å°å¤§çº¦ 10 æ¬¡å³å¯ã€‚æ­¤å¤–ï¼Œå¦‚æœè¿›ç¨‹é€€å‡ºï¼Œä½ çš„ sperf ä¹Ÿåº”è¯¥ç›¸åº”é€€å‡ºã€‚è¿™ä¸ªè¡Œä¸ºç±»ä¼¼äº strace å’Œ perfã€‚\"\n    }), \"\\n\", _jsx(Box, {\n      logo: \"âš ï¸\",\n      title: \"åŠæ—¶æ¸…ç©º stdout çš„ç¼“å†²åŒº\",\n      children: _jsxs(_components.p, {\n        children: [\"ä¸åŒäºä½ çš„æœ¬åœ°æµ‹è¯• (stdout ä¸ºç»ˆç«¯)ï¼ŒOnline Judge åœ¨è¯„æµ‹æ—¶ä¼šæŠŠ stdout é‡å®šå‘åˆ°æ–‡ä»¶ (æˆ–ç®¡é“)ï¼Œå› è€Œ libc ä¼šè¿›å…¥\\nfully buffered mode (å°±åƒæˆ‘ä»¬è¯¾å ‚ä¸Šè®² fork åœ¨ \", _jsx(_components.code, {\n          children: \"./a.out\"\n        }), \" å’Œ \", _jsx(_components.code, {\n          children: \"./a.out | wc -l\"\n        }), \" çœ‹åˆ°ä¸åŒè¡Œæ•°çš„ä¾‹å­é‚£æ ·)ã€‚å› æ­¤è¯·ç¡®ä¿ä½ åœ¨æ¯ä¸€è½®è¾“å‡ºåä½¿ç”¨ fflushâ€”â€”å¦åˆ™ timeout è¢«å¼ºè¡Œç»ˆæ­¢æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½çœ‹ä¸åˆ°ä½ çš„è¾“å‡ºã€‚\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"4. å®éªŒæŒ‡å—\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"4.1 Trace å·¥å…·\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æ“ä½œç³»ç»Ÿé‡Œæä¾›äº†è¶³å¤Ÿçš„å·¥å…·æ»¡è¶³ä½  â€œæ£€æŸ¥çŠ¶æ€æœºæ‰§è¡Œâ€ çš„éœ€æ±‚â€”â€”é‚£å°±æ˜¯è¿½è¸ªå·¥å…· traceã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ strace å¯ä»¥è¿½è¸ªç¨‹åºæ‰§è¡Œæ—¶çš„ç³»ç»Ÿè°ƒç”¨ã€‚\"\n    }), \"\\n\", _jsx(Box, {\n      logo: \"â˜•ï¸\",\n      title: \"å®ç° strace\",\n      children: _jsx(_components.p, {\n        children: \"å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ Linux ä¸Šå®ç° straceï¼Œæœ‰å“ªäº›å¯èƒ½çš„é€”å¾„ï¼ŸAI ç»™äº†æˆ‘ä»¬ä¸€äº›æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ ptrace ç³»ç»Ÿè°ƒç”¨ã€Linux Auditã€eBPFã€SystemTap å’Œ LTTngã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ã€æŒæ¡ç¨‹åº¦æ¥é€‰æ‹©æ€§åœ°äº†è§£è¿™äº›æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¯¹è¯¾ç¨‹å†…å®¹æ„Ÿåˆ°åƒåŠ›ï¼Œä¸å¦¨ä¼˜å…ˆå®Œæˆå®éªŒï¼›ä½†å¦‚æœä½ å¯¹ç¼–ç¨‹å·²ç»æœ‰å¾ˆä¸é”™çš„è‡ªä¿¡ï¼Œå°±å¯ä»¥è¯•ä¸€è¯•å…¶ä»–çš„æœºåˆ¶ã€‚\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Trace å·¥å…·æ˜¯ç³»ç»Ÿç¼–ç¨‹æ—¶éå¸¸å¸¸ç”¨çš„é—®é¢˜è¯Šæ–­å·¥å…·ã€‚æ ¹æ®è°ƒè¯•ç†è®ºï¼Œtrace åœ¨ä¸€å®šç¨‹åº¦ä¸Šååº”äº†ç¨‹åºæ‰§è¡Œçš„æµç¨‹ï¼Œå› æ­¤å¯ä»¥å¸®åŠ©ä½ ç¼©å° bug æ‰€åœ¨çš„èŒƒå›´ (å›é¡¾è°ƒè¯•çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘ç”Ÿ error çš„ç¨‹åºçŠ¶æ€)ï¼›æ­¤å¤–ï¼Œtrace ä¸­é¢å¤–çš„ä¿¡æ¯è¿˜èƒ½å¸®åŠ©è¯Šæ–­æ€§èƒ½ç­‰é—®é¢˜ (ä¾‹å¦‚ä½ çš„ç¨‹åºæ˜¯å¦åœ¨æŸä¸ªç³»ç»Ÿè°ƒç”¨ä¸ŠèŠ±å»äº†å¤§é‡çš„æ—¶é—´)ã€‚é™¤äº†æˆ‘ä»¬ç†ŸçŸ¥çš„ strace, ltraceï¼Œå…¶å® trace å¹¿æ³›åœ°å­˜åœ¨äºè®¡ç®—æœºç³»ç»Ÿçš„å„ä¸ªå±‚é¢ä¸Šï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"æ“ä½œç³»ç»Ÿå†…æ ¸ (ä¾‹å¦‚ Linux) æä¾›äº†å¤šç§ trace æœºåˆ¶ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒ \", _jsx(_components.a, {\n          href: \"https://www.kernel.org/doc/html/latest/trace/ftrace.html\",\n          children: \"ftrace\"\n        }), \"ï¼›\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"æµè§ˆå™¨çš„å¼€å‘è€…æ¨¡å¼ (F12 æ§åˆ¶å°ï¼Œæƒ³å¿…å¤§å®¶å·²ç»ç”¨å®ƒæŸ¥çœ‹è¿‡è¯¾ç¨‹ç½‘ç«™çš„ slides æ˜¯å¦‚ä½•å®ç°çš„äº†) ä¸­ï¼Œèƒ½å¤Ÿ trace ç½‘ç»œç­‰è¯·æ±‚â€”â€”åˆ«å°çœ‹å®ƒï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ traceï¼è€Œä¸”å®ƒå¯¹è°ƒè¯•ç½‘ç«™çš„åŠŸèƒ½æ€§é—®é¢˜å’Œæ€§èƒ½é—®é¢˜éƒ½æ˜¯è‡³å…³é‡è¦çš„ï¼›\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"é€šè¿‡ Java Virtual Machine Tool Interface (JVMTI) åœ¨ Java è™šæ‹Ÿæœºä¸­åˆ›å»º agentï¼Œæ”¶é›†ç¨‹åºæ‰§è¡Œçš„ä¿¡æ¯ã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨ trace çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å®ç°ç¨‹åºçš„\", _jsx(_components.strong, {\n        children: \"æ€§èƒ½è¯Šæ–­\"\n      }), \"å·¥å…· (è™½ç„¶ strace çš„è®¾è®¡æ„å›¾æœ¬èº«å¹¶ä¸ä¸»è¦æ˜¯ä¸ºäº†è¯Šæ–­æ€§èƒ½é—®é¢˜)ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æ‰¾åˆ°ç¨‹åºè¿è¡Œæ—¶è€—æ—¶æœ€å¤šçš„é‚£äº›ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œæ‰¾åˆ°ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆã€‚\", _jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/Profiling_(computer_programming)\",\n        children: \"Profiler\"\n      }), \" èƒ½å¤Ÿæä¾›ç³»ç»Ÿæ€§èƒ½åˆ†æçš„æŠ¥å‘Šâ€”â€”è€Œä¸”è¿™ä»¶äº‹ä¸€ç‚¹ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªè¦åˆ†æ trace çš„è¾“å‡ºå°±å¯ä»¥äº†ã€‚ä½¿ç”¨é€‚å½“çš„å·¥å…·ï¼Œç”šè‡³å¯ä»¥æ ¹æ® trace çš„ç»“æœè¾“å‡ºä¸€ä¸ªå¯äº¤äº’çš„ \", _jsx(_components.a, {\n        href: \"http://www.brendangregg.com/flamegraphs.html\",\n        children: \"Flame Graph\"\n      }), \":\"]\n    }), \"\\n\", _jsx(\"iframe\", {\n      className: \"w-full\",\n      height: \"480\",\n      src: \"../../img/flame-graph.svg\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"4.2 è·å¾—ç³»ç»Ÿè°ƒç”¨åºåˆ—\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æˆ‘ä»¬çŸ¥é“ (å¹¶ä¸”æ¯å¹´è€ƒè¯•éƒ½ä¼šè€ƒ)ï¼Œstrace å¯ä»¥è·å¾—è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨çš„åºåˆ—ï¼š\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-text\",\n        children: \"$ strace ls\\nexecve(\\\"/bin/ls\\\", [\\\"ls\\\"], 0x7ffd3a99eb80 /* 23 vars */)  = 0\\nbrk(NULL)                                                = 0x55c642aa9000\\naccess(\\\"/etc/ld.so.nohwcap\\\", F_OK)                       = -1 ENOENT\\naccess(\\\"/etc/ld.so.preload\\\", R_OK)                       = -1 ENOENT\\nopenat(AT_FDCWD, \\\"/etc/ld.so.cache\\\", O_RDONLY|O_CLOEXEC) = 3\\nfstat(3, {st_mode=S_IFREG|0644, st_size=93852, ...})     = 0\\n...\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è€Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ä¸ª â€œçŠ¶æ€æœºçŠ¶æ€â€ ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„\", _jsx(_components.strong, {\n        children: \"å”¯ä¸€\"\n      }), \"æ–¹å¼ (è¿™ä¸ªè¯´æ³•å¹¶ä¸ä¸¥æ ¼ï¼›è¿˜å¯ä»¥é€šè¿‡å…±äº«å†…å­˜å®ç°ä¸æ“ä½œç³»ç»Ÿå†…æ ¸çš„é€šä¿¡)ã€‚strace ä» execve â€œé‡ç½®çŠ¶æ€æœºâ€ çš„ç³»ç»Ÿè°ƒç”¨å¼€å§‹ï¼Œåˆ—å‡ºè¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„ä¸€åˆ‡äº¤äº’ã€‚æ‰€ä»¥ä»æœ¬è´¨ä¸Šè®²ï¼Œæˆ‘ä»¬åªéœ€è¦\", _jsx(_components.strong, {\n        children: \"è§£æ strace çš„è¾“å‡º\"\n      }), \"å°±èƒ½å®Œæˆè¿™ä¸ªå®éªŒã€‚\"]\n    }), \"\\n\", _jsx(Box, {\n      logo: \"â˜•ï¸\",\n      title: \"é˜…è¯»ç³»ç»Ÿè°ƒç”¨åºåˆ—\",\n      children: _jsx(_components.p, {\n        children: \"è¿™ä¸ªå®éªŒçš„ä¸€ä¸ªæœ‰æ„çš„ â€œè®¾è®¡â€ æ˜¯å¼ºè¿«å¤§å®¶é˜…è¯» strace è¾“å‡ºçš„ç³»ç»Ÿè°ƒç”¨åºåˆ—ï¼Œè¿›è€Œè§£æå®ƒä»¬ã€‚è¿™æ ·ï¼Œå¤§å®¶å°±ä¼šè¢«è¿«å»çœ‹ä¸€çœ‹çœŸå®è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹æ˜¯æ€æ ·è°ƒç”¨æ“ä½œç³»ç»Ÿ API çš„ã€‚å¦‚æœä½ å¯¹ä»»ä½•ç³»ç»Ÿè°ƒç”¨æ„Ÿåˆ°å›°æƒ‘ï¼Œä½ éƒ½å¯ä»¥ç›´æ¥è¯¢é—® AIã€‚\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¸ä»…å¸Œæœ›å¾—åˆ°ç³»ç»Ÿè°ƒç”¨çš„åºåˆ—ï¼Œè¿˜éœ€è¦æœ‰ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæ—¶é—´æ‰èƒ½å®Œæˆè¿™ä¸ªå®éªŒã€‚strace çš„è¾“å‡ºä¸­å¹¶æ²¡æœ‰ï¼Œå—¯ï¼Œé‚£ä½ åº”è¯¥æƒ³åˆ°è®¡ç®—æœºç³»ç»Ÿä¸­çš„ â€œå…¬ç†â€ï¼š\"\n    }), \"\\n\", _jsx(Quiz, {\n      title: \"è®¡ç®—æœºç³»ç»Ÿå…¬ç†\",\n      question: \"å¦‚æœä½ æœ‰ä¸€ä¸ªåˆç†çš„éœ€æ±‚ï¼Œå°±ä¸€å®šæœ‰å·¥å…·å¯ä»¥æ»¡è¶³ä½ ã€‚\",\n      options: []\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æ‰€ä»¥ä½ ä¼šçŒœæµ‹ strace ä¹Ÿæä¾›äº†è¿™ä¸ªåŠŸèƒ½ã€‚ä½ å¯ä»¥æœç´¢ç½‘ç»œã€é˜…è¯»æ‰‹å†Œï¼Œæˆ–è€…ç›´æ¥é—®ä¸€é—® AI â€œå¦‚ä½•è·å¾—ä¸€ä¸ªè¿›ç¨‹æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´ï¼Ÿâ€ã€‚äººå·¥æ™ºèƒ½ç»™ä½ çš„å›ç­”ä¼šæœ‰æƒŠå–œ (ä¾‹å¦‚ï¼Œå®ƒä¼šç»™å‡º Windows å’Œ macOS åº”è¯¥æ€ä¹ˆè·å¾—ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´)ã€‚åœ¨å»ºç«‹äº†  strace çš„åŸºæœ¬æ¦‚å¿µåï¼Œæˆ‘ä»¬ä¾ç„¶æ¨èå¤§å®¶éå†å¼åœ°é˜…è¯» strace çš„æ‰‹å†Œï¼Œè·å¾—å¯¹è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ›´å…¨é¢çš„ç†è§£ã€‚\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"4.3 å®ç° sperf\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åŸºäº strace è®¾è®¡ä¸€ä¸ªå®Œæˆå®éªŒçš„è·¯çº¿å›¾äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠé‡è¦çš„æ­¥éª¤ä¸ºå¤§å®¶åˆ†è§£å¥½ï¼š\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"ä½¿ç”¨ \", _jsx(_components.code, {\n          children: \"fork\"\n        }), \" åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼›\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"å­è¿›ç¨‹ä½¿ç”¨ execve è°ƒç”¨ \", _jsx(_components.code, {\n          children: \"strace COMMAND ARG...\"\n        }), \"ï¼Œå¯åŠ¨ä¸€ä»½ straceï¼›æ³¨æ„åœ¨ execve æˆåŠŸè¿”å›ä»¥åï¼Œå­è¿›ç¨‹å·²ç»ä¸å†å—æ§åˆ¶äº†ï¼Œstrace ä¼šä¸æ–­è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„ traceï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚ç¨‹åºä¸ç»“æŸ strace ä¹Ÿä¸ä¼šç»“æŸï¼›\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"çˆ¶è¿›ç¨‹æƒ³åŠæ³•ä¸æ–­è¯»å– strace çš„è¾“å‡ºï¼Œç›´åˆ° strace ç¨‹åºç»“æŸï¼Œè¯»å–åˆ°è¾“å‡ºåï¼Œå¦‚æœè·ç¦»ä¸Šæ¬¡è¾“å‡ºå·²ç»è¶…è¿‡ 100msï¼Œå°±æŠŠç»Ÿè®¡ä¿¡æ¯æ‰“å°åˆ°å±å¹•ä¸Šã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä½ é‡åˆ°çš„ç¬¬ä¸€ä¸ªå®é™…é—®é¢˜å°±æ˜¯ä½¿ç”¨ execve ç³»ç»Ÿè°ƒç”¨ã€‚\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"execve\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"char\"\n          }), \" *filename, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"char\"\n          }), \" *\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"const\"\n          }), \" argv[], \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"char\"\n          }), \" *\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"const\"\n          }), \" envp[])\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"é¦–å…ˆï¼Œfilename æ˜¯ç›¸å¯¹äºè¿›ç¨‹çš„å½“å‰ç›®å½• (current working directory) è€Œè¨€çš„ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å› æ­¤ï¼Œè™½ç„¶ä½ åœ¨ç»ˆç«¯é‡Œ \", _jsx(_components.code, {\n        children: \"yes\"\n      }), \" æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœä½ \"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [\"execve(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"yes\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"NULL\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"NULL\"\n        }), \");\\nperror(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"exec\\\"\"\n        }), \");\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ç«‹å³å°±ä¼šå¾—åˆ° â€œexec: No such file or directoryâ€ï¼Œé™¤éä½ ä½¿ç”¨ \", _jsx(_components.code, {\n        children: \"/usr/bin/yes\"\n      }), \"ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ execvpe è§£å†³ï¼Œä¸è¿‡æˆ‘ä»¬çš„å®éªŒæ˜¯ç¦ç”¨çš„ï¼Œæ‰€ä»¥ä½ å¾—è‡ªå·±æƒ³åŠæ³•ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦ä¼ å…¥æ­£ç¡®çš„ \", _jsx(_components.code, {\n        children: \"argv\"\n      }), \" å’Œ \", _jsx(_components.code, {\n        children: \"envp\"\n      }), \"ã€‚å¦‚æœä½ åªæ˜¯è°ƒç”¨ yesï¼Œç»™ \", _jsx(_components.code, {\n        children: \"envp\"\n      }), \" ä¼ å…¥ \", _jsx(_components.code, {\n        children: \"NULL\"\n      }), \" ä¸ç®—æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†å¾ˆå¤šç¨‹åºçš„è¿è¡Œéƒ½æ˜¯ä¾èµ–äºæ­£ç¡®çš„ç¯å¢ƒå˜é‡çš„â€”â€”ä¸€ä¸ªä¾‹å­å°±æ˜¯ straceã€‚å¦‚æœåœ¨ execve strace çš„æ—¶å€™æ²¡æœ‰ä¼ å…¥æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒä¹Ÿæ²¡æ³•æ‰§è¡Œå‘½ä»¤ï¼š\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-text\",\n        children: \"$ PATH=\\\"\\\" /usr/bin/strace ls\\n/usr/bin/strace: Can't stat 'ls': No such file or directory\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ç”¨ä»¥ä¸‹ä»£ç  (ä¸å‡ºæ„å¤–) åº”è¯¥èƒ½æ­£ç¡®æ‰§è¡Œ straceï¼š\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"include\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\u003cstdio.h\u003e\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"include\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\u003cstdlib.h\u003e\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"include\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\u003cunistd.h\u003e\"\n          })]\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"main\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" argc, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"char\"\n          }), \" *argv[])\"]\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"char\"\n        }), \" *exec_argv[] = { \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"strace\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ls\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"NULL\"\n        }), \", };\\n    \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"char\"\n        }), \" *exec_envp[] = { \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"PATH=/bin\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"NULL\"\n        }), \", };\\n    execve(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"strace\\\"\"\n        }), \",          exec_argv, exec_envp);\\n    execve(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/bin/strace\\\"\"\n        }), \",     exec_argv, exec_envp);\\n    execve(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/usr/bin/strace\\\"\"\n        }), \", exec_argv, exec_envp);\\n    perror(argv[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]);\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"exit\"\n        }), \"(EXIT_FAILURE);\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"å®ƒ â€œæ‰‹å·¥â€ æ¨¡æ‹Ÿäº† PATH ç¯å¢ƒå˜é‡çš„è§£æâ€”â€”è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ä¸€ç³»åˆ—çš„ exec å‡½æ•°ï¼šexecl, execlp, execle, execv, execvp, execvpeã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨è¯¾å ‚ä¸Š (å’Œ xv6 shell) ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† pipe ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ›å»ºåŒ¿åç®¡é“ï¼Œå¹¶ä¸”åœ¨ gdb ä¸­è°ƒè¯•äº† Shell æ˜¯å¦‚ä½•å®ç°é‡å®šå‘çš„ã€‚æˆ‘ä»¬æ‘˜æŠ„ xv6 shell ç®¡é“å‘½ä»¤çš„å®ç°ï¼š\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" PIPE:\\n    pcmd = (\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"struct\"\n        }), \" pipecmd *)cmd;\\n    assert(syscall(SYS_pipe, p) \u003e= \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" (syscall(SYS_fork) == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \") {\\n        syscall(SYS_close, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \");\\n        syscall(SYS_dup, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"]);\\n        syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]);\\n        syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"]);\\n        runcmd(pcmd-\u003eleft);\\n    }\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" (syscall(SYS_fork) == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \") {\\n        syscall(SYS_close, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n        syscall(SYS_dup, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]);\\n        syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]);\\n        syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"]);\\n        runcmd(pcmd-\u003eright);\\n    }\\n    syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]);\\n    syscall(SYS_close, p[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"]);\\n    syscall(SYS_wait4, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"-1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n    syscall(SYS_wait4, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"-1\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"break\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(Box, {\n      logo: \"âš ï¸\",\n      title: \"è¯·å¤§å®¶ä¸è¦å¤åˆ¶ç²˜è´´ä¸Šé¢çš„ä»£ç \",\n      children: _jsx(_components.p, {\n        children: \"ä¸Šé¢çš„ä»£ç ç»™å¤§å®¶ä¸€ä¸ª â€œè¦åšä»€ä¹ˆâ€ çš„æç¤ºï¼›è€Œå¦‚æœä½ è‡ªå·±äº²æ‰‹ä»é›¶ç¼–å†™ï¼Œä½ å°±ä¼šè¢«è¿«ç”»å‡ºçŠ¶æ€æœºï¼Œæ¨¡æ‹Ÿå¤šä¸ªè¿›ç¨‹ä¹‹é—´äº¤äº’çš„çŠ¶æ€â€”â€”è¿™æ˜¯å¯¹å¤§å®¶ç†è§£å¤šè¿›ç¨‹ã€ç®¡é“éå¸¸å¿…è¦çš„ã€‚\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"strace çš„è¾“å‡ºå¾ˆåƒæ˜¯ä¸€è¡Œ C å‡½æ•°è°ƒç”¨ã€‚å¦‚æœä½¿ç”¨äº†æ­£ç¡®çš„å‚æ•°è°ƒç”¨ straceï¼Œæˆ‘ä»¬çš„é—®é¢˜å°±å˜æˆäº†ä»ä¸€è¡Œå­—ç¬¦ä¸²é‡Œæå–ç‰¹å®šä½ç½®çš„æ•°å­—å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ â€œ\", _jsx(_components.code, {\n        children: \"\u003c0.000011\u003e\"\n      }), \"â€ã€‚\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-text\",\n        children: \"mmap2(0xb76d1000, 10780, PROT_READ|PROT_WRITE, ...) = 0xb76d1000 \u003c0.000011\u003e\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è§£ææœ‰å¾ˆå¤šç§åŠæ³•ï¼Œæœ€æ–¹ä¾¿çš„å½“ç„¶æ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼å•¦ï¼æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¯•è¯• \", _jsx(_components.code, {\n        children: \"regex.h\"\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsxs(Box, {\n      logo: \"â˜•ï¸\",\n      title: \"å†™å‡ºæ­£ç¡®çš„ sperf\",\n      children: [_jsxs(_components.p, {\n        children: [\"å¦‚æœä½ æƒ³å¾—å¤šä¸€äº›ï¼Œå¯èƒ½ä¼šå‘ç°ä¸€äº›é¢å¤–çš„éº»çƒ¦ã€‚ä¾‹å¦‚ï¼Œstrace é»˜è®¤ä¼šæŠŠ trace è¾“å‡ºåˆ° stderrï¼Œè¿™ä¸ªè¡Œä¸ºæ²¡å•¥é—®é¢˜ã€‚ä½†å¦‚æœ strace è¿½è¸ªçš„ç¨‹åºä¹Ÿè¾“å‡ºåˆ° stderrï¼Œä¸å°± â€œç ´åâ€ äº† strace çš„è¾“å‡ºäº†å—ã€‚è€Œä¸”ï¼Œå³ä¾¿è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ (æ¯”å¦‚æŠŠç¨‹åºçš„ stderr é‡å®šå‘åˆ° \", _jsx(_components.code, {\n          children: \"/dev/null\"\n        }), \" ä¸¢å¼ƒ)ï¼Œç¨‹åºè¾“å‡ºçš„å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½å¯¹ parsing å¸¦æ¥ä¸å¥½çš„å½±å“ï¼š\"]\n      }), _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-text\",\n          children: \"$ strace -T echo -n '\\\", 1) = 100 \u003c99999.9\u003e' \u003e /dev/null\\nioctl(1, TCGETS, 0x7fff80723570)        = -1 ENOTTY \u003c0.000100\u003e\\nwrite(1, \\\"\\\\\\\", 1) = 100 \u003c99999.9\u003e\\\", 21)  = 21 \u003c0.000149\u003e\\nclose(1)                                = 0 \u003c0.000126\u003e\\n\"\n        })\n      }), _jsxs(_components.p, {\n        children: [\"æ˜¯çš„ï¼Œä¸€ä¸ªç³»ç»Ÿå·¥å…·éœ€è¦åœ¨\", _jsx(_components.strong, {\n          children: \"ä»»ä½•æ—¶å€™\"\n        }), \"éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚ä¸Šé¢çš„ä¾‹å­æœ‰ç‚¹ â€œæ•…æ„è€èµ–â€ï¼Œä½†å¦‚æœä½ åªè¯•å›¾åŒ¹é… \", _jsx(_components.code, {\n          children: \"\u003c\u003e\"\n        }), \" ä¸­çš„æ•°å­—ï¼Œå°±çš„ç¡®ä¼šåœ¨ä¸€äº›åœºæ™¯ä¸‹äº§ç”Ÿé”™è¯¯ã€‚è™½ç„¶æˆ‘ä»¬å¹¶ä¸ä¼šæƒ³å°½ä¸€åˆ‡åŠæ³•æ„é€ æç«¯çš„æµ‹è¯•ç”¨ä¾‹æ¥å¯¹ä»˜å¤§å®¶ï¼Œä½†å¤§å®¶ä¸å¦¨å¯ä»¥æ·±å…¥æ€è€ƒä¸€ä¸‹ â€œæ€ä¹ˆæŠŠç¨‹åºå†™å¯¹â€ è¿™ä¸ªé—®é¢˜ã€‚\"]\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"frontmatter":{"title":"M5: ç³»ç»Ÿè°ƒç”¨ Profiler (sperf)"}},"__N_SSG":true},"page":"/[[...index]]","query":{"index":["OS","2024","labs","M5.md"]},"buildId":"a2FwJzUPGFGc0QcwaUr13","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>