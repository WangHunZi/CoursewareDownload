<!DOCTYPE html><html>
<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Yanyan's Wiki</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/><link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"/><meta name="next-head-count" content="5"/><link rel="preload" href="../../_next/static/css/e993edd6a18ef4f0.css" as="style"/><link rel="stylesheet" href="../../_next/static/css/e993edd6a18ef4f0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../../_next/static/chunks/webpack-f73d82589f972e7d.js" defer=""></script><script src="../../_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="../../_next/static/chunks/main-3929bf55b0f13a18.js" defer=""></script><script src="../../_next/static/chunks/pages/_app-00b06920b385caf1.js" defer=""></script><script src="../../_next/static/chunks/pages/%5b%5b...index%5d%5d-877ec949b69be209.js" defer=""></script><script src="../../_next/static/a2FwJzUPGFGc0QcwaUr13/_buildManifest.js" defer=""></script><script src="../../_next/static/a2FwJzUPGFGc0QcwaUr13/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-slate-300/10"><div class="sticky top-0 z-40 w-full backdrop-blur flex-none border-b border-slate-900/10 bg-white/75 supports-backdrop-blur:bg-white/60"><div class="max-w-8xl mx-auto"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="relative flex items-center"><a href="../../index.html">Yanyan's wiki</a><form class="text-xs text-slate-500"> for <input type="text" name="token" class="font-mono text-xs w-16" maxLength="8"/></form><div class="relative hidden lg:flex items-center ml-4 pl-4 border-l"><nav class="text-sm leading-6 font-semibold text-slate-700 dark:text-slate-200"><ul class="flex space-x-8"><li><a class="hover:text-sky-500 dark:hover:text-sky-400" href="../2025/index.html">操作系统 (2025 春)</a></li></ul></nav></div></div></div></div></div><div class="container mx-auto max-w-5xl flex flex-col min-h-screen px-4"><div class="wiki bg-neutral-200/10"><h1>4. 数学视角的操作系统</h1>
<p><strong>背景回顾</strong>：在理解了 “软件 (应用)” 和 “硬件 (计算机)” 之后，操作系统就是直接运行在计算机硬件上的程序，它提供了应用程序执行的支撑和一组 API (系统调用)：操作系统内核被加载后，拥有完整计算机的控制权限，包括中断和 I/O 设备，因此可以构造出多个应用程序同时执行的 “假象”。</p>
<p><strong>本讲内容</strong>：一个 Python “操作系统玩具” 的设计与实现，帮助大家在更高的 “抽象层次” 上理解操作系统的行为。这个 “玩具” 将贯穿整个课程。</p>
<h2>4.1 程序正确性证明</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/4.1.html"></iframe></div></div></div>
<p>没错，计算机科学和数学的发展速度可能超过大家的想象——我们有被 “证明正确” 的 <a href="https://compcert.org/">编译器</a>、<a href="https://sel4.systems/">操作系统内核</a>；大家也可以阅读<a href="https://cacm.acm.org/news/formal-software-verification-measures-up/">科普文章</a>：</p>
<blockquote>
<p>Formal verification doesn’t result in perfect code; it simply narrows the possibility for errors and vulnerabilities to creep in,” Parno says. “What makes the technique so attractive is that you push the uncertainty or scope of problems down to smaller and smaller windows.</p>
</blockquote>
<p>同时，proof assistant 也是人工智能时代堪称完美的辅助工具：如果我们要信任 AI 产生的结果，就让它们给出一个 proof assistant 认可的证明吧！</p>
<h2>4.2 为操作系统建模</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/4.2.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<h2>4.3 数学视角的操作系统 🌶️</h2>
<div class="mx-20"><div class="text-center"><div class="slideshow w-full aspect-[4/3]"><iframe class="w-full h-full" src="slides/4.3.html"></iframe></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2"><button class="hover:bg-blue-300 text-white font-bold px-2 rounded"><img class="w-10" src="../img/vscode.svg"/></button></span><span class="font-serif text-lg border-b border-slate-600"><b></b></span><div class="font-serif pt-2"><div></div></div></div></div>
<p>下面是我们绘制一个 “Hello World” 状态空间的例子。Hello 会调用一个有趣的系统调用 fork，它的行为是复制状态机的当前状态：</p>
<iframe src="hello.html" height="420" width="100%"></iframe>
<p>我们将会在这个学期的时间里，仔细分析模型和真实操作系统 (Linux) 系统调用的行为，并用它们实现很多有趣的程序。</p>
<h2>Take-away Messages</h2>
<p>程序就是状态机；状态机可以用程序表示。因此：</p>
<ul>
<li>我们可以用更 “简单” 的方式 (例如 Python) 描述状态机、建模操作系统上的应用，并且实现操作系统的可执行模型。</li>
<li>一旦把操作系统、应用程序当做 “数学对象” 处理，那么我们图论、数理逻辑中的工具就能被应用于处理程序——例如，可以用图遍历 “暴力枚举” 的方法证明程序的正确性。</li>
</ul>
<h3>课后习题/编程作业</h3>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">🖥️</span><span class="font-serif text-lg border-b border-slate-600"><b>编程</b></span><div class="font-serif pt-2"><p>阅读 30 行简易操作系统模型的代码。你可以试着调试它，观察 generator 是如何实现状态机的切换的。作为类比，在现代分时操作系统中，状态机的隔离 (通过虚拟存储系统) 和切换是一项基础性的基础，也是操作系统最有趣的一小部分代码：在中断或是 trap 指令后，通常由一段汇编代码将当前状态机 (执行流) 的寄存器保存到内存中，完成状态的 “封存”。如果你感到 Mosaic 比较困难，完全可以忽略它 (或者，可以等课程结束后回来)。</p></div></div></div>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">🖥️</span><span class="font-serif text-lg border-b border-slate-600"><b>编程</b></span><div class="font-serif pt-2"><p>开始课程实验：课程实验在在课程网站上发布。实验有一定难度，同时也有实验指导，请大家仔细阅读。</p></div></div></div></div></div><div class="bg-neutral-100 text-center text-neutral-600 dark:bg-neutral-600 dark:text-neutral-200 lg:text-left"><div class="bg-neutral-200 p-6 text-center dark:bg-neutral-700"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons License: BY-NC 4.0</a><br/><a href="https://beian.miit.gov.cn/">苏 ICP 备 2020049101 号</a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    strong: \"strong\",\n    h2: \"h2\",\n    a: \"a\",\n    blockquote: \"blockquote\",\n    ul: \"ul\",\n    li: \"li\",\n    h3: \"h3\"\n  }, _provideComponents(), props.components), {Slideshow, Demo, Box} = _components;\n  if (!Box) _missingMdxReference(\"Box\", true);\n  if (!Demo) _missingMdxReference(\"Demo\", true);\n  if (!Slideshow) _missingMdxReference(\"Slideshow\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"4. 数学视角的操作系统\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"背景回顾\"\n      }), \"：在理解了 “软件 (应用)” 和 “硬件 (计算机)” 之后，操作系统就是直接运行在计算机硬件上的程序，它提供了应用程序执行的支撑和一组 API (系统调用)：操作系统内核被加载后，拥有完整计算机的控制权限，包括中断和 I/O 设备，因此可以构造出多个应用程序同时执行的 “假象”。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"本讲内容\"\n      }), \"：一个 Python “操作系统玩具” 的设计与实现，帮助大家在更高的 “抽象层次” 上理解操作系统的行为。这个 “玩具” 将贯穿整个课程。\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"4.1 程序正确性证明\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/4.1.html\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"没错，计算机科学和数学的发展速度可能超过大家的想象——我们有被 “证明正确” 的 \", _jsx(_components.a, {\n        href: \"https://compcert.org/\",\n        children: \"编译器\"\n      }), \"、\", _jsx(_components.a, {\n        href: \"https://sel4.systems/\",\n        children: \"操作系统内核\"\n      }), \"；大家也可以阅读\", _jsx(_components.a, {\n        href: \"https://cacm.acm.org/news/formal-software-verification-measures-up/\",\n        children: \"科普文章\"\n      }), \"：\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"Formal verification doesn’t result in perfect code; it simply narrows the possibility for errors and vulnerabilities to creep in,” Parno says. “What makes the technique so attractive is that you push the uncertainty or scope of problems down to smaller and smaller windows.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"同时，proof assistant 也是人工智能时代堪称完美的辅助工具：如果我们要信任 AI 产生的结果，就让它们给出一个 proof assistant 认可的证明吧！\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"4.2 为操作系统建模\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/4.2.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"intro/os-model\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"4.3 数学视角的操作系统 🌶️\"\n    }), \"\\n\", _jsx(Slideshow, {\n      url: \"slides/4.3.html\"\n    }), \"\\n\", _jsx(Demo, {\n      path: \"mosaic/mosaic\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"下面是我们绘制一个 “Hello World” 状态空间的例子。Hello 会调用一个有趣的系统调用 fork，它的行为是复制状态机的当前状态：\"\n    }), \"\\n\", _jsx(\"iframe\", {\n      src: \"hello.html\",\n      height: \"420\",\n      width: \"100%\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"我们将会在这个学期的时间里，仔细分析模型和真实操作系统 (Linux) 系统调用的行为，并用它们实现很多有趣的程序。\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Take-away Messages\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"程序就是状态机；状态机可以用程序表示。因此：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"我们可以用更 “简单” 的方式 (例如 Python) 描述状态机、建模操作系统上的应用，并且实现操作系统的可执行模型。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"一旦把操作系统、应用程序当做 “数学对象” 处理，那么我们图论、数理逻辑中的工具就能被应用于处理程序——例如，可以用图遍历 “暴力枚举” 的方法证明程序的正确性。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"课后习题/编程作业\"\n    }), \"\\n\", _jsx(Box, {\n      logo: \"🖥️\",\n      title: \"编程\",\n      children: _jsx(_components.p, {\n        children: \"阅读 30 行简易操作系统模型的代码。你可以试着调试它，观察 generator 是如何实现状态机的切换的。作为类比，在现代分时操作系统中，状态机的隔离 (通过虚拟存储系统) 和切换是一项基础性的基础，也是操作系统最有趣的一小部分代码：在中断或是 trap 指令后，通常由一段汇编代码将当前状态机 (执行流) 的寄存器保存到内存中，完成状态的 “封存”。如果你感到 Mosaic 比较困难，完全可以忽略它 (或者，可以等课程结束后回来)。\"\n      })\n    }), \"\\n\", _jsx(Box, {\n      logo: \"🖥️\",\n      title: \"编程\",\n      children: _jsx(_components.p, {\n        children: \"开始课程实验：课程实验在在课程网站上发布。实验有一定难度，同时也有实验指导，请大家仔细阅读。\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"frontmatter":{}},"__N_SSG":true},"page":"/[[...index]]","query":{"index":["OS","2024","lect4.md"]},"buildId":"a2FwJzUPGFGc0QcwaUr13","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body>
</html>