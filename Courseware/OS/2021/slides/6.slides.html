<!DOCTYPE html><html class="h-100">


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com/"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // â€¢ auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // â€¢ rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="../../../static/reveal/reveal.css">
<link rel="stylesheet" href="../../../static/reveal/theme/simple.css" id="theme">

<style>
.reveal .slide-number {
  font-size: 26px;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, .3);
}

.reveal .full-screen {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.reveal .slides {
  border: 1.5px #ddd solid;
  border-radius: 7px;
  text-align: left;
  font-weight: 300;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4 {
  font-family: 'Lato', 'SimHei', 'STXihei', 'Droid Sans';
  font-weight: 400;
}

.reveal p, .reveal li, .reveal center {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Droid Sans';
}

.reveal li + li {
  margin-top: 10px;
}

.reveal ul {
  display: block;
  margin-right: 15px;
}

.reveal p, .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
  padding:  0 25px 0 25px;
}

.reveal table {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Sans Serif';
  margin-top: 15px;
  margin-bottom: 15px;
}

.reveal th {
  background-color: #eee;
}

.reveal tr:nth-child(even) {
  background-color: #efffff;
}

.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  text-align: left;
  margin: 0 0 20px 0;
 color: #222; 
  font-weight: 400;
  line-height: 1.2;
  letter-spacing: normal;
}



.reveal h1 {
  margin: 0 10 0 10;
  font-size: 60px;
}
.reveal .middle h1 {
  text-align: center;
}

.reveal h2 {
  font-size: 48px;
  border-bottom: 2px solid rgb(106, 0, 95);
  padding-bottom: 5px;
}
.reveal h3 { font-size: 1.15em; }
.reveal h4 { font-size: 1.05em; }

.reveal .center {
  text-align: center;
}

.reveal .middle {
  height: 728px;
  display: flex;
  align-items: center;
  width: 100%;
}

.reveal pre {
  font-size: 28px;
 
  background-color: #eee;

  border-radius: 3mm;
  padding: 10px 10px 10px 10px;
}

.reveal pre code {
  max-height: none;
}

.reveal code {
  font-family: 'Inconsolata', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif', Monospace;
}

.reveal .middle blockquote {
  text-align: center;
  color: rgb(106, 0, 95);
  background: none;
  box-shadow: none;
}

.reveal .middle blockquote a {
  color: inherit;
}

.reveal blockquote p, .reveal blockquote li {
  font-family: 'Lato', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif';
}

section .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.reveal .author-block {
  margin: 75px 0 35px 0;
}
.reveal .author-affiliation img {
  margin: 15px 0 0 0;
}
.reveal .author-block p, .reveal .author-affiliation p  {
  font-family: 'Kaiti', 'STKaiti', 'Serif', 'Times', 'Times New Roman';
  margin-block-start: 0em;
  margin-block-end: 0em;
}
.reveal .author-affiliation {
  display: inline-block;
  font-size: 90%;
}
.reveal hr {
  border: 10px solid rgba(0, 0, 0, 0);
}
.reveal li {
  margin-top: 10px;
}
</style>

  <title>å¹¶å‘æ§åˆ¶ï¼šåŒæ­¥</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div class="reveal">
<div class="slides">
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">å¹¶å‘æ§åˆ¶ï¼šåŒæ­¥</h1>
<p class=" font-serif my-1"><include src="Slides_Author/index.html"><div><div class="py-16">
<p class=" font-serif my-1"><a href="http://ics.nju.edu.cn/~jyy" class=" text-amber-900">è’‹ç‚å²©</a></p>
</div>
<div class="row">
<div class="author-affiliation">
    <a href="http://www.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">ã€€ã€€å—äº¬å¤§å­¦ã€€ã€€</p>
    <img class="inline-img h-24" src="../../../static/img/nju-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
   <a href="http://cs.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</p>
    <img class="inline-img h-24" src="../../../static/img/njucs-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
    <a href="https://cs.nju.edu.cn/ics/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</p>
    <img class="inline-img h-24" src="../../../static/img/ics-logo.png" style="display: inline-block;"></a>
  </div>
</div></div></include></p></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">èƒŒæ™¯</h2>
<p class=" font-serif my-1">äº’æ–¥</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç”¨æˆ·ç¨‹åºçš„äº’æ–¥ (futex)</li>
<li class=" ml-8">æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„äº’æ–¥ (å…³ä¸­æ–­ + è‡ªæ—‹)<ul class=" list-disc font-serif">
<li class=" ml-8">åˆ©ç”¨è‡ªæ—‹é”ä¹Ÿå¯ä»¥å®ç°äº’æ–¥é”</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">å¹¶å‘æ•°æ®ç»“æ„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">é“¾è¡¨</li>
<li class=" ml-8">é˜Ÿåˆ—</li>
<li class=" ml-8">å¤åˆçš„æ•°æ®ç»“æ„ (malloc/free)</li>
</ul>
<hr>
<p class=" font-serif my-1"><del>æ˜¯æ—¶å€™é¢å¯¹çœŸæ­£çš„å¹¶å‘ç¼–ç¨‹äº†</del></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æœ¬æ¬¡è¯¾å†…å®¹ä¸ç›®æ ‡</h2>
<p class=" font-serif my-1">ç†è§£å…¸å‹çš„åŒæ­¥é—®é¢˜</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</li>
<li class=" ml-8">å“²å­¦å®¶åƒé¥­é—®é¢˜</li>
</ul>
<hr>
<p class=" font-serif my-1">ç†è§£å®ç°åŒæ­¥çš„æ–¹æ³•</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¿¡å·é‡</li>
<li class=" ml-8">æ¡ä»¶å˜é‡</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">ç¬¬ä¸€ä¸ªåŒæ­¥é—®é¢˜</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="-" class=" text-xl mt-2 pb-2 font-sans">ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">(ä½ ä»¬é‡åˆ°çš„) <red>90% çš„å®é™…å¹¶å‘é—®é¢˜éƒ½æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…</red>é—®é¢˜ã€‚å­¦ä¼šä½ ä»¬å°±èµ¢äº†ã€‚</p>
</blockquote>
<p class=" font-serif my-1">ç”Ÿäº§è€… (çº¿ç¨‹) ç”Ÿäº§èµ„æº (ä¸€ä¸ªå¯¹è±¡)ï¼Œç”Ÿäº§æ—¶é—´ä¸ç¡®å®š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç¼“å†²åŒºé‡Œæ²¡æœ‰ç©ºä½™çš„ç©ºé—´å­˜æ”¾ç”Ÿäº§çš„å¯¹è±¡æ—¶ç­‰å¾…</li>
</ul>
<hr>
<p class=" font-serif my-1">æ¶ˆè´¹è€… (çº¿ç¨‹) æ¶ˆè´¹èµ„æº (å–èµ°ä¸€ä¸ªå¯¹è±¡)ï¼Œæ¶ˆè´¹æ—¶é—´ä¹Ÿä¸ç¡®å®š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç¼“å†²åŒºé‡Œæ²¡æœ‰å¯¹è±¡å¯ä»¥æ¶ˆè´¹æ—¶ç­‰å¾…</li>
</ul>
<hr>
<p class=" font-serif my-1">å¦‚ä½•åè°ƒå®ƒä»¬çš„ç”Ÿäº§/æ¶ˆè´¹ï¼Ÿ</p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="-" class=" text-xl mt-2 pb-2 font-sans">äº’æ–¥/è‡ªæ—‹é”è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// é˜Ÿåˆ—ç©ºæ—¶ consumer åœ¨ spin!</span>
<span class="w">    </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">lk</span><span class="p">);</span>
<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_pop</span><span class="p">();</span>
<span class="w">    </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">lk</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">consume</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">succ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">succ</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// é˜Ÿåˆ—æ»¡æ—¶æ— æ³•æ”¾å…¥ï¼Œproducer åœ¨ spin!</span>
<span class="w">    </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">lk</span><span class="p">);</span>
<span class="w">    </span><span class="n">succ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_push</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="w">    </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">lk</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="-" class=" text-xl mt-2 pb-2 font-sans">ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼šåˆ†æ</h2>
<p class=" font-serif my-1">(æ›´ç²¾ç®€çš„è¡¨è¾¾) æœ‰ä¸¤ç§çº¿ç¨‹</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">"("</span><span class="p">);</span><span class="w"> </span><span class="c1">// push</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">")"</span><span class="p">);</span><span class="w"> </span><span class="c1">// pop</span>
<span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">åœ¨ä¸å—å¹¶å‘æ§åˆ¶çš„å‰æä¸‹ï¼Œä»»æ„çš„æ‹¬å·åºåˆ—éƒ½æ˜¯åˆæ³•çš„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼šæ‰“å°çš„æ‹¬å·åºåˆ—å¿…é¡»æ»¡è¶³<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸€å®šæ˜¯æŸä¸ªåˆæ³•æ‹¬å·åºåˆ—çš„å‰ç¼€</li>
<li class=" ml-8">æ‹¬å·åµŒå¥—çš„æ·±åº¦ä¸è¶…è¿‡ $n$<ul class=" list-disc font-serif">
<li class=" ml-8">$n=3$, <code>((())())(((</code> åˆæ³•</li>
<li class=" ml-8">$n=3$, <code>(((())))</code>, <code>(()))</code> ä¸åˆæ³•</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">åŒæ­¥</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="synchronization" class=" text-xl mt-2 pb-2 font-sans">åŒæ­¥ (Synchronization)</h2>
<p class=" font-serif my-1">ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šéšæ—¶é—´å˜åŒ–çš„é‡åœ¨å˜åŒ–è¿‡ç¨‹ä¸­ä¿æŒä¸€å®šçš„ç›¸å¯¹å…³ç³»</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">iTunesåŒæ­¥ (æ‰‹æœº vs ç”µè„‘)</li>
<li class=" ml-8">å˜é€Ÿç®±åŒæ­¥å™¨ (åˆå¹¶å¿«æ…¢é€Ÿé½¿è½®)</li>
<li class=" ml-8">åŒæ­¥ç”µæœº (è½¬å­ä¸ç£åœºé€Ÿåº¦ä¸€è‡´)</li>
<li class=" ml-8">åŒæ­¥ç”µè·¯ (ç”±æ—¶é’Ÿé©±åŠ¨ï¼Œä¸€ä¸ªå‘¨æœŸå†…å…¨éƒ¨å®Œæˆæ›´æ–°)</li>
</ul>
<hr>
<p class=" font-serif my-1">å¼‚æ­¥ (Asynchronous) = ä¸åŒæ­¥</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸Šè¿°å¾ˆå¤šä¾‹å­éƒ½æœ‰å¼‚æ­¥ç‰ˆæœ¬ (å¼‚æ­¥ç”µæœºã€å¼‚æ­¥ç”µè·¯ã€å¼‚æ­¥çº¿ç¨‹)</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å¹¶å‘ç¨‹åºä¸­çš„åŒæ­¥</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><red>åœ¨æŸä¸ªæ—¶é—´ç‚¹å…±åŒè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€</red>ã€‚</p>
<p class=" font-serif my-1">ç†è§£å¹¶å‘ç¨‹åºçš„æ–¹æ³•ï¼šæŠŠçº¿ç¨‹æƒ³è±¡æˆæˆ‘ä»¬è‡ªå·±ã€‚</p>
</blockquote>
<hr>
<p class=" font-serif my-1">æˆ‘ä»¬æœ¬èº«æ˜¯å¼‚æ­¥çš„æ‰§è¡Œæµï¼Œä½†éœ€è¦åœ¨æŸä¸ªç‚¹æ±‡åˆ <img alt="" class="float-right" src="../../../pages/OS/img/ge.jpg" width="190px"></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">NPYï¼šç­‰æˆ‘æ´—ä¸ªå¤´å°±å‡ºé—¨/ç­‰æˆ‘æ‰“å®Œè¿™å±€æ¸¸æˆå°±æ¥</li>
<li class=" ml-8">èˆå‹ï¼šç­‰æˆ‘å†™å®Œè¿™æ®µä»£ç å°±åƒé¥­</li>
<li class=" ml-8">å¯¼å¸ˆï¼šç­‰æˆ‘å‡ºå·®å›æ¥å°±è®¨è®ºè¿™ä¸ªè¯¾é¢˜</li>
<li class=" ml-8">ç”Ÿäº§è€…ï¼šç­‰ä½  (æ¶ˆè´¹è€…) ç©ºå‡ºé˜Ÿåˆ—æˆ‘å†ç»§ç»­</li>
<li class=" ml-8">æ¶ˆè´¹è€…ï¼šç­‰ä½  (ç”Ÿäº§è€…) æ”¾å…¥é˜Ÿåˆ—æˆ‘å†ç»§ç»­</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ¡ä»¶å˜é‡ï¼šä¸€ç§ä¸‡èƒ½çš„åŒæ­¥æ–¹æ³•</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="conditional-variables-cv" class=" text-xl mt-2 pb-2 font-sans">Conditional Variables (æ¡ä»¶å˜é‡, CV)</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><red>ä»»ä½•åŒæ­¥éƒ½æœ‰æ±‡åˆçš„ â€œæ¡ä»¶â€</red>ã€‚</p>
</blockquote>
<p class=" font-serif my-1">çº¿ç¨‹ join (<a href="../../../pages/OS/2021/demos/threads.h" class=" text-amber-900">threads.h</a>, <a href="../../../pages/OS/2021/demos/sum.c" class=" text-amber-900">sum.c</a>)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸåç»§ç»­æ‰§è¡Œ <code>exit</code>ï¼Œå¦åˆ™ç­‰å¾…</li>
</ul>
<hr>
<p class=" font-serif my-1">NPY çš„ä¾‹å­</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ‰“å®Œæ¸¸æˆä¸”æ´—å®Œå¤´åç»§ç»­æ‰§è¡Œ <code>date()</code>ï¼Œå¦åˆ™ç­‰å¾…</li>
</ul>
<hr>
<p class=" font-serif my-1">ç”Ÿäº§è€…/æ¶ˆè´¹è€…é—®é¢˜ (æ‹¬å·ç‰ˆæœ¬)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å·¦æ‹¬å·ï¼šæ·±åº¦ $k < n$ æ—¶ <code>printf</code>ï¼Œå¦åˆ™ç­‰å¾…</li>
<li class=" ml-8">å³æ‹¬å·ï¼š$k > 0$ æ—¶ <code>printf</code>ï¼Œå¦åˆ™ç­‰å¾…</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="conditional-variables" class=" text-xl mt-2 pb-2 font-sans">Conditional Variables: ç¡çœ å’Œå”¤é†’</h2>
<p class=" font-serif my-1">å¯¹äºä¸€ä¸ª â€œæ¡ä»¶å˜é‡â€ cv ä»£è¡¨äº†ä¸€ä¸ªåŒæ­¥æ¡ä»¶</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">wait(cv) ğŸ’¤<ul class=" list-disc font-serif">
<li class=" ml-8">è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾… cv ä¸Šçš„äº‹ä»¶å‘ç”Ÿ</li>
</ul>
</li>
<li class=" ml-8">signal/notify(cv) ğŸ’¬ ç§ä¿¡ï¼šèµ°èµ·<ul class=" list-disc font-serif">
<li class=" ml-8">æŠ¥å‘Š cv ä¸Šçš„äº‹ä»¶å‘ç”Ÿ</li>
<li class=" ml-8">å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾… cvï¼Œåˆ™å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹</li>
</ul>
</li>
<li class=" ml-8">broadcast/notifyAll(cv) ğŸ“£ æ‰€æœ‰äººï¼šèµ°èµ·<ul class=" list-disc font-serif">
<li class=" ml-8">æŠ¥å‘Š cv ä¸Šçš„äº‹ä»¶å‘ç”Ÿ</li>
<li class=" ml-8">å”¤é†’å…¨éƒ¨æ­£åœ¨ç­‰å¾… cv çš„çº¿ç¨‹</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ¡ä»¶å˜é‡ï¼šä¸‡èƒ½çš„åŒæ­¥æ–¹æ³•</h2>
<p class=" font-serif my-1">pthread æ¡ä»¶å˜é‡ï¼šå’Œäº’æ–¥é”è”åˆä½¿ç”¨</p>
<hr>
<p class=" font-serif my-1">éœ€è¦<red>ç­‰å¾…æ¡ä»¶æ»¡è¶³æ—¶</red></p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">wait</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">,</span><span class="w"> </span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">assert</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span><span class="w"> </span><span class="c1">// äº’æ–¥é”å¿…é¡»ä¿è¯é€€å‡ºå¾ªç¯æ—¶ cond ä¾ç„¶æˆç«‹</span>
<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
</code></pre></div>

<hr>
<p class=" font-serif my-1"><red>å…¶ä»–çº¿ç¨‹æ¡ä»¶å¯èƒ½è¢«æ»¡è¶³æ—¶</red></p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="n">broadcast</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">);</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="-" class=" text-xl mt-2 pb-2 font-sans">æ¡ä»¶å˜é‡ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o"><</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">,</span><span class="w"> </span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"("</span><span class="p">);</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">broadcast</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">></span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">,</span><span class="w"> </span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">")"</span><span class="p">);</span><span class="w"> </span><span class="n">count</span><span class="o">--</span><span class="p">;</span>
<span class="w">  </span><span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">broadcast</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">mutex å¤§å¹…ç®€åŒ–äº†æ­£ç¡®æ€§çš„è¯æ˜</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸è¦è‡ªä½œä¸»å¼ ä½¿ç”¨å…¶ä»–å†™æ³• (å‚è€ƒ OSTEP)</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ¡ä»¶å˜é‡ï¼šå°ä¹ é¢˜</h2>
<p class=" font-serif my-1">æœ‰ä¸‰ç§çº¿ç¨‹ï¼Œåˆ†åˆ«æ‰“å° <code><</code>, <code>></code>, å’Œ <code>_</code></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å¯¹è¿™äº›çº¿ç¨‹è¿›è¡ŒåŒæ­¥ï¼Œä½¿å¾—æ‰“å°å‡ºçš„åºåˆ—æ€»æ˜¯ <code><><_</code> å’Œ <code>><>_</code> ç»„åˆ</li>
</ul>
<hr>
<p class=" font-serif my-1">ä½¿ç”¨æ¡ä»¶å˜é‡ï¼Œåªè¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ‰“å° â€œ<code><</code>â€ çš„æ¡ä»¶ï¼Ÿ</li>
<li class=" ml-8">æ‰“å° â€œ<code>></code>â€ çš„æ¡ä»¶ï¼Ÿ</li>
<li class=" ml-8">æ‰“å° â€œ<code>_</code>â€ çš„æ¡ä»¶ï¼Ÿ<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="../../../pages/OS/2021/demos/fish.c" class=" text-amber-900">fish.c</a></li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">ä¿¡å·é‡</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="mutexlock-futex" class=" text-xl mt-2 pb-2 font-sans">å¤ä¹ ï¼šMutexLock (futex) å’Œæ›´è¡£å®¤ç®¡ç†</h2>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/OS/img/locker.jpg" width="300px"></p>
<p class=" font-serif my-1">ç®¡ç†å‘˜ (æ“ä½œç³»ç»Ÿä»£ç ) æœ‰ä¸€ä¸ªæ‰‹ç¯</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>ç®¡ç†å‘˜ç”¨è‡ªæ—‹é”ä¿æŠ¤åŸå­æ€§ã€æ¶ˆé™¤æ•°æ®ç«äº‰</red></li>
</ul>
<hr>
<p class=" font-serif my-1">ä»»ä½•äººæƒ³è¿›å…¥æ›´è¡£å®¤éƒ½éœ€è¦é€šè¿‡ç®¡ç†å‘˜</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å…ˆåˆ°çš„äºº (çº¿ç¨‹)<ul class=" list-disc font-serif">
<li class=" ml-8">æˆåŠŸè·å¾—æ‰‹ç¯ â†’ è¿›å…¥æ¸¸æ³³é¦† (çº¿ç¨‹å¯è¢«è°ƒåº¦æ‰§è¡Œ)</li>
</ul>
</li>
<li class=" ml-8">ååˆ°çš„äºº (çº¿ç¨‹)<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸èƒ½è¿›å…¥æ¸¸æ³³é¦†ï¼Œæ’é˜Ÿç­‰å¾… (çº¿ç¨‹è¿›å…¥é˜Ÿåˆ—ï¼Œä¸è¢«è°ƒåº¦æ‰§è¡Œ)</li>
</ul>
</li>
<li class=" ml-8">æ´—å®Œæ¾¡å‡ºæ¥çš„äºº (çº¿ç¨‹)<ul class=" list-disc font-serif">
<li class=" ml-8">äº¤è¿˜æ‰‹ç¯ç»™ç®¡ç†å‘˜ â†’ ç®¡ç†å‘˜äº¤ç»™æ’é˜Ÿçš„äººè¿›å…¥æ¸¸æ³³é¦† (ç­‰å¾…çš„çº¿ç¨‹è¢«å”¤é†’)</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ›´è¡£å®¤ç®¡ç†</h2>
<p class=" font-serif my-1">å®Œå…¨æ²¡æœ‰å¿…è¦é™åˆ¶æ‰‹ç¯çš„æ•°é‡â€”â€”è®©æ›´å¤šåŒå­¦å¯ä»¥è¿›å…¥æ›´è¡£å®¤</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç®¡ç†å‘˜å¯ä»¥æŒæœ‰ä»»æ„æ•°é‡çš„æ‰‹ç¯ (æ›´è¡£å®¤å®¹é‡ä¸Šé™)<ul class=" list-disc font-serif">
<li class=" ml-8">å…ˆè¿›å…¥æ›´è¡£å®¤çš„åŒå­¦å…ˆå¾—åˆ°</li>
<li class=" ml-8">æ‰‹ç¯ç”¨å®Œååˆ™éœ€è¦ç­‰åŒå­¦å‡ºæ¥</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"></p><center><img alt="" height="200px" src="../../../pages/OS/img/locker.jpg"> v.s. <img alt="" height="200px" src="../../../pages/OS/img/pool-2.jpg"></center></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="contd" class=" text-xl mt-2 pb-2 font-sans">æ›´è¡£å®¤ç®¡ç† (cont'd)</h2>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/OS/img/doraemon.gif" width="300px"></p>
<p class=" font-serif my-1">åšä¸€ç‚¹æ‰©å±•â€”â€”çº¿ç¨‹å¯ä»¥ä»»æ„ â€œå˜å‡ºâ€ ä¸€ä¸ªæ‰‹ç¯</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æŠŠæ‰‹ç¯çœ‹æˆæ˜¯ä»¤ç‰Œ</li>
<li class=" ml-8">å¾—åˆ°ä»¤ç‰Œçš„å¯ä»¥è¿›å…¥æ‰§è¡Œ</li>
<li class=" ml-8">å¯ä»¥éšæ—¶åˆ›å»ºä»¤ç‰Œ</li>
</ul>
<hr>
<p class=" font-serif my-1">â€œæ‰‹ç¯â€ = â€œä»¤ç‰Œâ€ = â€œä¸€ä¸ªèµ„æºâ€ = â€œä¿¡å·é‡â€ (semaphore)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">P(&sem) - prolaag = try + decrease; wait; down; in<ul class=" list-disc font-serif">
<li class=" ml-8">ç­‰å¾…ä¸€ä¸ªæ‰‹ç¯åè¿”å›</li>
<li class=" ml-8">å¦‚æœæ­¤æ—¶ç®¡ç†å‘˜æ‰‹ä¸Šæœ‰ç©ºé—²çš„æ‰‹ç¯ï¼Œç«‹å³è¿”å›</li>
</ul>
</li>
<li class=" ml-8">V(&sem) - verhoog = increase; post; up; out<ul class=" list-disc font-serif">
<li class=" ml-8">å˜å‡ºä¸€ä¸ªæ‰‹ç¯ï¼Œé€ç»™ç®¡ç†å‘˜</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="e-w-dijkstra" class=" text-xl mt-2 pb-2 font-sans">ä¿¡å·é‡ (E. W. Dijkstra)</h2>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/OS/img/semaphore-small.jpg" width="500px"></p>
<p class=" font-serif my-1">ä¿¡å·é‡ = äº’æ–¥é” + æ¡ä»¶å˜é‡</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">äº’æ–¥é”<ul class=" list-disc font-serif">
<li class=" ml-8">ä»…æœ‰ä¸€ä¸ªæ‰‹ç¯çš„æƒ…å†µ</li>
<li class=" ml-8">P = lock; V = unlock</li>
</ul>
</li>
<li class=" ml-8">æ¡ä»¶å˜é‡<ul class=" list-disc font-serif">
<li class=" ml-8">æ‰‹ç¯ = ç­‰å¾…æ¡ä»¶</li>
<li class=" ml-8">P = wait; V = signal<ul class=" list-disc font-serif">
<li class=" ml-8">å› ä¸ºè®¡æ•°å™¨çš„å­˜åœ¨ï¼Œä¸ä¼šå‘ç”Ÿ signal â€œä¸¢å¤±â€</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="-" class=" text-xl mt-2 pb-2 font-sans">ä¿¡å·é‡ï¼šå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…</h2>
<p class=" font-serif my-1">ä¿¡å·é‡è®¾è®¡çš„é‡ç‚¹</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">è€ƒè™‘ â€œæ‰‹ç¯â€ (æ¯ä¸€å•ä½çš„ â€œ<red>èµ„æº</red>â€) æ˜¯ä»€ä¹ˆï¼Œè°åˆ›é€ ï¼Ÿè°è·å–ï¼Ÿ<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="../../../pages/OS/2021/demos/producer-consumer.c" class=" text-amber-900"><code>producer-consumer.c</code></a></li>
</ul>
</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">P</span><span class="p">(</span><span class="o">&</span><span class="n">empty</span><span class="p">);</span><span class="w">   </span><span class="c1">// P()è¿”å› -> å¾—åˆ°æ‰‹ç¯</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"("</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‡è®¾çº¿ç¨‹å®‰å…¨</span>
<span class="w">  </span><span class="n">V</span><span class="p">(</span><span class="o">&</span><span class="n">fill</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">P</span><span class="p">(</span><span class="o">&</span><span class="n">fill</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">")"</span><span class="p">);</span>
<span class="w">  </span><span class="n">V</span><span class="p">(</span><span class="o">&</span><span class="n">empty</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸è¦è¢«è¿™ç§ç®€å•çš„å‡è±¡éª—äº†ï¼ä¿¡å·é‡å¥½ç”¨ï¼Œä½†æ²¡æœ‰é‚£ä¹ˆå¥½ç”¨ï¼ï¼</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">å“²å­¦å®¶åƒé¥­é—®é¢˜</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="e-w-dijkstra-1960" class=" text-xl mt-2 pb-2 font-sans">å“²å­¦å®¶åƒé¥­é—®é¢˜ (E. W. Dijkstra, 1960)</h2>
<p class=" font-serif my-1">å“²å­¦å®¶ (çº¿ç¨‹) æœ‰æ—¶æ€è€ƒï¼Œæœ‰æ—¶åƒé¥­</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åƒé¥­éœ€è¦åŒæ—¶å¾—åˆ°å·¦æ‰‹å’Œå³æ‰‹çš„å‰å­</li>
<li class=" ml-8">å½“å‰å­è¢«å…¶ä»–äººå æœ‰æ—¶ï¼Œå¿…é¡»ç­‰å¾…ï¼Œå¦‚ä½•å®ŒæˆåŒæ­¥ï¼Ÿ<ul class=" list-disc font-serif">
<li class=" ml-8">å¦‚ä½•ç”¨ä¿¡å·é‡å®ç°ï¼Ÿ</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/dining-philosophers.jpg" width="400px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å¿˜äº†ä¿¡å·é‡ï¼Œè®©æˆ‘ä»¬æ¥è€èµ–å§ï¼</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher_thread</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">lhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">has_fork</span><span class="p">[</span><span class="n">lhs</span><span class="p">]</span><span class="w"> </span><span class="o">&&</span><span class="w"> </span><span class="n">has_fork</span><span class="p">[</span><span class="n">rhs</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">,</span><span class="w"> </span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="c1">// å‡ºå¾ªç¯æ—¶ï¼Œå¾ªç¯æ¡ä»¶ä¸€å®šä¸ºå‡</span>
<span class="w">  </span><span class="n">has_fork</span><span class="p">[</span><span class="n">lhs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">has_fork</span><span class="p">[</span><span class="n">rhs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>

<span class="w">  </span><span class="n">philosopher_eat</span><span class="p">();</span>

<span class="w">  </span><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">has_fork</span><span class="p">[</span><span class="n">lhs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">has_fork</span><span class="p">[</span><span class="n">rhs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="n">broadcast</span><span class="p">(</span><span class="o">&</span><span class="n">cv</span><span class="p">);</span><span class="w"> </span><span class="c1">// å¯¹æ‰€æœ‰ç­‰å¾…çš„äººå–Šï¼šå‰å­æ”¾å›å»å•¦ï¼Œå¿«çœ‹çœ‹å§ï¼</span>
<span class="w">  </span><span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">mutex</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å¿˜äº†ä¿¡å·é‡ï¼Œè®©ä¸€ä¸ªäººé›†ä¸­ç®¡ç†å‰å­å§ï¼</h2>
<p class=" font-serif my-1">â€œMaster/Slaveâ€</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éå¸¸å¸¸è§çš„è§£å†³æ€è·¯ (HDFS, ...)</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher_thread</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">send_request</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">EAT</span><span class="p">);</span>
<span class="w">  </span><span class="n">P</span><span class="p">(</span><span class="n">allowed</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w"> </span><span class="c1">// waiter ä¼šæŠŠå‰å­é€’ç»™å“²å­¦å®¶</span>
<span class="w">  </span><span class="n">philosopher_eat</span><span class="p">();</span>
<span class="w">  </span><span class="n">send_request</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">DONE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">waiter_thread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">receive_request</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EAT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DONE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å¿˜äº†é‚£äº›å¤æ‚çš„åŒæ­¥ç®—æ³•å§</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œç®¡å‰å­çš„äººæ˜¯æ€§èƒ½ç“¶é¢ˆ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸€å¤§æ¡Œäººåƒé¥­ï¼Œæ¯ä¸ªäººéƒ½å«æœåŠ¡å‘˜çš„æ„Ÿè§‰</li>
</ul>
</blockquote>
<hr>
<p class=" font-serif my-1"><red>æŠ›å¼€ workload è°ˆä¼˜åŒ–å°±æ˜¯è€æµæ°“</red></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">eat (å®é™…çš„ workload) æ—¶é—´å¯èƒ½è¿œå¤§äºè¯·æ±‚ (å‡ ä¸ªå†…å­˜æ“ä½œ) æ—¶é—´</li>
<li class=" ml-8">å¦‚æœä¸€ä¸ª manager æä¸å®šï¼Œå¯ä»¥åˆ†å¤šä¸ª<ul class=" list-disc font-serif">
<li class=" ml-8">æŠŠç³»ç»Ÿè®¾è®¡å¥½ï¼Œä½¿é›†ä¸­ç®¡ç†ä¸æˆä¸ºç“¶é¢ˆ<ul class=" list-disc font-serif">
<li class=" ml-8">M. Brooker, et al. <a href="https://www.usenix.org/conference/nsdi20/presentation/brooker" class=" text-amber-900">Millions of tiny databases</a>, In <em>Proc. of NSDI</em>, 2020.</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ€»ç»“</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ€»ç»“</h2>
<p class=" font-serif my-1">æœ¬æ¬¡è¯¾å†…å®¹ä¸ç›®æ ‡</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç†è§£åŒæ­¥ï¼šåœ¨æŸä¸ªæ—¶é—´ç‚¹è¾¾åˆ°äº’ç›¸è®¤åŒçš„çŠ¶æ€</li>
<li class=" ml-8">å®ç°åŒæ­¥ï¼šæ¡ä»¶å˜é‡ã€ä¿¡å·é‡</li>
</ul>
<hr>
<p class=" font-serif my-1">Take-away messages</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸¤ç§åŒæ­¥çš„ paradigms<ul class=" list-disc font-serif">
<li class=" ml-8">æ¡ä»¶å˜é‡ï¼šç­‰å¾…æ¡ä»¶è¾¾æˆï¼Œå¹¶ç”¨äº’æ–¥é”ä¿è¯æ¡ä»¶ä¸è¢«ç ´å</li>
<li class=" ml-8">ä¿¡å·é‡ï¼šç”¨ä»¤ç‰Œ (æ‰‹ç¯) ç®¡ç†å‡†è®¸æ‰§è¡Œçš„æƒé™ </li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
  
</div>
</div>

<script src="../../../static/reveal/reveal.js"></script>
<script>
  Reveal.initialize({
    
    width: 1024, height: 768,
    
    slideNumber: 'c/t',
    controlsTutorial: false,
    progress: false,
    hash: true,
    center: false,
    autoAnimateUnmatched: true,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.3,
    transitionSpeed: 'fast'
  });
</script>


</body>


</html>