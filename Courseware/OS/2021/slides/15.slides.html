<!DOCTYPE html><html class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // &#8226; auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // &#8226; rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="../../../static/reveal/reveal.css">
<link rel="stylesheet" href="../../../static/reveal/theme/simple.css" id="theme">

<style>
.reveal .slide-number {
  font-size: 26px;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, .3);
}

.reveal .full-screen {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.reveal .slides {
  border: 1.5px #ddd solid;
  border-radius: 7px;
  text-align: left;
  font-weight: 300;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4 {
  font-family: 'Lato', 'SimHei', 'STXihei', 'Droid Sans';
  font-weight: 400;
}

.reveal p, .reveal li, .reveal center {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Droid Sans';
}

.reveal li + li {
  margin-top: 10px;
}

.reveal ul {
  display: block;
  margin-right: 15px;
}

.reveal p, .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
  padding:  0 25px 0 25px;
}

.reveal table {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Sans Serif';
  margin-top: 15px;
  margin-bottom: 15px;
}

.reveal th {
  background-color: #eee;
}

.reveal tr:nth-child(even) {
  background-color: #efffff;
}

.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  text-align: left;
  margin: 0 0 20px 0;
 color: #222; 
  font-weight: 400;
  line-height: 1.2;
  letter-spacing: normal;
}



.reveal h1 {
  margin: 0 10 0 10;
  font-size: 60px;
}
.reveal .middle h1 {
  text-align: center;
}

.reveal h2 {
  font-size: 48px;
  border-bottom: 2px solid rgb(106, 0, 95);
  padding-bottom: 5px;
}
.reveal h3 { font-size: 1.15em; }
.reveal h4 { font-size: 1.05em; }

.reveal .center {
  text-align: center;
}

.reveal .middle {
  height: 728px;
  display: flex;
  align-items: center;
  width: 100%;
}

.reveal pre {
  font-size: 28px;
 
  background-color: #eee;

  border-radius: 3mm;
  padding: 10px 10px 10px 10px;
}

.reveal pre code {
  max-height: none;
}

.reveal code {
  font-family: 'Inconsolata', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif', Monospace;
}

.reveal .middle blockquote {
  text-align: center;
  color: rgb(106, 0, 95);
  background: none;
  box-shadow: none;
}

.reveal .middle blockquote a {
  color: inherit;
}

.reveal blockquote p, .reveal blockquote li {
  font-family: 'Lato', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif';
}

section .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.reveal .author-block {
  margin: 75px 0 35px 0;
}
.reveal .author-affiliation img {
  margin: 15px 0 0 0;
}
.reveal .author-block p, .reveal .author-affiliation p  {
  font-family: 'Kaiti', 'STKaiti', 'Serif', 'Times', 'Times New Roman';
  margin-block-start: 0em;
  margin-block-end: 0em;
}
.reveal .author-affiliation {
  display: inline-block;
  font-size: 90%;
}
.reveal hr {
  border: 10px solid rgba(0, 0, 0, 0);
}
.reveal li {
  margin-top: 10px;
}
</style>

  <title>&#25991;&#20214;&#31995;&#32479;&#23454;&#29616;</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div class="reveal">
<div class="slides">
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">&#25991;&#20214;&#31995;&#32479;&#23454;&#29616;</h1>
<p class=" font-serif my-1"><include src="Slides_Author"><div><div class="py-16">
<p class=" font-serif my-1"><a href="http://ics.nju.edu.cn/~jyy" class=" text-amber-900">&#33931;&#28814;&#23721;</a></p>
</div>
<div class="row">
<div class="author-affiliation">
    <a href="http://www.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">&#12288;&#12288;&#21335;&#20140;&#22823;&#23398;&#12288;&#12288;</p>
    <img class="inline-img h-24" src="../../../static/img/nju-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
   <a href="http://cs.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">&#35745;&#31639;&#26426;&#31185;&#23398;&#19982;&#25216;&#26415;&#31995;</p>
    <img class="inline-img h-24" src="../../../static/img/njucs-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
    <a href="https://cs.nju.edu.cn/ics/" class=" text-amber-900"><p class=" font-serif my-1">&#35745;&#31639;&#26426;&#36719;&#20214;&#30740;&#31350;&#25152;</p>
    <img class="inline-img h-24" src="../../../static/img/ics-logo.png" style="display: inline-block;"></a>
  </div>
</div></div></include></p></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#32972;&#26223;</h2>
<p class=" font-serif my-1">&#24212;&#29992;&#30524;&#20013;&#30340;&#25991;&#20214;&#31995;&#32479;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#19968;&#32452; API<ul class=" list-disc font-serif">
<li class=" ml-8">mount - &#25991;&#20214;&#31995;&#32479;&#31649;&#29702;gg</li>
<li class=" ml-8">mkdir, rmkdir, link, symlink, unlink... - &#30446;&#24405;&#31649;&#29702;</li>
<li class=" ml-8">open, mmap, read, write, lseek... - &#25991;&#20214;&#31649;&#29702;</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#26412;&#27425;&#35838;&#20869;&#23481;&#19982;&#30446;&#26631;</h2>
<p class=" font-serif my-1">&#29702;&#35299;&#20004;&#20010;&#25991;&#20214;&#31995;&#32479;&#30340;&#35774;&#35745;&#19982;&#23454;&#29616;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">FAT</li>
<li class=" ml-8">UNIX &#25991;&#20214;&#31995;&#32479;/ext2</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">&#25991;&#20214;&#31995;&#32479;&#23454;&#29616;&#65306;&#38656;&#27714;&#20998;&#26512;</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="linux" class=" text-xl mt-2 pb-2 font-sans">&#20363;&#23376;&#65306;Linux &#25991;&#20214;&#31995;&#32479;&#21021;&#22987;&#21270;</h2>
<p class=" font-serif my-1">&#26368;&#23567;&#30340; <a href="https://box.nju.edu.cn/f/3f67e092e1ba441187d9/?dl=1" class=" text-amber-900">Linux &#31995;&#32479;&#38236;&#20687;</a></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#26500;&#36896; Linux &#21551;&#21160;&#26102;&#30340; &#8220;&#26681;&#25991;&#20214;&#31995;&#32479;&#8221;<ul class=" list-disc font-serif">
<li class=" ml-8">&#38543;&#25805;&#20316;&#31995;&#32479;&#21551;&#21160;&#21152;&#36733;</li>
<li class=" ml-8"><red>&#20320;&#21487;&#20197;&#20687;&#35843;&#35797;&#20320;&#30340; oslab &#19968;&#26679;&#35843;&#35797; Linux!</red></li>
</ul>
</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>initramfs
&#9500;&#9472;&#9472; busybox
&#9492;&#9472;&#9472; init
</code></pre></div>

<ul class=" list-disc font-serif">
<li class=" ml-8"><code>/busybox</code> &#26159;&#20010;&#20108;&#36827;&#21046;&#25991;&#20214;<ul class=" list-disc font-serif">
<li class=" ml-8">ELF 64-bit LSB executable, statically linked</li>
</ul>
</li>
<li class=" ml-8"><code>/init</code> &#21482;&#26377; 3 &#34892;<ul class=" list-disc font-serif">
<li class=" ml-8">&#23454;&#38469;&#21482;&#20570;&#19968;&#20214;&#20107;: &#25191;&#34892; busybox<ul class=" list-disc font-serif">
<li class=" ml-8"><code>exec /busybox sh</code></li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="linux" class=" text-xl mt-2 pb-2 font-sans">Linux &#21551;&#21160;&#31532;&#19968;&#20010;&#24212;&#29992;&#31243;&#24207;&#26102;&#30340;&#29366;&#24577;</h2>
<p class=" font-serif my-1">&#8220;&#20960;&#20046;&#20160;&#20040;&#20063;&#27809;&#26377;&#8221;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#20294;&#25152;&#26377;&#30340;&#19968;&#20999;&#37117;&#21487;&#20197;&#34987;<red>&#31995;&#32479;&#35843;&#29992;</red> &#8220;&#21019;&#24314;&#8221; &#20986;&#26469;<ul class=" list-disc font-serif">
<li class=" ml-8">mount - &#25991;&#20214;&#31995;&#32479;&#31649;&#29702;</li>
<li class=" ml-8">mkdir, rmkdir, link, symlink, unlink... - &#30446;&#24405;&#31649;&#29702;</li>
<li class=" ml-8">open, mmap, read, write, lseek... - &#25991;&#20214;&#31649;&#29702;</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>/busybox mkdir -p /bin &amp;&amp; /busybox mv /busybox /bin/
c1="arch ash base64 cat chattr chgrp chmod chown conspy cp cpio cttyhack date dd df dmesg dnsdomainname dumpkmap echo ed egrep false fatattr fdflush fgrep fsync getopt grep gunzip gzip hostname hush ionice iostat ipcalc kbd_mode kill link linux32 linux64 ln login ls lsattr lzop makemime mkdir mknod mktemp more mount mountpoint mpstat mt mv netstat nice nuke pidof ping ping6 pipe_progress printenv ps pwd reformime resume rev rm rmdir rpm run-parts scriptreplay sed setarch setpriv setserial sh sleep stat stty su sync tar touch true umount uname usleep vi watch zcat"
c2="[ [[ awk basename bc beep blkdiscard bunzip2 bzcat bzip2 cal chpst chrt chvt cksum clear cmp comm crontab cryptpw cut dc deallocvt diff dirname dos2unix dpkg dpkg-deb du dumpleases eject env envdir envuidgid expand expr factor fallocate fgconsole find flock fold free ftpget ftpput fuser groups hd head hexdump hexedit hostid id install ipcrm ipcs killall last less logger logname lpq lpr lsof lspci lsscsi lsusb lzcat lzma man md5sum mesg microcom mkfifo mkpasswd nc nl nmeter nohup nproc nsenter nslookup od openvt passwd paste patch pgrep pkill pmap printf pscan"
c3="pstree pwdx readlink realpath renice reset resize rpm2cpio runsv runsvdir rx script seq setfattr setkeycodes setsid setuidgid sha1sum sha256sum sha3sum sha512sum showkey shred shuf smemcap softlimit sort split ssl_client strings sum sv svc svok tac tail taskset tcpsvd tee telnet test tftp time timeout top tr traceroute traceroute6 truncate ts tty ttysize udhcpc6 udpsvd unexpand uniq unix2dos unlink unlzma unshare unxz unzip uptime users uudecode uuencode vlock volname w wall wc wget which who whoami whois xargs xxd xz xzcat yes"
for cmd in $c1 $c2 $c3; do
  /bin/busybox ln -s /bin/busybox /bin/$cmd
done
mkdir -p /proc &amp;&amp; mount -t proc  none /proc
mkdir -p /sys  &amp;&amp; mount -t sysfs none /sys
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#25991;&#20214;&#31995;&#32479;&#23454;&#29616;</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">&#22312;&#19968;&#20010; I/O &#35774;&#22791; (&#39537;&#21160;) &#19978;&#23454;&#29616; &#8220;&#30446;&#24405;&#26641;&#8221; &#30340;&#25968;&#25454;&#32467;&#26500;&#12290;</p>
</blockquote>
<p class=" font-serif my-1"><a href="https://www.kernel.org/doc/html/latest/filesystems/vfs.html" class=" text-amber-900">VFS</a>: &#31649;&#29702;&#25152;&#26377;&#25991;&#20214;&#31995;&#32479;&#20849;&#20139;&#30340;&#37096;&#20998;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#23545;&#35937; (inode) &#20998;&#37197;/&#22238;&#25910;&#12289;&#36335;&#24452;/&#31526;&#21495;&#38142;&#25509;&#35299;&#26512;&#12289;&#25346;&#36733;</li>
<li class=" ml-8">&#23450;&#20041;&#20102;&#27599;&#20010;&#20855;&#20307;&#25991;&#20214;&#31995;&#32479;&#38656;&#35201;&#23454;&#29616;&#30340;&#25509;&#21475;</li>
</ul>
<hr>
<p class=" font-serif my-1">&#22359;&#35774;&#22791;&#39537;&#21160;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>read_block</code>, <code>write_block</code></li>
</ul>
<hr>
<p class=" font-serif my-1">&#30446;&#24405;/&#25991;&#20214; API</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>mkdir</code>, <code>rmdir</code>, <code>link</code>, <code>unlink</code></li>
<li class=" ml-8"><code>open</code>, <code>read</code>, <code>write</code>, <code>stat</code></li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#22238;&#21040;&#25968;&#25454;&#32467;&#26500;&#35838;&#8230;&#8230;</h2>
<p class=" font-serif my-1">&#25991;&#20214;&#31995;&#32479;&#23454;&#29616;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#22312; <code>read_block</code>, <code>write_block</code> &#19978;&#23454;&#29616;&#19968;&#20010; &#8220;&#30446;&#24405;&#26641;&#8221; &#30340;&#25277;&#35937;&#25968;&#25454;&#31867;&#22411;</li>
</ul>
<hr>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/dir-tree.png" width="500px"></p></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="file-allocation-table-fat" class=" text-2xl mt-2 font-sans">File Allocation Table (FAT)</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="1980" class=" text-xl mt-2 pb-2 font-sans">&#35753;&#26102;&#38388;&#22238;&#21040; 1980 &#24180;</h2>
<p class=" font-serif my-1">5.25" &#36719;&#30424;&#65306;&#21333;&#38754; 180 KiB</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">360 &#20010; 512B &#25159;&#21306; (sectors)</li>
<li class=" ml-8">&#22312;&#36825;&#26679;&#30340;&#35774;&#22791;&#19978;&#25345;&#20037;&#21270;&#25968;&#25454;&#65292;&#24212;&#35813;&#36873;&#29992;&#24590;&#26679;&#30340;&#25968;&#25454;&#32467;&#26500;&#65311;</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/floppy-drives.jpg" width="600px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="fat" class=" text-xl mt-2 pb-2 font-sans">FAT &#25991;&#20214;&#31995;&#32479;&#65306;&#20998;&#26512;</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">&#25243;&#24320; workload &#35848;&#20248;&#21270;&#65292;&#23601;&#26159;&#32781;&#27969;&#27667;&#12290;</p>
</blockquote>
<hr>
<p class=" font-serif my-1">&#38656;&#27714;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#26641;&#29366;&#30340;&#30446;&#24405;&#32467;&#26500;</li>
<li class=" ml-8">&#31995;&#32479;&#20013;&#20197;&#23567;&#25991;&#20214;&#20026;&#20027; (&#20960;&#20010; block &#20197;&#20869;)</li>
<li class=" ml-8">&#26080;&#38656;&#25903;&#25345;&#38142;&#25509;</li>
</ul>
<hr>
<p class=" font-serif my-1">&#23454;&#29616;&#26041;&#24335;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#38142;&#34920;<ul class=" list-disc font-serif">
<li class=" ml-8">&#20219;&#20309;&#22797;&#26434;&#30340;&#39640;&#32423;&#25968;&#25454;&#32467;&#26500;&#37117;&#26174;&#24471;&#28010;&#36153;</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#29992;&#38142;&#34920;&#23384;&#20648;&#25968;&#25454;&#65306;&#20004;&#31181;&#35774;&#35745;</h2>
<ol class=" list-decimal font-serif">
<li class=" ml-8">&#22312;&#27599;&#20010;&#25968;&#25454;&#22359;&#21518;&#25918;&#32622;&#25351;&#38024;<ul class=" list-disc font-serif">
<li class=" ml-8"><green>&#20248;&#28857;</green>&#65306;&#23454;&#29616;&#31616;&#21333;&#12289;&#26080;&#39035;&#21333;&#29420;&#24320;&#36767;&#23384;&#20648;&#31354;&#38388;</li>
<li class=" ml-8"><red>&#32570;&#28857;</red>&#65306;&#25968;&#25454;&#30340;&#22823;&#23567;&#19981;&#26159; $2^k$; &#21333;&#32431;&#30340; lseek &#38656;&#35201;&#35835;&#25972;&#22359;&#25968;&#25454;</li>
</ul>
</li>
<li class=" ml-8">&#23558;&#25351;&#38024;&#38598;&#20013;&#23384;&#25918;&#22312;&#25991;&#20214;&#31995;&#32479;&#30340;&#26576;&#20010;&#21306;&#22495;<ul class=" list-disc font-serif">
<li class=" ml-8"><green>&#20248;&#28857;</green>&#65306;&#23616;&#37096;&#24615;&#22909;&#65307;lseek &#26356;&#24555;</li>
<li class=" ml-8"><red>&#32570;&#28857;</red>&#65306;&#38598;&#20013;&#23384;&#25918;&#30340;&#25968;&#25454;&#25439;&#22351;&#23558;&#23548;&#33268;&#25968;&#25454;&#20002;&#22833; (&#24590;&#20040;&#21150;&#65311;)</li>
</ul>
</li>
</ol>
<hr>
<p class=" font-serif my-1">&#21738;&#31181;&#26041;&#24335;&#30340;&#32570;&#38519;&#26159;&#33268;&#21629;&#12289;&#38590;&#20197;&#35299;&#20915;&#30340;&#65311;</p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#38598;&#20013;&#20445;&#23384;&#25152;&#26377;&#25351;&#38024;</h2>
<p class=" font-serif my-1">&#38598;&#20013;&#23384;&#20648;&#30340;&#25351;&#38024;&#23481;&#26131;&#25439;&#22351;&#65311;&#23384; $n$ &#20221;&#23601;&#34892;&#65281;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">FAT-12/16/32 (FAT entry&#65292;&#21363; &#8220;next &#25351;&#38024;&#8221; &#30340;&#22823;&#23567;)</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/fat32_layout.gif" width="700px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="file-allocation-table" class=" text-xl mt-2 pb-2 font-sans">&#8220;File Allocation Table&#8221; &#25991;&#20214;&#31995;&#32479;</h2>
<p class=" font-serif my-1"><a href="http://localhost:5001/static/wiki/OS/MSFAT-spec.pdf" class=" text-amber-900">RTFM</a> &#24471;&#21040;&#24517;&#35201;&#30340;&#32454;&#33410;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#36923;&#36753;&#19978;&#65292;&#25991;&#20214;/&#30446;&#24405;&#37117;&#26159;&#23383;&#33410;&#24207;&#21015; (&#34394;&#25311;&#21270;&#30340;&#30913;&#30424;)<ul class=" list-disc font-serif">
<li class=" ml-8">&#20197; cluster (&#31751;) &#20026;&#21333;&#20301;&#38142;&#25509; (FAT &#38598;&#20013;&#23384;&#20648;&#38142;&#34920;&#30340; next)</li>
</ul>
</li>
<li class=" ml-8">&#30446;&#24405;&#20063;&#26159;&#25991;&#20214;<ul class=" list-disc font-serif">
<li class=" ml-8">&#19968;&#20010; (filename, size, firstblock) &#30340;&#21015;&#34920;&#65292;&#39034;&#24207;&#23384;&#20648;</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1"><code>mmap</code> &#21040;&#20869;&#23384;&#65292;&#23601;&#21487;&#20197;&#30452;&#25509;&#35775;&#38382;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">fat_volume</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">fat_header</span><span class="w"> </span><span class="n">header</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">fat</span><span class="p">[</span><span class="n">FAT_NUM</span><span class="p">];</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">clusters</span><span class="p">[</span><span class="n">CLUSTER_SZ</span><span class="p">][];</span>
<span class="p">};</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="fat" class=" text-xl mt-2 pb-2 font-sans">FAT: &#38142;&#25509;&#23384;&#20648;&#30340;&#25991;&#20214;</h2>
<p class=" font-serif my-1">&#8220;FAT&#8221; &#30340; &#8220;next&#8221; &#25968;&#32452;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>0</code>: free; <code>2...MAX</code>: allocated; </li>
<li class=" ml-8"><code>ffffff7</code>: bad cluster; <code>ffffff8-ffffffe</code>, <code>-1</code>: end-of-file</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/FAT-number.png" width="1000px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#30446;&#24405;&#26641;&#23454;&#29616;&#65306;&#30446;&#24405;&#25991;&#20214;</h2>
<p class=" font-serif my-1">&#20197;&#26222;&#36890;&#25991;&#20214;&#30340;&#26041;&#24335;&#23384;&#20648; &#8220;&#30446;&#24405;&#8221; &#36825;&#20010;&#25968;&#25454;&#32467;&#26500;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">FAT: &#30446;&#24405; = 32-byte &#23450;&#38271;&#30446;&#24405;&#39033;&#30340;&#38598;&#21512;</li>
<li class=" ml-8">&#25805;&#20316;&#31995;&#32479;&#22312;&#35299;&#26512;&#26102;&#25226;&#26631;&#35760;&#20026;&#30446;&#24405;&#30340;&#30446;&#24405;&#39033; &#8220;&#24403;&#20570;&#8221; &#30446;&#24405;&#21363;&#21487;<ul class=" list-disc font-serif">
<li class=" ml-8">&#21487;&#20197;&#29992;&#36830;&#32493;&#30340;&#33509;&#24178;&#20010;&#30446;&#24405;&#39033;&#23384;&#20648; &#8220;&#38271;&#25991;&#20214;&#21517;&#8221;</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/FAT-dent.png" width="800px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="fat" class=" text-xl mt-2 pb-2 font-sans">FAT: &#24615;&#33021;&#19982;&#21487;&#38752;&#24615;</h2>
<p class=" font-serif my-1">&#24615;&#33021;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><green>&#65291;</green> &#23567;&#25991;&#20214;&#31616;&#30452;&#22826;&#21512;&#36866;&#20102;</li>
<li class=" ml-8"><red>&#65293;</red> &#20294;&#22823;&#25991;&#20214;&#30340;&#38543;&#26426;&#35775;&#38382;&#23601;&#19981;&#34892;&#20102;<ul class=" list-disc font-serif">
<li class=" ml-8">4 GB &#30340;&#25991;&#20214;&#36339;&#21040;&#26411;&#23614; (4 KB cluster) &#26377; $2^{20}$ &#27425;&#38142;&#34920; next &#25805;&#20316;</li>
<li class=" ml-8">&#32531;&#23384;&#33021;&#37096;&#20998;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;</li>
</ul>
</li>
<li class=" ml-8">&#22312; FAT &#26102;&#20195;&#65292;&#30913;&#30424;&#36830;&#32493;&#35775;&#38382;&#24615;&#33021;&#26356;&#20339;<ul class=" list-disc font-serif">
<li class=" ml-8">&#20351;&#29992;&#26102;&#38388;&#20037;&#30340;&#30913;&#30424;&#20250;&#20135;&#29983;&#30862;&#29255; (fragmentation)<ul class=" list-disc font-serif">
<li class=" ml-8">malloc &#20063;&#20250;&#20135;&#29983;&#30862;&#29255;&#65292;&#19981;&#36807;&#23545;&#24615;&#33021;&#24433;&#21709;&#19981;&#22826;&#22823;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">&#21487;&#38752;&#24615;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#32500;&#25252;&#33509;&#24178;&#20010; FAT &#30340;&#21103;&#26412;&#38450;&#27490;&#20803;&#25968;&#25454;&#25439;&#22351;<ul class=" list-disc font-serif">
<li class=" ml-8">&#39069;&#22806;&#30340;&#21516;&#27493;&#24320;&#38144;</li>
</ul>
</li>
<li class=" ml-8">&#25439;&#22351;&#30340; cluster &#22312; FAT &#20013;&#26631;&#35760;</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="ext2unix" class=" text-2xl mt-2 font-sans">ext2/UNIX &#25991;&#20214;&#31995;&#32479;</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#26356;&#22909;&#30340;&#25991;&#20214;&#31995;&#32479;&#65306;&#38656;&#35201;&#20570;&#21040;&#20160;&#20040;&#65311;</h2>
<p class=" font-serif my-1">&#19981;&#33021; &#8220;&#23613;&#21892;&#23613;&#32654;&#8221;&#65292;&#20294;&#21487;&#20197;&#22312; &#8220;&#23454;&#38469; workload&#8221; &#19979;&#23613;&#21487;&#33021;&#22909;</p>
<table>
<thead>
<tr>
<th><strong>Summary</strong></th>
<th><strong>Findings</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Most files are small</td>
<td>Roughly 2K is the most common size</td>
</tr>
<tr>
<td>Average file size is growing</td>
<td>Almost 200K is the average</td>
</tr>
<tr>
<td>Most bytes are stored in large files</td>
<td>A few big files use most of the space</td>
</tr>
<tr>
<td>File systems contains lots of files</td>
<td>Almost 100K on average</td>
</tr>
<tr>
<td>File systems are roughly half full</td>
<td>Even as disks grow, file systems remain ~50% full</td>
</tr>
<tr>
<td>Directories are typically small</td>
<td>Many have few entries; most have 20 or fewer</td>
</tr>
</tbody>
</table></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ext2unix" class=" text-xl mt-2 pb-2 font-sans">ext2/UNIX &#25991;&#20214;&#31995;&#32479;</h2>
<p class=" font-serif my-1">&#25353;&#23545;&#35937;&#26041;&#24335;&#38598;&#20013;&#23384;&#20648;&#25991;&#20214;/&#30446;&#24405;&#20803;&#25968;&#25454;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#22686;&#24378;&#23616;&#37096;&#24615; (&#26356;&#26131;&#20110;&#32531;&#23384;)</li>
<li class=" ml-8">&#25903;&#25345;&#38142;&#25509;</li>
</ul>
<hr>
<p class=" font-serif my-1">&#20026;&#22823;&#23567;&#25991;&#20214;&#21306;&#20998; fast/slow path</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#23567;&#30340;&#26102;&#20505;&#24212;&#35813;&#29992;&#25968;&#32452;<ul class=" list-disc font-serif">
<li class=" ml-8">&#36830;&#38142;&#34920;&#36941;&#21382;&#37117;&#30465;&#20102;</li>
</ul>
</li>
<li class=" ml-8">&#22823;&#30340;&#26102;&#20505;&#24212;&#35813;&#29992;&#26641; (B-Tree; Radix-Tree; ...)<ul class=" list-disc font-serif">
<li class=" ml-8">&#24555;&#36895;&#30340;&#38543;&#26426;&#35775;&#38382;</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ext2" class=" text-xl mt-2 pb-2 font-sans">ext2: &#30913;&#30424;&#38236;&#20687;&#26684;&#24335;</h2>
<p class=" font-serif my-1">&#23545;&#30913;&#30424;&#36827;&#34892;&#20998;&#32452;</p>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/fs-ext2.png" width="600px"></p>
<p class=" font-serif my-1">&#8220;superblock&#8221;&#65306;&#25991;&#20214;&#31995;&#32479;&#20803;&#25968;&#25454;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#25991;&#20214; (inode) &#25968;&#37327;</li>
<li class=" ml-8">block group &#20449;&#24687;<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="../../../pages/OS/2021/demos/ext2.h" class=" text-amber-900">ext2.h</a> &#37324;&#26377;&#20320;&#38656;&#35201;&#30693;&#36947;&#30340;&#19968;&#20999;</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ext2-inode" class=" text-xl mt-2 pb-2 font-sans">ext2 inode</h2>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/ext2-inode.gif" width="600px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ext2" class=" text-xl mt-2 pb-2 font-sans">ext2 &#30446;&#24405;&#25991;&#20214;</h2>
<p class=" font-serif my-1">&#19982; FAT &#26412;&#36136;&#30456;&#21516;&#65306;&#22312;&#25991;&#20214;&#19978;&#24314;&#31435;&#30446;&#24405;&#30340;&#25968;&#25454;&#32467;&#26500;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#27880;&#24847;&#21040; inode &#32479;&#19968;&#23384;&#20648;<ul class=" list-disc font-serif">
<li class=" ml-8">&#30446;&#24405;&#25991;&#20214;&#20013;&#23384;&#20648;&#25991;&#20214;&#21517;&#21040; inode &#32534;&#21495;&#30340; key-value mapping</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/ext2-dirent.jpg" width="800px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="ext2" class=" text-xl mt-2 pb-2 font-sans">ext2: &#24615;&#33021;&#19982;&#21487;&#38752;&#24615;</h2>
<p class=" font-serif my-1">&#22823;&#25991;&#20214;&#30340;&#38543;&#26426;&#35835;&#20889;&#24615;&#33021;&#25552;&#21319;&#26126;&#26174; ($O(1)$)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#25903;&#25345;&#38142;&#25509; (&#19968;&#23450;&#31243;&#24230;&#20943;&#23569;&#31354;&#38388;&#28010;&#36153;)</li>
<li class=" ml-8">inode &#22312;&#30913;&#30424;&#19978;&#36830;&#32493;&#23384;&#20648;&#65292;&#20415;&#20110;&#32531;&#23384;/&#39044;&#21462;</li>
<li class=" ml-8">&#20381;&#28982;&#26377;&#30862;&#29255;&#30340;&#38382;&#39064;</li>
</ul>
<hr>
<p class=" font-serif my-1">&#20294;&#21487;&#38752;&#24615;&#20381;&#28982;&#26159;&#20010;&#24456;&#22823;&#30340;&#38382;&#39064;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#23384;&#20648; inode &#30340;&#25968;&#25454;&#22359;&#25439;&#22351;&#26159;&#24456;&#20005;&#37325;&#30340;</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#23547;&#25214;&#26356;&#39640;&#25928;&#30340;&#25968;&#25454;&#32467;&#26500;&#65311;</h2>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/OS/img/btrfs-cow.png" width="500px"></p>
<p class=" font-serif my-1">btrfs: <em>Everything is a B-tree</em></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">The BTRFS B-tree... knows only about &#8220;keys, items, and block headers.&#8221;</li>
<li class=" ml-8">&#25968;&#25454;&#32467;&#26500;&#30001;&#22810;&#20010; copy-on-write &#30340; tree &#32452;&#25104;<ul class=" list-disc font-serif">
<li class=" ml-8">subvolume, extent allocation tree, checksum tree, chunk and device tree, reloc tree, ...</li>
<li class=" ml-8">O. Rodeth, et al. BTRFS: The Linux B-tree filesystem. <em>ACM Transactions on Storage</em> (ToS), 9(3), 2013.</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">&#24635;&#32467;</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">&#24635;&#32467;</h2>
<p class=" font-serif my-1">&#26412;&#27425;&#35838;&#20869;&#23481;&#19982;&#30446;&#26631;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#29702;&#35299;&#20004;&#20010;&#25991;&#20214;&#31995;&#32479;&#30340;&#35774;&#35745;&#19982;&#23454;&#29616;<ul class=" list-disc font-serif">
<li class=" ml-8">FAT: &#38142;&#34920; + &#20803;&#25968;&#25454;&#23384;&#20648;&#22312;&#30446;&#24405;&#39033;</li>
<li class=" ml-8">UNIX &#25991;&#20214;&#31995;&#32479;/ext2: bitmap + inode + &#32034;&#24341;</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">Takeaway messages</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#25991;&#20214;&#31995;&#32479;&#26159;&#30913;&#30424; (&#39537;&#21160;) &#19978;&#30340;&#25968;&#25454;&#32467;&#26500;</li>
</ul></div>
        
      
      </section>
    
    </section>
  
</div>
</div>

<script src="../../../static/reveal/reveal.js"></script>
<script>
  Reveal.initialize({
    
    width: 1024, height: 768,
    
    slideNumber: 'c/t',
    controlsTutorial: false,
    progress: false,
    hash: true,
    center: false,
    autoAnimateUnmatched: true,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.3,
    transitionSpeed: 'fast'
  });
</script>


</body>

</html>