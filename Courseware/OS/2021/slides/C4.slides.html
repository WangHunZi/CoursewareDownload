<!DOCTYPE html><html class="h-100">


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com/"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // â€¢ auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // â€¢ rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="../../../static/reveal/reveal.css">
<link rel="stylesheet" href="../../../static/reveal/theme/simple.css" id="theme">

<style>
.reveal .slide-number {
  font-size: 26px;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, .3);
}

.reveal .full-screen {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.reveal .slides {
  border: 1.5px #ddd solid;
  border-radius: 7px;
  text-align: left;
  font-weight: 300;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4 {
  font-family: 'Lato', 'SimHei', 'STXihei', 'Droid Sans';
  font-weight: 400;
}

.reveal p, .reveal li, .reveal center {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Droid Sans';
}

.reveal li + li {
  margin-top: 10px;
}

.reveal ul {
  display: block;
  margin-right: 15px;
}

.reveal p, .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
  padding:  0 25px 0 25px;
}

.reveal table {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Sans Serif';
  margin-top: 15px;
  margin-bottom: 15px;
}

.reveal th {
  background-color: #eee;
}

.reveal tr:nth-child(even) {
  background-color: #efffff;
}

.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  text-align: left;
  margin: 0 0 20px 0;
 color: #222; 
  font-weight: 400;
  line-height: 1.2;
  letter-spacing: normal;
}



.reveal h1 {
  margin: 0 10 0 10;
  font-size: 60px;
}
.reveal .middle h1 {
  text-align: center;
}

.reveal h2 {
  font-size: 48px;
  border-bottom: 2px solid rgb(106, 0, 95);
  padding-bottom: 5px;
}
.reveal h3 { font-size: 1.15em; }
.reveal h4 { font-size: 1.05em; }

.reveal .center {
  text-align: center;
}

.reveal .middle {
  height: 728px;
  display: flex;
  align-items: center;
  width: 100%;
}

.reveal pre {
  font-size: 28px;
 
  background-color: #eee;

  border-radius: 3mm;
  padding: 10px 10px 10px 10px;
}

.reveal pre code {
  max-height: none;
}

.reveal code {
  font-family: 'Inconsolata', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif', Monospace;
}

.reveal .middle blockquote {
  text-align: center;
  color: rgb(106, 0, 95);
  background: none;
  box-shadow: none;
}

.reveal .middle blockquote a {
  color: inherit;
}

.reveal blockquote p, .reveal blockquote li {
  font-family: 'Lato', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif';
}

section .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.reveal .author-block {
  margin: 75px 0 35px 0;
}
.reveal .author-affiliation img {
  margin: 15px 0 0 0;
}
.reveal .author-block p, .reveal .author-affiliation p  {
  font-family: 'Kaiti', 'STKaiti', 'Serif', 'Times', 'Times New Roman';
  margin-block-start: 0em;
  margin-block-end: 0em;
}
.reveal .author-affiliation {
  display: inline-block;
  font-size: 90%;
}
.reveal hr {
  border: 10px solid rgba(0, 0, 0, 0);
}
.reveal li {
  margin-top: 10px;
}
</style>

  <title>[C4] å¹¶å‘æ•°æ®ç»“æ„</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div class="reveal">
<div class="slides">
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="c4" class=" text-2xl mt-2 font-sans">[C4] å¹¶å‘æ•°æ®ç»“æ„</h1>
<p class=" font-serif my-1"><include src="Slides_Author/index.html"><div><div class="py-16">
<p class=" font-serif my-1"><a href="http://ics.nju.edu.cn/~jyy" class=" text-amber-900">è’‹ç‚å²©</a></p>
</div>
<div class="row">
<div class="author-affiliation">
    <a href="http://www.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">ã€€ã€€å—äº¬å¤§å­¦ã€€ã€€</p>
    <img class="inline-img h-24" src="../../../static/img/nju-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
   <a href="http://cs.nju.edu.cn/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</p>
    <img class="inline-img h-24" src="../../../static/img/njucs-logo.jpg" style="display: inline-block;"></a>
  </div>
<div class="author-affiliation">
    <a href="https://cs.nju.edu.cn/ics/" class=" text-amber-900"><p class=" font-serif my-1">è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</p>
    <img class="inline-img h-24" src="../../../static/img/ics-logo.png" style="display: inline-block;"></a>
  </div>
</div></div></include></p></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">èƒŒæ™¯</h2>
<p class=" font-serif my-1">å¹¶å‘ç¼–ç¨‹ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å…¥é—¨ï¼š<code>threads.h</code></li>
<li class=" ml-8">æ”¾å¼ƒï¼šåŸå­æ€§ã€é¡ºåºã€å¯è§æ€§çš„ä¸§å¤±</li>
</ul>
<hr>
<p class=" font-serif my-1">äº’æ–¥ï¼šæ¢å¤ â€œå—â€ ä¹‹é—´çš„åŸå­æ€§ã€é¡ºåºã€å¯è§æ€§</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>lock(&lk)</code></li>
<li class=" ml-8"><code>unlock(&lk)</code></li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æœ¬æ¬¡è¯¾å†…å®¹ä¸ç›®æ ‡</h2>
<p class=" font-serif my-1">ç†è§£æ•°æ®ç«äº‰</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ•°æ®ç«äº‰æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ</li>
</ul>
<hr>
<p class=" font-serif my-1">ç”¨äº’æ–¥é”å®ç°å¹¶å‘æ•°æ®ç»“æ„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">çº¿ç¨‹å®‰å…¨çš„é“¾è¡¨</li>
<li class=" ml-8">malloc/free</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="data-race" class=" text-2xl mt-2 font-sans">æ•°æ®ç«äº‰ (Data Race)</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®ç«äº‰</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><red>ä¸åŒçš„çº¿ç¨‹</red>åŒæ—¶è®¿é—®<red>åŒä¸€æ®µå†…å­˜</red>ï¼Œä¸”<red>è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™</red>ã€‚</p>
</blockquote>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸¤ä¸ªå†…å­˜è®¿é—®åœ¨ â€œèµ›è·‘â€ï¼Œâ€œè·‘èµ¢â€ çš„æ“ä½œå…ˆæ‰§è¡Œ<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="../../../pages/OS/2021/demos/peterson.c" class=" text-amber-900">peterson.c</a>: å†…å­˜è®¿é—®éƒ½åœ¨èµ›è·‘<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="https://www.felixcloutier.com/x86/mfence" class=" text-amber-900">MFENCE</a>ï¼š<strike>å¦‚ä½•ç•™ä¸‹æœ€å°‘çš„ fenceï¼Œä¾ç„¶ä¿è¯ç®—æ³•æ­£ç¡®ï¼Ÿ</strike></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/race.jpg" width="500px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="contd" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®ç«äº‰ (cont'd)</h2>
<p class=" font-serif my-1">Peterson ç®—æ³•å‘Šè¯‰å¤§å®¶ï¼š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>ä½ ä»¬å†™ä¸å¯¹æ— é”çš„å¹¶å‘ç¨‹åº</red></li>
<li class=" ml-8">æ‰€ä»¥äº‹æƒ…åè€Œç®€å•äº†</li>
</ul>
<p class=" font-serif my-1"><br></p>
<h1 class="center text-2xl mt-2 font-sans">ç”¨äº’æ–¥é”ä¿æŠ¤å¥½å…±äº«æ•°æ®</h1>

<p class=" font-serif my-1"><br></p>
<h1 class="center text-2xl mt-2 font-sans">æ¶ˆç­ä¸€åˆ‡æ•°æ®ç«äº‰</h1></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®ç«äº‰ï¼šä¾‹å­</h2>
<p class=" font-serif my-1">ä»¥ä¸‹ä»£ç æ¦‚æ‹¬äº†ä½ ä»¬é‡åˆ°æ•°æ®ç«äº‰çš„å¤§éƒ¨åˆ†æƒ…å†µ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸è¦ç¬‘ï¼Œä½ ä»¬çš„ bug å‡ ä¹éƒ½æ˜¯è¿™ä¸¤ç§æƒ…å†µçš„å˜ç§</li>
</ul>
<hr>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="c1">// Case #1: ä¸Šé”™äº†é”</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">thread1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">spin_lock</span><span class="p">(</span><span class="o">&</span><span class="n">lk1</span><span class="p">);</span><span class="w"> </span><span class="n">sum</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">spin_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">lk1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">thread2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">spin_lock</span><span class="p">(</span><span class="o">&</span><span class="n">lk2</span><span class="p">);</span><span class="w"> </span><span class="n">sum</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">spin_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">lk2</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<hr>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="c1">// Case #2: å¿˜è®°ä¸Šé”</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">thread1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">spin_lock</span><span class="p">(</span><span class="o">&</span><span class="n">lk1</span><span class="p">);</span><span class="w"> </span><span class="n">sum</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">spin_unlock</span><span class="p">(</span><span class="o">&</span><span class="n">lk1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">thread2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sum</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ•°æ®ç»“æ„å’Œå¹¶å‘æ•°æ®ç»“æ„</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®ç»“æ„ (æŠ½è±¡æ•°æ®ç±»å‹)</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">Abstract Data Type (ADT): A mathematical model for data types, where a data type is defined by its behavior semantics from the point of view of a <em>user</em> of the data, specifically in terms of possible values, possible operations on data of this type, and the behavior of these operations.</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ADT æ˜¯æ¥å£ (æè¿°æ•°æ®ç»“æ„ä¸Šæ“ä½œçš„è¡Œä¸º)</li>
<li class=" ml-8">ADT ç”¨æŸä¸ªå…·ä½“çš„æ•°æ®ç»“æ„å®ç°</li>
</ul>
</blockquote>
<hr>
<p class=" font-serif my-1">å­¦è¿‡çš„æ•°æ®ç»“æ„</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">Array, vector, linked list, (balanced) binary search tree, interval tree, hash table, skip list, ...</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">ä¾‹å­ï¼šé“¾è¡¨</h2>
<p class=" font-serif my-1">(é¢è¯•é¢˜) å®ç°åŒå‘é“¾è¡¨æ“ä½œ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ“ä½œç³»ç»Ÿä¸­éå¸¸å¸¸ç”¨ (è¯·å‚è€ƒ Linux <code>list_head</code>)</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">node_t</span><span class="p">;</span>

<span class="n">node_t</span><span class="w"> </span><span class="n">head</span><span class="p">;</span><span class="w"> </span><span class="c1">// æ³¨æ„ä¸æ˜¯æŒ‡é’ˆ</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">list_init</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">head</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">head</span><span class="o">-></span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="o">-></span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">list_insert_before</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">new</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TODO</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">list_insert_after</span><span class="w"> </span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">new</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TODO</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">list_remove</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TODO</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="1" class=" text-xl mt-2 pb-2 font-sans">ç¼–ç¨‹å»ºè®® (1): ä¸è¦ç›´æ¥ä¸Šæ‰‹å°±ç¼–</h2>
<p class=" font-serif my-1">ç™½æ¿é¢è¯•ï¼šæ•°æ®ç»“æ„ã€ç®—æ³•â€¦â€¦</p>
<hr>
<p class=" font-serif my-1">Google ç»å…¸é¢è¯•</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">Phone interview<ul class=" list-disc font-serif">
<li class=" ml-8">åœ¨ Google Docs ä¸­å†™å‡º bug-free çš„ä»£ç  (x1)</li>
</ul>
</li>
<li class=" ml-8">Onsite interview<ul class=" list-disc font-serif">
<li class=" ml-8">åœ¨ç™½æ¿ä¸Šå†™å‡º bug-free çš„ä»£ç  (x3)</li>
</ul>
</li>
<li class=" ml-8">å›½å†…å¤§å‚éš¾åº¦æ™®éæ¯”è¿™ä¸ªæ›´é«˜ ğŸ˜‚</li>
</ul>
<hr>
<p class=" font-serif my-1">åœ¨ç™½æ¿ä¸Šç¼–ç¨‹å¿…é¡»<red>æ—¶åˆ»ä¿æŒå¤´è„‘æ¸…é†’</red></p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ—¶åˆ»ç†è§£ä»£ç å…¨å±€å’Œå±€éƒ¨çš„ specification å’Œå®ç°çš„é€”å¾„</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="2" class=" text-xl mt-2 pb-2 font-sans">ç¼–ç¨‹å»ºè®® (2): ä¸è¨€è‡ªæ˜ã€ä¸è¨€è‡ªè¯</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">list_remove</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 2021 å¹´ç™¾åº¦æœç´¢ â€œåŒå‘é“¾è¡¨ åˆ é™¤â€ ä»ç„¶å¾—åˆ°è¿™ä¸ªå›ç­” (WTF)</span>
<span class="w">  </span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="o">-></span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="p">;</span>
<span class="w">  </span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="o">-></span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">list_check</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="o">-></span><span class="n">next</span><span class="p">);</span><span class="w"> </span><span class="c1">// circular list's invariant</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="o">-></span><span class="n">prev</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">list_remove</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="p">;</span>
<span class="w">  </span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="p">;</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="o">&&</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next</span><span class="p">);</span><span class="w"> </span><span class="c1">// possibly prev == next</span>
<span class="w">  </span><span class="n">prev</span><span class="o">-></span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">  </span><span class="n">next</span><span class="o">-></span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="w">  </span><span class="n">list_check</span><span class="p">(</span><span class="n">prev</span><span class="p">);</span><span class="w"> </span><span class="n">list_check</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æŠŠé“¾è¡¨æ”¹æˆçº¿ç¨‹å®‰å…¨çš„</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">lock_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">node_t</span><span class="p">;</span>
</code></pre></div></div>
        
      
         <div class="fragment"> 
        <div><hr>
<p class=" font-serif my-1">å‘ƒâ€¦â€¦å¥½åƒä¸å¤ªå¯¹â€¦â€¦</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">list_remove_r</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">list_remove</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">  </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
         </div> 
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="contd" class=" text-xl mt-2 pb-2 font-sans">æŠŠé“¾è¡¨æ”¹æˆçº¿ç¨‹å®‰å…¨çš„ (cont'd)</h2>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">lock_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">node_t</span><span class="p">;</span>
</code></pre></div>

<hr>
<p class=" font-serif my-1">å‘ƒâ€¦â€¦å¥½åƒè¿˜æ˜¯ä¸å¤ªå¯¹â€¦â€¦</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">list_remove_r</span><span class="p">(</span><span class="n">node_t</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">lock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">list_remove</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">  </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">prev</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="w">  </span><span class="n">unlock</span><span class="p">(</span><span class="o">&</span><span class="n">node</span><span class="o">-></span><span class="n">next</span><span class="o">-></span><span class="n">lock</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ‰€ä»¥â€¦â€¦</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">Many operating systems utilized a single lock when first transitioning 
to multiprocessors, including Sun OS and Linux. In the latter, this lock 
even had a name, the big kernel lock (BKL).</p>
</blockquote>
<p class=" font-serif my-1">å¾€ç®€å•é‡Œå†™</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ€»æ˜¯å‡è®¾è‡ªå·±å†™ä¸å¯¹å¹¶å‘ç¨‹åºï¼š<red>ä½¿ç”¨é“¾è¡¨çº§çš„é”</red></li>
</ul>
<hr>
<p class=" font-serif my-1">æ—¶åˆ»è­¦æƒ• â€œ<a href="https://www.fourmilab.ch/documents/univac/heisenbug/" class=" text-amber-900">Heisenbug</a>â€</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç¨æœ‰ä¸æ…<ul class=" list-disc font-serif">
<li class=" ml-8">è«åå…¶å¦™çš„å€¼å‡ºé”™ã€è™šæ‹Ÿæœºå¡æ­»ã€è™šæ‹Ÿæœºç¥ç§˜é‡å¯â€¦â€¦</li>
</ul>
</li>
<li class=" ml-8"><red>é˜²å¾¡æ€§åœ°ç¼–ç¨‹</red><ul class=" list-disc font-serif">
<li class=" ml-8">ä½¿ä½ æ›´æ—©ã€æ›´å®¹æ˜“åœ°è¯Šæ–­å‡º bug</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="mallocfree" class=" text-2xl mt-2 font-sans">çº¿ç¨‹å®‰å…¨çš„ malloc/free</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">å†…å­˜åˆ†é…å’Œç®¡ç†</h2>
<p class=" font-serif my-1">å‡è®¾æœ‰ä¸€æ®µç©ºé—²çš„å†…å­˜ (â€œå †â€ï¼›å·²çŸ¥å¤§å°)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>malloc(size)</code> - è¿”å›ä¸€ä¸ªæ–°é²œçš„å¯¹è±¡ï¼Œå†…å­˜åœ°å€ <code>[x, x+size)</code><ul class=" list-disc font-serif">
<li class=" ml-8">æ— æ³•åˆ†é…æ—¶è¿”å› <code>NULL</code></li>
</ul>
</li>
<li class=" ml-8"><code>free(x)</code> - æ— æƒ…åœ°å’Œå¯¹è±¡ <code>[x, x+size)</code> åˆ†æ‰‹<ul class=" list-disc font-serif">
<li class=" ml-8">double-free = undefined behavior</li>
</ul>
</li>
<li class=" ml-8">æ€è€ƒé¢˜ï¼šç©ºé—²çš„ä¸€æ®µå†…å­˜æ€ä¹ˆæ¥ï¼Ÿ(ç¨‹åºæ˜¯çŠ¶æ€æœº)<ul class=" list-disc font-serif">
<li class=" ml-8">demo: <a href="../../../pages/OS/2021/demos/malloc-workload.c" class=" text-amber-900">malloc-workload.c</a> + strace</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/no-object.gif" width="480px"></p>
<p class=" font-serif my-1"></p><center>(é‚£å°± new ä¸€ä¸ªå§)</center></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ•°æ®ç»“æ„ï¼šåˆ†æ</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">ä¸è¦ç°åœ¨å°±å¼€å§‹è®¾è®¡ï¼Œå…ˆç†è§£é—®é¢˜ï¼</p>
</blockquote>
<p class=" font-serif my-1">æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªå·²è¢«åˆ†é…åŒºé—´çš„é›†åˆ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">$[\ell_0, r_0) \cup [\ell_1, r_1) \cup \ldots \cup [\ell_i, r_i) \subseteq [L, R)$<ul class=" list-disc font-serif">
<li class=" ml-8">äº’ä¸ç›¸äº¤ï¼š$\ell_0 < r_0 \le \ell_1 < r_1 \le \ldots < r_i \le \ell_{i+1}$</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1">æ”¯æŒçš„æ“ä½œ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">malloc($x$): ä» $[L, R)$ ä¸­è¿”å›ä¸€æ®µä¸ $[\ell_i, r_i)$ ä¸ç›¸äº¤çš„ $[\ell, \ell + x)$</li>
<li class=" ml-8">free($\ell_i$): ç»™å®š $\ell_i$, åˆ é™¤ $[\ell_i,r_i)$<ul class=" list-disc font-serif">
<li class=" ml-8">æŒ‘æˆ˜ 1: æ€ä¹ˆé€šè¿‡åŒºé—´å·¦ç«¯ç‚¹æ‰¾åˆ°å³ç«¯ç‚¹ï¼Ÿï¼Ÿï¼Ÿ</li>
<li class=" ml-8">æŒ‘æˆ˜ 2: è®¾è®¡æ€æ ·çš„æ•°æ®ç»“æ„ç®¡ç†åŒºé—´çš„é›†åˆ<ul class=" list-disc font-serif">
<li class=" ml-8">ç©ºé—²é“¾è¡¨, binary search tree, interval tree, ...</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="mallocfree" class=" text-xl mt-2 pb-2 font-sans">å®ç°é«˜æ•ˆçš„ malloc/free</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">Premature optimization is the root of all evil.</p>
<p class=" font-serif my-1">â€”â€”D. E. Knuth</p>
</blockquote>
<p class=" font-serif my-1">é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>è„±ç¦» workload åšä¼˜åŒ–å°±æ˜¯è€æµæ°“</red></li>
<li class=" ml-8"><red>è„±ç¦» workload åšä¼˜åŒ–å°±æ˜¯è€æµæ°“</red></li>
<li class=" ml-8"><red>è„±ç¦» workload åšä¼˜åŒ–å°±æ˜¯è€æµæ°“</red><ul class=" list-disc font-serif">
<li class=" ml-8">åœ¨å¼€å§‹è€ƒè™‘æ€§èƒ½ä¹‹å‰ï¼Œç†è§£ä½ éœ€è¦è€ƒè™‘ä»€ä¹ˆæ ·çš„æ€§èƒ½</li>
</ul>
</li>
</ul></div>
        
      
         <div class="fragment"> 
        <div><hr>
<p class=" font-serif my-1">æƒ³æŸ¥çœ‹ç¨‹åºçš„ malloc/free åºåˆ—ï¼Ÿ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>è®¡ç®—æœºç³»ç»Ÿå…¬ç†ï¼šä½ æƒ³åˆ°çš„å°±ä¸€å®šæœ‰äººåšåˆ°ã€‚</red><ul class=" list-disc font-serif">
<li class=" ml-8"><a href="../../../pages/OS/2021/demos/mtrace.c" class=" text-amber-900">mtrace.c</a> â€œ<code>LD_PRELOAD</code> hookingâ€</li>
</ul>
</li>
</ul></div>
         </div> 
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="workload" class=" text-xl mt-2 pb-2 font-sans">Workload åˆ†æ</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1">æŒ‡å¯¼æ€æƒ³ï¼š$O(n)$ å¤§å°çš„å¯¹è±¡åˆ†é…åè‡³å°‘æœ‰ $\Omega(n)$ çš„è¯»å†™æ“ä½œï¼Œå¦åˆ™å°±æ˜¯ performance bug (ä¸åº”è¯¥åˆ†é…é‚£ä¹ˆå¤š)ã€‚</p>
</blockquote>
<ul class=" list-disc font-serif">
<li class=" ml-8">è¶Šå°çš„å¯¹è±¡åˆ›å»º/åˆ†é…è¶Šé¢‘ç¹<ul class=" list-disc font-serif">
<li class=" ml-8">å­—ç¬¦ä¸²ã€ä¸´æ—¶å¯¹è±¡ç­‰ (å‡ ååˆ°å‡ ç™¾å­—èŠ‚)ï¼›ç”Ÿå­˜å‘¨æœŸå¯é•¿å¯çŸ­ </li>
</ul>
</li>
<li class=" ml-8">è¾ƒä¸ºé¢‘ç¹åœ°åˆ†é…ä¸­ç­‰å¤§å°çš„å¯¹è±¡<ul class=" list-disc font-serif">
<li class=" ml-8">è¾ƒå¤§çš„æ•°ç»„ã€å¤æ‚çš„å¯¹è±¡ï¼›æ›´é•¿çš„ç”Ÿå­˜å‘¨æœŸ</li>
</ul>
</li>
<li class=" ml-8">ä½é¢‘ç‡çš„å¤§å¯¹è±¡<ul class=" list-disc font-serif">
<li class=" ml-8">å·¨å¤§çš„å®¹å™¨ã€åˆ†é…å™¨ï¼›å¾ˆé•¿çš„ç”Ÿå­˜å‘¨æœŸ</li>
</ul>
</li>
<li class=" ml-8"><red>å¹¶è¡Œã€å¹¶è¡Œã€å†å¹¶è¡Œ</red><ul class=" list-disc font-serif">
<li class=" ml-8">æ‰€æœ‰åˆ†é…éƒ½ä¼šåœ¨æ‰€æœ‰å¤„ç†å™¨ä¸Šå‘ç”Ÿ</li>
<li class=" ml-8">ä½¿ç”¨é“¾è¡¨/åŒºé—´æ ‘å¯ä¸æ˜¯ä¸ªå¥½æƒ³æ³•</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="malloc-fast-and-slow" class=" text-xl mt-2 pb-2 font-sans"><code>malloc</code>, Fast and Slow</h2>
<p class=" font-serif my-1">è®¾ç½®ä¸¤å¥—ç³»ç»Ÿï¼š</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">fast path<ul class=" list-disc font-serif">
<li class=" ml-8">æ€§èƒ½æå¥½ã€å¹¶è¡Œåº¦æé«˜ã€è¦†ç›–å¤§éƒ¨åˆ†æƒ…å†µ</li>
<li class=" ml-8">ä½†æœ‰å°æ¦‚ç‡ä¼šå¤±è´¥</li>
</ul>
</li>
<li class=" ml-8">slow path<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸åœ¨ä¹é‚£ä¹ˆå¿«</li>
<li class=" ml-8">ä½†æŠŠå›°éš¾çš„äº‹æƒ…åšå¥½<ul class=" list-disc font-serif">
<li class=" ml-8">è®¡ç®—æœºç³»ç»Ÿé‡Œæœ‰å¾ˆå¤šè¿™æ ·çš„ä¾‹å­ (æ¯”å¦‚ cache)</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">äººç±»ä¹Ÿæ˜¯è¿™æ ·çš„ç³»ç»Ÿ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">Daniel Kahneman. <em>Thinking, Fast and Slow</em>. Farrar, Straus and Giroux, 2011.</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="slab-fast-path" class=" text-xl mt-2 pb-2 font-sans">Slab åˆ†é…: Fast Path</h2>
<p class=" font-serif my-1">å¯¹è±¡è¶Šå°ã€åˆ†é…è¶Šé¢‘ç¹ï¼Œè¶Šå¯èƒ½æ˜¯æ€§èƒ½ç“¶é¢ˆ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>ä½¿å°å¯¹è±¡çš„åˆ†é…å°½å¯èƒ½åœ¨çº¿ç¨‹æœ¬åœ°å®Œæˆè€Œæ— éœ€äº’æ–¥</red></li>
</ul>
<hr>
<p class=" font-serif my-1">Slab åˆ†é…å™¨ (segregated list)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ¯ä¸ª slab é‡Œçš„æ¯ä¸ªå¯¹è±¡éƒ½ä¸€æ ·å¤§<ul class=" list-disc font-serif">
<li class=" ml-8">æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰æ¯ä¸ªå¯¹è±¡å¤§å°çš„ slab</li>
<li class=" ml-8">fast path â†’ ç«‹å³åœ¨çº¿ç¨‹æœ¬åœ°åˆ†é…å®Œæˆ</li>
</ul>
</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/slabs.jpg" width="600px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="slab-slow-path" class=" text-xl mt-2 pb-2 font-sans">Slab åˆ†é…: Slow Path</h2>
<p class=" font-serif my-1">Slab åˆ†é…å¤±è´¥</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">çº¿ç¨‹ç”³è¯·å¾ˆå¤§çš„å†…å­˜</li>
<li class=" ml-8">æˆ– per-thread çš„ç¼“å­˜æ»¡äº†</li>
</ul>
<hr>
<p class=" font-serif my-1">æ­¤æ—¶çš„æƒ…å†µï¼šå¤§å†…å­˜åˆ†é…</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å› ä¸ºä¸é¢‘ç¹ï¼Œç®€å•èµ·è§ï¼Œä¸Šé”å°±å¥½äº†<ul class=" list-disc font-serif">
<li class=" ml-8">buddy system (1963): çº¿æ®µæ ‘ (å•ä½: page)</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">é‡Šæ”¾</h2>
<p class=" font-serif my-1">å›æ”¶å°å¯¹è±¡ (slab ä¸­çš„å¯¹è±¡)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>å°å¿ƒï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹åˆ†é…çš„å†…å­˜å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹å›æ”¶</red></li>
<li class=" ml-8">å°å¿ƒï¼šslab ç©ºååº”å›æ”¶ slab</li>
</ul>
<p class=" font-serif my-1">å›æ”¶å¤§å¯¹è±¡ (å›æ”¶ slab æˆ–å¤§å—å†…å­˜)</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸Šé”å°±å¥½äº† (<strike>æˆ–è€…ç”¨èªæ˜çš„æ— é”ç®—æ³•å®ç°</strike>)</li>
</ul>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/race.jpg" width="500px"></p></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="mallocfree" class=" text-xl mt-2 pb-2 font-sans">ç°å®ä¸–ç•Œä¸­çš„ malloc/free</h2>
<p class=" font-serif my-1">ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰ç°ä»£ malloc/free å®ç°çš„åŸºç¡€</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å½“ç„¶ï¼Œå®é™…æƒ…å†µä¼šå¤æ‚å¾—å¤šï¼Œæ€§èƒ½ä¹Ÿæ˜¯é”±é“¢å¿…è¾ƒ<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="https://sourceware.org/glibc/wiki/MallocInternals" class=" text-amber-900">glibc</a>: arena â†’ heap â†’ tcache (thread-local)</li>
<li class=" ml-8"><a href="https://google.github.io/tcmalloc/design.html" class=" text-amber-900">TCMalloc</a>: thread-caching malloc
    <img alt="" class="center" src="../../../pages/OS/img/tcmalloc.png" width="640px"></li>
<li class=" ml-8"><a href="https://wiki.openjdk.java.net/display/zgc/Main" class=" text-amber-900">OpenJDK: ZGC</a>: region based + tlab (thread-local)<ul class=" list-disc font-serif">
<li class=" ml-8">managed memory å…è®¸ object moveï¼Œå› æ­¤å¤æ‚å¾—å¤šâ€¦â€¦</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans">æ€»ç»“</h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">æ€»ç»“</h2>
<p class=" font-serif my-1">æœ¬æ¬¡è¯¾å†…å®¹ä¸ç›®æ ‡</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç†è§£æ•°æ®ç«äº‰</li>
<li class=" ml-8">ç”¨äº’æ–¥é”å®ç°å¹¶å‘æ•°æ®ç»“æ„ (å’Œ malloc/free)</li>
</ul>
<hr>
<p class=" font-serif my-1">Take-away messages</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">åƒä¸‡ä¸è¦é«˜ä¼°è‡ªå·±å†™å¹¶å‘ç¨‹åºçš„èƒ½åŠ›<ul class=" list-disc font-serif">
<li class=" ml-8">ç”¨ç®€å•ã€æ¸…æ¥šçš„æ–¹å¼å†™å‡ºå¯ä»¥è¯æ˜çš„ç®—æ³•</li>
</ul>
</li>
<li class=" ml-8">æŠ›å¼€ workload è°ˆä¼˜åŒ–å°±æ˜¯è€æµæ°“<ul class=" list-disc font-serif">
<li class=" ml-8">ç†è§£ workload å†è®¾è®¡å¹¶å‘æ•°æ®ç»“æ„<ul class=" list-disc font-serif">
<li class=" ml-8">ç”¨å¥½ trace/profiler</li>
</ul>
</li>
<li class=" ml-8">å¤šå¤„ç†å™¨ä¸Šçš„äº’æ–¥ (ä¸²è¡ŒåŒ–) æ˜¯ç“¶é¢ˆ</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
  
</div>
</div>

<script src="../../../static/reveal/reveal.js"></script>
<script>
  Reveal.initialize({
    
    width: 1024, height: 768,
    
    slideNumber: 'c/t',
    controlsTutorial: false,
    progress: false,
    hash: true,
    center: false,
    autoAnimateUnmatched: true,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.3,
    transitionSpeed: 'fast'
  });
</script>


</body>


</html>