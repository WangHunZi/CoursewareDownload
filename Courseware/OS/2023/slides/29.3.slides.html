<!DOCTYPE html><html class="h-100">


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com/"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // â€¢ auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // â€¢ rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="../../../static/reveal/reveal.css">
<link rel="stylesheet" href="../../../static/reveal/theme/simple.css" id="theme">

<style>
.reveal .slide-number {
  font-size: 26px;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, .3);
}

.reveal .full-screen {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.reveal .slides {
  border: 1.5px #ddd solid;
  border-radius: 7px;
  text-align: left;
  font-weight: 300;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4 {
  font-family: 'Lato', 'SimHei', 'STXihei', 'Droid Sans';
  font-weight: 400;
}

.reveal p, .reveal li, .reveal center {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Droid Sans';
}

.reveal li + li {
  margin-top: 10px;
}

.reveal ul {
  display: block;
  margin-right: 15px;
}

.reveal p, .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
  padding:  0 25px 0 25px;
}

.reveal table {
  font-size: 32px;
  font-family: 'Lato', 'STHeiti', 'SimHei', 'Sans Serif';
  margin-top: 15px;
  margin-bottom: 15px;
}

.reveal th {
  background-color: #eee;
}

.reveal tr:nth-child(even) {
  background-color: #efffff;
}

.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  text-align: left;
  margin: 0 0 20px 0;
 color: #222; 
  font-weight: 400;
  line-height: 1.2;
  letter-spacing: normal;
}



.reveal h1 {
  margin: 0 10 0 10;
  font-size: 60px;
}
.reveal .middle h1 {
  text-align: center;
}

.reveal h2 {
  font-size: 48px;
  border-bottom: 2px solid rgb(106, 0, 95);
  padding-bottom: 5px;
}
.reveal h3 { font-size: 1.15em; }
.reveal h4 { font-size: 1.05em; }

.reveal .center {
  text-align: center;
}

.reveal .middle {
  height: 728px;
  display: flex;
  align-items: center;
  width: 100%;
}

.reveal pre {
  font-size: 28px;
 
  background-color: #eee;

  border-radius: 3mm;
  padding: 10px 10px 10px 10px;
}

.reveal pre code {
  max-height: none;
}

.reveal code {
  font-family: 'Inconsolata', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif', Monospace;
}

.reveal .middle blockquote {
  text-align: center;
  color: rgb(106, 0, 95);
  background: none;
  box-shadow: none;
}

.reveal .middle blockquote a {
  color: inherit;
}

.reveal blockquote p, .reveal blockquote li {
  font-family: 'Lato', 'AR PL Ukai CN', 'STKaiti', 'KaiTi', 'Sans Serif';
}

section .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.reveal .author-block {
  margin: 75px 0 35px 0;
}
.reveal .author-affiliation img {
  margin: 15px 0 0 0;
}
.reveal .author-block p, .reveal .author-affiliation p  {
  font-family: 'Kaiti', 'STKaiti', 'Serif', 'Times', 'Times New Roman';
  margin-block-start: 0em;
  margin-block-end: 0em;
}
.reveal .author-affiliation {
  display: inline-block;
  font-size: 90%;
}
.reveal hr {
  border: 10px solid rgba(0, 0, 0, 0);
}
.reveal li {
  margin-top: 10px;
}
</style>

  <title>å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div class="reveal">
<div class="slides">
   
    <section>
    
      
      <section>
      

      
        
        <div><div class="center middle"><div style="width:100%"><h1 id="_1" class=" text-2xl mt-2 font-sans"><a href="29.3.slides.html" class=" text-amber-900">å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤</a></h1></div></div></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="crash-consistency" class=" text-xl mt-2 pb-2 font-sans">å´©æºƒä¸€è‡´æ€§ (Crash Consistency)</h2>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<p class=" font-serif my-1"><strong>Crash Consistency</strong>: Move the file system from one consistent state (e.g., before the file got appended to) to another atomically (e.g., after the inode, bitmap, and new data block have been written to disk).</p>
</blockquote>
<p class=" font-serif my-1"></p><center>(ä½ ä»¬å¹³æ—¶ç¼–ç¨‹æ—¶å‡è®¾ä¸ä¼šå‘ç”Ÿçš„äº‹ï¼Œæ“ä½œç³»ç»Ÿéƒ½è¦ç»™ä½ å…œåº•)</center>
<hr>
<p class=" font-serif my-1">ç£ç›˜ä¸æä¾›å¤šå—è¯»å†™ â€œall or nothingâ€ çš„æ”¯æŒ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">ç”šè‡³ä¸ºäº†æ€§èƒ½ï¼Œæ²¡æœ‰é¡ºåºä¿è¯<ul class=" list-disc font-serif">
<li class=" ml-8">bwrite å¯èƒ½è¢«ä¹±åº</li>
<li class=" ml-8">æ‰€ä»¥ç£ç›˜è¿˜æä¾›äº† bflush ç­‰å¾…å·²å†™å…¥çš„æ•°æ®è½ç›˜</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="file-system-checking-fsck" class=" text-xl mt-2 pb-2 font-sans">File System Checking (FSCK)</h2>
<p class=" font-serif my-1">æ ¹æ®ç£ç›˜ä¸Šå·²æœ‰çš„ä¿¡æ¯ï¼Œæ¢å¤å‡º â€œæœ€å¯èƒ½â€ çš„æ•°æ®ç»“æ„</p>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/fsck-recovery.png" width="750px"></p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="https://dl.acm.org/doi/10.5555/1855741.1855751" class=" text-amber-900">SQCK: A declarative file system checker</a> (OSDI'08)</li>
<li class=" ml-8"><a href="https://dl.acm.org/doi/10.1145/3281031" class=" text-amber-900">Towards robust file system checkers</a> (FAST'18)<ul class=" list-disc font-serif">
<li class=" ml-8">â€œwidely used file systems (EXT4, XFS, BtrFS, and F2FS) may leave the file system in an uncorrectable state if the repair procedure is interrupted unexpectedlyâ€ ğŸ˜‚</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">é’ˆå¯¹ crashï¼Œæˆ‘ä»¬éœ€è¦æ›´å¯é çš„æ–¹æ³•æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¯é çš„æ–¹æ³•</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´çš„æ ¹æœ¬åŸå› æ˜¯<red>å­˜å‚¨è®¾å¤‡æ— æ³•æä¾›å¤šæ¬¡å†™å…¥çš„åŸå­æ€§</red></li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="_1" class=" text-xl mt-2 pb-2 font-sans">é‡æ–°æ€è€ƒæ•°æ®ç»“æ„çš„å­˜å‚¨</h2>
<p class=" font-serif my-1">ä¸¤ä¸ª â€œè§†è§’â€</p>
<ol class=" list-decimal font-serif">
<li class=" ml-8">å­˜å‚¨å®é™…<red>æ•°æ®ç»“æ„</red><ul class=" list-disc font-serif">
<li class=" ml-8">æ–‡ä»¶ç³»ç»Ÿçš„ â€œç›´è§‚â€ è¡¨ç¤º</li>
<li class=" ml-8">crash unsafe</li>
</ul>
</li>
<li class=" ml-8">Append-only è®°å½•æ‰€æœ‰<red>å†å²æ“ä½œ</red><ul class=" list-disc font-serif">
<li class=" ml-8">â€œé‡åšâ€ æ‰€æœ‰æ“ä½œå¾—åˆ°æ•°æ®ç»“æ„çš„å½“å‰çŠ¶æ€</li>
<li class=" ml-8">å®¹æ˜“å®ç°å´©æºƒä¸€è‡´æ€§</li>
</ul>
</li>
</ol>
<hr>
<p class=" font-serif my-1">äºŒè€…çš„èåˆ</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ•°æ®ç»“æ„æ“ä½œå‘ç”Ÿæ—¶ï¼Œç”¨ (2) append-only è®°å½•æ—¥å¿—</li>
<li class=" ml-8">æ—¥å¿—è½ç›˜åï¼Œç”¨ (1) æ›´æ–°æ•°æ®ç»“æ„</li>
<li class=" ml-8">å´©æºƒåï¼Œé‡æ”¾æ—¥å¿—å¹¶æ¸…é™¤ (ç§°ä¸º redo logï¼›ç›¸åº”ä¹Ÿå¯ä»¥ undo log)</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="atomic-append" class=" text-xl mt-2 pb-2 font-sans">å®ç° Atomic Append</h2>
<p class=" font-serif my-1">ç”¨ bread, bwrite å’Œ bflush å®ç° append()</p>
<p class=" font-serif my-1"><img alt="" class="center" src="../../../pages/OS/img/fs-journaling.png" width="800px"></p>
<ol class=" list-decimal font-serif">
<li class=" ml-8">å®šä½åˆ° journal çš„æœ«å°¾ (bread)</li>
<li class=" ml-8">bwrite TXBegin å’Œæ‰€æœ‰æ•°æ®ç»“æ„æ“ä½œ</li>
<li class=" ml-8">bflush ç­‰å¾…æ•°æ®è½ç›˜</li>
<li class=" ml-8">bwrite TXEnd</li>
<li class=" ml-8">bflush ç­‰å¾…æ•°æ®è½ç›˜</li>
<li class=" ml-8">å°†æ•°æ®ç»“æ„æ“ä½œå†™å…¥å®é™…æ•°æ®ç»“æ„åŒºåŸŸ</li>
<li class=" ml-8">ç­‰å¾…æ•°æ®è½ç›˜åï¼Œåˆ é™¤ (æ ‡è®°) æ—¥å¿—</li>
</ol></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="journaling" class=" text-xl mt-2 pb-2 font-sans">Journaling: ä¼˜åŒ–</h2>
<p class=" font-serif my-1">ç°åœ¨ç£ç›˜éœ€è¦å†™å…¥åŒä»½çš„æ•°æ®</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">æ‰¹å¤„ç† (xv6; jbd)<ul class=" list-disc font-serif">
<li class=" ml-8">å¤šæ¬¡ç³»ç»Ÿè°ƒç”¨çš„ Tx åˆå¹¶æˆä¸€ä¸ªï¼Œå‡å°‘ log çš„å¤§å°</li>
<li class=" ml-8">jbd: å®šæœŸ write back</li>
</ul>
</li>
<li class=" ml-8">Checksum (ext4)<ul class=" list-disc font-serif">
<li class=" ml-8">ä¸å†æ ‡è®° TxBegin/TxEnd</li>
<li class=" ml-8">ç›´æ¥æ ‡è®° Tx çš„é•¿åº¦å’Œ checksum</li>
</ul>
</li>
<li class=" ml-8">Metadata journaling (ext4 default)<ul class=" list-disc font-serif">
<li class=" ml-8">æ•°æ®å ç£ç›˜å†™å…¥çš„ç»å¤§éƒ¨åˆ†<ul class=" list-disc font-serif">
<li class=" ml-8">åªå¯¹ inode å’Œ bitmap åš journaling å¯ä»¥æé«˜æ€§èƒ½</li>
</ul>
</li>
<li class=" ml-8">ä¿è¯æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„æ˜¯ä¸€è‡´çš„ï¼›ä½†æ•°æ®å¯èƒ½ä¸¢å¤±</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
      
      <section>
      

      
        
        <div><h2 id="metadata-journaling" class=" text-xl mt-2 pb-2 font-sans">Metadata Journaling</h2>
<p class=" font-serif my-1">ä»åº”ç”¨è§†è§’æ¥çœ‹ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„è¡Œä¸ºå¯èƒ½å¾ˆæ€ªå¼‚</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">å„ç±»ç³»ç»Ÿè½¯ä»¶ (git, sqlite, gdbm, ...) ä¸å¹¸ä¸­æ‹›<ul class=" list-disc font-serif">
<li class=" ml-8"><a href="https://cn.bing.com/search?q=All+file+systems+are+not+created+equal%3A+On+the+complexity+of+crafting+crash-consistent+applications&form=APMCS1&PC=APMC" class=" text-amber-900">All file systems are not created equal: On the complexity of crafting crash-consistent applications</a> (OSDI'14)</li>
<li class=" ml-8">(os-workbench é‡Œçš„å°ç§˜å¯†)</li>
</ul>
</li>
<li class=" ml-8"><a href="https://zhuanlan.zhihu.com/p/25188921" class=" text-amber-900">æ›´å¤šçš„åº”ç”¨ç¨‹åºå¯èƒ½å‘ç”Ÿ data loss</a><ul class=" list-disc font-serif">
<li class=" ml-8">æˆ‘ä»¬çš„å·¥ä½œ: GNU coreutils, gmake, gzip, ... ä¹Ÿæœ‰é—®é¢˜</li>
<li class=" ml-8"><a href="https://dl.acm.org/doi/10.1145/2950290.2950327" class=" text-amber-900">Crash consistency validation made easy</a> (FSE'16)</li>
</ul>
</li>
</ul>
<hr>
<p class=" font-serif my-1">æ›´ä¸ºä¸€åŠ³æ°¸é€¸çš„æ–¹æ¡ˆï¼šTxOS</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">xbegin/xend/xabort ç³»ç»Ÿè°ƒç”¨å®ç°è·¨ syscall çš„ â€œall-or-nothingâ€<ul class=" list-disc font-serif">
<li class=" ml-8">åº”ç”¨åœºæ™¯ï¼šæ•°æ®æ›´æ–°ã€è½¯ä»¶æ›´æ–°ã€check-useâ€¦â€¦</li>
<li class=" ml-8"><a href="https://dl.acm.org/doi/10.1145/1629575.1629591" class=" text-amber-900">Operating systems transactions</a> (SOSP'09)</li>
</ul>
</li>
</ul></div>
        
      
      </section>
    
    </section>
  
</div>
</div>

<script src="../../../static/reveal/reveal.js"></script>
<script>
  Reveal.initialize({
    
    width: 1024, height: 768,
    
    slideNumber: 'c/t',
    controlsTutorial: false,
    progress: false,
    hash: true,
    center: false,
    autoAnimateUnmatched: true,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.3,
    transitionSpeed: 'fast'
  });
</script>


</body>


</html>