<!DOCTYPE html><html class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../../static/katex/katex.min.css">
  <script defer src="../../../static/katex/katex.min.js"></script>
  <script defer src="../../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // &#8226; auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // &#8226; rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<style>
.article {
  -webkit-hyphens: auto;
}
form {
  margin-block-end: 0;
}
img {
  display: inline-block;
}
code { font-size: 85%; }
pre {
  font-size: 95%;
  line-height: 120%;
}
blockquote {
  font-size: 95%;
}
p {
  font-size: 105%;
  text-indent: 2em;
}
li {
  font-size: 105%;
}
blockquote p {
  text-indent: 0em;
}
.float-right {
  padding-left: 10px;
}
.float-left {
  padding-right: 10px;
}
a {
  color: rgb(29 78 216);
}
strong {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.box        {
  border-radius: 2px; padding: 1px 4px 2px 4px;
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
  font-size: 95%;
}
.box-blue,  .badge-primary  { background-color: rgba(66, 139, 202, 0.5); color: #1d4ed8; }
.box-green, .badge-success  { background-color: rgba(92, 184, 92, 0.5);  color: #15803d; }
.box-red,   .badge-danger   { background-color: rgba(217, 83, 79, 0.5);  color: #b91c1c; }
.box-yellow,.badge-warning  { background-color: rgba(240, 173, 78, 0.5); color: #a16207; }
.box-gray   { background-color: #a0a0a0; }

.badge {
  padding: 1 4 1 4;
  display: inline-block;
  border-radius: 0.25rem;
  border: 1px solid;
}
.message p {
  text-indent: 0em;
  margin-top: 1px;
}
.message h1, h2, h3, h4, h5 {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.message h2 {
  font-size: 120%;
  margin-top: 5px;
  margin-bottom: 2px;
}
.message li {
  list-style: disc;
  margin-left: 2em;
}
li > p {
  text-indent: 0em;
}
block-quote h4 {
  float: left;
  display: inline-block;
}
.center {
  display: block;
  margin: auto;
}
hr {
  margin-top: 20px;
  padding-bottom: 20px;
}

.fa-gradient {
	background: -webkit-gradient(linear, left top, left bottom, from(rgb(99, 27, 103)), to(#333));
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
}

</style>


  <title>L3: &#29992;&#25143;&#24577;&#36827;&#31243; (uproc)</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div>

<div class="px-2 py-1 w-full fixed z-50 bg-gradient-to-r from-black via-purple-700 via-purple-500 shadow-lg" style="-webkit-backdrop-filter: saturate(150%) blur(4px); backdrop-filter: saturate(150%) blur(4px)">
  <form>
    <a href="../../../index.html"><span class="text-lg px-2 text-white">Yanyan's Wiki</span></a>
    <a href="../../2023/index.html"><span class="text-sm px-2 text-white">&#25805;&#20316;&#31995;&#32479; (2023)</span></a>
    <input maxlength="9" id="token-input" class="float-right appearance-none border border-transparent px-2 py-1 w-20 bg-white text-gray-700 placeholder-gray-400 shadow-md rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent font-mono" type="text" placeholder="TOKEN" oninput="login();">
  </form>
</div>

<div class="article container mx-auto md:px-8 lg:px-8 xl:px-8 2xl:px-8 shadow-lg border pb-8 pt-10 max-w-screen-md text-justify divide-y-2 divide-white">
  <div><h1 id="l3-uproc" class=" text-2xl mt-2 font-sans">L3: &#29992;&#25143;&#24577;&#36827;&#31243; (uproc)</h1>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_1" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-red" style=" padding-bottom: 0;">&#9200; &#25130;&#27490;&#26085;&#26399;</h4>
<p class=" font-serif my-1"><strong>Soft Deadline: 2022 &#24180; 6 &#26376; 26 &#26085; 23:59:59&#12290;</strong></p>
<p class=" font-serif my-1"><red><strong>&#26412;&#23454;&#39564;&#22312; L2 &#20195;&#30721;&#30340;&#22522;&#30784;&#19978;&#23436;&#25104;</strong>&#12290;&#20294;&#22914;&#26524;&#20320;&#20960;&#20046;&#27809;&#26377;&#23436;&#25104; L2 (&#20363;&#22914;&#27809;&#26377;&#27491;&#30830;&#23454;&#29616;&#21516;&#27493;&#25805;&#20316;&#65292;&#25110;&#26159;&#21482;&#25903;&#25345;&#21333;&#22788;&#29702;&#22120;)&#65292;&#20381;&#28982;&#21487;&#20197;&#24320;&#22987; L3 &#24182;&#36890;&#36807;&#37096;&#20998;&#27979;&#35797;&#29992;&#20363;&#12290;</red></p>
<p class=" font-serif my-1">&#22312;&#21629;&#20196;&#34892;&#20013; <code>git pull origin L3</code> &#19979;&#36733;&#26694;&#26550;&#20195;&#30721;&#12290;</p>
<p class=" font-serif my-1"><strong><red>&#26412;&#27425;&#23454;&#39564;&#25552;&#20132;&#26102;&#65292;&#38656;&#35201;&#35774;&#32622;&#29615;&#22659;&#21464;&#37327; <code>MODULE</code> &#20026; <code>L3</code></red></strong> (&#22914;&#26524;&#20320;&#23558; export &#20889;&#22312;&#20102; Makefile &#37324;&#65292;&#38656;&#35201;&#30456;&#24212;&#20316;&#20986;&#20462;&#25913;&#65292;&#21542;&#21017;&#23558;&#25552;&#20132;&#21040;&#36807;&#24448;&#30340;&#23454;&#39564;)&#12290;</p>
<p class=" font-serif my-1">&#26412;&#27425;&#23454;&#39564;&#30340;&#25253;&#21578;&#30452;&#25509;&#22312; <code>kernel/</code> &#30446;&#24405;&#19979;&#21407;&#20808;&#30340;&#23454;&#39564;&#25253;&#21578;&#22522;&#30784;&#19978;&#28155;&#21152;&#12290;</p>
<p class=" font-serif my-1"><strong>&#25298;&#32477;&#20869;&#21367;</strong>&#65306;&#38500;&#38750;&#29305;&#27530;&#24773;&#20917;&#65292;&#26412;&#27425;&#23454;&#39564;&#30340;&#23454;&#39564;&#25253;&#21578;<strong>&#19981;&#24314;&#35758;&#36229;&#36807; 2 &#39029; A4 &#32440;</strong>&#12290;&#35831;&#22312;&#23454;&#39564;&#25253;&#21578;&#20013;&#25551;&#36848;&#20320;&#22312;&#23454;&#39564;&#20013;&#36935;&#21040;&#30340;&#29305;&#21035;&#20540;&#24471;&#19968;&#25552;&#30340;&#20107;&#20214;&#65292;&#20363;&#22914;&#20320;&#20195;&#30721;&#30340;&#26550;&#26500;&#35774;&#35745;&#12289;&#29305;&#21035;&#31934;&#24039;&#30340;&#23454;&#29616;&#12289;&#36935;&#21040;&#21360;&#35937;&#28145;&#21051;&#30340; bug &#31561;&#12290;</p>
</blockquote>
<p class=" font-serif my-1"><oj-status course="OS2022" module="L3"><div class="divide-y divide-dashed">
    <div class="flex font-semibold">
      OS2022-L3 &#25552;&#20132;&#32467;&#26524;
    </div>
    
  </div>
</oj-status></p>
<h2 id="1" class=" text-xl mt-2 pb-2 font-sans">1. &#32972;&#26223;</h2>
<p class=" font-serif my-1"><img alt="" class="float-right" src="../../../pages/OS/img/vr.jpg" width="250px"></p>
<p class=" font-serif my-1">&#22312;&#19978;&#19968;&#20010;&#23454;&#39564;&#20013;&#65292;&#25105;&#20204;&#24050;&#32463;&#23454;&#29616;&#20102;&#29616;&#20195;&#22810;&#22788;&#29702;&#22120;&#30828;&#20214;&#19978;&#30340;&#19968;&#20010; &#8220;&#23884;&#20837;&#24335;&#8221; &#25805;&#20316;&#31995;&#32479;&#8212;&#8212;&#23427;&#33021;&#22815;&#20197;&#25250;&#21344;&#30340;&#26041;&#24335;&#35843;&#24230;&#22810;&#20010;&#30452;&#25509;&#36816;&#34892;&#22312;&#20869;&#26680;&#24577;&#30340;&#32447;&#31243;&#65292;&#20174;&#32780;&#23454;&#29616;&#22788;&#29702;&#22120;&#30340;&#26102;&#20998;&#22797;&#29992;&#12290;&#22914;&#26524;&#20320;&#30340;&#35745;&#31639;&#26426;&#30828;&#20214;&#27809;&#26377; MMU&#65292;&#20320;&#30340; Lab2 &#24050;&#32463;&#26159;&#30456;&#24403;&#35946;&#21326;&#30340;&#20102;&#12290;</p>
<p class=" font-serif my-1">&#24403;&#28982;&#65292;&#20320;&#30340;&#35745;&#31639;&#26426;&#30828;&#20214;&#26159;&#26377; MMU &#30340;&#12290;&#25152;&#20197;&#26159;&#26102;&#20505;&#32473;&#32447;&#31243;&#25140;&#19978; MMU &#25552;&#20379;&#30340; VR &#31995;&#32479;&#65292;&#20351;&#24471;&#32447;&#31243;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#36816;&#34892;&#22312;&#36739;&#20302;&#30340;&#26435;&#38480;&#32423;&#21035;&#65292;&#20174;&#32780;&#22312;&#25191;&#34892;&#20219;&#20309;&#25935;&#24863;&#25805;&#20316;&#26102;&#37117;&#20250;&#23558;&#25511;&#21046;&#26435;&#36890;&#36807;&#24322;&#24120;&#26426;&#21046;&#20132;&#32473;&#25805;&#20316;&#31995;&#32479;&#12290;</li>
<li class=" ml-8">&#26080;&#27861;&#30452;&#25509;&#30475;&#21040;&#29289;&#29702;&#22320;&#22336;&#65292;&#35775;&#38382;&#20219;&#20309;&#22320;&#22336;&#65292;&#21253;&#25324;&#21462; PC &#22788;&#30340;&#25351;&#20196;&#12289;load/store &#20869;&#23384;&#31561;&#65292;&#20840;&#37096;&#35201;&#32463;&#36807; VR &#30524;&#38236;&#30340;&#36716;&#35793;&#12290;VR &#30524;&#38236;&#34987;&#25805;&#20316;&#31995;&#32479;&#37197;&#32622;&#20026;&#19968;&#20010;&#25968;&#25454;&#32467;&#26500;&#65292;&#19988;&#21482;&#26377;&#25805;&#20316;&#31995;&#32479;&#25165;&#26377;&#26435;&#20462;&#25913;&#12290;</li>
</ul>
<p class=" font-serif my-1">&#36825;&#26679;&#25105;&#20204;&#23601;&#24471;&#21040;&#20102;&#36827;&#31243;&#12290;&#22312;&#36825;&#20010;&#23454;&#39564;&#37324;&#65292;&#20320;&#20250;&#23558;&#20320;&#30340; &#8220;&#23884;&#20837;&#24335;&#25805;&#20316;&#31995;&#32479;&#8221; &#21464;&#25104;&#19968;&#20010;&#21644; UNIX &#20960;&#20046; &#8220;&#26080;&#38480;&#25509;&#36817;&#8221; &#30340;&#30495;&#27491;&#25805;&#20316;&#31995;&#32479;&#65292;&#36827;&#31243;&#21487;&#20197;&#22312;&#29992;&#25143;&#24577;&#36816;&#34892;&#65292;&#24182;&#19988;&#22240;&#20026;&#20013;&#26029;/&#24322;&#24120;/&#31995;&#32479;&#35843;&#29992;&#21518;&#65292;&#25805;&#20316;&#31995;&#32479;&#33021;&#22815;&#27491;&#30830;&#22320;&#22788;&#29702;&#23427;&#20204;&#12290;</p>
<h2 id="2" class=" text-xl mt-2 pb-2 font-sans">2. &#23454;&#39564;&#25551;&#36848;</h2>
<h3 id="21" class=" text-lg mt-2 pb-2 font-sans">2.1 &#23454;&#39564;&#24635;&#35272;</h3>
<p class=" font-serif my-1">&#36825;&#20010;&#23454;&#39564;&#22312; pmm &#21644; kmt &#30340;&#22522;&#30784;&#19978;&#65292;&#22686;&#21152;&#29992;&#25143;&#24577;&#30340;&#36827;&#31243; (&#21487;&#20197;&#29702;&#35299;&#20026;&#25317;&#26377;&#22320;&#22336;&#31354;&#38388;&#30340;&#36827;&#31243;)&#12290;&#22312;&#36825;&#20010;&#23454;&#39564;&#20013;&#65292;&#20320;&#30340;&#25805;&#20316;&#31995;&#32479;&#23558;&#20250;&#21152;&#36733;&#31532;&#19968;&#20010;&#29992;&#25143;&#24577;&#36827;&#31243; (&#36827;&#31243;&#30340;&#20195;&#30721; &#8220;&#30828;&#32534;&#30721;&#8221; &#22312;&#25805;&#20316;&#31995;&#32479;&#21551;&#21160;&#26102;&#30340;&#20869;&#23384;&#20013;)&#65292;&#24182;&#19988;&#20801;&#35768;&#29992;&#25143;&#24577;&#36827;&#31243;&#25191;&#34892;&#31995;&#32479;&#35843;&#29992;&#12290;&#20855;&#20307;&#26469;&#35828;&#65292;&#38500; uproc &#27169;&#22359;&#30340;&#21021;&#22987;&#21270; (init) &#20043;&#22806;&#65292;&#20320;&#38656;&#35201;&#23454;&#29616;&#20197;&#19979;&#31995;&#32479;&#35843;&#29992;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="n">MODULE</span><span class="p">(</span><span class="n">uproc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)();</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">kputc</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fork</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">wait</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">status</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exit</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">kill</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">mmap</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">prot</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getpid</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">sleep</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seconds</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">uptime</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>

<p class=" font-serif my-1">&#31995;&#32479;&#35843;&#29992;&#30340;&#34892;&#20026;&#22522;&#26412;&#36981;&#24490; Linux &#31995;&#32479;&#35843;&#29992;&#65292;&#25105;&#20204;&#20250;&#22312;&#20043;&#21518;&#36827;&#34892;&#34917;&#20805;&#35828;&#26126;&#12290;</p>
<h3 id="22-uproc" class=" text-lg mt-2 pb-2 font-sans">2.2 &#29992;&#25143;&#36827;&#31243; (uproc) &#27169;&#22359;</h3>
<h4 id="221-init-" class=" pt-2 pb-2 font-sans">2.2.1 init - &#27169;&#22359;&#21021;&#22987;&#21270;</h4>
<p class=" font-serif my-1">&#23436;&#25104;&#24517;&#35201;&#30340;&#21021;&#22987;&#21270;&#12290;&#20320;&#38656;&#35201;&#25163;&#21160;&#22312;&#20320;&#30340; <code>os-&gt;init</code> &#20013;&#35843;&#29992;&#23427;&#12290;</p>
<p class=" font-serif my-1">&#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#65292;&#26412;&#23454;&#39564;&#38656;&#35201; AbstractMachine &#30340; VME (VM Extension)&#65292;VME &#21021;&#22987;&#21270; (<code>vme_init</code>) &#26102;&#38656;&#35201;&#39029;&#38754;&#20998;&#37197;&#21644;&#22238;&#25910;&#30340;&#20989;&#25968;&#65292;&#24182;&#19988;&#20250;&#31435;&#21363;&#23601;&#22320;&#35843;&#29992;&#12290;&#35831;&#20320;&#30830;&#22312;&#36866;&#24403;&#30340;&#22320;&#26041;&#23436;&#25104; VME &#30340;&#21021;&#22987;&#21270;&#65292;&#20363;&#22914;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="n">vme_init</span><span class="p">(</span><span class="n">pmm</span><span class="o">-&gt;</span><span class="n">alloc</span><span class="p">,</span><span class="w"> </span><span class="n">pmm</span><span class="o">-&gt;</span><span class="n">free</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#36825;&#20010;&#21021;&#22987;&#21270;&#21487;&#20197;&#22312; <code>uproc-&gt;init</code> &#20013;&#23436;&#25104;&#12290;</p>
<h4 id="222-kputc-" class=" pt-2 pb-2 font-sans">2.2.2 kputc - &#25171;&#21360;&#35843;&#35797;&#23383;&#31526;</h4>
<p class=" font-serif my-1">&#36825;&#26159;&#26368;&#31616;&#21333;&#30340;&#31995;&#32479;&#35843;&#29992;&#65292;&#21487;&#20197;&#22312;&#20869;&#26680;&#25171;&#21360;&#20986;&#19968;&#20010;&#29992;&#25143;&#24577;&#25968;&#25454;&#12290;&#22312;&#27492;&#22522;&#30784;&#19978;&#65292;&#20320;&#21487;&#20197;&#23454;&#29616; printf &#26356;&#22909;&#22320;&#35266;&#23519;&#29992;&#25143;&#31243;&#24207;&#21644;&#20869;&#26680;&#20043;&#38388;&#30340;&#20132;&#20114;&#12290;&#34429;&#28982;&#36825;&#20010;&#31995;&#32479;&#35843;&#29992;&#20250;&#22312;&#19979;&#19968;&#20010;&#23454;&#39564;&#34987; write &#21462;&#20195;&#65292;&#20294;&#19968;&#20010; &#8220;&#23454;&#29616;&#26368;&#31616;&#21333;&#8221; &#30340;&#31995;&#32479;&#23545;&#22823;&#23478;&#26159;&#33267;&#20851;&#37325;&#35201;&#30340;&#12290;&#25105;&#20204;&#29978;&#33267;&#21487;&#20197;&#30452;&#25509;&#32473;&#20986;&#23427;&#30340;&#21442;&#32771;&#23454;&#29616;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">kputc</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">putch</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"> </span><span class="c1">// safe for qemu even if not lock-protected</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="223-getpid-" class=" pt-2 pb-2 font-sans">2.2.3 getpid - &#33719;&#24471;&#36827;&#31243;&#21495;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">getpid</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#36820;&#22238;&#24403;&#21069;&#36827;&#31243;&#30340;&#36827;&#31243;&#21495;&#12290;&#36827;&#31243;&#21495;&#20174; 1 &#24320;&#22987;&#32534;&#21495;&#65292;&#19981;&#36229;&#36807; 32767&#12290;&#20320;&#38656;&#35201;&#20445;&#35777;&#33509;&#24178;&#36827;&#31243;&#21495;&#30456;&#20851;&#30340;&#22522;&#26412;&#24615;&#36136;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#20219;&#20309;&#36827;&#31243;&#20174;&#21019;&#24314;&#24320;&#22987;&#65292;&#36827;&#31243;&#21495;&#19981;&#20250;&#21464;&#21270;&#65292;&#21363;&#21516;&#19968;&#36827;&#31243;&#22810;&#27425;&#35843;&#29992; getpid &#20250;&#36820;&#22238;&#21516;&#19968;&#20010;&#25968;&#20540;&#12290;</li>
<li class=" ml-8">&#31995;&#32479;&#20013;&#27599;&#20010;&#36827;&#31243;&#37117;&#26377;&#19981;&#21516;&#30340;&#36827;&#31243;&#21495;&#12290;</li>
<li class=" ml-8">&#36827;&#31243;&#21495;&#22312;&#20998;&#37197;&#26102;&#65292;&#23613;&#37327;&#20570;&#21040;&#22312;&#25968;&#31186;&#30340;&#26102;&#38388;&#33539;&#22260;&#20869;&#19981;&#37325;&#22797;&#20351;&#29992;&#65292;&#36825;&#26159;&#20026;&#20102;&#38450;&#27490; kill &#26432;&#27515;&#26032;&#20998;&#37197;&#30340;&#36827;&#31243;&#12290;</li>
</ul>
<h4 id="224-sleep-" class=" pt-2 pb-2 font-sans">2.2.4 sleep - &#36827;&#31243;&#30561;&#30496;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">sleep</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seconds</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#23558;&#36827;&#31243;&#30561;&#30496; seconds &#31186;&#21518;&#20877;&#27425;&#21796;&#37266;&#8212;&#8212;&#23436;&#20840;&#20005;&#26684;&#26102;&#38388;&#30340;&#30561;&#30496;&#26159;&#20570;&#19981;&#21040;&#30340;&#65292;&#20320;&#21482;&#38656;&#35201;&#20445;&#35777;&#21796;&#37266;&#21069;&#21518;&#19981;&#23567;&#20110; seconds &#31186; (&#20801;&#35768;&#30053;&#22810;&#19968;&#20123;)&#12290;&#36827;&#31243;&#30561;&#30496;&#26102;&#19981;&#24212;&#21344;&#29992; CPU&#12290;</p>
<h4 id="225-uptime-" class=" pt-2 pb-2 font-sans">2.2.5 uptime - &#33719;&#24471;&#24320;&#26426;&#26102;&#38388;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int64_t</span><span class="w"> </span><span class="nf">uptime</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#36820;&#22238;&#24320;&#26426;&#26102;&#38388;&#30340;&#27627;&#31186;&#25968;&#65292;&#24212;&#29992;&#31243;&#24207;&#21487;&#20197;&#29992;&#27492;&#25968;&#20540;&#20316;&#20026;&#21442;&#32771;&#65292;&#21516;&#26679;&#19981;&#24517;&#23436;&#20840;&#31934;&#30830;&#12290;</p>
<h4 id="226-fork-" class=" pt-2 pb-2 font-sans">2.2.6 fork - &#21019;&#24314;&#36827;&#31243;&#21103;&#26412;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">fork</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#21019;&#24314;&#24403;&#21069;&#36827;&#31243; (&#29366;&#24577;&#26426;) &#30340;&#19968;&#20010;&#21103;&#26412;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#21019;&#24314;&#30340;&#36827;&#31243;&#20174;&#29992;&#25143;&#24577;&#25191;&#34892;&#30475;&#26469;&#27809;&#26377;&#20219;&#20309;&#21306;&#21035;&#65292;&#38500;&#20102; GPRx (rax) &#30340;&#36820;&#22238;&#20540;&#65306;&#29238;&#36827;&#31243;&#36820;&#22238;&#23376;&#36827;&#31243;&#36827;&#31243;&#21495;&#65292;&#23376;&#36827;&#31243;&#36820;&#22238; 0&#12290;</li>
<li class=" ml-8">&#20320;&#38656;&#35201;&#23454;&#29616; Copy-on-Write &#25165;&#33021;&#36890;&#36807;&#25152;&#26377;&#27979;&#35797;&#29992;&#20363;&#12290;<ul class=" list-disc font-serif">
<li class=" ml-8">&#20855;&#20307;&#26469;&#35828;&#65292;&#25105;&#20204;&#30340;&#27979;&#35797;&#29992;&#20363;&#21487;&#33021;&#20250; fork &#22810;&#20221;&#36827;&#31243;&#12290;&#22914;&#26524;&#20320;&#22312; fork &#26102;&#30452;&#25509;&#22797;&#21046;&#20840;&#37096;&#30340;&#22320;&#22336;&#31354;&#38388;&#65292;&#21487;&#33021;&#20250;&#38754;&#20020;&#20869;&#23384;&#19981;&#36275;&#12290;</li>
<li class=" ml-8">&#27491;&#30830;&#22320;&#20570;&#27861;&#26159;&#23558;&#34987;&#22797;&#21046;&#30340;&#22320;&#22336;&#31354;&#38388;&#26631;&#35760;&#20026;&#21482;&#35835;&#65292;&#24182;&#22312;&#21457;&#29983; page fault &#26102;&#20877;&#22797;&#21046;&#12290;&#20320;&#38656;&#35201;&#39029;&#38754;&#30340;&#24341;&#29992;&#35745;&#25968;&#20197;&#27491;&#30830;&#22788;&#29702;&#36830;&#32493;&#22810;&#20010; fork &#30340;&#24773;&#20917;&#12290;</li>
</ul>
</li>
</ul>
<h4 id="227-wait-" class=" pt-2 pb-2 font-sans">2.2.7 wait - &#31561;&#24453;&#23376;&#36827;&#31243;&#32467;&#26463;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">status</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#31561;&#24453;&#24403;&#21069;&#36827;&#31243;&#21019;&#24314;&#30340;&#26576;&#20010;&#30452;&#25509;&#23376;&#36827;&#31243; (&#23376;&#36827;&#31243; fork &#20135;&#29983;&#30340;&#23376;&#36827;&#31243;&#19981;&#22312;&#31561;&#24453;&#21015;&#34920;) &#32467;&#26463;&#12290;&#22914;&#26524;&#24403;&#21069;&#27809;&#26377;&#36816;&#34892;&#30340;&#23376;&#36827;&#31243;&#65292;&#36820;&#22238; -1&#65292;&#21542;&#21017;&#36820;&#22238; 0&#65292;&#24182;&#23558;&#23376;&#36827;&#31243; exit &#30340;&#36864;&#20986;&#20195;&#30721;&#20445;&#23384;&#21040; status &#25351;&#21521;&#30340;&#20301;&#32622;&#12290;</p>
<p class=" font-serif my-1">&#22312;&#23454;&#38469;&#30340;&#31995;&#32479;&#20013;&#65292;fork &#21644; wait &#24212;&#24403;&#26159;&#37197;&#23545;&#30340;&#8212;&#8212;&#21363;&#20415;&#23376;&#36827;&#31243;&#32467;&#26463;&#20102;&#65292;&#29238;&#36827;&#31243;&#20381;&#28982;&#21487;&#20197;&#30830;&#20445;&#33719;&#24471;&#23376;&#36827;&#31243;&#30340;&#36820;&#22238;&#20540;&#12290;&#20294;&#36825;&#23601;&#24102;&#26469;&#20102;&#19968;&#20010;&#40635;&#28902;&#65306;&#25805;&#20316;&#31995;&#32479;&#26080;&#27861;&#21306;&#20998;&#26159;&#29238;&#36827;&#31243;&#22240;&#20026; bug &#23548;&#33268;&#27704;&#36828;&#19981;&#20877;&#20250; wait&#65292;&#36824;&#26159;&#29238;&#36827;&#31243;&#26242;&#26102;&#36824;&#22312;&#25191;&#34892;&#20854;&#20182;&#36923;&#36753;&#65292;&#27809;&#26377;&#35843;&#29992; wait&#12290;&#36825;&#23601;&#26377;&#20102;&#26377;&#36259;&#30340; &#8220;&#20725;&#23608; (Zombie)&#8221; &#36827;&#31243;&#12290;&#20294;&#25105;&#20204;&#30340;&#23454;&#39564;&#20316;&#20986;&#20102;&#31616;&#21270;&#65306;&#22914;&#26524;&#24403;&#21069;&#27809;&#26377;&#36816;&#34892;&#30340;&#23376;&#36827;&#31243;&#65292;&#29238;&#36827;&#31243;&#30340; wait &#23558;&#36820;&#22238; -1&#65292;&#20063;&#19981;&#20877;&#33021;&#22815;&#33719;&#24471;&#36864;&#20986;&#36827;&#31243;&#30340;&#36820;&#22238;&#20540;&#12290;</p>
<h4 id="228-exit-" class=" pt-2 pb-2 font-sans">2.2.8 exit - &#32467;&#26463;&#24403;&#21069;&#36827;&#31243;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exit</span><span class="p">)(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#32467;&#26463;&#24403;&#21069;&#29366;&#24577;&#26426;&#30340;&#25191;&#34892;&#65292;&#24182;&#35760;&#24405;&#36820;&#22238;&#20540;&#20026; status&#12290;&#21442;&#32771; wait&#12290;</p>
<h4 id="229-kill-" class=" pt-2 pb-2 font-sans">2.2.9 kill - &#32467;&#26463;&#36827;&#31243;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#32467;&#26463;&#19968;&#20010;&#36827;&#31243;&#21495;&#20026; pid &#30340;&#36827;&#31243;&#12290;&#20320;&#21487;&#20197;&#20026;&#23427;&#25351;&#23450;&#20219;&#20309;&#36820;&#22238;&#20540;&#12290;</p>
<h4 id="2210-mmap-" class=" pt-2 pb-2 font-sans">2.2.10 mmap - &#20462;&#25913;&#36827;&#31243;&#22320;&#22336;&#31354;&#38388;</h4>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="n">task_t</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">prot</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>

<p class=" font-serif my-1">&#20462;&#25913;&#36827;&#31243;&#30340;&#22320;&#22336;&#31354;&#38388;&#65292;&#20026;&#20854;&#20998;&#37197;&#19968;&#20010;&#22320;&#22336;&#19981;&#23567;&#20110; addr&#12289;&#23545;&#20854;&#21040;&#39029;&#36793;&#30028; (protect &#36820;&#22238; AddrSpace &#20013;&#30340; pgsize)&#12289;&#22823;&#23567;&#19981;&#23567;&#20110; length &#30340;&#19968;&#27573;&#20869;&#23384;&#12290;flags (&#24050;&#23450;&#20041;&#22312;&#26694;&#26550;&#20195;&#30721;&#20013;)&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>MAP_SHARED</code> - &#22312; fork &#26102;&#65292;&#35813;&#20869;&#23384;&#22312;&#29238;&#23376;&#36827;&#31243;&#20043;&#38388;&#20849;&#20139;&#12290;</li>
<li class=" ml-8"><code>MAP_PRIVATE</code> - &#22312; fork &#26102;&#65292;&#35813;&#20869;&#23384;&#20250;&#34987;&#22797;&#21046;&#19968;&#20221; (&#23613;&#21487;&#33021;&#22320;&#23454;&#29616;&#25104; copy-on-write)&#12290;</li>
<li class=" ml-8"><code>MAP_UNMAP</code> - &#21024;&#38500;&#20174; addr &#24320;&#22987;&#12289;&#38271;&#24230;&#20026; length &#30340;&#26144;&#23556; (&#32780;&#19981;&#26159;&#20998;&#37197;)&#12290;&#27880;&#24847;&#21487;&#33021; unmap &#19968;&#27573;&#36830;&#32493;&#20869;&#23384;&#20013;&#30340;&#19968;&#23567;&#37096;&#20998;&#12290;&#20320;&#38656;&#35201;&#26816;&#26597;&#36827;&#31243;&#24182;&#27809;&#26377;&#25317;&#26377; addr &#24320;&#22987;&#38271;&#24230;&#20026; length &#30340;&#20869;&#23384;&#65292;&#22914;&#26524;&#27809;&#26377;&#65292;&#21017; mmap &#22833;&#36133;&#12290;</li>
</ul>
<p class=" font-serif my-1">prot &#26144;&#23556;&#26435;&#38480;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><code>PROT_READ</code> - &#21487;&#35835;&#12290;</li>
<li class=" ml-8"><code>PROT_WRITE</code> - &#21487;&#20889;&#12290;</li>
</ul>
<p class=" font-serif my-1">&#27880;&#24847;&#25105;&#20204;&#20801;&#35768; <code>PROT_READ | PROT_WRITE</code> &#36825;&#26679;&#30340;&#26435;&#38480;&#12290;</p>
<h3 id="23" class=" text-lg mt-2 pb-2 font-sans">2.3 &#29992;&#25143;&#36827;&#31243;&#20195;&#30721;</h3>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_2" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-red" style=" padding-bottom: 0;">&#9888;&#65039; &#20307;&#31995;&#32467;&#26500;</h4>
<p class=" font-serif my-1">&#30001;&#20110;&#28041;&#21450; Application Binary Interface&#65292;&#20174;&#20170;&#24448;&#21518;&#30340;&#23454;&#39564;&#20165;&#38656;&#35201;&#25903;&#25345; x86-64&#12290;&#24403;&#28982;&#65292;&#20320;&#20381;&#28982;&#22312;&#23454;&#29616;&#20195;&#30721;&#26102;&#24212;&#35813;&#23613;&#21487;&#33021;&#20445;&#25345;&#36328;&#20307;&#31995;&#26426;&#26500;&#30340;&#20860;&#23481;&#24615;&#12290;</p>
</blockquote>
<p class=" font-serif my-1">&#26694;&#26550;&#20195;&#30721;&#20013;&#26032;&#22686;&#20102;&#19968;&#20010; user &#30446;&#24405;&#12290;&#30446;&#21069;&#65292;&#23427;&#21487;&#20197;&#29983;&#25104;&#21807;&#19968;&#30340;&#12289;&#34987;&#21152;&#36733;&#21040;&#25805;&#20316;&#31995;&#32479;&#19978;&#30340;&#29992;&#25143;&#24577;&#24212;&#29992;&#31243;&#24207;&#12290;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>user/
&#9500;&#9472;&#9472; init.c
&#9500;&#9472;&#9472; Makefile
&#9500;&#9472;&#9472; trampoline.S
&#9492;&#9472;&#9472; ulib.h
</code></pre></div>

<p class=" font-serif my-1">&#25105;&#20204;&#20026;&#22823;&#23478;&#23454;&#29616;&#20102;&#19968;&#20010;&#26368;&#23567;&#30340; ulib&#65292;&#21253;&#25324;&#26412;&#27425;&#23454;&#39564;&#20013;&#25152;&#29992;&#30340;&#31995;&#32479;&#35843;&#29992;&#23553;&#35013;&#8212;&#8212;&#27880;&#24847; user &#21644; kernel &#20849;&#20139;&#20102; <code>syscall.h</code> &#21644; <code>user.h</code> &#22836;&#25991;&#20214;&#65292;&#20854;&#20013;&#21253;&#21547;&#20102;&#37325;&#35201;&#30340;&#23439;&#23450;&#20041;&#65292;&#20363;&#22914;&#31995;&#32479;&#35843;&#29992;&#30340;&#32534;&#21495;&#21644;&#31995;&#32479;&#35843;&#29992;&#20013;&#20351;&#29992;&#30340; flags &#20540;&#12290;</p>
<p class=" font-serif my-1">&#29992;&#25143;&#36827;&#31243;&#30340;&#32534;&#35793;&#30001;&#19977;&#37096;&#20998;&#32452;&#25104;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#32534;&#35793; .c &#21644; .S &#25991;&#20214;&#12290;&#27880;&#24847;&#21040;&#25105;&#20204;&#20351;&#29992;&#20102;&#21644; kernel &#31867;&#20284;&#30340;&#32534;&#35793;&#36873;&#39033;&#65292;&#20363;&#22914; <code>-mno-sse</code> &#19981;&#20351;&#29992;&#28014;&#28857;&#23492;&#23384;&#22120;&#12289;<code>-ffreestanding</code> &#21019;&#24314;&#19968;&#20010;&#38646;&#20381;&#36182;&#30340;&#36816;&#34892;&#29615;&#22659;&#31561;&#12290;&#20854;&#20013;&#65292;&#26368;&#37325;&#35201;&#30340;&#32534;&#35793;&#36873;&#39033;&#26159; <code>-fPIC</code>&#65292;&#20351;&#24471;&#25105;&#20204;&#32534;&#35793;&#20986;<red>&#20301;&#32622;&#26080;&#20851;&#20195;&#30721;</red>&#65292;&#23427;&#33021;&#22815;&#34987;&#21152;&#36733;&#21040;&#22320;&#22336;&#31354;&#38388;&#30340;&#20219;&#20309;&#20301;&#32622;&#12290;</li>
<li class=" ml-8">&#23558;&#25152;&#26377;&#30446;&#26631;&#25991;&#20214;&#38745;&#24577;&#38142;&#25509;&#65292;&#20854;&#20013;&#29992;&#21040;&#30340;&#32534;&#35793;&#36873;&#39033; (RTFM):<ul class=" list-disc font-serif">
<li class=" ml-8"><code>--omagic</code> &#23558;&#20195;&#30721;&#21644;&#25968;&#25454; &#8220;&#32465;&#22312;&#19968;&#36215;&#8221; &#20943;&#23569;&#25991;&#20214;&#30340;&#20307;&#31215;</li>
<li class=" ml-8"><code>--pic-executable</code> &#38142;&#25509;&#25104;&#20301;&#32622;&#26080;&#20851;&#30340;&#21487;&#25191;&#34892;&#25991;&#20214;</li>
<li class=" ml-8"><code>--no-dynamic-linker</code> &#38745;&#24577;&#38142;&#25509;&#25152;&#26377;&#31526;&#21495;</li>
</ul>
</li>
<li class=" ml-8">&#36890;&#36807; objcopy &#23558;&#20195;&#30721;&#12289;&#25968;&#25454;&#21644; bss &#32479;&#19968;&#25552;&#21462;&#20986;&#26469;&#65292;&#24471;&#21040;&#20108;&#36827;&#21046;&#25991;&#20214; <code>_init</code><ul class=" list-disc font-serif">
<li class=" ml-8"><code>_init</code> &#26159;&#21487;&#20197;&#30452;&#25509;&#25191;&#34892;&#30340;&#25351;&#20196;&#24207;&#21015;&#65292;&#20320;&#21487;&#20197;&#35797;&#30528;&#29992; <code>ndisasm -b 64</code> &#26597;&#30475;&#21453;&#27719;&#32534;&#65292;&#22836;&#37096;&#30340;&#20195;&#30721;&#21363;&#26159; trampoline.S &#20013;&#30340;&#20195;&#30721;</li>
</ul>
</li>
<li class=" ml-8">&#36890;&#36807; xxd &#29983;&#25104;&#19968;&#20010; C &#20195;&#30721;&#65292;&#24688;&#22909;&#26159; <code>_init</code> &#30340;&#25968;&#25454;&#65292;&#20363;&#22914;</li>
</ul>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">_init</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="mh">0xe8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span>
<span class="w">  </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcd</span><span class="p">,</span><span class="w"> </span><span class="mh">0x80</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span>
<span class="w">  </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc3</span>
<span class="p">};</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_init_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">27</span><span class="p">;</span>
</code></pre></div>

<p class=" font-serif my-1">&#36825;&#20010;&#25991;&#20214;&#23558;&#20250;&#34987;&#37325;&#23450;&#21521;&#21040; <code>kernel/src/initcode.inc</code>&#12290;&#26694;&#26550;&#20195;&#30721;&#20013;&#21253;&#21547;&#20102;&#23545;&#36825;&#20010;&#25991;&#20214;&#30340; &#8220;&#31896;&#36148;&#24341;&#29992;&#8221; (initcode.inc):</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;os.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;syscall.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">"initcode.inc"</span>

<span class="n">MODULE_DEF</span><span class="p">(</span><span class="n">uproc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">};</span>
</code></pre></div>

<p class=" font-serif my-1">&#36825;&#26679;&#65292;&#20320;&#30340;&#25805;&#20316;&#31995;&#32479;&#20195;&#30721;&#21487;&#20197;&#36890;&#36807; <code>_init</code> &#21464;&#37327;&#26469;&#33719;&#24471;&#29992;&#25143;&#24577;&#36827;&#31243;&#30340;&#20195;&#30721;&#12290;&#36825;&#20010;&#27969;&#31243;&#21644; xv6 &#21313;&#20998;&#31867;&#20284;&#65292;&#22914;&#26524;&#26377;&#19981;&#28165;&#26970;&#30340;&#22320;&#26041;&#65292;&#21487;&#20197;&#38405;&#35835; xv6 initcode &#30340;&#22788;&#29702;&#12290;</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_3" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-red" style=" padding-bottom: 0;">&#9888;&#65039; &#27880;&#24847;</h4>
<p class=" font-serif my-1">&#25105;&#20204;&#20250;&#22312; Online Judge &#27979;&#35797;&#26102;&#20351;&#29992;&#25105;&#20204;&#30340;&#20195;&#30721;&#12290;&#22240;&#27492;&#35831;&#19981;&#35201;&#20462;&#25913;&#36825;&#37096;&#20998;&#25991;&#20214;&#21517; (&#20363;&#22914; initcode.inc)&#12290;</p>
</blockquote>
<h3 id="24-application-binary-interface" class=" text-lg mt-2 pb-2 font-sans">2.4 Application Binary Interface</h3>
<p class=" font-serif my-1">&#25105;&#20204;&#20026;&#22823;&#23478;&#20934;&#22791;&#20102;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340; ABI&#65292;&#24110;&#21161;&#22823;&#23478;&#24555;&#36895;&#19978;&#25163;&#24212;&#29992;&#31243;&#24207;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">&#20108;&#36827;&#21046;&#25991;&#20214;&#30340;&#21152;&#36733;<ul class=" list-disc font-serif">
<li class=" ml-8">&#25105;&#20204;&#21482;&#38656;&#35201;&#25903;&#25345; init &#36825;&#19968;&#20010;&#20108;&#36827;&#21046;&#31243;&#24207;</li>
<li class=" ml-8">&#23427;&#21487;&#20197;&#34987;&#21152;&#36733;&#21040;&#20219;&#20309;&#22320;&#22336;&#31354;&#38388;&#21512;&#27861;&#30340;&#20301;&#32622; (&#25105;&#20204;&#24050;&#32463;&#32534;&#35793;&#25104;&#20102;&#20301;&#32622;&#26080;&#20851;&#20195;&#30721;)</li>
<li class=" ml-8">rsp &#38656;&#35201;&#34987;&#21021;&#22987;&#21270;&#20026;&#21487;&#29992;&#30340;&#22534;&#26632;&#65292;&#33267;&#23569;&#19968;&#20010;&#39029;&#38754;&#22823;&#23567; (&#39029;&#38754;&#30340;&#22823;&#23567;&#30001; <code>as-&gt;pgsize</code> &#25351;&#23450;)</li>
</ul>
</li>
<li class=" ml-8">&#31995;&#32479;&#35843;&#29992; ABI<ul class=" list-disc font-serif">
<li class=" ml-8">&#31995;&#32479;&#35843;&#29992;&#32534;&#21495;&#20445;&#23384;&#22312; GRPx (rax) &#20013;</li>
<li class=" ml-8">&#21442;&#25968;&#20445;&#23384;&#22312; GPR1 (rdi), GPR2 (rsi), GPR3 (rdx), GPR4 (rcx) &#20013;</li>
<li class=" ml-8">&#36890;&#36807; int \$0x80 &#25351;&#20196;&#23454;&#29616;&#31995;&#32479;&#35843;&#29992;</li>
<li class=" ml-8">&#31995;&#32479;&#35843;&#29992;&#36820;&#22238;&#20540;&#22312; GPRx (rax) &#20013;</li>
</ul>
</li>
</ul>
<h2 id="3" class=" text-xl mt-2 pb-2 font-sans">3. &#27491;&#30830;&#24615;&#26631;&#20934;</h2>
<p class=" font-serif my-1">Online Judge &#22312;&#27979;&#35797;&#26102;&#23558;&#20250;&#20351;&#29992;&#19968;&#20010;&#31245;&#24494;&#26377;&#20123;&#22823; (&#20294;&#19981;&#20250;&#36229;&#36807; 16KB) &#30340; init &#31243;&#24207;&#65292;&#24182;&#19988;&#26367;&#25442;&#21516;&#23398;&#20204;&#30340; initcode.inc &#32534;&#35793;&#65292;&#24182;&#26816;&#26597;&#31995;&#32479;&#35843;&#29992;&#30340;&#22522;&#26412;&#21151;&#33021;&#12290;&#30001;&#20110;&#20174;&#26412;&#23454;&#39564;&#24320;&#22987;&#20195;&#30721;&#37327;&#23601;&#36827;&#20837;&#19968;&#20010; &#8220;&#33192;&#32960;&#26399;&#8221;&#65292;&#22240;&#27492;&#27979;&#35797;&#30340;&#20005;&#33499;&#24615;&#20250;&#26377;&#25152;&#19979;&#38477;&#65292;&#31995;&#32479;&#35843;&#29992;&#33021;&#22522;&#26412;&#27491;&#24120;&#36816;&#36716;&#21363;&#21487;&#36890;&#36807;&#12290;&#20294;&#20173;&#28982;&#35831;&#21516;&#23398;&#20204;&#20570;&#22909;&#21387;&#21147;&#27979;&#35797;&#65292;&#20855;&#20307;&#27491;&#30830;&#24615;&#35201;&#27714;&#38500;&#23454;&#29616;&#19978;&#36848; API &#23545;&#24212;&#30340;&#21151;&#33021;&#22806;&#65292;&#36824;&#38656;&#35201;&#28385;&#36275;&#65306;</p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>uproc &#27169;&#22359;&#20013;&#30340;&#20989;&#25968;&#38656;&#35201;&#33258;&#34892;&#22312;&#31995;&#32479;&#35843;&#29992;&#22788;&#29702;&#26102;&#35843;</red>&#29992;&#12290;2.1 &#33410; uproc &#20013;&#30340;&#20989;&#25968;&#20026;&#22823;&#23478;&#25552;&#20379;&#20102;&#27491;&#30830;&#30340;&#31995;&#32479;&#35843;&#29992;&#20989;&#25968;&#22768;&#26126;&#12290;</li>
<li class=" ml-8"><red>&#31995;&#32479;&#35843;&#29992;&#25191;&#34892;&#26102;&#65292;&#19981;&#33021;&#20840;&#31243;&#20851;&#38381;&#20013;&#26029;</red>&#12290;&#22312;&#23454;&#38469;&#30340;&#31995;&#32479;&#20013;&#65292;&#31995;&#32479;&#35843;&#29992;&#30340;&#26102;&#38388;&#21487;&#33021;&#24456;&#38271;&#65292;&#32780;&#31995;&#32479;&#35843;&#29992;&#30340;&#25191;&#34892;&#23454;&#38469;&#26159; &#8220;&#23646;&#20110;&#8221; &#36827;&#31243;&#26412;&#36523;&#30340;&#8212;&#8212;&#20363;&#22914; time &#21629;&#20196;&#30340;&#36755;&#20986;&#20013;&#65292;user (&#29992;&#25143;&#24577;) &#21644; sys (&#20869;&#26680;&#24577;) &#30340;&#36816;&#34892;&#26102;&#38388;&#37117;&#34987;&#35745;&#20837;&#12290;&#31995;&#32479;&#35843;&#29992;&#22312;&#19981;&#25345;&#26377;&#33258;&#26059;&#38145;&#31561;&#20020;&#30028;&#36164;&#28304;&#26102;&#24212;&#24403;&#20801;&#35768;&#34987;&#20013;&#26029;&#12290;</li>
</ul>
<p class=" font-serif my-1">(TBD)</p>
<h2 id="4" class=" text-xl mt-2 pb-2 font-sans">4. &#23454;&#39564;&#25351;&#21335;</h2>
<p class=" font-serif my-1">(TBD)</p></div>
</div>

<div class="container text-xs py-3">
  <span class="text-muted">
    <center><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="../../../static/img/cc-4.0.png"></a>
    &#160;&#160;&#160;<a style="color:inherit" href="https://beian.miit.gov.cn/">&#33487; ICP &#22791; 2020049101 &#21495;</a>
    </center>
  </span>
</div>

</div>

<script src="../../../static/js/jquery.min.js"></script>

<script>
function get_token() {
  var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
  if (match) return match[2];
  else return "";
}
var token = get_token();
var hint = "token", box = $("#token-input");

if (token == "") { }
else { box.val(token); }

function login() {
  var token = box.val()
  if (!token) {
    document.cookie = ''
  } else {
    document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;'
  }
}
</script>


</body>

</html>