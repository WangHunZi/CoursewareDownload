<!DOCTYPE html><html class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../../static/katex/katex.min.css">
  <script defer src="../../static/katex/katex.min.js"></script>
  <script defer src="../../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // • rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<style>
.article {
  -webkit-hyphens: auto;
}
form {
  margin-block-end: 0;
}
img {
  display: inline-block;
}
code { font-size: 85%; }
pre {
  font-size: 95%;
  line-height: 120%;
}
blockquote {
  font-size: 95%;
}
p {
  font-size: 105%;
  text-indent: 2em;
}
li {
  font-size: 105%;
}
blockquote p {
  text-indent: 0em;
}
.float-right {
  padding-left: 10px;
}
.float-left {
  padding-right: 10px;
}
a {
  color: rgb(29 78 216);
}
strong {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.box        {
  border-radius: 2px; padding: 1px 4px 2px 4px;
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
  font-size: 95%;
}
.box-blue,  .badge-primary  { background-color: rgba(66, 139, 202, 0.5); color: #1d4ed8; }
.box-green, .badge-success  { background-color: rgba(92, 184, 92, 0.5);  color: #15803d; }
.box-red,   .badge-danger   { background-color: rgba(217, 83, 79, 0.5);  color: #b91c1c; }
.box-yellow,.badge-warning  { background-color: rgba(240, 173, 78, 0.5); color: #a16207; }
.box-gray   { background-color: #a0a0a0; }

.badge {
  padding: 1 4 1 4;
  display: inline-block;
  border-radius: 0.25rem;
  border: 1px solid;
}
.message p {
  text-indent: 0em;
  margin-top: 1px;
}
.message h1, h2, h3, h4, h5 {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.message h2 {
  font-size: 120%;
  margin-top: 5px;
  margin-bottom: 2px;
}
.message li {
  list-style: disc;
  margin-left: 2em;
}
li > p {
  text-indent: 0em;
}
block-quote h4 {
  float: left;
  display: inline-block;
}
.center {
  display: block;
  margin: auto;
}
hr {
  margin-top: 20px;
  padding-bottom: 20px;
}

.fa-gradient {
	background: -webkit-gradient(linear, left top, left bottom, from(rgb(99, 27, 103)), to(#333));
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
}

</style>


  <title>2022 操作系统期中测验</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div>

<div class="px-2 py-1 w-full fixed z-50 bg-gradient-to-r from-black via-purple-700 via-purple-500 shadow-lg" style="-webkit-backdrop-filter: saturate(150%) blur(4px); backdrop-filter: saturate(150%) blur(4px)">
  <form>
    <a href="../../index.html"><span class="text-lg px-2 text-white">Yanyan's Wiki</span></a>
    <a href="../2023/index.html"><span class="text-sm px-2 text-white">操作系统 (2023)</span></a>
    <input maxlength="9" id="token-input" class="float-right appearance-none border border-transparent px-2 py-1 w-20 bg-white text-gray-700 placeholder-gray-400 shadow-md rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent font-mono" type="text" placeholder="TOKEN" oninput="login();">
  </form>
</div>

<div class="article container mx-auto md:px-8 lg:px-8 xl:px-8 2xl:px-8 shadow-lg border pb-8 pt-10 max-w-screen-md text-justify divide-y-2 divide-white">
  <div><h1 id="2022" class=" text-2xl mt-2 font-sans">2022 操作系统期中测验</h1>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_1" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-red" style=" padding-bottom: 0;">⚠️ 学术诚信</h4>
<p class=" font-serif my-1"><strong>请自觉遵守学术诚信</strong></p>
<ul class=" list-disc font-serif">
<li class=" ml-8"><red>禁止与他人讨论、询问或透露任何与测验相关的信息。</red></li>
<li class=" ml-8"><red>请确保你交卷 (不再提交) 后再观看课程视频直播。</red></li>
<li class=" ml-8">简答题：<red>禁止查阅任何资料。</red></li>
<li class=" ml-8">编程题：<red>允许使用手册 (manpages, API references 等)；请主动避开自己先前编写的代码和教科书/课程网站上的示例代码等。</red></li>
</ul>
<p class=" font-serif my-1">期中测验分数由 Online Judge 给出。为了鼓励大家的诚信行为：</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">简答题提交成功获得 45% 分数，提交正确获得额外 5%</li>
<li class=" ml-8">编程题提交成功获得 45% 分数，提交正确获得额外 5%</li>
<li class=" ml-8">请不要为 1 分的总评 (折合小于 < 0.002 GPA) 出卖自己的灵魂</li>
</ul>
</blockquote>
<hr>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_2" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-red" style=" padding-bottom: 0;">⚠️ 提交时间</h4>
<p class=" font-serif my-1"><strong>测验时间：10:10 - 12:00</strong> (服务器已经完成时间同步；以此时间段内收到的提交为准)</p>
<p class=" font-serif my-1"><strong>注意 Online Judge 30 分钟内只能提交 3 次</strong>；以得分高的为准。请大家在本地完成好测试和检查；请不要面向 Online Judge 编程。</p>
</blockquote>
<p class=" font-serif my-1"><oj-status course="OS2022" module="Midterm"><div class="divide-y divide-dashed">
    <div class="flex font-semibold">
      OS2022-Midterm 提交结果
    </div>
    
  </div>
</oj-status></p>
<h2 id="1" class=" text-xl mt-2 pb-2 font-sans">1. 简答题</h2>
<p class=" font-serif my-1">现有如下代码：</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">do_sum</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="cm">/* 1 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="cm">/* 2 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cm">/* 3 */</span><span class="w">  </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="cm">/* 4 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="cm">/* 5 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cm">/* 6 */</span><span class="w">  </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="cm">/* 7 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="cm">/* 8 */</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cm">/* 9 */</span><span class="w">  </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">有两个线程 <code>T1</code> 和 <code>T2</code> 均执行 <code>do_sum</code> 代码 (共享 <code>sum</code> 变量)。假设线程每次按 1, 2, 3, ... 9 顺序执行一条语句，且读/写会立即在共享内存中生效。例如，若两个线程以如下顺序执行语句，即相当于 <code>T1</code> 执行完后再执行 <code>T2</code>：</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>T1.1 T1.2 T1.3 T1.4 T1.5 T1.6 T1.7 T1.8 T1.9
T2.1 T2.2 T2.3 T2.4 T2.5 T2.6 T2.7 T2.8 T2.9
</code></pre></div>

<p class=" font-serif my-1">将得到 <code>sum = 6</code> (但这显然不是最小值)。你需要给出使 <code>sum</code> 最小化的一个线程执行顺序 (<code>T1</code> 和 <code>T2</code> 可以交错执行)。</p>
<h2 id="2" class=" text-xl mt-2 pb-2 font-sans">2. 编程题</h2>
<p class=" font-serif my-1">假设我们需要对很多 $x$ ($x > 0$) 计算 $f(x)$ 的和。每个 $f(x)$ 都可能会计算较长的时间。你需要在 <a href="../../pages/OS/2022/demos/thread.h" class=" text-amber-900">thread.h</a> 和 <a href="../../pages/OS/2022/demos/thread-sync.h" class=" text-amber-900">thread-sync.h</a> (Online Judge 会使用此实现) 的基础上实现不少于 4 个 worker 线程的并行处理：</p>
<ul class=" list-disc font-serif">
<li class=" ml-8">所有待处理的 $x$ 都是 <code>int</code> 类型，从标准输入 (stdin) 读入直到输入结束</li>
<li class=" ml-8">对每一个整数 $x$，都调用来自外部的 <code>long f(int x);</code> 计算，这个函数是线程安全的</li>
<li class=" ml-8">你的程序需要输出所有 <code>f(x)</code> 的和 (保证和不超过 <code>long</code> 的范围)，并正常终止</li>
<li class=" ml-8">你需要尽快处理来自 stdin 的输入 (读入以后统一处理将导致 Time Limit Exceeded)</li>
<li class=" ml-8">个别的 <code>f(x)</code> 可能会消耗较长的时间，请确保此时在有待计算的 $x$ 时其他线程不会被闲置</li>
</ul>
<p class=" font-serif my-1">注意：编程时请自觉仅使用手册，不要参考已有的代码或教科书等材料。</p>
<h2 id="3" class=" text-xl mt-2 pb-2 font-sans">3. 提交方法</h2>
<p class=" font-serif my-1">首先，将编程题和简答题的答案保存在<red>一个 .c 文件</red>中，其中简答题的答案 (线程执行顺序) 写在 <code>/* */</code> 中，<code>TX.X</code> 之间可以任意空格/换行分割，<a href="../../pages/OS/2022/demos/midterm-example.c" class=" text-amber-900">midterm-example.c</a> 是一个 Online Judge 可以接收但无法得到满分的示例代码。注意Online Judge 将以文本中首次出现的 <code>/* */</code> 为准。评测环境为 x86-64。</p>
<p class=" font-serif my-1">通过命令行提交 (<red>刷新本页面查看评测结果</red>)：</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code>$ curl http://jyywiki.cn/upload -F course=OS2022 -F module=Midterm \
  -F token=你的TOKEN -F file=@你要提交的.c文件路径
</code></pre></div></div>
</div>

<div class="container text-xs py-3">
  <span class="text-muted">
    <center><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="../../static/img/cc-4.0.png"></a>
       <a style="color:inherit" href="https://beian.miit.gov.cn/">苏 ICP 备 2020049101 号</a>
    </center>
  </span>
</div>

</div>

<script src="../../static/js/jquery.min.js"></script>

<script>
function get_token() {
  var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
  if (match) return match[2];
  else return "";
}
var token = get_token();
var hint = "token", box = $("#token-input");

if (token == "") { }
else { box.val(token); }

function login() {
  var token = box.val()
  if (!token) {
    document.cookie = ''
  } else {
    document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;'
  }
}
</script>


</body>

</html>