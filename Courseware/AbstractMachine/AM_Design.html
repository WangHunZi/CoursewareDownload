<!DOCTYPE html><html class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../static/css/base.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="../static/img/favicon.png" type="image/x-icon">

  <style>
    .font-sans {
      font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
    }
    .font-serif {
      font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
    }
  </style>
  <link rel="stylesheet" href="../static/katex/katex.min.css">
  <script defer src="../static/katex/katex.min.js"></script>
  <script defer src="../static/katex/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // &#8226; auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // &#8226; rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>


  

<style>
.article {
  -webkit-hyphens: auto;
}
form {
  margin-block-end: 0;
}
img {
  display: inline-block;
}
code { font-size: 85%; }
pre {
  font-size: 95%;
  line-height: 120%;
}
blockquote {
  font-size: 95%;
}
p {
  font-size: 105%;
  text-indent: 2em;
}
li {
  font-size: 105%;
}
blockquote p {
  text-indent: 0em;
}
.float-right {
  padding-left: 10px;
}
.float-left {
  padding-right: 10px;
}
a {
  color: rgb(29 78 216);
}
strong {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.box        {
  border-radius: 2px; padding: 1px 4px 2px 4px;
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
  font-size: 95%;
}
.box-blue,  .badge-primary  { background-color: rgba(66, 139, 202, 0.5); color: #1d4ed8; }
.box-green, .badge-success  { background-color: rgba(92, 184, 92, 0.5);  color: #15803d; }
.box-red,   .badge-danger   { background-color: rgba(217, 83, 79, 0.5);  color: #b91c1c; }
.box-yellow,.badge-warning  { background-color: rgba(240, 173, 78, 0.5); color: #a16207; }
.box-gray   { background-color: #a0a0a0; }

.badge {
  padding: 1 4 1 4;
  display: inline-block;
  border-radius: 0.25rem;
  border: 1px solid;
}
.message p {
  text-indent: 0em;
  margin-top: 1px;
}
.message h1, h2, h3, h4, h5 {
  font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
}
.message h2 {
  font-size: 120%;
  margin-top: 5px;
  margin-bottom: 2px;
}
.message li {
  list-style: disc;
  margin-left: 2em;
}
li > p {
  text-indent: 0em;
}
block-quote h4 {
  float: left;
  display: inline-block;
}
.center {
  display: block;
  margin: auto;
}
hr {
  margin-top: 20px;
  padding-bottom: 20px;
}

.fa-gradient {
	background: -webkit-gradient(linear, left top, left bottom, from(rgb(99, 27, 103)), to(#333));
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
}

</style>


  <title>AbstractMachine &#35774;&#35745;&#27010;&#36848;</title>
</head>

<body class="d-flex flex-column h-100">
  
  

<div>

<div class="px-2 py-1 w-full fixed z-50 bg-gradient-to-r from-black via-purple-700 via-purple-500 shadow-lg" style="-webkit-backdrop-filter: saturate(150%) blur(4px); backdrop-filter: saturate(150%) blur(4px)">
  <form>
    <a href="../index.html"><span class="text-lg px-2 text-white">Yanyan's Wiki</span></a>
    <a href="../OS/2023/index.html"><span class="text-sm px-2 text-white">&#25805;&#20316;&#31995;&#32479; (2023)</span></a>
    <input maxlength="9" id="token-input" class="float-right appearance-none border border-transparent px-2 py-1 w-20 bg-white text-gray-700 placeholder-gray-400 shadow-md rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent font-mono" type="text" placeholder="TOKEN" oninput="login();">
  </form>
</div>

<div class="article container mx-auto md:px-8 lg:px-8 xl:px-8 2xl:px-8 shadow-lg border pb-8 pt-10 max-w-screen-md text-justify divide-y-2 divide-white">
  <div><h1 id="abstractmachine" class=" text-2xl mt-2 font-sans">AbstractMachine &#35774;&#35745;&#27010;&#36848;</h1>
<p class=" font-serif my-1">AbstractMachine &#30340;&#35774;&#35745;&#30446;&#26631;&#26159;&#33021; &#8220;&#23481;&#26131;&#22320;&#8221; &#23454;&#29616;&#21508;&#31867;&#31995;&#32479;&#36719;&#20214; (&#30452;&#25509;&#38656;&#27714;&#26159;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;)&#12290;&#19968;&#20010;&#22909;&#30340;&#26426;&#21046;&#19981;&#20165;&#24212;&#24403;&#36275;&#22815;&#31616;&#21333;&#12289;&#20581;&#22766;&#65292;&#36824;&#24212;&#35813;&#33021;&#39640;&#25928;&#22320;&#25903;&#25345;&#21508;&#31181;&#31574;&#30053;&#30340;&#23454;&#29616;&#12290;&#28982;&#32780;&#19990;&#30028;&#24182;&#19981;&#26159;&#32477;&#23545;&#23436;&#32654;&#30340;&#65306;&#25903;&#25345;&#20840;&#38754;&#30340;&#25277;&#35937;&#23618;&#19981;&#21487;&#36991;&#20813;&#20250;&#30456;&#23545;&#24222;&#22823;&#65307;&#32780;&#31934;&#31616;&#30340;&#25277;&#35937;&#23618;&#21017;&#21487;&#33021;&#26080;&#27861;&#23454;&#29616;&#26576;&#20123;&#31574;&#30053;&#65292;&#25110;&#26159;&#24615;&#33021;&#36739;&#20302;&#12290;AbstractMachine (&#25351;&#20196;&#38598;&#20307;&#31995;&#32467;&#26500;&#21644;&#25805;&#20316;&#31995;&#32479;&#20043;&#38388;&#30340;&#25277;&#35937;&#23618;) &#20316;&#20026; &#8220;&#32473;&#21516;&#23398;&#20204;&#35774;&#35745;&#30340;&#31532;&#19968;&#20010;&#31995;&#32479;&#8221;&#65292;&#25105;&#20204;&#25152;&#20570;&#30340;&#21462;&#33293;&#26159;&#20351;&#23427;&#23613;&#21487;&#33021; &#8220;&#23481;&#26131;&#34987;&#29702;&#35299;&#8221;&#65292;&#19981;&#24796;&#22312;&#26576;&#20123;&#26102;&#20505;&#36807;&#24230;&#31616;&#21270;&#25110;&#25439;&#22833;&#24615;&#33021;&#12290;</p>
<h2 id="1" class=" text-xl mt-2 pb-2 font-sans">1. &#23454;&#29616; &#8220;&#35745;&#31639;&#26426;&#36719;&#20214;&#26632;&#8221; &#38754;&#20020;&#30340;&#22256;&#38590;</h2>
<p class=" font-serif my-1">&#8220;&#20889;&#19968;&#20010;&#25805;&#20316;&#31995;&#32479;&#8221; &#23545;&#20110;&#35745;&#31639;&#26426;&#19987;&#19994;&#30340;&#21516;&#23398;&#20204;&#26469;&#35828;&#26080;&#30097;&#26159;&#19968;&#20214;&#21548;&#36215;&#26469;&#24456;&#37239;&#30340;&#20107;&#8212;&#8212;&#24403;&#28982;&#65292;&#36825;&#31181;&#26032;&#40092;&#24863;&#24456;&#22823;&#31243;&#24230;&#26469;&#28304;&#20110;&#21508;&#31181;&#20851;&#20110; &#8220;&#25805;&#20316;&#31995;&#32479;&#8221; &#30340;&#20256;&#35828;&#65292;&#27604;&#22914;&#35201;&#25026;&#27719;&#32534;&#21644;&#31995;&#32479;&#25351;&#20196;&#12289;&#24456;&#22797;&#26434;&#8230;&#8230;&#20294;&#36825;&#20123;&#20854;&#23454;&#37117;&#26159;&#23545;&#25805;&#20316;&#31995;&#32479;&#30340;<strong>&#35875;&#20256;</strong>&#8212;&#8212;&#8220;&#25805;&#20316;&#31995;&#32479;&#19981;&#36807;&#23601;&#26159;&#19968;&#20010; C &#31243;&#24207;&#8221;&#12290;</p>
<p class=" font-serif my-1">&#23398;&#36807;&#12298;&#35745;&#31639;&#26426;&#31995;&#32479;&#22522;&#30784;&#12299;&#30340;&#21516;&#23398;&#20063;&#35768;&#20250;&#24515;&#19968;&#31505;&#65292;&#20294;&#22823;&#23478;&#22810;&#22810;&#23569;&#23569;&#23545;&#36825;&#21477;&#35805;&#36824;&#26159;&#24863;&#21040;&#26377;&#20123; &#8220;&#24515;&#34394;&#8221;&#12290;&#30828;&#20214;&#21644;&#36719;&#20214;&#20043;&#38388;&#26377;&#19968;&#20123;&#36798;&#25104;&#40664;&#22865;&#30340;&#32422;&#23450;&#65306;&#26377;&#20123;&#23384;&#20648;&#22120; (ROM) &#33021;&#30452;&#25509;&#20197;&#20869;&#23384;&#26144;&#23556;&#30340;&#26041;&#24335;&#34987;&#22788;&#29702;&#22120;&#35775;&#38382;&#65307;&#22240;&#27492; CPU Reset &#20043;&#21518;&#65292;&#21482;&#35201;&#23558; PC &#25351;&#38024;&#35774;&#32622;&#25104;&#26576;&#20010;&#22266;&#23450;&#30340;&#20301;&#32622;&#21363;&#21487;&#12290;ROM &#20013;&#30340;&#20195;&#30721; (firmware&#65292;&#21378;&#21830;&#32534;&#20889;) &#20250;&#21152;&#36733;&#23384;&#20648;&#35774;&#22791;&#19978;&#30340;&#31243;&#24207;&#65292;&#20934;&#22791;&#22909; &#8220;C &#31243;&#24207;&#30340;&#36816;&#34892;&#29615;&#22659;&#8221;&#65292;&#24182;&#36339;&#36716;&#21040; <code>main</code> &#20989;&#25968;&#25191;&#34892;&#12290;</p>
<p class=" font-serif my-1">&#20294;&#27492;&#26102;&#65292;&#22788;&#29702;&#22120;&#27604; RESET &#21518;&#30340; &#8220;&#21407;&#22987;&#8221; &#29366;&#24577;&#24182;&#27809;&#26377;&#22909;&#22810;&#23569;&#12290;&#22312;&#25191;&#34892;&#12298;&#25805;&#20316;&#31995;&#32479;&#12299;&#25945;&#31185;&#20070;&#19978;&#25551;&#36848;&#30340;&#37027;&#20123;&#20107;&#24773; (&#20363;&#22914;&#21019;&#24314;&#31532;&#19968;&#20010;&#36827;&#31243;) &#20043;&#21069;&#65292;&#36824;&#26377;&#28023;&#37327;&#30340;&#21021;&#22987;&#21270;&#24037;&#20316;&#31561;&#30528;&#20320;&#65306;GDT, APIC, IDT, TSS, &#21021;&#22987;&#39029;&#34920;&#8230;&#8230;&#19981;&#21516;&#20307;&#31995;&#32467;&#26500;&#22823;&#21516;&#23567;&#24322;&#65292;&#20320;&#20250;&#30475;&#21040;&#24456;&#22810;&#22855;&#24618;&#23545;&#31995;&#32479;&#23492;&#23384;&#22120;&#30340;&#35774;&#32622;&#65292;&#32780;&#25630;&#25026;&#23427;&#20204;&#30340;&#21807;&#19968;&#26041;&#24335;&#23601;&#26159; RTFM&#12290;</p>
<p class=" font-serif my-1">&#22240;&#27492;&#24456;&#22810;&#21516;&#23398;&#38405;&#35835;&#32593;&#19978;&#25945;&#31243; (&#21644; XXX &#33258;&#21046;&#25805;&#20316;&#31995;&#32479;&#20070;) &#30340;&#26102;&#20505;&#65292;&#22797;&#26434;&#30340;&#27010;&#24565;&#23618;&#20986;&#19981;&#31351;&#65292;&#24324;&#20102;&#21322;&#22825;&#25165;&#25171;&#21360;&#20010; Hello World&#12290;&#36825;&#19968;&#22256;&#38590;&#30340;&#30452;&#25509;&#21407;&#22240;&#26159;&#22823;&#23478;&#23545;&#30828;&#20214;&#30340;&#35268;&#32422;&#24182;&#19981;&#29087;&#24713;&#65292;&#32780;&#19988;&#23398;&#20064;&#23427;&#20204;&#30340;&#21807;&#19968;&#36884;&#24452;&#23601;&#26159; RTFM&#65292;&#24324;&#38169;&#19968;&#20010; bit &#19981;&#20877;&#26159; Segmentation Fault&#65292;&#32780;&#26159;&#23548;&#33268; &#8220;&#20160;&#20040;&#37117;&#27809;&#21457;&#29983;&#8221; &#21040;&#27169;&#25311;&#22120;&#30452;&#25509;&#23849;&#28291;&#65292;&#26085;&#24535;&#20449;&#24687;&#36824;&#23569;&#24471;&#21487;&#24604;&#12290;&#20570;&#36807;&#12298;&#35745;&#31639;&#26426;&#31995;&#32479;&#22522;&#30784;&#12299;&#23454;&#39564;&#30340;&#21516;&#23398;&#20204;&#20063;&#19968;&#23450;&#26377;&#36807;&#22240;&#20026;&#30475;&#25163;&#20876;&#19981;&#20180;&#32454;&#23548;&#33268;&#35843;&#35797;&#33267;&#27515;&#30340;&#24841;&#24555;&#20307;&#39564;&#12290;</p>
<h2 id="2" class=" text-xl mt-2 pb-2 font-sans">2. &#25105;&#20204;&#38656;&#35201;&#20160;&#20040;&#65311;</h2>
<p class=" font-serif my-1">&#34429;&#28982;&#25805;&#20316;&#31995;&#32479;&#25945;&#31185;&#20070;&#19978;&#19968;&#30452;&#24378;&#35843; &#8220;<strong>&#26426;&#21046;&#19982;&#31574;&#30053;&#20998;&#31163;</strong>&#8221;&#65292;&#20294;&#22312; &#8220;&#20889;&#20010;&#25805;&#20316;&#31995;&#32479;&#8221; &#26041;&#38754;&#65292;&#26426;&#21046;&#21644;&#31574;&#30053;&#21364;&#27809;&#26377;&#24456;&#22909;&#22320;&#34987;&#20998;&#24320;&#12290;&#20027;&#27969;&#30340;&#25945;&#31243;&#23545;&#30528;&#19968;&#20010;&#20855;&#20307;&#30340;&#30828;&#20214; (x86, MIPS, RISC-V) &#33258;&#24213;&#21521;&#19978;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#65307;&#22909;&#22788;&#26159;&#36164;&#26009;&#35814;&#23454;&#65292;&#32570;&#28857;&#26159;&#20307;&#31995;&#32467;&#26500;&#22826;&#36807;&#22797;&#26434;&#65292;&#23588;&#20854;&#26159; x86-64 (2021 &#24180;&#20102;&#65292;&#36824;&#26377;&#22826;&#22810;&#20070;&#36824;&#22312;&#35762; i386&#8230;&#8230;)&#12290;</p>
<p class=" font-serif my-1">&#26356;&#40635;&#28902;&#30340;&#26159;&#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#20026;&#22810;&#20010;&#30828;&#20214;&#24179;&#21488;&#20889;&#25805;&#20316;&#31995;&#32479;&#65292;&#25105;&#20204;&#36824;&#38656;&#35201;<strong>&#25226;&#31867;&#20284;&#30340;&#20107;&#20026;&#19981;&#21516;&#30828;&#20214;&#37325;&#22797;&#33509;&#24178;&#27425;</strong>&#12290;&#25351;&#20196;&#38598;&#26159;&#30828;&#20214;&#35774;&#35745;&#32773;&#20860;&#39038;&#19978;&#23618;&#36719;&#20214;&#38656;&#27714;&#21644;&#29289;&#29702;&#30828;&#20214;&#23454;&#29616;&#38590;&#24230;&#26102;&#20570;&#20986;&#21508;&#31181;&#26435;&#34913;&#24471;&#26469;&#30340;&#65292;&#26377;&#26102;&#36824;&#32972;&#30528;&#21382;&#21490;&#30340;&#21253;&#34993;&#12290;&#22914;&#26524;&#20307;&#31995;&#32467;&#26500;&#35838;&#25945;&#25105;&#20204;&#23454;&#29616;&#20102;&#19968;&#20010; MIPS32 &#25110; RISC-V32 &#30340; CPU&#12290;&#25105;&#24819;&#25226;&#25805;&#20316;&#31995;&#32479;&#35838;&#19978;&#30340;&#36855;&#20320;&#25805;&#20316;&#31995;&#32479;&#31227;&#26893;&#21040;&#33258;&#24049;&#30340; CPU &#19978;&#8230;&#8230;&#21516;&#26679;&#30340;&#40635;&#28902;&#35201;&#20877;&#32463;&#21382;&#19968;&#27425;&#12290;&#24050;&#32463;&#22312; x86-64 &#19978;&#27515;&#36807;&#19968;&#27425;&#20102;&#65292;&#36824;&#35201;&#20877;&#22312; MIPS32 &#19978;&#27515;&#19968;&#27425;&#21527;&#65311;</p>
<p class=" font-serif my-1">&#30828;&#20214;&#25277;&#35937;&#23618;&#19968;&#30452;&#20197;&#26469;&#37117;&#26159;&#35299;&#20915;&#36825;&#19968;&#38382;&#39064;&#30340;&#21150;&#27861;&#12290;&#19990;&#30028;&#19978;&#23384;&#22312;&#24456;&#22810;&#28418;&#20142;&#30340;&#30828;&#20214;&#25277;&#35937;&#23618;&#65292;&#20363;&#22914; Linux &#20869;&#26680;&#12289;seL4 &#31561;&#31561;&#12290;&#27809;&#38169;&#65292;<strong>x86 &#30340;&#30830;&#25552;&#20379;&#20102;&#36275;&#22815;&#30340;&#26426;&#21046;&#29992;&#26469;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#65292;&#20294;&#36825;&#19981;&#20195;&#34920;&#25105;&#20204;&#38656;&#35201;&#22312;&#23427;&#19978;&#38754;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;</strong>&#12290;&#33021;&#22815;&#24110;&#21161; C &#20195;&#30721;&#35775;&#38382;&#30828;&#20214;&#25552;&#20379;&#30340;&#12289;&#29992;&#20110;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#30340; &#8220;&#26368;&#23567;&#8221; &#26426;&#21046;&#65292;&#23601;&#26159; AbstractMachine&#12290;</p>
<h2 id="3" class=" text-xl mt-2 pb-2 font-sans">3. &#30828;&#20214;&#20026;&#36719;&#20214;&#25552;&#20379;&#30340;&#26426;&#21046;</h2>
<p class=" font-serif my-1">&#23454;&#38469;&#19978;&#65292;&#25105;&#20204;&#22312;&#35838;&#22530;&#19978;&#24050;&#32463;&#22312;&#19968;&#23450;&#31243;&#24230;&#32473;&#20986;&#19978;&#38754;&#38382;&#39064;&#30340;&#31572;&#26696;&#65306;&#31243;&#24207; = &#25805;&#20316;&#31995;&#32479; = &#30828;&#20214; = &#29366;&#24577;&#26426;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#38656;&#35201;&#30340;&#21482;&#26159;&#23545;&#29366;&#24577;&#26426;&#20316;&#20986;&#36866;&#24403;&#30340;&#25277;&#35937;&#65292;&#20351;&#24471;&#25105;&#20204;&#21487;&#20197;&#26356;&#28789;&#27963;&#22320;&#31649;&#29702;&#29366;&#24577;&#26426;&#30340;&#25191;&#34892;&#12289;&#21644;&#35774;&#22791;&#30340;&#20132;&#20114;&#65292;&#20197;&#21450;&#22810;&#20010;&#25191;&#34892;&#27969;&#12290;</p>
<p class=" font-serif my-1"><img alt="" class="center" src="../pages/OS/img/am-arch.jpg" width="100%"></p>
<h3 id="31" class=" text-lg mt-2 pb-2 font-sans">3.1. &#19968;&#21488;&#26368;&#23567;&#30340; &#8220;&#35745;&#31639;&#26426;&#8221;</h3>
<p class=" font-serif my-1">&#39318;&#20808;&#65292;&#30828;&#20214;&#21644;&#36719;&#20214; (&#21253;&#25324;&#22266;&#20214;) &#20043;&#38388;&#24517;&#39035;&#23384;&#22312;&#26576;&#31181;&#32422;&#23450;&#65292;&#20351;&#24471;&#25105;&#20204;&#31995;&#32479; RESET &#21518;&#33021;&#35774;&#32622;&#22909;&#20195;&#30721; (&#20855;&#20307;&#26159;&#19968;&#20010;&#27809;&#26377;&#26631;&#20934;&#24211; C &#31243;&#24207;&#65292;&#24403;&#28982;&#20063;&#21487;&#20197;&#26159; C++/Rust/...) &#30340;&#36816;&#34892;&#29615;&#22659;&#65292;&#20854;&#20013;&#26377;&#26632;&#21306;&#12289;&#38745;&#24577;&#25968;&#25454;&#12289;&#22534;&#21306; (<code>heap</code>)&#65307;&#20195;&#30721;&#20174; main &#20989;&#25968;&#24320;&#22987;&#25191;&#34892;&#12290;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// &#27809;&#26377; API&#65292;&#38500;&#20102;&#35745;&#31639;&#65292;&#20160;&#20040;&#20063;&#20570;&#19981;&#20102;</span>
<span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">&#38500;&#27492;&#20043;&#22806;&#65292;&#22914;&#26524;&#36719;&#20214;&#21482;&#26159; &#8220;&#32431;&#31929;&#8221; &#30340; C &#35821;&#35328;&#65292;&#37027;&#20040;&#23427;&#38500;&#20102;&#25226;&#20869;&#23384;&#37324;&#30340;&#25968;&#20540;&#31639;&#19968;&#31639;&#65292;&#20445;&#23384;&#21040;&#21478;&#19968;&#20010;&#20869;&#23384;&#20301;&#32622;&#37324;&#65292;&#23601;&#20877;&#20063;&#19981;&#33021;&#20570;&#20854;&#20182;&#20219;&#20309;&#20107;&#24773;&#20102;&#12290;&#25152;&#20197;&#25105;&#20204;&#24456;&#33258;&#28982;&#22320;&#65292;&#33267;&#23569;&#38656;&#35201;&#25105;&#20204;&#30340;&#31243;&#24207;&#33021;&#21521;&#22806;&#36755;&#20986;&#28857;&#20160;&#20040;&#8212;&#8212;AbstractMachine &#23601;&#25552;&#20379;&#20102;&#25171;&#21360;&#21333;&#20010;&#23383;&#31526;&#21040;&#35843;&#35797;&#32456;&#31471;&#21644;&#32467;&#26463;&#25191;&#34892;&#30340;&#26426;&#21046;&#12290;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">putch</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">halt</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">);</span>
</code></pre></div>

<h3 id="32" class=" text-lg mt-2 pb-2 font-sans">3.2. &#36755;&#20837;/&#36755;&#20986;</h3>
<p class=" font-serif my-1">&#36825;&#19968;&#20999;&#37117;&#22826;&#33258;&#28982;&#20102;&#65292;&#20294;&#36824;&#19981;&#22815;&#12290;&#25105;&#20204;&#30340;&#30828;&#20214;&#31995;&#32479;&#37324;&#26377;&#24456;&#22810; I/O &#35774;&#22791;&#65292;&#38190;&#30424;&#12289;&#40736;&#26631;&#12289;&#30913;&#30424;&#12289;&#26174;&#31034;&#22120; (&#29978;&#33267;&#26159;&#26174;&#31034;&#21152;&#36895;&#22120;)&#8230;&#8230;&#35774;&#22791;&#20116;&#33457;&#20843;&#38376;&#65292;&#20294;&#23427;&#20204;&#19982;&#35745;&#31639;&#26426;&#36719;&#20214;&#30340;&#25509;&#21475;&#20063;&#26159;&#31867;&#20284;&#30340;&#8212;&#8212;&#23427;&#20204;&#25552;&#20379;&#21487;&#20197;&#35835;/&#20889;&#30340;&#23492;&#23384;&#22120;&#65292;&#25105;&#20204;&#36890;&#36807;&#21521;&#23492;&#23384;&#22120;&#21457;&#36865;&#25351;&#20196;&#26469;&#23436;&#25104;&#23545;&#35774;&#22791;&#30340;&#25511;&#21046;&#12290;&#22240;&#20026;&#26159;&#38754;&#21521;&#25945;&#23398;&#30340;&#31995;&#32479;&#65292;&#25152;&#20197;&#25105;&#20204;&#24178;&#33030;&#23601;&#23450;&#20041;&#22909;&#19968;&#32452;&#35774;&#22791;&#21644;&#23427;&#20204;&#30340;&#25509;&#21475;&#23601;&#23436;&#20107;&#20799;&#20102; (&#21442;&#32771;<a href="AM_Devices.html" class=" text-amber-900">&#35774;&#22791;&#25991;&#26723;</a>)&#65292;&#21253;&#25324;&#26102;&#38047;&#12289;&#38190;&#30424;&#12289;&#26174;&#31034;&#21152;&#36895;&#22120;&#12289;&#30913;&#30424;&#8230;&#8230;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ioe_read</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ioe_write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
</code></pre></div>

<h3 id="33" class=" text-lg mt-2 pb-2 font-sans">3.3. &#20013;&#26029;&#21644;&#24322;&#24120;</h3>
<p class=" font-serif my-1">&#25105;&#20204;&#36824;&#21487;&#20197;&#20801;&#35768;&#22788;&#29702;&#22120;&#38543;&#26102;&#34987;&#20013;&#26029;&#65292;&#20445;&#23384;&#24403;&#21069;&#25191;&#34892;&#30340;&#23492;&#23384;&#22120;&#29616;&#22330; (context)&#65292;&#24182;&#35843;&#29992; <code>cte_init</code> &#25351;&#23450;&#30340;&#20013;&#26029;&#22788;&#29702;&#31243;&#24207;&#12290;&#21482;&#35201;&#25105;&#20204;&#33021;&#22312;&#20869;&#23384;&#20013;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340; context&#65292;&#23601;&#33021;&#22312;&#20013;&#26029;&#30340;&#39537;&#21160;&#19979;&#65292;&#22312;&#22810;&#20010; context &#20043;&#38388;&#20999;&#25442;&#65292;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#35838;&#19978;&#35762;&#36848;&#26368;&#37325;&#35201;&#30340; &#8220;&#20998;&#26102;&#22810;&#32447;&#31243;&#8221;&#12290;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">bool</span><span class="w">     </span><span class="nf">cte_init</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">handler</span><span class="p">)(</span><span class="n">Event</span><span class="w"> </span><span class="n">ev</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">));</span>
<span class="kt">void</span><span class="w">     </span><span class="nf">yield</span><span class="w">   </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">bool</span><span class="w">     </span><span class="nf">ienabled</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span><span class="w">     </span><span class="nf">iset</span><span class="w">    </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">enable</span><span class="p">);</span>
<span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="nf">kcontext</span><span class="p">(</span><span class="n">Area</span><span class="w"> </span><span class="n">kstack</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">entry</span><span class="p">)(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</code></pre></div>

<h3 id="34" class=" text-lg mt-2 pb-2 font-sans">3.4. &#34394;&#25311;&#23384;&#20648;&#31649;&#29702;</h3>
<p class=" font-serif my-1">&#20026;&#20102;&#33021;&#22815;&#23454;&#29616;&#36827;&#31243;&#65292;&#20809;&#26377;&#20013;&#26029;&#20063;&#36824;&#26159;&#19981;&#22815;&#30340;&#65292;&#25105;&#20204;&#36824;&#24076;&#26395;&#33021;&#20026;&#36827;&#31243;&#21019;&#24314;&#38548;&#31163;&#30340;&#22320;&#22336;&#31354;&#38388;&#12290;&#28982;&#32780;&#65292;&#19981;&#21516;&#30828;&#20214;&#31649;&#29702;&#34394;&#25311;&#20869;&#23384;&#30340;&#26041;&#24335;&#22823;&#30456;&#24452;&#24237;&#12290;x86-64 &#31995;&#32479;&#20351;&#29992;&#30828;&#20214; MMU &#32500;&#25252;&#22235;&#32423;&#39029;&#34920; (PML4, PDPT, PD, PT)&#65307;MIPS32 &#21017;&#26159;&#36719;&#20214; MMU &#22312; TLB &#32570;&#22833;&#26102;&#20135;&#29983;&#24322;&#24120;&#12290;</p>
<p class=" font-serif my-1">&#22312;&#25152;&#26377;&#36825;&#20123;&#34394;&#25311;&#23384;&#20648;&#30340;&#23454;&#29616;&#20013;&#65292;&#26412;&#36136;&#30340;&#26159;&#25805;&#20316;&#31995;&#32479;&#32500;&#25252;&#20102;&#19968;&#20010; &#8220;&#22320;&#22336;&#32763;&#35793;&#20989;&#25968; $f$&#8221;&#65292;&#24182;&#19988; $f$ &#21487;&#20197;&#34987;&#28789;&#27963;&#22320; &#8220;&#21152;&#36733;&#8221; &#21040; CPU &#19978;&#21457;&#29983;&#20316;&#29992;&#65292;&#20351; CPU &#21462;&#25351;&#20196;&#12289;&#35835;&#20889;&#20869;&#23384;&#26102;&#65292;&#20250;&#25226;&#20869;&#23384;&#22320;&#22336; $m$ &#32763;&#35793;&#25104; $f(m)$&#12290;&#25152;&#20197;&#65292;&#34394;&#25311;&#23384;&#20648;&#31649;&#29702;&#30340;&#26412;&#36136;&#23601;&#26159;&#32500;&#25252;&#19968;&#31995;&#21015;&#30340; &#8220;&#22320;&#22336;&#31354;&#38388;&#26144;&#23556;&#8221; &#23545;&#35937; (<code>AddrSpace</code>)&#65292;&#21021;&#22987;&#26102;&#26144;&#23556;&#20026;&#31354; (&#31243;&#24207;&#35775;&#38382;&#20219;&#20309;&#22320;&#22336;&#37117;&#23558;&#20135;&#29983;&#32570;&#39029;&#24322;&#24120;)&#65292;&#20294;&#21487;&#20197;&#36890;&#36807; <code>map</code> &#25913;&#21464;&#39029;&#38754;&#21040;&#39029;&#38754;&#30340;&#26144;&#23556;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">bool</span><span class="w">     </span><span class="nf">vme_init</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">pgalloc</span><span class="p">)(</span><span class="kt">int</span><span class="p">),</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">pgfree</span><span class="p">)(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">));</span>
<span class="kt">void</span><span class="w">     </span><span class="nf">protect</span><span class="w">  </span><span class="p">(</span><span class="n">AddrSpace</span><span class="w"> </span><span class="o">*</span><span class="n">as</span><span class="p">);</span>
<span class="kt">void</span><span class="w">     </span><span class="nf">unprotect</span><span class="p">(</span><span class="n">AddrSpace</span><span class="w"> </span><span class="o">*</span><span class="n">as</span><span class="p">);</span>
<span class="kt">void</span><span class="w">     </span><span class="nf">map</span><span class="w">      </span><span class="p">(</span><span class="n">AddrSpace</span><span class="w"> </span><span class="o">*</span><span class="n">as</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">vaddr</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">paddr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">prot</span><span class="p">);</span>
<span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="nf">ucontext</span><span class="w"> </span><span class="p">(</span><span class="n">AddrSpace</span><span class="w"> </span><span class="o">*</span><span class="n">as</span><span class="p">,</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="n">kstack</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">entry</span><span class="p">);</span>
</code></pre></div>

<h3 id="35" class=" text-lg mt-2 pb-2 font-sans">3.5. &#22810;&#22788;&#29702;&#22120;</h3>
<p class=" font-serif my-1">&#26368;&#21518;&#65292;&#22823;&#23478;&#26368;&#38476;&#29983;&#30340;&#22810;&#22788;&#29702;&#22120;&#21487;&#33021;&#21453;&#32780;&#26368;&#31616;&#21333;&#65306;&#23427;&#21644;&#25105;&#20204;&#35838;&#22530;&#19978;&#30340; <code>threads.h</code> &#19968;&#26679;&#65292;&#21551;&#21160;&#33509;&#24178;&#20010;&#22788;&#29702;&#22120; (&#31867;&#27604;&#20110;&#21019;&#24314;&#33509;&#24178;&#20010;&#32447;&#31243;)&#65292;&#28982;&#21518;&#27599;&#20010;&#22788;&#29702;&#22120;&#37117;&#25191;&#34892;&#23436;&#20840;&#19968;&#26679;&#30340; <code>entry</code> &#20989;&#25968;&#65292;&#20197;&#21450;&#20195;&#30721;&#21487;&#20197;&#33719;&#24471;&#24403;&#21069;&#25191;&#34892;&#30340;&#22788;&#29702;&#22120;&#12289;&#22788;&#29702;&#22120;&#24635;&#25968;&#65292;&#24182;&#25552;&#20379;&#19968;&#20010;&#21407;&#23376;&#25805;&#20316;&#65306;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="kt">bool</span><span class="w"> </span><span class="nf">mpe_init</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">entry</span><span class="p">)());</span>
<span class="kt">int</span><span class="w">  </span><span class="nf">cpu_count</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span><span class="w">  </span><span class="nf">cpu_current</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span><span class="w">  </span><span class="nf">atomic_xchg</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newval</span><span class="p">);</span>
</code></pre></div>

<h3 id="36-abstractmachine" class=" text-lg mt-2 pb-2 font-sans">3.6. AbstractMachine &#19978;&#30340;&#25805;&#20316;&#31995;&#32479;</h3>
<p class=" font-serif my-1">&#23601;&#36825;&#26679;&#65292;&#12298;&#25805;&#20316;&#31995;&#32479;&#12299;&#25945;&#31185;&#20070;&#19978;&#30340;&#27010;&#24565;&#21464;&#25104;&#20102;&#27963;&#29983;&#29983;&#30340;&#20195;&#30721;&#12290;&#19979;&#38754;&#30340;&#20195;&#30721;&#35835;&#36215;&#26469;&#65292;&#26159;&#19981;&#26159;&#20687;&#25805;&#20316;&#31995;&#32479;&#25945;&#31185;&#20070;&#19978;&#25551;&#36848;&#30340; &#8220;&#25805;&#20316;&#31995;&#32479;&#8221; &#30340;&#26679;&#23376;&#21602;&#65311;</p>
<div class="codehilite"><pre class=" bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;am.h&gt;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">task</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="n">STK_SZ</span><span class="p">];</span>
<span class="w">  </span><span class="cm">/* &#20854;&#20182; task &#30456;&#20851;&#30340;&#25968;&#25454; */</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">task</span><span class="w"> </span><span class="o">*</span><span class="n">percpu_current</span><span class="p">[</span><span class="n">MAX_CPU</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="cp">#define cur (percpu_current[cpu()])</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">task</span><span class="w"> </span><span class="n">tasks</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* task &#25551;&#36848; */</span><span class="w"> </span><span class="p">};</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* task &#20195;&#30721; */</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// &#20013;&#26029;&#39537;&#21160;&#30340;&#19978;&#19979;&#25991;&#20999;&#25442;</span>
<span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="nf">on_interrupt</span><span class="p">(</span><span class="n">Event</span><span class="w"> </span><span class="n">ev</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cur</span><span class="p">)</span><span class="w"> </span><span class="n">cur</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#23558;&#24403;&#21069; CPU &#30340;&#19978;&#19979;&#25991;&#20445;&#23384;&#21040; task</span>
<span class="w">  </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &#23547;&#25214;&#19979;&#19968;&#20010;&#21487;&#35843;&#24230;&#30340; &#8220;&#19978;&#19979;&#25991;&#8221;</span>
<span class="w">    </span><span class="n">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cur</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">cpu</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">cur</span><span class="o">-</span><span class="n">tasks</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">ncpu</span><span class="p">());</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cur</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#25226;&#25214;&#21040;&#30340; &#8220;&#19978;&#19979;&#25991;&#8221; &#24674;&#22797;&#21040; CPU &#19978;&#25191;&#34892;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">percpu_entry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">intr_write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#25171;&#24320;&#24403;&#21069; CPU &#30340;&#20013;&#26029;</span>
<span class="w">  </span><span class="n">yield</span><span class="p">();</span><span class="w"> </span><span class="c1">// &#19981;&#20250;&#36820;&#22238;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">cte_init</span><span class="p">(</span><span class="n">on_interrupt</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">tasks</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">task</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">kcontext</span><span class="p">((</span><span class="n">Area</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">stk</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">stk</span><span class="o">+</span><span class="n">STK_SZ</span><span class="p">},</span>
<span class="w">      </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#21019;&#24314;&#19968;&#20010;&#21487;&#34987;&#35843;&#24230;&#25191;&#34892;&#30340;&#20869;&#26680;&#19978;&#19979;&#25991;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">mpe_init</span><span class="p">(</span><span class="n">percpu_entry</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#21551;&#21160;&#25152;&#26377;&#22788;&#29702;&#22120;</span>
<span class="p">}</span>
</code></pre></div>

<p class=" font-serif my-1">&#25105;&#20204;&#20250;&#22312;&#12298;&#25805;&#20316;&#31995;&#32479;&#12299;&#35838;&#31243;&#19978;&#35762;&#35299;&#36825;&#20123;&#20195;&#30721;&#12290;&#20320;&#21487;&#20197;&#35797;&#30528;&#32534;&#35793;&#36816;&#34892;&#23427;&#21527;&#65311;&#36816;&#34892;&#26102;&#65292;&#35774;&#32622; <code>make run smp=4</code> &#21487;&#20197;&#21551;&#21160; 4 &#20010;&#34394;&#25311; CPU &#25191;&#34892;&#12290;&#22312; QEMU Monitor &#20013;&#21487;&#20197;&#20351;&#29992; <code>info cpus</code> &#26597;&#30475; CPU &#21644;&#27169;&#25311;&#32447;&#31243;&#30340;&#23545;&#24212;&#20851;&#31995;&#12290;</p>
<h3 id="4-abstractmachine" class=" text-lg mt-2 pb-2 font-sans">4. AbstractMachine &#26159;&#20160;&#20040;&#65311;</h3>
<p class=" font-serif my-1">AbstractMachine &#35299;&#20915;&#30340;&#38382;&#39064;&#26159; &#8220;&#33021;&#21542;&#22312;&#19981;&#29702;&#35299;&#30828;&#20214;&#26426;&#21046;&#32454;&#33410;&#30340;&#21069;&#25552;&#19979;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#8221;&#12290;</p>
<p class=" font-serif my-1">&#23454;&#38469;&#19978;&#65292;C &#31243;&#24207;&#26412;&#36523;&#23601;&#26159;&#19968;&#20010;&#24456;&#19981;&#38169;&#30340;&#25277;&#35937;&#8212;&#8212;&#25105;&#20204;&#21487;&#20197;&#24536;&#25481;&#35745;&#31639;&#26426;&#30828;&#20214;&#30340;&#21021;&#22987;&#21270;&#12289;&#21021;&#22987;&#30340;&#21152;&#36733;&#22120;&#31561;&#25216;&#26415;&#32454;&#33410;&#65292;&#21482;&#35201;&#20551;&#35774;&#31243;&#24207;&#20174; <code>main</code> &#20989;&#25968;&#24320;&#22987;&#25191;&#34892;&#21363;&#21487;&#12290;&#22312;&#27492;&#22522;&#30784;&#19978;&#65292;&#34429;&#28982;&#19981;&#21516;&#35745;&#31639;&#26426;&#31995;&#32479;&#30340;&#25351;&#20196;&#38598;&#12289;&#35774;&#22791;&#25509;&#21475;&#31561;&#22343;&#19981;&#21516;&#65292;&#20294;&#23427;&#20204;&#37117;&#36981;&#24490;&#20102; &#8220;&#20911;&#35834;&#20381;&#26364;&#20307;&#31995;&#32467;&#26500;&#8221;&#65292;&#25903;&#25345;&#20013;&#26029;/&#24322;&#24120;&#25511;&#21046;&#27969;&#21644;&#34394;&#25311;&#23384;&#20648;&#12290;&#20363;&#22914;&#65292;&#26576;&#20010; x86 &#31995;&#32479;&#20351;&#29992; <code>int 0x80</code> &#25351;&#20196;&#33258;&#38519;&#20837;&#20869;&#26680;&#65307;&#26576;&#20010; MIPS32 &#31995;&#32479;&#21017;&#20351;&#29992; <code>trap</code> &#25351;&#20196;&#12290;&#20294;&#36825;&#20010;&#32454;&#33410;&#23545;&#25105;&#20204;&#26469;&#35828;&#24182;&#19981;&#37325;&#35201;&#65292;&#25105;&#20204;&#24076;&#26395;&#30340;&#26159; C &#31243;&#24207;&#22312;&#38543;&#26102;&#21487;&#20197;&#35843;&#29992; <code>yield()</code> API &#20135;&#29983;&#19968;&#20010;&#33258;&#38519;&#24322;&#24120;&#12290;</p>
<p class=" font-serif my-1">AbstractMachine &#25226;&#30828;&#20214;&#25552;&#20379;&#30340;&#26426;&#21046; (&#21487;&#20197;&#30475;&#25104;&#26159; &#8220;&#25351;&#20196;&#8221;) &#35937;&#25104;&#19968;&#32452; C API&#65292;&#24182;&#23558;&#36825;&#20123; API &#20998;&#20026;&#20960;&#32452; (extensions)&#12290;&#22312;&#20854;&#20013;&#19981;&#21487;&#36991;&#20813;&#22320;&#20002;&#22833;&#20102;&#19968;&#20123;&#23545;&#35745;&#31639;&#26426;&#31995;&#32479;&#30340;&#32454;&#33410;&#25511;&#21046;&#65292;&#20294;&#21364;&#23631;&#34109;&#20102;&#29712;&#30862;&#30340;&#24213;&#23618;&#32454;&#33410;&#65292;&#24110;&#21161;&#21021;&#23398;&#32773;&#29702;&#35299;&#35745;&#31639;&#26426;&#31995;&#32479;&#30340;&#26412;&#36136;&#12290;</p>
<blockquote class=" bg-gray-200 p-2 rounded mb-2 mt-2 mx-4">
<h4 id="_1" class=" pt-2 pb-2 font-sans float-left text-sm box border mr-1 mt-1 box-blue" style=" padding-bottom: 0;">&#35266;&#28857;&#65306;&#8220;&#23398;&#25805;&#20316;&#31995;&#32479;&#23601;&#26159;&#35201;&#23398;&#36825;&#20123;&#32454;&#33410;&#8221;</h4>
<p class=" font-serif my-1">&#26377;&#20123;&#20154;&#20250;&#35828;&#65292;&#23454;&#29616;&#25805;&#20316;&#31995;&#32479;&#19981;&#23601;&#26159;&#36825;&#20123;&#29712;&#30862;&#30340;&#32454;&#33410;&#21527;&#65292;&#25277;&#35937;&#20102;&#19981;&#23601;&#27809;&#20102;&#65311;&#24182;&#19981;&#26159;&#36825;&#26679;&#30340;&#12290;&#22312;&#36866;&#24403;&#30340;&#25277;&#35937;&#19978;&#65292;&#25105;&#20204;&#33021;&#26356;&#23481;&#26131;&#22320;&#30475;&#21040;&#35745;&#31639;&#26426;&#31995;&#32479;&#20013;<strong>&#26356;&#37325;&#35201;&#30340;&#32454;&#33410;</strong>&#8212;&#8212;&#22810;&#22788;&#29702;&#22120;&#24182;&#21457;&#31243;&#24207;&#30340;&#32534;&#20889;&#26041;&#27861;&#12289;&#24182;&#21457; bug &#30340;&#35843;&#35797;&#12289;&#23545;&#35937;&#30340;&#31649;&#29702;&#21644;&#22238;&#25910;&#12289;&#25805;&#20316;&#31995;&#32479;&#21508;&#20010;&#37096;&#20998;&#20043;&#38388;&#30340;&#22797;&#26434;&#20132;&#20114;&#8230;&#8230;&#21518;&#38754;&#30340;&#19990;&#30028;&#27604;&#29712;&#30862;&#30340;&#24213;&#23618;&#32454;&#33410;&#26356;&#31934;&#24425;&#65292;&#20063;&#26356;&#26377;&#25361;&#25112;&#12290;</p>
<p class=" font-serif my-1">&#22240;&#27492;&#65292;&#35753;&#25105;&#20204;&#22312;&#12298;&#25805;&#20316;&#31995;&#32479;&#12299;&#35838;&#19978;&#26242;&#26102;&#24536;&#35760;&#30828;&#20214;&#65292;&#21435;&#20851;&#27880;&#25805;&#20316;&#31995;&#32479;&#37324;&#30340;&#23545;&#35937;&#21644; API &#21543;&#65281;</p>
</blockquote></div>
</div>

<div class="container text-xs py-3">
  <span class="text-muted">
    <center><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="../static/img/cc-4.0.png"></a>
    &#160;&#160;&#160;<a style="color:inherit" href="https://beian.miit.gov.cn/">&#33487; ICP &#22791; 2020049101 &#21495;</a>
    </center>
  </span>
</div>

</div>

<script src="../static/js/jquery.min.js"></script>

<script>
function get_token() {
  var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
  if (match) return match[2];
  else return "";
}
var token = get_token();
var hint = "token", box = $("#token-input");

if (token == "") { }
else { box.val(token); }

function login() {
  var token = box.val()
  if (!token) {
    document.cookie = ''
  } else {
    document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;'
  }
}
</script>


</body>

</html>