<!DOCTYPE html><html>
<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Yanyan's Wiki</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/><link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"/><meta name="next-head-count" content="5"/><link rel="preload" href="../_next/static/css/e993edd6a18ef4f0.css" as="style"/><link rel="stylesheet" href="../_next/static/css/e993edd6a18ef4f0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../_next/static/chunks/webpack-f73d82589f972e7d.js" defer=""></script><script src="../_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="../_next/static/chunks/main-3929bf55b0f13a18.js" defer=""></script><script src="../_next/static/chunks/pages/_app-00b06920b385caf1.js" defer=""></script><script src="../_next/static/chunks/pages/%5b%5b...index%5d%5d-877ec949b69be209.js" defer=""></script><script src="../_next/static/a2FwJzUPGFGc0QcwaUr13/_buildManifest.js" defer=""></script><script src="../_next/static/a2FwJzUPGFGc0QcwaUr13/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-slate-300/10"><div class="sticky top-0 z-40 w-full backdrop-blur flex-none border-b border-slate-900/10 bg-white/75 supports-backdrop-blur:bg-white/60"><div class="max-w-8xl mx-auto"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="relative flex items-center"><a href="../index.html">Yanyan's wiki</a><form class="text-xs text-slate-500">Â forÂ <input type="text" name="token" class="font-mono text-xs w-16" maxLength="8"/></form><div class="relative hidden lg:flex items-center ml-4 pl-4 border-l"><nav class="text-sm leading-6 font-semibold text-slate-700 dark:text-slate-200"><ul class="flex space-x-8"><li><a class="hover:text-sky-500 dark:hover:text-sky-400" href="../OS/2025/index.html">æ“ä½œç³»ç»Ÿ (2025 æ˜¥)</a></li></ul></nav></div></div></div></div></div><div class="container mx-auto max-w-5xl flex flex-col min-h-screen px-4"><div class="wiki bg-neutral-200/10"><h1>AbstractMachine è§„çº¦ (Specifications)</h1>
<h2>1. åŸºæœ¬æ¦‚å¿µ</h2>
<p>AbstractMachine ä¸Šè¿è¡Œçš„ç¨‹åºç§°ä¸º â€œkernelâ€ (å†…æ ¸)ã€‚è¿™ä¸ªåå­—é€šå¸¸è¡¨ç¤ºç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šã€å¯¹ç¡¬ä»¶æœ‰ç›´æ¥æ§åˆ¶çš„ä»£ç ã€‚ä¸ä»…æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œåƒåœ¨ GPU ä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿç§°ä¸º â€œkernelâ€ã€‚</p>
<p>AbstractMachine ä¸Šçš„ kernel è¢«ç¼–è¯‘æˆä¸€ä¸ªç›®æ ‡ä½“ç³»ç»“æ„/å¹³å°ä¸Šå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¹¶å¯ä»¥ç›´æ¥åœ¨ç¯å¢ƒ (å¦‚è®¡ç®—æœºç¡¬ä»¶ã€è™šæ‹Ÿæœºç­‰) ä¸Šæ‰§è¡Œï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>x86 (x86 32-bit), qemu (æ¨¡æ‹Ÿå™¨)</li>
<li>x86_64 (x86 64-bit), qemu (æ¨¡æ‹Ÿå™¨)</li>
<li>riscv64 (RISC-V 64-bit), nemu (æ¨¡æ‹Ÿå™¨)</li>
<li>native (ä½œä¸ºæœ¬åœ°è¿›ç¨‹è¿è¡Œ)</li>
</ul>
<p>åœ¨ã€Šæ“ä½œç³»ç»Ÿã€‹å®éªŒä¸­ï¼Œè¯·å¤§å®¶ä»¥ x86_64-qemu ä¸ºåŸºå‡†å¹³å°ï¼Œå…¶ä»–å®ç°ä½œä¸ºå‚è€ƒã€‚</p>
<h2>2. TRM (Turing Machine): C è¯­è¨€è¿è¡Œç¯å¢ƒ</h2>
<p>Kernel æ˜¯ä¸€ä¸ª C è¯­è¨€ä¹¦å†™çš„ç¨‹åºï¼ŒC è¯­è¨€ä»£ç å®šä¹‰äº†ç¨‹åº (kernel) çš„è¿è¡Œæ—¶çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>åªè¯»ä»£ç ï¼Œç”± kernel ä¸­å®šä¹‰çš„ C è¯­è¨€å‡½æ•°æ„æˆã€‚</li>
<li>å‡½æ•°è°ƒç”¨å½¢æˆçš„æ ˆã€‚æ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šåœ¨æ ˆä¸Šæ”¾ç½®ä¸€ä¸ªæ–°çš„æ ˆå¸§ã€‚æ¦‚å¿µä¸Šï¼Œæ¯ä¸€ä¸ªæ ˆå¸§éƒ½æœ‰ç‹¬ç«‹çš„ PC (ç¨‹åºè®¡æ•°å™¨)ã€å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚</li>
<li>åªè¯»æ•°æ®ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²å¸¸é‡ã€‚å†™å…¥åªè¯»æ•°æ®å°†å¯¼è‡´ undefined behaviorã€‚</li>
<li>è¯»å†™æ•°æ®ã€‚é™æ€å˜é‡å±äºè¯»å†™æ•°æ®ï¼›æ­¤å¤–ï¼Œæœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„è¯»å†™æ•°æ® (å¤§å°ç”±å…·ä½“å®ç°å†³å®š) ä½œä¸ºå¯ç”¨çš„å †åŒºã€‚</li>
</ul>
<p>ä»¥ä¸Šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªå¹³å¦çš„åœ°å€ç©ºé—´ä¸­ (åªè¯»ä»£ç ã€æ ˆã€æ•°æ®ã€å †åŒºäº’ä¸ç›¸äº¤ä¸”è¿ç»­å­˜å‚¨)ï¼Œå¯¹ç›¸åº”ç¬¦å·æ‰§è¡Œå–åœ°å€æ“ä½œ <code>&</code> ä¼šå¾—åˆ°æŒ‡å‘ç›¸åº”åŒºåŸŸçš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¯ä»¥è½¬æ¢ä¸º <code>intptr_t</code> ç±»å‹çš„æ•´æ•°ã€‚ç¨‹åºå¯åŠ¨æ—¶ï¼Œkernel è¢« TRM åŠ è½½ï¼Œkernel è¿è¡Œæ—¶å¯ä½¿ç”¨çš„æ ˆå¤§å°ä¸å°‘äº 4 KiBï¼›å †å†…å­˜çš„å¤§å°å’Œä½ç½®åœ¨è¿è¡Œæ—¶ç¡®å®šï¼Œé€šè¿‡ <code>heap</code> å˜é‡è·å–ï¼Œkernel å¯¹åº”çš„çŠ¶æ€æœºå¼€å§‹æ‰§è¡Œã€‚AbstractMachine ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œä» <code>main</code> å‡½æ•°å¼€å§‹æ‰§è¡Œï¼ŒåŒ…å«å‚æ•° <code>const char *args</code>ï¼Œ<code>args</code> ä¿å­˜åœ¨æ ˆå¸§ä¸­ï¼›<code>args</code> æŒ‡å‘çš„å†…å®¹ä¸ºåªè¯»æ•°æ®ã€‚</p>
<div class="box blue-box"><div><span class="float-left text-4xl mr-3 mt-2">ğŸ—’ï¸</span><span class="font-serif text-lg border-b border-slate-600"><b>main() çš„å‚æ•°å’Œè¿”å›å€¼</b></span><div class="font-serif pt-2"><pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *args)</span> {
    ...
}
</code></pre><p>çš„å‚æ•°åœ¨ <code>make run</code> å‰é€šè¿‡è®¾ç½® <code>mainargs</code> ç¯å¢ƒå˜é‡æŒ‡å®šã€‚å‚æ•°å­—ç¬¦ä¸²çš„é•¿åº¦ (åŒ…å«æœ«å°¾çš„ <code>\0</code>) ä¸èƒ½è¶…è¿‡ 1024 å­—èŠ‚ã€‚main å‡½æ•°è¿”å›åï¼Œkernel å®Œæˆè¿è¡Œã€‚å‡è®¾è¿”å›å€¼ä¸º <code>r</code>ï¼ŒAbstractMachine ä¼šæ‰§è¡Œ <code>halt(r)</code> ç»ˆæ­¢ã€‚</p></div></div></div>
<p>æˆ‘ä»¬ä¸å¦¨å‡å®šæ‰§è¡Œä¸€æ¡ C è¯­è¨€è¯­å¥ä¼šä»çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span></span></span></span> è¿ç§»åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">s'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œè®°ä½œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>â†’</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">s\to s'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>ã€‚Kernel åœ¨è¿è¡Œæ—¶å…è®¸è°ƒç”¨ AbstractMachine APIï¼Œæ­¤æ—¶çš„çŠ¶æ€è¿ç§» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>â†’</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">s\to s'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> ç”± AbstractMachine å®šä¹‰ã€‚</p>
<h3>2.1. <code>Area</code> ç»“æ„ä½“</h3>
<pre><code class="hljs language-c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Area</span> {</span>
  <span class="hljs-type">void</span> *start, *end;
} Area;
</code></pre>
<p>è¡¨ç¤ºå·¦é—­å³å¼€åŒºé—´ <code>[start, end)</code> çš„ä¸€æ®µå†…å­˜ã€‚æˆ‘ä»¬å‡è®¾åœ°å€ç©ºé—´çš„æœ€åä¸€ä¸ªå­—èŠ‚ (ä¾‹å¦‚ 32-bit å¹³å°ä¸‹åœ°å€ <code>0xffffffff</code>) æ°¸è¿œä¸ä¼šè¢«åŒ…å«åœ¨æŸä¸ª <code>Area</code> ä¸­ï¼Œå› æ­¤ <code>end</code> ä¸ä¼šæº¢å‡ºã€‚ä¾‹å¦‚ï¼Œ32-bit å¹³å°ä¸‹çš„æŸä¸ª Area:</p>
<pre><code class="hljs language-c">(Area) {
  .start = (<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>;
  .end   = (<span class="hljs-type">void</span> *)<span class="hljs-number">0xffffffff</span>;
}
</code></pre>
<p>åˆ™å®ƒæœ€åä¸€ä¸ªå­—èŠ‚çš„åœ°å€æ˜¯ <code>0xfffffffe</code>ã€‚<code>klib-macros.h</code> æä¾›äº†ä¸€äº›åŒºé—´çš„æ„é€ /åˆ¤æ–­çš„å®ï¼š</p>
<pre><code class="hljs language-c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> RANGE(st, ed)       (Area) { .start = (void *)(st), .end = (void *)(ed) }</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> IN_RANGE(ptr, area) ((area).start <= (ptr) && (ptr) < (area).end)</span>
</code></pre>
<h3>2.2. <code>heap</code>: kernel å¯ç”¨çš„ç‰©ç†å†…å­˜å †åŒº</h3>
<pre><code class="hljs language-c"><span class="hljs-keyword">extern</span> Area heap;
</code></pre>
<p>æ ‡è®°äº†ä¸€æ®µè¿ç»­çš„ã€ä»£ç å¯ä»¥ä½¿ç”¨çš„ç‰©ç†å†…å­˜ <code>[heap.start, heap.end)</code>ï¼Œè¿™æ®µå†…å­˜ (å †åŒº) kernel å¯ä»¥ä»»æ„è¯»å†™ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚<code>heap</code> åœ¨ <code>main</code> è¢«è°ƒç”¨å‰åˆå§‹åŒ–ï¼Œä¹‹åä¸ä¼šæ”¹å˜ (ä»»æ„å¤„ç†å™¨éƒ½å¯ä»¥è¯»å–å®ƒ)ã€‚ä¿®æ”¹ <code>heap</code> å¯¼è‡´ undefined behaviorï¼›Kernel æ²¡æœ‰ä»»ä½•ç†ç”±éœ€è¦ä¿®æ”¹å®ƒã€‚</p>
<h3>2.3. <code>putch</code>: æ‰“å°å­—ç¬¦</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">putch</span><span class="hljs-params">(<span class="hljs-type">char</span> ch)</span>;
</code></pre>
<p>å‘é»˜è®¤çš„è°ƒè¯•ç»ˆç«¯æ‰“å° ASCII ç ä¸º <code>ch</code> çš„å­—ç¬¦ï¼š</p>
<ul>
<li>å¯¹ x86 (x86-64) QEMU å¹³å°ï¼Œå‘ COM1 è¾“å‡ºï¼Œé€šè¿‡ QEMU çš„ <code>-serial</code> å¯ä»¥é€‰æ‹©è¾“å‡ºä½ç½®ã€‚</li>
<li>å¯¹ native å¹³å°ï¼Œè¾“å‡ºåˆ° stdoutã€‚</li>
<li>å¯¹çœŸå®çš„ç¡¬ä»¶å¹³å°ï¼Œå‘è°ƒè¯•ä¸²å£è¾“å‡ºã€‚</li>
</ul>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚putch æ˜¯æœ€åŸºæœ¬çš„è°ƒè¯•åŠŸèƒ½ï¼Œå› æ­¤ AbstractMachine çš„å®ç°è´Ÿè´£ä¿è¯å®ƒåœ¨å¤šå¤„ç†å™¨ä¸Šçš„å®‰å…¨æ€§ã€‚</p>
<h3>2.4. <code>halt</code>: ç»ˆæ­¢ AbstractMachine</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">halt</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> __<span class="hljs-title function_">attribute__</span><span class="hljs-params">((__noreturn__))</span>;
</code></pre>
<p>ç«‹å³ç»ˆæ­¢æ•´ä¸ª AbstractMachine çš„è¿è¡Œï¼Œå¹¶è¿”å›æ•°å­—ç¼–å· <code>code</code> (0-255)ï¼š</p>
<ul>
<li>å¯¹ QEMU å¹³å°ï¼Œè™šæ‹Ÿæœºå°†ç›´æ¥ç»ˆæ­¢ï¼Œç»ˆæ­¢å‰ä¼šå‘è°ƒè¯•ç»ˆç«¯æ‰“å°ä¿¡æ¯ (ä¾‹å¦‚è¿”å›ä»£ç )ã€‚</li>
<li>å¯¹ native å¹³å°ï¼Œä»£ç å°†é€€å‡ºï¼Œè¿›ç¨‹çš„è¿”å›ä»£ç ä¸º <code>code</code>ã€‚</li>
<li>å¯¹çœŸå®çš„ç¡¬ä»¶å¹³å°ï¼Œæ ¹æ®ç¡¬ä»¶çš„æ”¯æŒå…³é—­æˆ–è¿›å…¥æ­»å¾ªç¯çŠ¶æ€ã€‚</li>
</ul>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚åœ¨ä»»æ„å¤„ç†å™¨ä¸Šæ‰§è¡Œ <code>halt</code> éƒ½ä¼šç»ˆæ­¢æ•´ä¸ª Kernel çš„æ‰§è¡Œã€‚</p>
<h2>3. MPE (Multi-Processing Extension) å…±äº«å†…å­˜å¤šå¤„ç†å™¨</h2>
<p>è¿›å…¥å…±äº«å†…å­˜å¤šå¤„ç†å™¨æ¨¡å¼ã€‚å‡è®¾ç³»ç»Ÿä¸­æœ‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">n</span></span></span></span> ä¸ªå¤„ç†å™¨ï¼Œåœ¨å®Œæˆ MPE åˆå§‹åŒ–åï¼Œç³»ç»Ÿä¸­å°±æœ‰å¤šä¸ªå¹¶è¡Œæ‰§è¡Œã€å…±äº«å†…å­˜ä¸”æ‹¥æœ‰ç‹¬ç«‹å †æ ˆçš„çŠ¶æ€æœºã€‚</p>
<p><red><strong>æ•°æ®ç«äº‰</strong></red>ï¼šä¸¤ä¸ªå¤„ç†å™¨åŒæ—¶ (åœ¨çŠ¶æ€æœºæ¨¡å‹ä¸­æ„å‘³ç€å…ˆå) è®¿é—®ä¸€ä¸ªå…±äº«å†…å­˜ä½ç½®ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™æ˜¯æ•°æ®ç«äº‰ã€‚æ•°æ®ç«äº‰ (data race) åœ¨ AbstractMachine æ˜¯ undefined behaviorï¼Œåº”å½“ä¸¥æ ¼é¿å…ã€‚</p>
<h3>3.1. <code>mpe_init</code>: å¯åŠ¨å¤šå¤„ç†å™¨</h3>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">mpe_init</span><span class="hljs-params">(<span class="hljs-type">void</span> (*entry)())</span>;
</code></pre>
<p>å¯åŠ¨ç³»ç»Ÿä¸­å¤šå¤„ç†å™¨çš„æ‰§è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½è·³è½¬åˆ° <code>entry</code> å¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œæµå…±äº«ä»£ç ã€æ•°æ®ï¼›æ¯ä¸ªæ‰§è¡Œæµæœ‰ç‹¬ç«‹çš„å †æ ˆå’Œå¯„å­˜å™¨ï¼Œä¸” entry è¿è¡Œæ—¶å¯ä½¿ç”¨çš„æ ˆå¤§å°ä¸å°‘äº 4 KiBã€‚</p>
<p><red><strong>é™åˆ¶</strong></red>ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­ï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ (å¤šæ¬¡è°ƒç”¨å)ï¼Œä¸”è°ƒç”¨å <code>entry</code> ä¸èƒ½è¿”å›ã€‚</p>
<h3>3.2. <code>cpu_count</code>: å¤„ç†å™¨ä¸ªæ•°</h3>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">cpu_count</span><span class="hljs-params">()</span>;
</code></pre>
<p>è¿”å›ç³»ç»Ÿä¸­å¤„ç†å™¨çš„ä¸ªæ•°ï¼Œåœ¨æ•´ä¸ª AbstractMachine æ‰§è¡ŒæœŸé—´æ•°å€¼ä¸ä¼šå˜åŒ–ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚ç”±äºå¤„ç†å™¨æ•°é‡ä¸å˜ï¼Œå› æ­¤ <code>cpu_count</code> çš„å®ç°é€šå¸¸å®ç°æ˜¯ä¸€ä¸ªå…±äº«å†…å­˜ (æˆ–è®¾å¤‡å¯„å­˜å™¨) çš„è¯»æ“ä½œã€‚ç¼–ç¨‹æ—¶ (ä¾‹å¦‚å®ç°æ“ä½œç³»ç»Ÿæ—¶) ä½ å¯ä»¥å‡è®¾ç³»ç»Ÿä¸­å¤„ç†å™¨çš„ä¸ªæ•°ä¸è¶…è¿‡ 8 ä¸ªã€‚</p>
<h3>3.3. <code>cpu_current</code>: å½“å‰å¤„ç†å™¨ç¼–å·</h3>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">cpu_current</span><span class="hljs-params">()</span>;
</code></pre>
<p>è¿”å›å½“å‰æ‰§è¡Œæµçš„ CPU ç¼–å·ï¼Œä» <code>0</code> å¼€å§‹ï¼Œä¾‹å¦‚ <code>cpu_count() == 4</code>ï¼Œåˆ™åœ¨å››ä¸ª CPU ä¸Šåˆ†åˆ«è°ƒç”¨ <code>cpu_current()</code> å°†åˆ†åˆ«å¾—åˆ° <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚ä»»ä½•å¤„ç†å™¨åœ¨ä»»ä½•æ—¶å€™çš†å¯è°ƒç”¨ã€‚</p>
<h3>3.4. <code>atomic_xchg</code>: å†…å­˜äº¤æ¢</h3>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">atomic_xchg</span><span class="hljs-params">(<span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> *addr, <span class="hljs-type">int</span> newval)</span>;
</code></pre>
<p>åŸå­ (ä¸ä¼šè¢«å…¶ä»–å¤„ç†å™¨çš„åŸå­æ“ä½œæ‰“æ–­) åœ°äº¤æ¢å†…å­˜åœ°å€ä¸­çš„æ•°å€¼ï¼Œç­‰ä»·äºä»¥ä¸‹ C ä»£ç ï¼š</p>
<pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">atomic_xchg</span><span class="hljs-params">(<span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> *addr, <span class="hljs-type">int</span> newval)</span> {
  <span class="hljs-type">int</span> *ret = *addr;
  *addr = newval;
  <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚ä½ å¯ä»¥å‡è®¾è¿™æ˜¯ Kernel ä¸­å”¯ä¸€æ”¯æŒçš„åŸå­æ“ä½œï¼Œå¯ä»¥ç”¨äºæ¶ˆé™¤æ•°æ®ç«äº‰ã€‚å¦‚æœä½ å¸Œæœ›ä½¿ç”¨æ›´å¤æ‚çš„åŸå­æ“ä½œï¼Œåœ¨æ”¯æŒçš„ä½“ç³»ç»“æ„ä¸Šå¯ä»¥è€ƒè™‘ <code>stdatomic.h</code> å’Œ GCC builtin çš„å‡½æ•°ã€‚</p>
<h2>4. IOE (I/O Extension) è®¾å¤‡ç®¡ç†</h2>
<p>ä¸ºäº†å®ç°æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€äº›åŸºç¡€çš„ I/O è®¾å¤‡è®¿é—®ã€‚åœ¨ AbstractMachine ä¸­ï¼Œæˆ‘ä»¬å¯¹å¸¸è§çš„è®¾å¤‡è¿›è¡Œäº†æŠ½è±¡ï¼ŒæŠŠå®ƒä»¬ç®€åŒ–ä¸ºäº†ä¸€ç»„å¯ä»¥è¯»æˆ–å†™çš„æ§åˆ¶å¯„å­˜å™¨ï¼Œé€šè¿‡è¯»/å†™è¿™äº›å¯„å­˜å™¨å®ç°è®¾å¤‡çŠ¶æ€çš„è¯»å–å’Œæ§åˆ¶ã€‚</p>
<h3>4.1. <code>ioe_init</code>: åˆå§‹åŒ– I/O æ‰©å±•</h3>
<pre><code class="hljs language-c"><span class="hljs-type">bool</span> <span class="hljs-title function_">ioe_init</span><span class="hljs-params">()</span>;
</code></pre>
<p>å®Œæˆç³»ç»Ÿä¸­ I/O è®¾å¤‡çš„åˆå§‹åŒ–ã€‚</p>
<p><red><strong>é™åˆ¶</strong></red>ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ <code>mpe_init</code> ä¹‹å‰ã€‚</p>
<h3>4.2. <code>ioe_read/ioe_write</code>: I/O è®¾å¤‡è¯»å†™</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">ioe_read</span> <span class="hljs-params">(<span class="hljs-type">int</span> reg, <span class="hljs-type">void</span> *buf)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">ioe_write</span><span class="hljs-params">(<span class="hljs-type">int</span> reg, <span class="hljs-type">void</span> *buf)</span>;
</code></pre>
<p>ä»ç¼–å·ä¸º <code>reg</code> çš„å¯„å­˜å™¨è¯»å–/å†™å…¥ï¼Œè¯»å–/å†™å…¥çš„æ•°æ®å–å†³äºå¯„å­˜å™¨çš„ç¼–å·ã€‚è®¾å¤‡å¯èƒ½ä¼šå¯¹å¯„å­˜å™¨çš„ä½¿ç”¨ä½œå‡ºé¢å¤–çš„è§„å®šï¼Œè¯·å‚è€ƒ <a href="AM_Devices.html">Abstract Machine è®¾å¤‡æ–‡æ¡£</a>ã€‚ä¸ºäº†å‡å°‘å¤§å®¶å®šä¹‰é¢å¤–çš„å˜é‡ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ klib-macros.h ä¸­å°è£…åçš„å®è®¿é—®è®¾å¤‡ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-c">*rtc = io_read(AM_TIMER_RTC);
io_read(AM_GPU_STATUS).ready;
io_write(UART_TX, <span class="hljs-string">'X'</span>);
</code></pre>
<p><red><strong>å¤šå¤„ç†å™¨ï¼šä¸å®‰å…¨</strong></red>ï¼šå¯¹åŒä¸€ä¸ª I/O è®¾å¤‡çš„è®¿é—®å¿…é¡»äº’æ–¥ã€‚å€¼å¾—é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œ<code>ioe_read</code> å’Œ <code>ioe_write</code> çš„ä»£ç å¯ä»¥è¢« CTE ä¸­æ–­ (è¿™æ˜¯å…è®¸çš„)ã€‚ä½† Kernel éœ€è¦ä¿è¯åœ¨<red>ä»»æ„æ—¶åˆ»å¯¹åŒä¸€ä¸ªè®¾å¤‡åªå…è®¸æœ‰ä¸€ä¸ªå°šæœªè¿”å›çš„ <code>ioe_read</code> æˆ– <code>ioe_write</code> æ“ä½œ</red>ï¼Œå¦åˆ™å°†å¯¼è‡´ undefined behaviorã€‚</p>
<h2>5. CTE (Context Extension) ä¸Šä¸‹æ–‡å’Œä¸­æ–­ç®¡ç†</h2>
<p>TRMã€MPE å’Œ IOE èƒ½å¤Ÿè¿è¡Œå¤šä¸ªå¤„ç†å™¨ä¸Šçš„é¡ºåºç¨‹åºï¼Œå¤šä¸ªå…±äº«å†…å­˜çš„æ‰§è¡Œæµ (å¤„ç†å™¨) æ€»æ˜¯æ‰§è¡Œå½“å‰æŒ‡ä»¤ã€‚CTE <strong>å…è®¸ kernel ç®¡ç†å¼‚æ­¥çš„æ‰§è¡Œæµï¼Œå…è®¸æ¯ä¸ªå¤„ç†å™¨åˆ†åˆ«åœ¨ä¸­æ–­/å¼‚å¸¸å‘ç”Ÿæ—¶æ‰§è¡Œä»£ç ï¼Œå¹¶ä¿å­˜/åˆ‡æ¢åˆ°å…¶ä»–æ‰§è¡Œæµ</strong>ã€‚</p>
<p>CTE å…è®¸åœ¨ç¨‹åºæ‰§è¡Œä¸­å¼•å…¥ä»¥ä¸‹å¼‚å¸¸ (trap) æ§åˆ¶æµï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ¥æºï¼š</p>
<ul>
<li>å¤„ç†å™¨å¤–éƒ¨ä¸­æ–­ (æ—¶é’Ÿã€I/O è®¾å¤‡)</li>
<li>æŒ‡ä»¤æ‰§è¡Œäº§ç”Ÿçš„å¼‚å¸¸ (ä¸»åŠ¨æ‰§è¡Œçš„ trap æŒ‡ä»¤å’Œ undefined behavior å¯¼è‡´çš„é”™è¯¯)</li>
<li>å¯¹äº VME ucontext åˆ›å»ºçš„ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œè®¿é—®æ˜ å°„æƒé™è¿åçš„åœ°å€äº§ç”Ÿçš„ç¼ºé¡µ</li>
</ul>
<p>åœ¨å¼‚å¸¸ (trap) å‘ç”Ÿåï¼Œä¼š<red><strong>å€Ÿç”¨å½“å‰æ‰§è¡Œæµçš„æ ˆ</strong></red>ï¼Œåœ¨æ ˆä¸Šä¿å­˜é¢å¤–çš„æ•°æ®å<red><strong>å…³é—­ä¸­æ–­</strong></red>ï¼Œç„¶å**<red>ç›´æ¥åœ¨å½“å‰æ ˆä¸Š**</red>è°ƒç”¨ cte_init æ—¶æ³¨å†Œå¥½çš„ handler å‡½æ•°ã€‚handler è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰§è¡Œæµçš„æŒ‡é’ˆï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥æ‰§è¡Œæµæ‰§è¡Œã€‚</p>
<p><red><strong>å¤šå¤„ç†å™¨ï¼šåˆ†åˆ«å“åº”ä¸­æ–­å’Œå¼‚å¸¸</strong></red>ã€‚å½“ç³»ç»Ÿä¸­æœ‰å¤šä¸ªå¤„ç†å™¨æ—¶ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½å¯èƒ½åŒæ—¶å‘ç”Ÿä¸­æ–­/å¼‚å¸¸ï¼›ä½† AbstractMachine ä»£ç å®ç°ä¿è¯ä¸­æ–­å¤„ç†ä»…æ¶‰åŠå¤„ç†å™¨è‡ªèº«çš„çŠ¶æ€ (ä½†ä¼šä¿®æ”¹å¤„ç†å™¨çš„å†…æ ¸æ ˆ)ã€‚å› æ­¤ <code>cte_init</code> ä¸­æ³¨å†Œçš„å¤„ç†ç¨‹åºåº”å½“å°å¿ƒæ•°æ®ç«äº‰çš„å‘ç”Ÿã€‚</p>
<h3>5.1. <code>cte_init</code>: åˆå§‹åŒ–ä¸Šä¸‹æ–‡æ‰©å±•</h3>
<pre><code class="hljs language-c"><span class="hljs-type">bool</span> <span class="hljs-title function_">cte_init</span><span class="hljs-params">(Context *(*handler)(Event ev, Context *ctx))</span>;
</code></pre>
<p>æ³¨å†Œä¸­æ–­/ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åºï¼šåœ¨ä¸­æ–­/å¼‚å¸¸/ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒAbstractMachine ä¼šç«‹å³ä¿å­˜å½“å‰æ‰§è¡Œæµçš„ä¸Šä¸‹æ–‡ (Context, åŒ…æ‹¬å¯„å­˜å™¨ç°åœºç­‰) åˆ°å½“å‰æ‰§è¡Œæµçš„å†…æ ¸æ ˆ (æ ˆç©ºé—´ç”± kcontext/ucontext æŒ‡å®š)ï¼Œç„¶åè°ƒç”¨ <code>handler</code>ï¼Œå…¶ä¸­å‚æ•° <code>ev</code> æ˜¯äº‹ä»¶çš„ç±»å‹ï¼š</p>
<ul>
<li><code>EVENT_ERROR</code>     - éæ³•è®¿é—®çš„å¼‚å¸¸ï¼Œä¾‹å¦‚ #GP</li>
<li><code>EVENT_IRQ_TIMER</code> - æ—¶é’Ÿä¸­æ–­</li>
<li><code>EVENT_IRQ_IODEV</code> - I/O è®¾å¤‡ä¸­æ–­ (é”®ç›˜ã€ä¸²å£â€¦â€¦)</li>
<li><code>EVENT_PAGEFAULT</code> - ç¼ºé¡µå¼‚å¸¸</li>
<li><code>EVENT_SYSCALL</code>   - ç³»ç»Ÿè°ƒç”¨</li>
<li><code>EVENT_YIELD</code>     - <code>yield()</code> è‡ªé™·</li>
</ul>
<p>è€Œ <code>ctx</code> æ˜¯æŒ‡å‘ä¿å­˜åœ¨å½“å‰æ‰§è¡Œæµä¿¡æ¯çš„æŒ‡é’ˆã€‚<code>handler</code> å¯ä»¥è¿”å›ä»»ä½•åˆæ³•çš„ <code>Context</code> (å¯ä»¥ç”± <code>kcontext</code> åˆ›å»ºï¼Œæˆ–è€…æ˜¯æŸä¸ª <code>handler</code> ä¿å­˜çš„å‚æ•°)ã€‚</p>
<p><red><strong>é™åˆ¶</strong></red>ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ <code>mpe_init</code> ä¹‹å‰ã€‚å¯ä»¥åœ¨ IOE ä¹‹å‰æˆ–ä¹‹ååˆå§‹åŒ–ã€‚</p>
<p><red><strong>ctx çš„ç”Ÿå­˜å‘¨æœŸ</strong></red>ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æ‰§è¡Œæµï¼Œå®ƒå¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>MPE æœªå¯åŠ¨æ—¶çš„ <code>main</code> å‡½æ•°çš„æ‰§è¡Œï¼Œå®ƒä½¿ç”¨ AbstractMachine (TRM) åˆå§‹åŒ–æ—¶çš„å†…æ ¸æ ˆï¼›</li>
<li>MPE å¯åŠ¨å <code>mp_entry</code> å‡½æ•°çš„æ‰§è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨çš„ <code>mp_entry</code> æ‰§è¡Œéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„å†…æ ¸æ ˆï¼›</li>
<li>å…¶ä»–ç”± <code>kcontext</code> åˆ›å»ºçš„ä¸Šä¸‹æ–‡åœ¨ CPU ä¸Šçš„æ‰§è¡Œï¼Œåˆ›å»ºæ—¶ä¼šæŒ‡å®šä¸€ä¸ªå†…æ ¸æ ˆã€‚</li>
</ul>
<p>åœ¨ä¸­æ–­/å¼‚å¸¸å‘ç”Ÿåï¼Œ<red>ä¸­æ–­/å¼‚å¸¸è¿”å›æ—¶çš„ context å°†ä¼šè¢«ä¿å­˜åœ¨å½“å‰æ‰§è¡Œæµçš„å †æ ˆä¸Šã€‚åªæœ‰å½“è¿™ä¸ªæ‰§è¡Œæµè¢«è°ƒåº¦æ‰§è¡Œ (å”¯ä¸€è¢«è°ƒåº¦æ‰§è¡Œçš„å¯èƒ½æ˜¯ <code>handler()</code> çš„è¿”å›) åè¢«å¼¹å‡ºå †æ ˆ</red>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ <code>handler</code> è¿”å›åˆ°å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆ <code>ctx</code> æŒ‡é’ˆæŒ‡å‘çš„ä¸Šä¸‹æ–‡å°†ä¸€ç›´ä¿æŒæœ‰æ•ˆï¼Œç›´åˆ°è¿™ä¸€ä¸Šä¸‹æ–‡è¢«å†æ¬¡è°ƒåº¦æˆ–å†…æ ¸æ ˆè¢«é‡Šæ”¾ã€‚</p>
<p><red><strong>æ ˆçš„ä½¿ç”¨</strong></red>ï¼šå› ä¸º trap ä¼šå€Ÿç”¨å½“å‰æ‰§è¡Œæµçš„å †æ ˆï¼Œå› æ­¤å¿…é¡»ä¿è¯<red><strong>å½“å‰æ‰§è¡Œæµå®Œå…¨æ¸…é™¤æ ˆä¸Šçš„å†…å®¹åæ‰å¯ä»¥å°†æ‰§è¡Œæµåœ¨å¦ä¸€ä¸ªå¤„ç†å™¨ä¸Šå¼€å§‹æ‰§è¡Œ</strong></red>ã€‚</p>
<h3>5.2. <code>iset/ienabled</code>: å¤–éƒ¨ä¸­æ–­ç®¡ç†</h3>
<pre><code class="hljs language-c"><span class="hljs-type">bool</span> <span class="hljs-title function_">ienabled</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">iset</span><span class="hljs-params">(<span class="hljs-type">bool</span> enable)</span>;
</code></pre>
<p>è¯»å–/å†™å…¥å½“å‰å¤„ç†å™¨çš„ä¸­æ–­æ‰“å¼€/å±è”½çŠ¶æ€ã€‚å…¶ä¸­ <code>ienabled/iset</code> çš„ <code>true</code>/<code>false</code> åˆ†åˆ«è¡¨ç¤ºä¸­æ–­æ‰“å¼€/å…³é—­ã€‚æ³¨æ„ä¸­æ–­å…³é—­åªèƒ½å±è”½å¤„ç†å™¨å¤–çš„ä¸­æ–­ (å³ <code>EVENT_IRQ_TIMER</code> å’Œ <code>EVENT_IRQ_IODEV</code>)ï¼Œå¤„ç†å™¨åŒæ­¥äº§ç”Ÿçš„ error, page fault, syscall å’Œ yield ä¸èƒ½å±è”½ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼›<code>ienabled/iset</code> ä»…èƒ½å½±å“å½“å‰æ‰§è¡ŒæŒ‡ä»¤ CPU çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œä¸èƒ½å…³é—­/æŸ¥è¯¢å…¶ä»–å¤„ç†å™¨çš„ä¸­æ–­çŠ¶æ€ã€‚</p>
<h3>5.3. <code>yield</code>: Self-Trapping</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">yield</span><span class="hljs-params">()</span>;
</code></pre>
<p>é™·å…¥å†…æ ¸æ‰§è¡Œï¼Œå°†ä¼šåœ¨å½“å‰å¤„ç†å™¨ä¸Šè°ƒç”¨ <code>handler(EVENT_YIELD, saved_context)</code>ï¼Œå…¶ä¸­ <code>saved_context</code> æ˜¯ä¿å­˜çš„å½“å‰å†…æ ¸ä¸Šä¸‹æ–‡ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ï¼šæ‰§è¡Œ <code>yield</code> çš„å½“å‰å¤„ç†å™¨ä¼šå®Œæˆ self-trappingã€‚</p>
<h3>5.4. <code>kcontext</code>: åˆ›å»ºå†…æ ¸æ€è¿è¡Œçš„ä¸Šä¸‹æ–‡</h3>
<pre><code class="hljs language-c">Context *<span class="hljs-title function_">kcontext</span><span class="hljs-params">(Area kstack, <span class="hljs-type">void</span> (*entry)(<span class="hljs-type">void</span> *), <span class="hljs-type">void</span> *arg)</span>;
</code></pre>
<p>å°† <code>kstack</code> è¡¨ç¤ºçš„ä¸€æ®µå†…å­˜ä½œä¸ºå†…æ ¸æ ˆä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„å†…æ ¸æ€ä¸Šä¸‹æ–‡ï¼Œè¿”å›çš„ <code>Context</code> æŒ‡é’ˆå¯ä»¥åœ¨ä¸­æ–­è¿”å›æ—¶è¢«è°ƒåº¦åˆ°å¤„ç†å™¨ä¸Šæ‰§è¡Œã€‚é¦–æ¬¡æ‰§è¡Œè¿”å›çš„ä¸Šä¸‹æ–‡ä¸­ PC ä¸º <code>entry</code>ï¼Œå¹¶æ­£ç¡®ä¸º <code>entry</code> å‡½æ•°ä¼ é€’äº† <code>arg</code> å‚æ•°ã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ï¼Œä½†è¦æ³¨æ„ kstack åŒºåŸŸçš„åˆæ³•æ€§ï¼Œä¾‹å¦‚ data race æˆ– double allocation éƒ½å¯¼è‡´ undefined behaviorã€‚</p>
<h2>6. VME (Virtual Memory Extension) è™šæ‹Ÿåœ°å€ç©ºé—´</h2>
<p>VME å…è®¸ä¸ºæ‰§è¡Œæµ (ä¸Šä¸‹æ–‡ Context) èµ‹äºˆä¸€ä¸ª â€œè™šæ‹Ÿâ€ çš„å†…å­˜è§†å›¾ï¼Œæ¯å½“è®¿é—®ä»»ä½•å†…å­˜ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span> çš„æ—¶å€™ï¼Œéƒ½å–è®¿é—® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ã€‚VME æä¾›äº†æè¿°ã€ä¿®æ”¹æ•°æ®ç»“æ„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span> çš„æœºåˆ¶ã€‚</p>
<p><red><strong>é™åˆ¶</strong></red>ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ <code>mpe_init</code> ä¹‹å‰ã€‚</p>
<h3>6.1. <code>vme_init</code>: åˆå§‹åŒ–è™šå­˜ç®¡ç†</h3>
<pre><code class="hljs language-c"><span class="hljs-type">bool</span> <span class="hljs-title function_">vme_init</span><span class="hljs-params">(<span class="hljs-type">void</span> *(*pgalloc)(<span class="hljs-type">int</span>), <span class="hljs-type">void</span> (*pgfree)(<span class="hljs-type">void</span> *))</span>;
</code></pre>
<p>åˆå§‹åŒ–è™šæ‹Ÿå­˜å‚¨ã€‚<code>pgalloc</code>ã€<code>pgfree</code> å‡½æ•°åˆ†åˆ«ç”¨äºä¸€ä¸ªç‰©ç†é¡µé¢çš„åˆ†é…å’Œå›æ”¶ã€‚æ³¨æ„ <code>vme_init</code> æ‰§è¡Œæ—¶å°±å¯èƒ½è°ƒç”¨ <code>pgalloc</code>/<code>pgfree</code>ï¼Œä½ éœ€è¦ç¡®ä¿å®ƒä»¬åœ¨ vme_init è°ƒç”¨æ—¶å¤„äºå¯ç”¨çŠ¶æ€ã€‚</p>
<p><red><strong>å¤šå¤„ç†å™¨ï¼šæ³¨æ„</strong></red>ï¼špgalloc/pgfree ä¼šåœ¨ protect, unprotect å’Œ map ä¸­è¢«è°ƒç”¨ï¼Œå› æ­¤è¯·ç¡®ä¿ä½ çš„ pgalloc/pgfree æ˜¯å¤šå¤„ç†å™¨å®‰å…¨çš„ã€‚</p>
<h3>6.2. <code>protect</code>/<code>unprotect</code>: åœ°å€ç©ºé—´ç®¡ç†</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">protect</span><span class="hljs-params">(AddrSpace *as)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">unprotect</span><span class="hljs-params">(AddrSpace *as)</span>;
</code></pre>
<p>åˆ›å»º/é”€æ¯ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œå…¶ä¸­ <code>protect(as)</code> åï¼Œ<code>as</code> ä¼šè¢«åˆå§‹åŒ–ï¼š</p>
<ul>
<li><code>as->pgsize</code> æ˜¯é¡µé¢çš„å¤§å° (AbstractMachine å¯èƒ½è¿”å›ä¸å®é™…æœºå™¨ä¸åŒçš„é¡µé¢å¤§å°)ã€‚</li>
<li><code>as->area</code> æ˜¯è¢«ä¿æŠ¤çš„ (ç”¨æˆ·æ€å¯è®¿é—®) åœ°å€ç©ºé—´èŒƒå›´ã€‚</li>
<li><code>as->ptr</code> æ˜¯ AbstractMachine ç§æœ‰çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ x86-qemu çš„å®ç°æ˜¯ CR3 å¯„å­˜å™¨çš„æ•°å€¼ã€‚</li>
</ul>
<p><red><strong>å¤šå¤„ç†å™¨ï¼šæ³¨æ„</strong></red>ã€‚protect/unprotect ä¼šè°ƒç”¨ pgalloc/pgfree åˆ†é…æˆ–é‡Šæ”¾é¡µé¢ï¼Œå¹¶ä¼šå†™å…¥ <code>as</code>ã€‚</p>
<h3>6.3. <code>map</code>: ä¿®æ”¹åœ°å€ç©ºé—´æ˜ å°„</h3>
<pre><code class="hljs language-c"><span class="hljs-type">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(AddrSpace *as, <span class="hljs-type">void</span> *vaddr, <span class="hljs-type">void</span> *paddr, <span class="hljs-type">int</span> prot)</span>;
</code></pre>
<p>å¯¹åœ°å€ç©ºé—´ <code>as</code> å»ºç«‹ <code>vaddr</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">â†’</span></span></span></span> <code>paddr</code> çš„æ˜ å°„ï¼Œå½“ <code>paddr</code> ä¸º <code>NULL</code> æ—¶ï¼Œå–æ¶ˆè¯¥é¡µé¢çš„æ˜ å°„ã€‚prot ç”±ä»¥ä¸‹ flag ç»„æˆã€‚æ³¨æ„ <code>vaddr</code> å’Œ <code>paddr</code> å¿…é¡»å¯¹é½åˆ°é¡µé¢è¾¹ç•Œ (<code>as->pgsize</code>)ï¼Œä¸” <code>vaddr</code> å¿…é¡»ä½äº <code>as->area</code>ã€<code>paddr</code> æŒ‡å‘çš„é¡µé¢ä½äº <code>heap</code>ã€‚</p>
<pre><code class="hljs language-c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MMAP_NONE  0x00000000 <span class="hljs-comment">// no access</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MMAP_READ  0x00000001 <span class="hljs-comment">// can read</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MMAP_WRITE 0x00000002 <span class="hljs-comment">// can write</span></span>
</code></pre>
<p><red><strong>å¤šå¤„ç†å™¨ï¼šæ³¨æ„</strong></red>ã€‚map ä¼šè°ƒç”¨ pgalloc/pgfree åˆ†é…æˆ–é‡Šæ”¾é¡µé¢ã€‚</p>
<h3>6.4. <code>ucontext</code>: åˆ›å»ºè¢«ä¿æŠ¤çš„ç”¨æˆ·æ€è¿›ç¨‹ä¸Šä¸‹æ–‡</h3>
<pre><code class="hljs language-c">Context *<span class="hljs-title function_">ucontext</span><span class="hljs-params">(AddrSpace *as, Area kstack, <span class="hljs-type">void</span> *entry)</span>;
</code></pre>
<p>ä¸ <code>kcontext</code> ç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ªå¯è¢«è°ƒåº¦æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå®ƒçš„æ‰§è¡Œä½äºä½æƒé™çš„ç”¨æˆ·æ€ï¼Œåœ°å€ç©ºé—´ç”± <code>as</code> æŒ‡å®šï¼Œåˆå§‹ PC ä¸º <code>entry</code>ã€‚åœ¨ç”¨æˆ·æ€å‘ç”Ÿä¸­æ–­/å¼‚å¸¸ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ (kernel) è¿è¡Œï¼Œå¹¶åˆ‡æ¢åˆ°å†…æ ¸æ ˆã€‚ä¸­æ–­/å¼‚å¸¸å¤„ç†ç¨‹åº (åŒ…æ‹¬ä¿å­˜çš„ä¸Šä¸‹æ–‡) éƒ½å­˜å‚¨åœ¨ <code>kstack</code> æŒ‡å®šçš„å†…æ ¸æ ˆã€‚</p>
<p><green><strong>å¤šå¤„ç†å™¨ï¼šå®‰å…¨</strong></green>ã€‚<code>ucontext</code> ä»…ä¿®æ”¹ <code>kstack</code> ä¸­çš„æ•°å€¼ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸Šä¸‹æ–‡ã€‚</p></div></div><div class="bg-neutral-100 text-center text-neutral-600 dark:bg-neutral-600 dark:text-neutral-200 lg:text-left"><div class="bg-neutral-200 p-6 text-center dark:bg-neutral-700"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons License: BY-NC 4.0</a><br/><a href="https://beian.miit.gov.cn/">è‹ ICP å¤‡ 2020049101 å·</a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    h2: \"h2\",\n    p: \"p\",\n    ul: \"ul\",\n    li: \"li\",\n    code: \"code\",\n    pre: \"pre\",\n    span: \"span\",\n    math: \"math\",\n    semantics: \"semantics\",\n    mrow: \"mrow\",\n    mi: \"mi\",\n    annotation: \"annotation\",\n    msup: \"msup\",\n    mo: \"mo\",\n    h3: \"h3\",\n    strong: \"strong\",\n    a: \"a\"\n  }, _provideComponents(), props.components), {Box} = _components;\n  if (!Box) _missingMdxReference(\"Box\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"AbstractMachine è§„çº¦ (Specifications)\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"1. åŸºæœ¬æ¦‚å¿µ\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"AbstractMachine ä¸Šè¿è¡Œçš„ç¨‹åºç§°ä¸º â€œkernelâ€ (å†…æ ¸)ã€‚è¿™ä¸ªåå­—é€šå¸¸è¡¨ç¤ºç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šã€å¯¹ç¡¬ä»¶æœ‰ç›´æ¥æ§åˆ¶çš„ä»£ç ã€‚ä¸ä»…æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œåƒåœ¨ GPU ä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿç§°ä¸º â€œkernelâ€ã€‚\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"AbstractMachine ä¸Šçš„ kernel è¢«ç¼–è¯‘æˆä¸€ä¸ªç›®æ ‡ä½“ç³»ç»“æ„/å¹³å°ä¸Šå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¹¶å¯ä»¥ç›´æ¥åœ¨ç¯å¢ƒ (å¦‚è®¡ç®—æœºç¡¬ä»¶ã€è™šæ‹Ÿæœºç­‰) ä¸Šæ‰§è¡Œï¼Œä¾‹å¦‚ï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"x86 (x86 32-bit), qemu (æ¨¡æ‹Ÿå™¨)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"x86_64 (x86 64-bit), qemu (æ¨¡æ‹Ÿå™¨)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"riscv64 (RISC-V 64-bit), nemu (æ¨¡æ‹Ÿå™¨)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"native (ä½œä¸ºæœ¬åœ°è¿›ç¨‹è¿è¡Œ)\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨ã€Šæ“ä½œç³»ç»Ÿã€‹å®éªŒä¸­ï¼Œè¯·å¤§å®¶ä»¥ x86_64-qemu ä¸ºåŸºå‡†å¹³å°ï¼Œå…¶ä»–å®ç°ä½œä¸ºå‚è€ƒã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2. TRM (Turing Machine): C è¯­è¨€è¿è¡Œç¯å¢ƒ\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Kernel æ˜¯ä¸€ä¸ª C è¯­è¨€ä¹¦å†™çš„ç¨‹åºï¼ŒC è¯­è¨€ä»£ç å®šä¹‰äº†ç¨‹åº (kernel) çš„è¿è¡Œæ—¶çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"åªè¯»ä»£ç ï¼Œç”± kernel ä¸­å®šä¹‰çš„ C è¯­è¨€å‡½æ•°æ„æˆã€‚\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å‡½æ•°è°ƒç”¨å½¢æˆçš„æ ˆã€‚æ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šåœ¨æ ˆä¸Šæ”¾ç½®ä¸€ä¸ªæ–°çš„æ ˆå¸§ã€‚æ¦‚å¿µä¸Šï¼Œæ¯ä¸€ä¸ªæ ˆå¸§éƒ½æœ‰ç‹¬ç«‹çš„ PC (ç¨‹åºè®¡æ•°å™¨)ã€å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"åªè¯»æ•°æ®ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²å¸¸é‡ã€‚å†™å…¥åªè¯»æ•°æ®å°†å¯¼è‡´ undefined behaviorã€‚\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"è¯»å†™æ•°æ®ã€‚é™æ€å˜é‡å±äºè¯»å†™æ•°æ®ï¼›æ­¤å¤–ï¼Œæœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„è¯»å†™æ•°æ® (å¤§å°ç”±å…·ä½“å®ç°å†³å®š) ä½œä¸ºå¯ç”¨çš„å †åŒºã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ä»¥ä¸Šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªå¹³å¦çš„åœ°å€ç©ºé—´ä¸­ (åªè¯»ä»£ç ã€æ ˆã€æ•°æ®ã€å †åŒºäº’ä¸ç›¸äº¤ä¸”è¿ç»­å­˜å‚¨)ï¼Œå¯¹ç›¸åº”ç¬¦å·æ‰§è¡Œå–åœ°å€æ“ä½œ \", _jsx(_components.code, {\n        children: \"\u0026\"\n      }), \" ä¼šå¾—åˆ°æŒ‡å‘ç›¸åº”åŒºåŸŸçš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¯ä»¥è½¬æ¢ä¸º \", _jsx(_components.code, {\n        children: \"intptr_t\"\n      }), \" ç±»å‹çš„æ•´æ•°ã€‚ç¨‹åºå¯åŠ¨æ—¶ï¼Œkernel è¢« TRM åŠ è½½ï¼Œkernel è¿è¡Œæ—¶å¯ä½¿ç”¨çš„æ ˆå¤§å°ä¸å°‘äº 4 KiBï¼›å †å†…å­˜çš„å¤§å°å’Œä½ç½®åœ¨è¿è¡Œæ—¶ç¡®å®šï¼Œé€šè¿‡ \", _jsx(_components.code, {\n        children: \"heap\"\n      }), \" å˜é‡è·å–ï¼Œkernel å¯¹åº”çš„çŠ¶æ€æœºå¼€å§‹æ‰§è¡Œã€‚AbstractMachine ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œä» \", _jsx(_components.code, {\n        children: \"main\"\n      }), \" å‡½æ•°å¼€å§‹æ‰§è¡Œï¼ŒåŒ…å«å‚æ•° \", _jsx(_components.code, {\n        children: \"const char *args\"\n      }), \"ï¼Œ\", _jsx(_components.code, {\n        children: \"args\"\n      }), \" ä¿å­˜åœ¨æ ˆå¸§ä¸­ï¼›\", _jsx(_components.code, {\n        children: \"args\"\n      }), \" æŒ‡å‘çš„å†…å®¹ä¸ºåªè¯»æ•°æ®ã€‚\"]\n    }), \"\\n\", _jsxs(Box, {\n      logo: \"ğŸ—’ï¸\",\n      title: \"main() çš„å‚æ•°å’Œè¿”å›å€¼\",\n      children: [_jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-c\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"main\"\n          }), _jsxs(_components.span, {\n            className: \"hljs-params\",\n            children: [\"(\", _jsx(_components.span, {\n              className: \"hljs-type\",\n              children: \"const\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-type\",\n              children: \"char\"\n            }), \" *args)\"]\n          }), \" {\\n    ...\\n}\\n\"]\n        })\n      }), _jsxs(_components.p, {\n        children: [\"çš„å‚æ•°åœ¨ \", _jsx(_components.code, {\n          children: \"make run\"\n        }), \" å‰é€šè¿‡è®¾ç½® \", _jsx(_components.code, {\n          children: \"mainargs\"\n        }), \" ç¯å¢ƒå˜é‡æŒ‡å®šã€‚å‚æ•°å­—ç¬¦ä¸²çš„é•¿åº¦ (åŒ…å«æœ«å°¾çš„ \", _jsx(_components.code, {\n          children: \"\\\\0\"\n        }), \") ä¸èƒ½è¶…è¿‡ 1024 å­—èŠ‚ã€‚main å‡½æ•°è¿”å›åï¼Œkernel å®Œæˆè¿è¡Œã€‚å‡è®¾è¿”å›å€¼ä¸º \", _jsx(_components.code, {\n          children: \"r\"\n        }), \"ï¼ŒAbstractMachine ä¼šæ‰§è¡Œ \", _jsx(_components.code, {\n          children: \"halt(r)\"\n        }), \" ç»ˆæ­¢ã€‚\"]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"æˆ‘ä»¬ä¸å¦¨å‡å®šæ‰§è¡Œä¸€æ¡ C è¯­è¨€è¯­å¥ä¼šä»çŠ¶æ€ \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsx(_components.mi, {\n                  children: \"s\"\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"s\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.4306em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"s\"\n            })]\n          })\n        })]\n      }), \" è¿ç§»åˆ° \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsxs(_components.msup, {\n                  children: [_jsx(_components.mi, {\n                    children: \"s\"\n                  }), _jsx(_components.mo, {\n                    mathvariant: \"normal\",\n                    lspace: \"0em\",\n                    rspace: \"0em\",\n                    children: \"â€²\"\n                  })]\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"s'\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.7519em\"\n              }\n            }), _jsxs(_components.span, {\n              className: \"mord\",\n              children: [_jsx(_components.span, {\n                className: \"mord mathnormal\",\n                children: \"s\"\n              }), _jsx(_components.span, {\n                className: \"msupsub\",\n                children: _jsx(_components.span, {\n                  className: \"vlist-t\",\n                  children: _jsx(_components.span, {\n                    className: \"vlist-r\",\n                    children: _jsx(_components.span, {\n                      className: \"vlist\",\n                      style: {\n                        height: \"0.7519em\"\n                      },\n                      children: _jsxs(_components.span, {\n                        style: {\n                          top: \"-3.063em\",\n                          marginRight: \"0.05em\"\n                        },\n                        children: [_jsx(_components.span, {\n                          className: \"pstrut\",\n                          style: {\n                            height: \"2.7em\"\n                          }\n                        }), _jsx(_components.span, {\n                          className: \"sizing reset-size6 size3 mtight\",\n                          children: _jsx(_components.span, {\n                            className: \"mord mtight\",\n                            children: _jsx(_components.span, {\n                              className: \"mord mtight\",\n                              children: \"â€²\"\n                            })\n                          })\n                        })]\n                      })\n                    })\n                  })\n                })\n              })]\n            })]\n          })\n        })]\n      }), \"ï¼Œè®°ä½œ \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsxs(_components.mrow, {\n                children: [_jsx(_components.mi, {\n                  children: \"s\"\n                }), _jsx(_components.mo, {\n                  children: \"â†’\"\n                }), _jsxs(_components.msup, {\n                  children: [_jsx(_components.mi, {\n                    children: \"s\"\n                  }), _jsx(_components.mo, {\n                    mathvariant: \"normal\",\n                    lspace: \"0em\",\n                    rspace: \"0em\",\n                    children: \"â€²\"\n                  })]\n                })]\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"s\\\\to s'\"\n              })]\n            })\n          })\n        }), _jsxs(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: [_jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.4306em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"s\"\n            }), _jsx(_components.span, {\n              className: \"mspace\",\n              style: {\n                marginRight: \"0.2778em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mrel\",\n              children: \"â†’\"\n            }), _jsx(_components.span, {\n              className: \"mspace\",\n              style: {\n                marginRight: \"0.2778em\"\n              }\n            })]\n          }), _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.7519em\"\n              }\n            }), _jsxs(_components.span, {\n              className: \"mord\",\n              children: [_jsx(_components.span, {\n                className: \"mord mathnormal\",\n                children: \"s\"\n              }), _jsx(_components.span, {\n                className: \"msupsub\",\n                children: _jsx(_components.span, {\n                  className: \"vlist-t\",\n                  children: _jsx(_components.span, {\n                    className: \"vlist-r\",\n                    children: _jsx(_components.span, {\n                      className: \"vlist\",\n                      style: {\n                        height: \"0.7519em\"\n                      },\n                      children: _jsxs(_components.span, {\n                        style: {\n                          top: \"-3.063em\",\n                          marginRight: \"0.05em\"\n                        },\n                        children: [_jsx(_components.span, {\n                          className: \"pstrut\",\n                          style: {\n                            height: \"2.7em\"\n                          }\n                        }), _jsx(_components.span, {\n                          className: \"sizing reset-size6 size3 mtight\",\n                          children: _jsx(_components.span, {\n                            className: \"mord mtight\",\n                            children: _jsx(_components.span, {\n                              className: \"mord mtight\",\n                              children: \"â€²\"\n                            })\n                          })\n                        })]\n                      })\n                    })\n                  })\n                })\n              })]\n            })]\n          })]\n        })]\n      }), \"ã€‚Kernel åœ¨è¿è¡Œæ—¶å…è®¸è°ƒç”¨ AbstractMachine APIï¼Œæ­¤æ—¶çš„çŠ¶æ€è¿ç§» \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsxs(_components.mrow, {\n                children: [_jsx(_components.mi, {\n                  children: \"s\"\n                }), _jsx(_components.mo, {\n                  children: \"â†’\"\n                }), _jsxs(_components.msup, {\n                  children: [_jsx(_components.mi, {\n                    children: \"s\"\n                  }), _jsx(_components.mo, {\n                    mathvariant: \"normal\",\n                    lspace: \"0em\",\n                    rspace: \"0em\",\n                    children: \"â€²\"\n                  })]\n                })]\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"s\\\\to s'\"\n              })]\n            })\n          })\n        }), _jsxs(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: [_jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.4306em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"s\"\n            }), _jsx(_components.span, {\n              className: \"mspace\",\n              style: {\n                marginRight: \"0.2778em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mrel\",\n              children: \"â†’\"\n            }), _jsx(_components.span, {\n              className: \"mspace\",\n              style: {\n                marginRight: \"0.2778em\"\n              }\n            })]\n          }), _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.7519em\"\n              }\n            }), _jsxs(_components.span, {\n              className: \"mord\",\n              children: [_jsx(_components.span, {\n                className: \"mord mathnormal\",\n                children: \"s\"\n              }), _jsx(_components.span, {\n                className: \"msupsub\",\n                children: _jsx(_components.span, {\n                  className: \"vlist-t\",\n                  children: _jsx(_components.span, {\n                    className: \"vlist-r\",\n                    children: _jsx(_components.span, {\n                      className: \"vlist\",\n                      style: {\n                        height: \"0.7519em\"\n                      },\n                      children: _jsxs(_components.span, {\n                        style: {\n                          top: \"-3.063em\",\n                          marginRight: \"0.05em\"\n                        },\n                        children: [_jsx(_components.span, {\n                          className: \"pstrut\",\n                          style: {\n                            height: \"2.7em\"\n                          }\n                        }), _jsx(_components.span, {\n                          className: \"sizing reset-size6 size3 mtight\",\n                          children: _jsx(_components.span, {\n                            className: \"mord mtight\",\n                            children: _jsx(_components.span, {\n                              className: \"mord mtight\",\n                              children: \"â€²\"\n                            })\n                          })\n                        })]\n                      })\n                    })\n                  })\n                })\n              })]\n            })]\n          })]\n        })]\n      }), \" ç”± AbstractMachine å®šä¹‰ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"2.1. \", _jsx(_components.code, {\n        children: \"Area\"\n      }), \" ç»“æ„ä½“\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"typedef\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"hljs-class\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"struct\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title\",\n            children: \"Area\"\n          }), \" {\"]\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" *start, *end;\\n} Area;\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è¡¨ç¤ºå·¦é—­å³å¼€åŒºé—´ \", _jsx(_components.code, {\n        children: \"[start, end)\"\n      }), \" çš„ä¸€æ®µå†…å­˜ã€‚æˆ‘ä»¬å‡è®¾åœ°å€ç©ºé—´çš„æœ€åä¸€ä¸ªå­—èŠ‚ (ä¾‹å¦‚ 32-bit å¹³å°ä¸‹åœ°å€ \", _jsx(_components.code, {\n        children: \"0xffffffff\"\n      }), \") æ°¸è¿œä¸ä¼šè¢«åŒ…å«åœ¨æŸä¸ª \", _jsx(_components.code, {\n        children: \"Area\"\n      }), \" ä¸­ï¼Œå› æ­¤ \", _jsx(_components.code, {\n        children: \"end\"\n      }), \" ä¸ä¼šæº¢å‡ºã€‚ä¾‹å¦‚ï¼Œ32-bit å¹³å°ä¸‹çš„æŸä¸ª Area:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [\"(Area) {\\n  .start = (\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" *)\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \";\\n  .end   = (\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" *)\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0xffffffff\"\n        }), \";\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åˆ™å®ƒæœ€åä¸€ä¸ªå­—èŠ‚çš„åœ°å€æ˜¯ \", _jsx(_components.code, {\n        children: \"0xfffffffe\"\n      }), \"ã€‚\", _jsx(_components.code, {\n        children: \"klib-macros.h\"\n      }), \" æä¾›äº†ä¸€äº›åŒºé—´çš„æ„é€ /åˆ¤æ–­çš„å®ï¼š\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"define\"\n          }), \" RANGE(st, ed)       (Area) { .start = (void *)(st), .end = (void *)(ed) }\"]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"define\"\n          }), \" IN_RANGE(ptr, area) ((area).start \u003c= (ptr) \u0026\u0026 (ptr) \u003c (area).end)\"]\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"2.2. \", _jsx(_components.code, {\n        children: \"heap\"\n      }), \": kernel å¯ç”¨çš„ç‰©ç†å†…å­˜å †åŒº\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"extern\"\n        }), \" Area heap;\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"æ ‡è®°äº†ä¸€æ®µè¿ç»­çš„ã€ä»£ç å¯ä»¥ä½¿ç”¨çš„ç‰©ç†å†…å­˜ \", _jsx(_components.code, {\n        children: \"[heap.start, heap.end)\"\n      }), \"ï¼Œè¿™æ®µå†…å­˜ (å †åŒº) kernel å¯ä»¥ä»»æ„è¯»å†™ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚\", _jsx(_components.code, {\n        children: \"heap\"\n      }), \" åœ¨ \", _jsx(_components.code, {\n        children: \"main\"\n      }), \" è¢«è°ƒç”¨å‰åˆå§‹åŒ–ï¼Œä¹‹åä¸ä¼šæ”¹å˜ (ä»»æ„å¤„ç†å™¨éƒ½å¯ä»¥è¯»å–å®ƒ)ã€‚ä¿®æ”¹ \", _jsx(_components.code, {\n        children: \"heap\"\n      }), \" å¯¼è‡´ undefined behaviorï¼›Kernel æ²¡æœ‰ä»»ä½•ç†ç”±éœ€è¦ä¿®æ”¹å®ƒã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"2.3. \", _jsx(_components.code, {\n        children: \"putch\"\n      }), \": æ‰“å°å­—ç¬¦\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"putch\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"char\"\n          }), \" ch)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å‘é»˜è®¤çš„è°ƒè¯•ç»ˆç«¯æ‰“å° ASCII ç ä¸º \", _jsx(_components.code, {\n        children: \"ch\"\n      }), \" çš„å­—ç¬¦ï¼š\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"å¯¹ x86 (x86-64) QEMU å¹³å°ï¼Œå‘ COM1 è¾“å‡ºï¼Œé€šè¿‡ QEMU çš„ \", _jsx(_components.code, {\n          children: \"-serial\"\n        }), \" å¯ä»¥é€‰æ‹©è¾“å‡ºä½ç½®ã€‚\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å¯¹ native å¹³å°ï¼Œè¾“å‡ºåˆ° stdoutã€‚\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å¯¹çœŸå®çš„ç¡¬ä»¶å¹³å°ï¼Œå‘è°ƒè¯•ä¸²å£è¾“å‡ºã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚putch æ˜¯æœ€åŸºæœ¬çš„è°ƒè¯•åŠŸèƒ½ï¼Œå› æ­¤ AbstractMachine çš„å®ç°è´Ÿè´£ä¿è¯å®ƒåœ¨å¤šå¤„ç†å™¨ä¸Šçš„å®‰å…¨æ€§ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"2.4. \", _jsx(_components.code, {\n        children: \"halt\"\n      }), \": ç»ˆæ­¢ AbstractMachine\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"halt\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" code)\"]\n        }), \" __\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"attribute__\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"((__noreturn__))\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ç«‹å³ç»ˆæ­¢æ•´ä¸ª AbstractMachine çš„è¿è¡Œï¼Œå¹¶è¿”å›æ•°å­—ç¼–å· \", _jsx(_components.code, {\n        children: \"code\"\n      }), \" (0-255)ï¼š\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"å¯¹ QEMU å¹³å°ï¼Œè™šæ‹Ÿæœºå°†ç›´æ¥ç»ˆæ­¢ï¼Œç»ˆæ­¢å‰ä¼šå‘è°ƒè¯•ç»ˆç«¯æ‰“å°ä¿¡æ¯ (ä¾‹å¦‚è¿”å›ä»£ç )ã€‚\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"å¯¹ native å¹³å°ï¼Œä»£ç å°†é€€å‡ºï¼Œè¿›ç¨‹çš„è¿”å›ä»£ç ä¸º \", _jsx(_components.code, {\n          children: \"code\"\n        }), \"ã€‚\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å¯¹çœŸå®çš„ç¡¬ä»¶å¹³å°ï¼Œæ ¹æ®ç¡¬ä»¶çš„æ”¯æŒå…³é—­æˆ–è¿›å…¥æ­»å¾ªç¯çŠ¶æ€ã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚åœ¨ä»»æ„å¤„ç†å™¨ä¸Šæ‰§è¡Œ \", _jsx(_components.code, {\n        children: \"halt\"\n      }), \" éƒ½ä¼šç»ˆæ­¢æ•´ä¸ª Kernel çš„æ‰§è¡Œã€‚\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"3. MPE (Multi-Processing Extension) å…±äº«å†…å­˜å¤šå¤„ç†å™¨\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è¿›å…¥å…±äº«å†…å­˜å¤šå¤„ç†å™¨æ¨¡å¼ã€‚å‡è®¾ç³»ç»Ÿä¸­æœ‰ \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsx(_components.mi, {\n                  children: \"n\"\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"n\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.4306em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"n\"\n            })]\n          })\n        })]\n      }), \" ä¸ªå¤„ç†å™¨ï¼Œåœ¨å®Œæˆ MPE åˆå§‹åŒ–åï¼Œç³»ç»Ÿä¸­å°±æœ‰å¤šä¸ªå¹¶è¡Œæ‰§è¡Œã€å…±äº«å†…å­˜ä¸”æ‹¥æœ‰ç‹¬ç«‹å †æ ˆçš„çŠ¶æ€æœºã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"æ•°æ®ç«äº‰\"\n        })\n      }), \"ï¼šä¸¤ä¸ªå¤„ç†å™¨åŒæ—¶ (åœ¨çŠ¶æ€æœºæ¨¡å‹ä¸­æ„å‘³ç€å…ˆå) è®¿é—®ä¸€ä¸ªå…±äº«å†…å­˜ä½ç½®ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™æ˜¯æ•°æ®ç«äº‰ã€‚æ•°æ®ç«äº‰ (data race) åœ¨ AbstractMachine æ˜¯ undefined behaviorï¼Œåº”å½“ä¸¥æ ¼é¿å…ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"3.1. \", _jsx(_components.code, {\n        children: \"mpe_init\"\n      }), \": å¯åŠ¨å¤šå¤„ç†å™¨\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"mpe_init\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" (*entry)())\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å¯åŠ¨ç³»ç»Ÿä¸­å¤šå¤„ç†å™¨çš„æ‰§è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½è·³è½¬åˆ° \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \" å¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œæµå…±äº«ä»£ç ã€æ•°æ®ï¼›æ¯ä¸ªæ‰§è¡Œæµæœ‰ç‹¬ç«‹çš„å †æ ˆå’Œå¯„å­˜å™¨ï¼Œä¸” entry è¿è¡Œæ—¶å¯ä½¿ç”¨çš„æ ˆå¤§å°ä¸å°‘äº 4 KiBã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"é™åˆ¶\"\n        })\n      }), \"ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­ï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ (å¤šæ¬¡è°ƒç”¨å)ï¼Œä¸”è°ƒç”¨å \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \" ä¸èƒ½è¿”å›ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"3.2. \", _jsx(_components.code, {\n        children: \"cpu_count\"\n      }), \": å¤„ç†å™¨ä¸ªæ•°\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"cpu_count\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"()\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è¿”å›ç³»ç»Ÿä¸­å¤„ç†å™¨çš„ä¸ªæ•°ï¼Œåœ¨æ•´ä¸ª AbstractMachine æ‰§è¡ŒæœŸé—´æ•°å€¼ä¸ä¼šå˜åŒ–ã€‚\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚ç”±äºå¤„ç†å™¨æ•°é‡ä¸å˜ï¼Œå› æ­¤ \", _jsx(_components.code, {\n        children: \"cpu_count\"\n      }), \" çš„å®ç°é€šå¸¸å®ç°æ˜¯ä¸€ä¸ªå…±äº«å†…å­˜ (æˆ–è®¾å¤‡å¯„å­˜å™¨) çš„è¯»æ“ä½œã€‚ç¼–ç¨‹æ—¶ (ä¾‹å¦‚å®ç°æ“ä½œç³»ç»Ÿæ—¶) ä½ å¯ä»¥å‡è®¾ç³»ç»Ÿä¸­å¤„ç†å™¨çš„ä¸ªæ•°ä¸è¶…è¿‡ 8 ä¸ªã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"3.3. \", _jsx(_components.code, {\n        children: \"cpu_current\"\n      }), \": å½“å‰å¤„ç†å™¨ç¼–å·\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"cpu_current\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"()\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è¿”å›å½“å‰æ‰§è¡Œæµçš„ CPU ç¼–å·ï¼Œä» \", _jsx(_components.code, {\n        children: \"0\"\n      }), \" å¼€å§‹ï¼Œä¾‹å¦‚ \", _jsx(_components.code, {\n        children: \"cpu_count() == 4\"\n      }), \"ï¼Œåˆ™åœ¨å››ä¸ª CPU ä¸Šåˆ†åˆ«è°ƒç”¨ \", _jsx(_components.code, {\n        children: \"cpu_current()\"\n      }), \" å°†åˆ†åˆ«å¾—åˆ° \", _jsx(_components.code, {\n        children: \"0\"\n      }), \", \", _jsx(_components.code, {\n        children: \"1\"\n      }), \", \", _jsx(_components.code, {\n        children: \"2\"\n      }), \", \", _jsx(_components.code, {\n        children: \"3\"\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚ä»»ä½•å¤„ç†å™¨åœ¨ä»»ä½•æ—¶å€™çš†å¯è°ƒç”¨ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"3.4. \", _jsx(_components.code, {\n        children: \"atomic_xchg\"\n      }), \": å†…å­˜äº¤æ¢\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"atomic_xchg\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"volatile\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" *addr, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" newval)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åŸå­ (ä¸ä¼šè¢«å…¶ä»–å¤„ç†å™¨çš„åŸå­æ“ä½œæ‰“æ–­) åœ°äº¤æ¢å†…å­˜åœ°å€ä¸­çš„æ•°å€¼ï¼Œç­‰ä»·äºä»¥ä¸‹ C ä»£ç ï¼š\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"atomic_xchg\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"volatile\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" *addr, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" newval)\"]\n        }), \" {\\n  \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"int\"\n        }), \" *ret = *addr;\\n  *addr = newval;\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" ret;\\n}\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚ä½ å¯ä»¥å‡è®¾è¿™æ˜¯ Kernel ä¸­å”¯ä¸€æ”¯æŒçš„åŸå­æ“ä½œï¼Œå¯ä»¥ç”¨äºæ¶ˆé™¤æ•°æ®ç«äº‰ã€‚å¦‚æœä½ å¸Œæœ›ä½¿ç”¨æ›´å¤æ‚çš„åŸå­æ“ä½œï¼Œåœ¨æ”¯æŒçš„ä½“ç³»ç»“æ„ä¸Šå¯ä»¥è€ƒè™‘ \", _jsx(_components.code, {\n        children: \"stdatomic.h\"\n      }), \" å’Œ GCC builtin çš„å‡½æ•°ã€‚\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"4. IOE (I/O Extension) è®¾å¤‡ç®¡ç†\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä¸ºäº†å®ç°æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€äº›åŸºç¡€çš„ I/O è®¾å¤‡è®¿é—®ã€‚åœ¨ AbstractMachine ä¸­ï¼Œæˆ‘ä»¬å¯¹å¸¸è§çš„è®¾å¤‡è¿›è¡Œäº†æŠ½è±¡ï¼ŒæŠŠå®ƒä»¬ç®€åŒ–ä¸ºäº†ä¸€ç»„å¯ä»¥è¯»æˆ–å†™çš„æ§åˆ¶å¯„å­˜å™¨ï¼Œé€šè¿‡è¯»/å†™è¿™äº›å¯„å­˜å™¨å®ç°è®¾å¤‡çŠ¶æ€çš„è¯»å–å’Œæ§åˆ¶ã€‚\"\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"4.1. \", _jsx(_components.code, {\n        children: \"ioe_init\"\n      }), \": åˆå§‹åŒ– I/O æ‰©å±•\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"bool\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ioe_init\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"()\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"å®Œæˆç³»ç»Ÿä¸­ I/O è®¾å¤‡çš„åˆå§‹åŒ–ã€‚\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"é™åˆ¶\"\n        })\n      }), \"ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ \", _jsx(_components.code, {\n        children: \"mpe_init\"\n      }), \" ä¹‹å‰ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"4.2. \", _jsx(_components.code, {\n        children: \"ioe_read/ioe_write\"\n      }), \": I/O è®¾å¤‡è¯»å†™\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ioe_read\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" reg, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *buf)\"]\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ioe_write\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" reg, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *buf)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ä»ç¼–å·ä¸º \", _jsx(_components.code, {\n        children: \"reg\"\n      }), \" çš„å¯„å­˜å™¨è¯»å–/å†™å…¥ï¼Œè¯»å–/å†™å…¥çš„æ•°æ®å–å†³äºå¯„å­˜å™¨çš„ç¼–å·ã€‚è®¾å¤‡å¯èƒ½ä¼šå¯¹å¯„å­˜å™¨çš„ä½¿ç”¨ä½œå‡ºé¢å¤–çš„è§„å®šï¼Œè¯·å‚è€ƒ \", _jsx(_components.a, {\n        href: \"AM_Devices.md\",\n        children: \"Abstract Machine è®¾å¤‡æ–‡æ¡£\"\n      }), \"ã€‚ä¸ºäº†å‡å°‘å¤§å®¶å®šä¹‰é¢å¤–çš„å˜é‡ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ klib-macros.h ä¸­å°è£…åçš„å®è®¿é—®è®¾å¤‡ï¼Œä¾‹å¦‚ï¼š\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [\"*rtc = io_read(AM_TIMER_RTC);\\nio_read(AM_GPU_STATUS).ready;\\nio_write(UART_TX, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'X'\"\n        }), \");\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šä¸å®‰å…¨\"\n        })\n      }), \"ï¼šå¯¹åŒä¸€ä¸ª I/O è®¾å¤‡çš„è®¿é—®å¿…é¡»äº’æ–¥ã€‚å€¼å¾—é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œ\", _jsx(_components.code, {\n        children: \"ioe_read\"\n      }), \" å’Œ \", _jsx(_components.code, {\n        children: \"ioe_write\"\n      }), \" çš„ä»£ç å¯ä»¥è¢« CTE ä¸­æ–­ (è¿™æ˜¯å…è®¸çš„)ã€‚ä½† Kernel éœ€è¦ä¿è¯åœ¨\", _jsxs(\"red\", {\n        children: [\"ä»»æ„æ—¶åˆ»å¯¹åŒä¸€ä¸ªè®¾å¤‡åªå…è®¸æœ‰ä¸€ä¸ªå°šæœªè¿”å›çš„ \", _jsx(_components.code, {\n          children: \"ioe_read\"\n        }), \" æˆ– \", _jsx(_components.code, {\n          children: \"ioe_write\"\n        }), \" æ“ä½œ\"]\n      }), \"ï¼Œå¦åˆ™å°†å¯¼è‡´ undefined behaviorã€‚\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"5. CTE (Context Extension) ä¸Šä¸‹æ–‡å’Œä¸­æ–­ç®¡ç†\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"TRMã€MPE å’Œ IOE èƒ½å¤Ÿè¿è¡Œå¤šä¸ªå¤„ç†å™¨ä¸Šçš„é¡ºåºç¨‹åºï¼Œå¤šä¸ªå…±äº«å†…å­˜çš„æ‰§è¡Œæµ (å¤„ç†å™¨) æ€»æ˜¯æ‰§è¡Œå½“å‰æŒ‡ä»¤ã€‚CTE \", _jsx(_components.strong, {\n        children: \"å…è®¸ kernel ç®¡ç†å¼‚æ­¥çš„æ‰§è¡Œæµï¼Œå…è®¸æ¯ä¸ªå¤„ç†å™¨åˆ†åˆ«åœ¨ä¸­æ–­/å¼‚å¸¸å‘ç”Ÿæ—¶æ‰§è¡Œä»£ç ï¼Œå¹¶ä¿å­˜/åˆ‡æ¢åˆ°å…¶ä»–æ‰§è¡Œæµ\"\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"CTE å…è®¸åœ¨ç¨‹åºæ‰§è¡Œä¸­å¼•å…¥ä»¥ä¸‹å¼‚å¸¸ (trap) æ§åˆ¶æµï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ¥æºï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"å¤„ç†å™¨å¤–éƒ¨ä¸­æ–­ (æ—¶é’Ÿã€I/O è®¾å¤‡)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"æŒ‡ä»¤æ‰§è¡Œäº§ç”Ÿçš„å¼‚å¸¸ (ä¸»åŠ¨æ‰§è¡Œçš„ trap æŒ‡ä»¤å’Œ undefined behavior å¯¼è‡´çš„é”™è¯¯)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å¯¹äº VME ucontext åˆ›å»ºçš„ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œè®¿é—®æ˜ å°„æƒé™è¿åçš„åœ°å€äº§ç”Ÿçš„ç¼ºé¡µ\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨å¼‚å¸¸ (trap) å‘ç”Ÿåï¼Œä¼š\", _jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å€Ÿç”¨å½“å‰æ‰§è¡Œæµçš„æ ˆ\"\n        })\n      }), \"ï¼Œåœ¨æ ˆä¸Šä¿å­˜é¢å¤–çš„æ•°æ®å\", _jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å…³é—­ä¸­æ–­\"\n        })\n      }), \"ï¼Œç„¶å**\", _jsx(\"red\", {\n        children: \"ç›´æ¥åœ¨å½“å‰æ ˆä¸Š**\"\n      }), \"è°ƒç”¨ cte_init æ—¶æ³¨å†Œå¥½çš„ handler å‡½æ•°ã€‚handler è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰§è¡Œæµçš„æŒ‡é’ˆï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥æ‰§è¡Œæµæ‰§è¡Œã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šåˆ†åˆ«å“åº”ä¸­æ–­å’Œå¼‚å¸¸\"\n        })\n      }), \"ã€‚å½“ç³»ç»Ÿä¸­æœ‰å¤šä¸ªå¤„ç†å™¨æ—¶ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½å¯èƒ½åŒæ—¶å‘ç”Ÿä¸­æ–­/å¼‚å¸¸ï¼›ä½† AbstractMachine ä»£ç å®ç°ä¿è¯ä¸­æ–­å¤„ç†ä»…æ¶‰åŠå¤„ç†å™¨è‡ªèº«çš„çŠ¶æ€ (ä½†ä¼šä¿®æ”¹å¤„ç†å™¨çš„å†…æ ¸æ ˆ)ã€‚å› æ­¤ \", _jsx(_components.code, {\n        children: \"cte_init\"\n      }), \" ä¸­æ³¨å†Œçš„å¤„ç†ç¨‹åºåº”å½“å°å¿ƒæ•°æ®ç«äº‰çš„å‘ç”Ÿã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"5.1. \", _jsx(_components.code, {\n        children: \"cte_init\"\n      }), \": åˆå§‹åŒ–ä¸Šä¸‹æ–‡æ‰©å±•\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"bool\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"cte_init\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"(Context *(*handler)(Event ev, Context *ctx))\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"æ³¨å†Œä¸­æ–­/ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åºï¼šåœ¨ä¸­æ–­/å¼‚å¸¸/ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒAbstractMachine ä¼šç«‹å³ä¿å­˜å½“å‰æ‰§è¡Œæµçš„ä¸Šä¸‹æ–‡ (Context, åŒ…æ‹¬å¯„å­˜å™¨ç°åœºç­‰) åˆ°å½“å‰æ‰§è¡Œæµçš„å†…æ ¸æ ˆ (æ ˆç©ºé—´ç”± kcontext/ucontext æŒ‡å®š)ï¼Œç„¶åè°ƒç”¨ \", _jsx(_components.code, {\n        children: \"handler\"\n      }), \"ï¼Œå…¶ä¸­å‚æ•° \", _jsx(_components.code, {\n        children: \"ev\"\n      }), \" æ˜¯äº‹ä»¶çš„ç±»å‹ï¼š\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_ERROR\"\n        }), \"     - éæ³•è®¿é—®çš„å¼‚å¸¸ï¼Œä¾‹å¦‚ #GP\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_IRQ_TIMER\"\n        }), \" - æ—¶é’Ÿä¸­æ–­\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_IRQ_IODEV\"\n        }), \" - I/O è®¾å¤‡ä¸­æ–­ (é”®ç›˜ã€ä¸²å£â€¦â€¦)\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_PAGEFAULT\"\n        }), \" - ç¼ºé¡µå¼‚å¸¸\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_SYSCALL\"\n        }), \"   - ç³»ç»Ÿè°ƒç”¨\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"EVENT_YIELD\"\n        }), \"     - \", _jsx(_components.code, {\n          children: \"yield()\"\n        }), \" è‡ªé™·\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è€Œ \", _jsx(_components.code, {\n        children: \"ctx\"\n      }), \" æ˜¯æŒ‡å‘ä¿å­˜åœ¨å½“å‰æ‰§è¡Œæµä¿¡æ¯çš„æŒ‡é’ˆã€‚\", _jsx(_components.code, {\n        children: \"handler\"\n      }), \" å¯ä»¥è¿”å›ä»»ä½•åˆæ³•çš„ \", _jsx(_components.code, {\n        children: \"Context\"\n      }), \" (å¯ä»¥ç”± \", _jsx(_components.code, {\n        children: \"kcontext\"\n      }), \" åˆ›å»ºï¼Œæˆ–è€…æ˜¯æŸä¸ª \", _jsx(_components.code, {\n        children: \"handler\"\n      }), \" ä¿å­˜çš„å‚æ•°)ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"é™åˆ¶\"\n        })\n      }), \"ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ \", _jsx(_components.code, {\n        children: \"mpe_init\"\n      }), \" ä¹‹å‰ã€‚å¯ä»¥åœ¨ IOE ä¹‹å‰æˆ–ä¹‹ååˆå§‹åŒ–ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"ctx çš„ç”Ÿå­˜å‘¨æœŸ\"\n        })\n      }), \"ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æ‰§è¡Œæµï¼Œå®ƒå¯èƒ½æ˜¯ï¼š\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"MPE æœªå¯åŠ¨æ—¶çš„ \", _jsx(_components.code, {\n          children: \"main\"\n        }), \" å‡½æ•°çš„æ‰§è¡Œï¼Œå®ƒä½¿ç”¨ AbstractMachine (TRM) åˆå§‹åŒ–æ—¶çš„å†…æ ¸æ ˆï¼›\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"MPE å¯åŠ¨å \", _jsx(_components.code, {\n          children: \"mp_entry\"\n        }), \" å‡½æ•°çš„æ‰§è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨çš„ \", _jsx(_components.code, {\n          children: \"mp_entry\"\n        }), \" æ‰§è¡Œéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„å†…æ ¸æ ˆï¼›\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"å…¶ä»–ç”± \", _jsx(_components.code, {\n          children: \"kcontext\"\n        }), \" åˆ›å»ºçš„ä¸Šä¸‹æ–‡åœ¨ CPU ä¸Šçš„æ‰§è¡Œï¼Œåˆ›å»ºæ—¶ä¼šæŒ‡å®šä¸€ä¸ªå†…æ ¸æ ˆã€‚\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åœ¨ä¸­æ–­/å¼‚å¸¸å‘ç”Ÿåï¼Œ\", _jsxs(\"red\", {\n        children: [\"ä¸­æ–­/å¼‚å¸¸è¿”å›æ—¶çš„ context å°†ä¼šè¢«ä¿å­˜åœ¨å½“å‰æ‰§è¡Œæµçš„å †æ ˆä¸Šã€‚åªæœ‰å½“è¿™ä¸ªæ‰§è¡Œæµè¢«è°ƒåº¦æ‰§è¡Œ (å”¯ä¸€è¢«è°ƒåº¦æ‰§è¡Œçš„å¯èƒ½æ˜¯ \", _jsx(_components.code, {\n          children: \"handler()\"\n        }), \" çš„è¿”å›) åè¢«å¼¹å‡ºå †æ ˆ\"]\n      }), \"ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ \", _jsx(_components.code, {\n        children: \"handler\"\n      }), \" è¿”å›åˆ°å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆ \", _jsx(_components.code, {\n        children: \"ctx\"\n      }), \" æŒ‡é’ˆæŒ‡å‘çš„ä¸Šä¸‹æ–‡å°†ä¸€ç›´ä¿æŒæœ‰æ•ˆï¼Œç›´åˆ°è¿™ä¸€ä¸Šä¸‹æ–‡è¢«å†æ¬¡è°ƒåº¦æˆ–å†…æ ¸æ ˆè¢«é‡Šæ”¾ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"æ ˆçš„ä½¿ç”¨\"\n        })\n      }), \"ï¼šå› ä¸º trap ä¼šå€Ÿç”¨å½“å‰æ‰§è¡Œæµçš„å †æ ˆï¼Œå› æ­¤å¿…é¡»ä¿è¯\", _jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å½“å‰æ‰§è¡Œæµå®Œå…¨æ¸…é™¤æ ˆä¸Šçš„å†…å®¹åæ‰å¯ä»¥å°†æ‰§è¡Œæµåœ¨å¦ä¸€ä¸ªå¤„ç†å™¨ä¸Šå¼€å§‹æ‰§è¡Œ\"\n        })\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"5.2. \", _jsx(_components.code, {\n        children: \"iset/ienabled\"\n      }), \": å¤–éƒ¨ä¸­æ–­ç®¡ç†\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"bool\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ienabled\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \")\"]\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"iset\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"bool\"\n          }), \" enable)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"è¯»å–/å†™å…¥å½“å‰å¤„ç†å™¨çš„ä¸­æ–­æ‰“å¼€/å±è”½çŠ¶æ€ã€‚å…¶ä¸­ \", _jsx(_components.code, {\n        children: \"ienabled/iset\"\n      }), \" çš„ \", _jsx(_components.code, {\n        children: \"true\"\n      }), \"/\", _jsx(_components.code, {\n        children: \"false\"\n      }), \" åˆ†åˆ«è¡¨ç¤ºä¸­æ–­æ‰“å¼€/å…³é—­ã€‚æ³¨æ„ä¸­æ–­å…³é—­åªèƒ½å±è”½å¤„ç†å™¨å¤–çš„ä¸­æ–­ (å³ \", _jsx(_components.code, {\n        children: \"EVENT_IRQ_TIMER\"\n      }), \" å’Œ \", _jsx(_components.code, {\n        children: \"EVENT_IRQ_IODEV\"\n      }), \")ï¼Œå¤„ç†å™¨åŒæ­¥äº§ç”Ÿçš„ error, page fault, syscall å’Œ yield ä¸èƒ½å±è”½ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼›\", _jsx(_components.code, {\n        children: \"ienabled/iset\"\n      }), \" ä»…èƒ½å½±å“å½“å‰æ‰§è¡ŒæŒ‡ä»¤ CPU çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œä¸èƒ½å…³é—­/æŸ¥è¯¢å…¶ä»–å¤„ç†å™¨çš„ä¸­æ–­çŠ¶æ€ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"5.3. \", _jsx(_components.code, {\n        children: \"yield\"\n      }), \": Self-Trapping\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"yield\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"()\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"é™·å…¥å†…æ ¸æ‰§è¡Œï¼Œå°†ä¼šåœ¨å½“å‰å¤„ç†å™¨ä¸Šè°ƒç”¨ \", _jsx(_components.code, {\n        children: \"handler(EVENT_YIELD, saved_context)\"\n      }), \"ï¼Œå…¶ä¸­ \", _jsx(_components.code, {\n        children: \"saved_context\"\n      }), \" æ˜¯ä¿å­˜çš„å½“å‰å†…æ ¸ä¸Šä¸‹æ–‡ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ï¼šæ‰§è¡Œ \", _jsx(_components.code, {\n        children: \"yield\"\n      }), \" çš„å½“å‰å¤„ç†å™¨ä¼šå®Œæˆ self-trappingã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"5.4. \", _jsx(_components.code, {\n        children: \"kcontext\"\n      }), \": åˆ›å»ºå†…æ ¸æ€è¿è¡Œçš„ä¸Šä¸‹æ–‡\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [\"Context *\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"kcontext\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(Area kstack, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" (*entry)(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *), \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *arg)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å°† \", _jsx(_components.code, {\n        children: \"kstack\"\n      }), \" è¡¨ç¤ºçš„ä¸€æ®µå†…å­˜ä½œä¸ºå†…æ ¸æ ˆä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„å†…æ ¸æ€ä¸Šä¸‹æ–‡ï¼Œè¿”å›çš„ \", _jsx(_components.code, {\n        children: \"Context\"\n      }), \" æŒ‡é’ˆå¯ä»¥åœ¨ä¸­æ–­è¿”å›æ—¶è¢«è°ƒåº¦åˆ°å¤„ç†å™¨ä¸Šæ‰§è¡Œã€‚é¦–æ¬¡æ‰§è¡Œè¿”å›çš„ä¸Šä¸‹æ–‡ä¸­ PC ä¸º \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \"ï¼Œå¹¶æ­£ç¡®ä¸º \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \" å‡½æ•°ä¼ é€’äº† \", _jsx(_components.code, {\n        children: \"arg\"\n      }), \" å‚æ•°ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ï¼Œä½†è¦æ³¨æ„ kstack åŒºåŸŸçš„åˆæ³•æ€§ï¼Œä¾‹å¦‚ data race æˆ– double allocation éƒ½å¯¼è‡´ undefined behaviorã€‚\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"6. VME (Virtual Memory Extension) è™šæ‹Ÿåœ°å€ç©ºé—´\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"VME å…è®¸ä¸ºæ‰§è¡Œæµ (ä¸Šä¸‹æ–‡ Context) èµ‹äºˆä¸€ä¸ª â€œè™šæ‹Ÿâ€ çš„å†…å­˜è§†å›¾ï¼Œæ¯å½“è®¿é—®ä»»ä½•å†…å­˜ \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsx(_components.mi, {\n                  children: \"x\"\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"x\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.4306em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"x\"\n            })]\n          })\n        })]\n      }), \" çš„æ—¶å€™ï¼Œéƒ½å–è®¿é—® \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsxs(_components.mrow, {\n                children: [_jsx(_components.mi, {\n                  children: \"f\"\n                }), _jsx(_components.mo, {\n                  stretchy: \"false\",\n                  children: \"(\"\n                }), _jsx(_components.mi, {\n                  children: \"x\"\n                }), _jsx(_components.mo, {\n                  stretchy: \"false\",\n                  children: \")\"\n                })]\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"f(x)\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"1em\",\n                verticalAlign: \"-0.25em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              style: {\n                marginRight: \"0.10764em\"\n              },\n              children: \"f\"\n            }), _jsx(_components.span, {\n              className: \"mopen\",\n              children: \"(\"\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              children: \"x\"\n            }), _jsx(_components.span, {\n              className: \"mclose\",\n              children: \")\"\n            })]\n          })\n        })]\n      }), \"ã€‚VME æä¾›äº†æè¿°ã€ä¿®æ”¹æ•°æ®ç»“æ„ \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsx(_components.mi, {\n                  children: \"f\"\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"f\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.8889em\",\n                verticalAlign: \"-0.1944em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mord mathnormal\",\n              style: {\n                marginRight: \"0.10764em\"\n              },\n              children: \"f\"\n            })]\n          })\n        })]\n      }), \" çš„æœºåˆ¶ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"é™åˆ¶\"\n        })\n      }), \"ï¼šåœ¨ä¸€æ¬¡ kernel è¿è¡Œä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”å¿…é¡»åœ¨ \", _jsx(_components.code, {\n        children: \"mpe_init\"\n      }), \" ä¹‹å‰ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"6.1. \", _jsx(_components.code, {\n        children: \"vme_init\"\n      }), \": åˆå§‹åŒ–è™šå­˜ç®¡ç†\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"bool\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"vme_init\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *(*pgalloc)(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \"), \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" (*pgfree)(\", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *))\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åˆå§‹åŒ–è™šæ‹Ÿå­˜å‚¨ã€‚\", _jsx(_components.code, {\n        children: \"pgalloc\"\n      }), \"ã€\", _jsx(_components.code, {\n        children: \"pgfree\"\n      }), \" å‡½æ•°åˆ†åˆ«ç”¨äºä¸€ä¸ªç‰©ç†é¡µé¢çš„åˆ†é…å’Œå›æ”¶ã€‚æ³¨æ„ \", _jsx(_components.code, {\n        children: \"vme_init\"\n      }), \" æ‰§è¡Œæ—¶å°±å¯èƒ½è°ƒç”¨ \", _jsx(_components.code, {\n        children: \"pgalloc\"\n      }), \"/\", _jsx(_components.code, {\n        children: \"pgfree\"\n      }), \"ï¼Œä½ éœ€è¦ç¡®ä¿å®ƒä»¬åœ¨ vme_init è°ƒç”¨æ—¶å¤„äºå¯ç”¨çŠ¶æ€ã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šæ³¨æ„\"\n        })\n      }), \"ï¼špgalloc/pgfree ä¼šåœ¨ protect, unprotect å’Œ map ä¸­è¢«è°ƒç”¨ï¼Œå› æ­¤è¯·ç¡®ä¿ä½ çš„ pgalloc/pgfree æ˜¯å¤šå¤„ç†å™¨å®‰å…¨çš„ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"6.2. \", _jsx(_components.code, {\n        children: \"protect\"\n      }), \"/\", _jsx(_components.code, {\n        children: \"unprotect\"\n      }), \": åœ°å€ç©ºé—´ç®¡ç†\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"protect\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"(AddrSpace *as)\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"unprotect\"\n        }), _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"(AddrSpace *as)\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"åˆ›å»º/é”€æ¯ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œå…¶ä¸­ \", _jsx(_components.code, {\n        children: \"protect(as)\"\n      }), \" åï¼Œ\", _jsx(_components.code, {\n        children: \"as\"\n      }), \" ä¼šè¢«åˆå§‹åŒ–ï¼š\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"as-\u003epgsize\"\n        }), \" æ˜¯é¡µé¢çš„å¤§å° (AbstractMachine å¯èƒ½è¿”å›ä¸å®é™…æœºå™¨ä¸åŒçš„é¡µé¢å¤§å°)ã€‚\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"as-\u003earea\"\n        }), \" æ˜¯è¢«ä¿æŠ¤çš„ (ç”¨æˆ·æ€å¯è®¿é—®) åœ°å€ç©ºé—´èŒƒå›´ã€‚\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"as-\u003eptr\"\n        }), \" æ˜¯ AbstractMachine ç§æœ‰çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ x86-qemu çš„å®ç°æ˜¯ CR3 å¯„å­˜å™¨çš„æ•°å€¼ã€‚\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šæ³¨æ„\"\n        })\n      }), \"ã€‚protect/unprotect ä¼šè°ƒç”¨ pgalloc/pgfree åˆ†é…æˆ–é‡Šæ”¾é¡µé¢ï¼Œå¹¶ä¼šå†™å…¥ \", _jsx(_components.code, {\n        children: \"as\"\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"6.3. \", _jsx(_components.code, {\n        children: \"map\"\n      }), \": ä¿®æ”¹åœ°å€ç©ºé—´æ˜ å°„\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"map\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(AddrSpace *as, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *vaddr, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *paddr, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" prot)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"å¯¹åœ°å€ç©ºé—´ \", _jsx(_components.code, {\n        children: \"as\"\n      }), \" å»ºç«‹ \", _jsx(_components.code, {\n        children: \"vaddr\"\n      }), \" \", _jsxs(_components.span, {\n        className: \"katex\",\n        children: [_jsx(_components.span, {\n          className: \"katex-mathml\",\n          children: _jsx(_components.math, {\n            xmlns: \"http://www.w3.org/1998/Math/MathML\",\n            children: _jsxs(_components.semantics, {\n              children: [_jsx(_components.mrow, {\n                children: _jsx(_components.mo, {\n                  children: \"â†’\"\n                })\n              }), _jsx(_components.annotation, {\n                encoding: \"application/x-tex\",\n                children: \"\\\\to\"\n              })]\n            })\n          })\n        }), _jsx(_components.span, {\n          className: \"katex-html\",\n          \"aria-hidden\": \"true\",\n          children: _jsxs(_components.span, {\n            className: \"base\",\n            children: [_jsx(_components.span, {\n              className: \"strut\",\n              style: {\n                height: \"0.3669em\"\n              }\n            }), _jsx(_components.span, {\n              className: \"mrel\",\n              children: \"â†’\"\n            })]\n          })\n        })]\n      }), \" \", _jsx(_components.code, {\n        children: \"paddr\"\n      }), \" çš„æ˜ å°„ï¼Œå½“ \", _jsx(_components.code, {\n        children: \"paddr\"\n      }), \" ä¸º \", _jsx(_components.code, {\n        children: \"NULL\"\n      }), \" æ—¶ï¼Œå–æ¶ˆè¯¥é¡µé¢çš„æ˜ å°„ã€‚prot ç”±ä»¥ä¸‹ flag ç»„æˆã€‚æ³¨æ„ \", _jsx(_components.code, {\n        children: \"vaddr\"\n      }), \" å’Œ \", _jsx(_components.code, {\n        children: \"paddr\"\n      }), \" å¿…é¡»å¯¹é½åˆ°é¡µé¢è¾¹ç•Œ (\", _jsx(_components.code, {\n        children: \"as-\u003epgsize\"\n      }), \")ï¼Œä¸” \", _jsx(_components.code, {\n        children: \"vaddr\"\n      }), \" å¿…é¡»ä½äº \", _jsx(_components.code, {\n        children: \"as-\u003earea\"\n      }), \"ã€\", _jsx(_components.code, {\n        children: \"paddr\"\n      }), \" æŒ‡å‘çš„é¡µé¢ä½äº \", _jsx(_components.code, {\n        children: \"heap\"\n      }), \"ã€‚\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [_jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"define\"\n          }), \" MMAP_NONE  0x00000000 \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// no access\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"define\"\n          }), \" MMAP_READ  0x00000001 \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// can read\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"#\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"define\"\n          }), \" MMAP_WRITE 0x00000002 \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// can write\"\n          })]\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"red\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šæ³¨æ„\"\n        })\n      }), \"ã€‚map ä¼šè°ƒç”¨ pgalloc/pgfree åˆ†é…æˆ–é‡Šæ”¾é¡µé¢ã€‚\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"6.4. \", _jsx(_components.code, {\n        children: \"ucontext\"\n      }), \": åˆ›å»ºè¢«ä¿æŠ¤çš„ç”¨æˆ·æ€è¿›ç¨‹ä¸Šä¸‹æ–‡\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-c\",\n        children: [\"Context *\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ucontext\"\n        }), _jsxs(_components.span, {\n          className: \"hljs-params\",\n          children: [\"(AddrSpace *as, Area kstack, \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"void\"\n          }), \" *entry)\"]\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ä¸ \", _jsx(_components.code, {\n        children: \"kcontext\"\n      }), \" ç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ªå¯è¢«è°ƒåº¦æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå®ƒçš„æ‰§è¡Œä½äºä½æƒé™çš„ç”¨æˆ·æ€ï¼Œåœ°å€ç©ºé—´ç”± \", _jsx(_components.code, {\n        children: \"as\"\n      }), \" æŒ‡å®šï¼Œåˆå§‹ PC ä¸º \", _jsx(_components.code, {\n        children: \"entry\"\n      }), \"ã€‚åœ¨ç”¨æˆ·æ€å‘ç”Ÿä¸­æ–­/å¼‚å¸¸ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ (kernel) è¿è¡Œï¼Œå¹¶åˆ‡æ¢åˆ°å†…æ ¸æ ˆã€‚ä¸­æ–­/å¼‚å¸¸å¤„ç†ç¨‹åº (åŒ…æ‹¬ä¿å­˜çš„ä¸Šä¸‹æ–‡) éƒ½å­˜å‚¨åœ¨ \", _jsx(_components.code, {\n        children: \"kstack\"\n      }), \" æŒ‡å®šçš„å†…æ ¸æ ˆã€‚\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(\"green\", {\n        children: _jsx(_components.strong, {\n          children: \"å¤šå¤„ç†å™¨ï¼šå®‰å…¨\"\n        })\n      }), \"ã€‚\", _jsx(_components.code, {\n        children: \"ucontext\"\n      }), \" ä»…ä¿®æ”¹ \", _jsx(_components.code, {\n        children: \"kstack\"\n      }), \" ä¸­çš„æ•°å€¼ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸Šä¸‹æ–‡ã€‚\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"frontmatter":{}},"__N_SSG":true},"page":"/[[...index]]","query":{"index":["AbstractMachine","AM_Spec.md"]},"buildId":"a2FwJzUPGFGc0QcwaUr13","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body>
</html>